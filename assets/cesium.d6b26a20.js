function e(e){return null!=e}function t(e){var t;this.name="DeveloperError",this.message=e;try{throw new Error}catch(n){t=n.stack}this.stack=t}e(Object.create)&&(t.prototype=Object.create(Error.prototype),t.prototype.constructor=t),t.prototype.toString=function(){var t=this.name+": "+this.message;return e(this.stack)&&(t+="\n"+this.stack.toString()),t},t.throwInstantiationError=function(){throw new t("This function defines an interface and should not be called directly.")};var n={};function r(e,t,n){return"Expected "+n+" to be typeof "+t+", actual typeof was "+e}function i(e,t){return null!=e?e:t}function o(e){null==e&&(e=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,this.init_genrand(e)}n.typeOf={},n.defined=function(n,r){if(!e(r))throw new t(function(e){return e+" is required, actual value was undefined"}(n))},n.typeOf.func=function(e,n){if("function"!=typeof n)throw new t(r(typeof n,"function",e))},n.typeOf.string=function(e,n){if("string"!=typeof n)throw new t(r(typeof n,"string",e))},n.typeOf.number=function(e,n){if("number"!=typeof n)throw new t(r(typeof n,"number",e))},n.typeOf.number.lessThan=function(e,r,i){if(n.typeOf.number(e,r),r>=i)throw new t("Expected "+e+" to be less than "+i+", actual value was "+r)},n.typeOf.number.lessThanOrEquals=function(e,r,i){if(n.typeOf.number(e,r),r>i)throw new t("Expected "+e+" to be less than or equal to "+i+", actual value was "+r)},n.typeOf.number.greaterThan=function(e,r,i){if(n.typeOf.number(e,r),r<=i)throw new t("Expected "+e+" to be greater than "+i+", actual value was "+r)},n.typeOf.number.greaterThanOrEquals=function(e,r,i){if(n.typeOf.number(e,r),r<i)throw new t("Expected "+e+" to be greater than or equal to"+i+", actual value was "+r)},n.typeOf.object=function(e,n){if("object"!=typeof n)throw new t(r(typeof n,"object",e))},n.typeOf.bool=function(e,n){if("boolean"!=typeof n)throw new t(r(typeof n,"boolean",e))},n.typeOf.number.equals=function(e,r,i,o){if(n.typeOf.number(e,i),n.typeOf.number(r,o),i!==o)throw new t(e+" must be equal to "+r+", the actual values are "+i+" and "+o)},i.EMPTY_OBJECT=Object.freeze({}),o.prototype.init_genrand=function(e){for(this.mt[0]=e>>>0,this.mti=1;this.mti<this.N;this.mti++){e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&e)>>>16)<<16)+1812433253*(65535&e)+this.mti,this.mt[this.mti]>>>=0}},o.prototype.genrand_int32=function(){var e,t=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var n;for(this.mti==this.N+1&&this.init_genrand(5489),n=0;n<this.N-this.M;n++)e=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+this.M]^e>>>1^t[1&e];for(;n<this.N-1;n++)e=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+(this.M-this.N)]^e>>>1^t[1&e];e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^t[1&e],this.mti=0}return e=this.mt[this.mti++],e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,(e^=e>>>18)>>>0},o.prototype.random=function(){return this.genrand_int32()*(1/4294967296)};var a={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,EPSILON21:1e-21,GRAVITATIONALPARAMETER:3986004418e5,SOLAR_RADIUS:6955e5,LUNAR_RADIUS:1737400,SIXTY_FOUR_KILOBYTES:65536,FOUR_GIGABYTES:4294967296};a.sign=i(Math.sign,(function(e){return 0===(e=+e)||e!=e?e:e>0?1:-1})),a.signNotZero=function(e){return e<0?-1:1},a.toSNorm=function(e,t){return t=i(t,255),Math.round((.5*a.clamp(e,-1,1)+.5)*t)},a.fromSNorm=function(e,t){return t=i(t,255),a.clamp(e,0,t)/t*2-1},a.normalize=function(e,t,n){return 0===(n=Math.max(n-t,0))?0:a.clamp((e-t)/n,0,1)},a.sinh=i(Math.sinh,(function(e){return(Math.exp(e)-Math.exp(-e))/2})),a.cosh=i(Math.cosh,(function(e){return(Math.exp(e)+Math.exp(-e))/2})),a.lerp=function(e,t,n){return(1-n)*e+n*t},a.PI=Math.PI,a.ONE_OVER_PI=1/Math.PI,a.PI_OVER_TWO=Math.PI/2,a.PI_OVER_THREE=Math.PI/3,a.PI_OVER_FOUR=Math.PI/4,a.PI_OVER_SIX=Math.PI/6,a.THREE_PI_OVER_TWO=3*Math.PI/2,a.TWO_PI=2*Math.PI,a.ONE_OVER_TWO_PI=1/(2*Math.PI),a.RADIANS_PER_DEGREE=Math.PI/180,a.DEGREES_PER_RADIAN=180/Math.PI,a.RADIANS_PER_ARCSECOND=a.RADIANS_PER_DEGREE/3600,a.toRadians=function(e){return e*a.RADIANS_PER_DEGREE},a.toDegrees=function(e){return e*a.DEGREES_PER_RADIAN},a.convertLongitudeRange=function(e){var t=a.TWO_PI,n=e-Math.floor(e/t)*t;return n<-Math.PI?n+t:n>=Math.PI?n-t:n},a.clampToLatitudeRange=function(e){return a.clamp(e,-1*a.PI_OVER_TWO,a.PI_OVER_TWO)},a.negativePiToPi=function(e){return a.zeroToTwoPi(e+a.PI)-a.PI},a.zeroToTwoPi=function(e){var t=a.mod(e,a.TWO_PI);return Math.abs(t)<a.EPSILON14&&Math.abs(e)>a.EPSILON14?a.TWO_PI:t},a.mod=function(e,t){return(e%t+t)%t},a.equalsEpsilon=function(e,t,n,r){n=i(n,0),r=i(r,n);var o=Math.abs(e-t);return o<=r||o<=n*Math.max(Math.abs(e),Math.abs(t))},a.lessThan=function(e,t,n){return e-t<-n},a.lessThanOrEquals=function(e,t,n){return e-t<n},a.greaterThan=function(e,t,n){return e-t>n},a.greaterThanOrEquals=function(e,t,n){return e-t>-n};var s=[1];a.factorial=function(e){var t=s.length;if(e>=t)for(var n=s[t-1],r=t;r<=e;r++){var i=n*r;s.push(i),n=i}return s[e]},a.incrementWrap=function(e,t,n){return n=i(n,0),++e>t&&(e=n),e},a.isPowerOfTwo=function(e){return 0!==e&&0==(e&e-1)},a.nextPowerOfTwo=function(e){return--e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},a.clamp=function(e,t,n){return e<t?t:e>n?n:e};var u=new o;function c(e,t){this.x=i(e,0),this.y=i(t,0)}a.setRandomNumberSeed=function(e){u=new o(e)},a.nextRandomNumber=function(){return u.random()},a.randomBetween=function(e,t){return a.nextRandomNumber()*(t-e)+e},a.acosClamped=function(e){return Math.acos(a.clamp(e,-1,1))},a.asinClamped=function(e){return Math.asin(a.clamp(e,-1,1))},a.chordLength=function(e,t){return 2*t*Math.sin(.5*e)},a.logBase=function(e,t){return Math.log(e)/Math.log(t)},a.cbrt=i(Math.cbrt,(function(e){var t=Math.pow(Math.abs(e),1/3);return e<0?-t:t})),a.log2=i(Math.log2,(function(e){return Math.log(e)*Math.LOG2E})),a.fog=function(e,t){var n=e*t;return 1-Math.exp(-n*n)},a.fastApproximateAtan=function(e){return e*(-.1784*Math.abs(e)-.0663*e*e+1.0301)},a.fastApproximateAtan2=function(e,t){var n,r,i=Math.abs(e);n=Math.abs(t),r=Math.max(i,n);var o=(n=Math.min(i,n))/r;return i=a.fastApproximateAtan(o),i=Math.abs(t)>Math.abs(e)?a.PI_OVER_TWO-i:i,i=e<0?a.PI-i:i,i=t<0?-i:i},c.fromElements=function(t,n,r){return e(r)?(r.x=t,r.y=n,r):new c(t,n)},c.clone=function(t,n){if(e(t))return e(n)?(n.x=t.x,n.y=t.y,n):new c(t.x,t.y)},c.fromCartesian3=c.clone,c.fromCartesian4=c.clone,c.packedLength=2,c.pack=function(e,t,n){return n=i(n,0),t[n++]=e.x,t[n]=e.y,t},c.unpack=function(t,n,r){return n=i(n,0),e(r)||(r=new c),r.x=t[n++],r.y=t[n],r},c.packArray=function(n,r){var i=n.length,o=2*i;if(e(r)){if(!Array.isArray(r)&&r.length!==o)throw new t("If result is a typed array, it must have exactly array.length * 2 elements");r.length!==o&&(r.length=o)}else r=new Array(o);for(var a=0;a<i;++a)c.pack(n[a],r,2*a);return r},c.unpackArray=function(t,n){var r=t.length;e(n)?n.length=r/2:n=new Array(r/2);for(var i=0;i<r;i+=2){var o=i/2;n[o]=c.unpack(t,i,n[o])}return n},c.fromArray=c.unpack,c.maximumComponent=function(e){return Math.max(e.x,e.y)},c.minimumComponent=function(e){return Math.min(e.x,e.y)},c.minimumByComponent=function(e,t,n){return n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n},c.maximumByComponent=function(e,t,n){return n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n},c.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},c.magnitude=function(e){return Math.sqrt(c.magnitudeSquared(e))};var l=new c;c.distance=function(e,t){return c.subtract(e,t,l),c.magnitude(l)},c.distanceSquared=function(e,t){return c.subtract(e,t,l),c.magnitudeSquared(l)},c.normalize=function(e,t){var n=c.magnitude(e);return t.x=e.x/n,t.y=e.y/n,t},c.dot=function(e,t){return e.x*t.x+e.y*t.y},c.cross=function(e,t){return e.x*t.y-e.y*t.x},c.multiplyComponents=function(e,t,n){return n.x=e.x*t.x,n.y=e.y*t.y,n},c.divideComponents=function(e,t,n){return n.x=e.x/t.x,n.y=e.y/t.y,n},c.add=function(e,t,n){return n.x=e.x+t.x,n.y=e.y+t.y,n},c.subtract=function(e,t,n){return n.x=e.x-t.x,n.y=e.y-t.y,n},c.multiplyByScalar=function(e,t,n){return n.x=e.x*t,n.y=e.y*t,n},c.divideByScalar=function(e,t,n){return n.x=e.x/t,n.y=e.y/t,n},c.negate=function(e,t){return t.x=-e.x,t.y=-e.y,t},c.abs=function(e,t){return t.x=Math.abs(e.x),t.y=Math.abs(e.y),t};var h=new c;c.lerp=function(e,t,n,r){return c.multiplyByScalar(t,n,h),r=c.multiplyByScalar(e,1-n,r),c.add(h,r,r)};var d=new c,f=new c;c.angleBetween=function(e,t){return c.normalize(e,d),c.normalize(t,f),a.acosClamped(c.dot(d,f))};var m=new c;function p(e,t,n){this.x=i(e,0),this.y=i(t,0),this.z=i(n,0)}c.mostOrthogonalAxis=function(e,t){var n=c.normalize(e,m);return c.abs(n,n),t=n.x<=n.y?c.clone(c.UNIT_X,t):c.clone(c.UNIT_Y,t)},c.equals=function(t,n){return t===n||e(t)&&e(n)&&t.x===n.x&&t.y===n.y},c.equalsArray=function(e,t,n){return e.x===t[n]&&e.y===t[n+1]},c.equalsEpsilon=function(t,n,r,i){return t===n||e(t)&&e(n)&&a.equalsEpsilon(t.x,n.x,r,i)&&a.equalsEpsilon(t.y,n.y,r,i)},c.ZERO=Object.freeze(new c(0,0)),c.UNIT_X=Object.freeze(new c(1,0)),c.UNIT_Y=Object.freeze(new c(0,1)),c.prototype.clone=function(e){return c.clone(this,e)},c.prototype.equals=function(e){return c.equals(this,e)},c.prototype.equalsEpsilon=function(e,t,n){return c.equalsEpsilon(this,e,t,n)},c.prototype.toString=function(){return"("+this.x+", "+this.y+")"},p.fromSpherical=function(t,n){e(n)||(n=new p);var r=t.clock,o=t.cone,a=i(t.magnitude,1),s=a*Math.sin(o);return n.x=s*Math.cos(r),n.y=s*Math.sin(r),n.z=a*Math.cos(o),n},p.fromElements=function(t,n,r,i){return e(i)?(i.x=t,i.y=n,i.z=r,i):new p(t,n,r)},p.clone=function(t,n){if(e(t))return e(n)?(n.x=t.x,n.y=t.y,n.z=t.z,n):new p(t.x,t.y,t.z)},p.fromCartesian4=p.clone,p.packedLength=3,p.pack=function(e,t,n){return n=i(n,0),t[n++]=e.x,t[n++]=e.y,t[n]=e.z,t},p.unpack=function(t,n,r){return n=i(n,0),e(r)||(r=new p),r.x=t[n++],r.y=t[n++],r.z=t[n],r},p.packArray=function(n,r){var i=n.length,o=3*i;if(e(r)){if(!Array.isArray(r)&&r.length!==o)throw new t("If result is a typed array, it must have exactly array.length * 3 elements");r.length!==o&&(r.length=o)}else r=new Array(o);for(var a=0;a<i;++a)p.pack(n[a],r,3*a);return r},p.unpackArray=function(t,n){var r=t.length;e(n)?n.length=r/3:n=new Array(r/3);for(var i=0;i<r;i+=3){var o=i/3;n[o]=p.unpack(t,i,n[o])}return n},p.fromArray=p.unpack,p.maximumComponent=function(e){return Math.max(e.x,e.y,e.z)},p.minimumComponent=function(e){return Math.min(e.x,e.y,e.z)},p.minimumByComponent=function(e,t,n){return n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.z=Math.min(e.z,t.z),n},p.maximumByComponent=function(e,t,n){return n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n.z=Math.max(e.z,t.z),n},p.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y+e.z*e.z},p.magnitude=function(e){return Math.sqrt(p.magnitudeSquared(e))};var _=new p;p.distance=function(e,t){return p.subtract(e,t,_),p.magnitude(_)},p.distanceSquared=function(e,t){return p.subtract(e,t,_),p.magnitudeSquared(_)},p.normalize=function(e,t){var n=p.magnitude(e);return t.x=e.x/n,t.y=e.y/n,t.z=e.z/n,t},p.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},p.multiplyComponents=function(e,t,n){return n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z,n},p.divideComponents=function(e,t,n){return n.x=e.x/t.x,n.y=e.y/t.y,n.z=e.z/t.z,n},p.add=function(e,t,n){return n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n},p.subtract=function(e,t,n){return n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n},p.multiplyByScalar=function(e,t,n){return n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n},p.divideByScalar=function(e,t,n){return n.x=e.x/t,n.y=e.y/t,n.z=e.z/t,n},p.negate=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},p.abs=function(e,t){return t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t};var g=new p;p.lerp=function(e,t,n,r){return p.multiplyByScalar(t,n,g),r=p.multiplyByScalar(e,1-n,r),p.add(g,r,r)};var v=new p,y=new p;p.angleBetween=function(e,t){p.normalize(e,v),p.normalize(t,y);var n=p.dot(v,y),r=p.magnitude(p.cross(v,y,v));return Math.atan2(r,n)};var T=new p;p.mostOrthogonalAxis=function(e,t){var n=p.normalize(e,T);return p.abs(n,n),t=n.x<=n.y?n.x<=n.z?p.clone(p.UNIT_X,t):p.clone(p.UNIT_Z,t):n.y<=n.z?p.clone(p.UNIT_Y,t):p.clone(p.UNIT_Z,t)},p.projectVector=function(e,t,n){var r=p.dot(e,t)/p.dot(t,t);return p.multiplyByScalar(t,r,n)},p.equals=function(t,n){return t===n||e(t)&&e(n)&&t.x===n.x&&t.y===n.y&&t.z===n.z},p.equalsArray=function(e,t,n){return e.x===t[n]&&e.y===t[n+1]&&e.z===t[n+2]},p.equalsEpsilon=function(t,n,r,i){return t===n||e(t)&&e(n)&&a.equalsEpsilon(t.x,n.x,r,i)&&a.equalsEpsilon(t.y,n.y,r,i)&&a.equalsEpsilon(t.z,n.z,r,i)},p.cross=function(e,t,n){var r=e.x,i=e.y,o=e.z,a=t.x,s=t.y,u=t.z,c=i*u-o*s,l=o*a-r*u,h=r*s-i*a;return n.x=c,n.y=l,n.z=h,n},p.midpoint=function(e,t,n){return n.x=.5*(e.x+t.x),n.y=.5*(e.y+t.y),n.z=.5*(e.z+t.z),n},p.fromDegrees=function(e,t,n,r,i){return e=a.toRadians(e),t=a.toRadians(t),p.fromRadians(e,t,n,r,i)};var E=new p,x=new p,C=new p(40680631590769,40680631590769,40408299984661.445);p.fromRadians=function(t,n,r,o,a){r=i(r,0);var s=e(o)?o.radiiSquared:C,u=Math.cos(n);E.x=u*Math.cos(t),E.y=u*Math.sin(t),E.z=Math.sin(n),E=p.normalize(E,E),p.multiplyComponents(s,E,x);var c=Math.sqrt(p.dot(E,x));return x=p.divideByScalar(x,c,x),E=p.multiplyByScalar(E,r,E),e(a)||(a=new p),p.add(x,E,a)},p.fromDegreesArray=function(t,n,r){var i=t.length;e(r)?r.length=i/2:r=new Array(i/2);for(var o=0;o<i;o+=2){var a=t[o],s=t[o+1],u=o/2;r[u]=p.fromDegrees(a,s,0,n,r[u])}return r},p.fromRadiansArray=function(t,n,r){var i=t.length;e(r)?r.length=i/2:r=new Array(i/2);for(var o=0;o<i;o+=2){var a=t[o],s=t[o+1],u=o/2;r[u]=p.fromRadians(a,s,0,n,r[u])}return r},p.fromDegreesArrayHeights=function(t,n,r){var i=t.length;e(r)?r.length=i/3:r=new Array(i/3);for(var o=0;o<i;o+=3){var a=t[o],s=t[o+1],u=t[o+2],c=o/3;r[c]=p.fromDegrees(a,s,u,n,r[c])}return r},p.fromRadiansArrayHeights=function(t,n,r){var i=t.length;e(r)?r.length=i/3:r=new Array(i/3);for(var o=0;o<i;o+=3){var a=t[o],s=t[o+1],u=t[o+2],c=o/3;r[c]=p.fromRadians(a,s,u,n,r[c])}return r},p.ZERO=Object.freeze(new p(0,0,0)),p.UNIT_X=Object.freeze(new p(1,0,0)),p.UNIT_Y=Object.freeze(new p(0,1,0)),p.UNIT_Z=Object.freeze(new p(0,0,1)),p.prototype.clone=function(e){return p.clone(this,e)},p.prototype.equals=function(e){return p.equals(this,e)},p.prototype.equalsEpsilon=function(e,t,n){return p.equalsEpsilon(this,e,t,n)},p.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};var S={octEncodeInRange:function(e,t,n){if(n.x=e.x/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),n.y=e.y/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),e.z<0){var r=n.x,i=n.y;n.x=(1-Math.abs(i))*a.signNotZero(r),n.y=(1-Math.abs(r))*a.signNotZero(i)}return n.x=a.toSNorm(n.x,t),n.y=a.toSNorm(n.y,t),n},octEncode:function(e,t){return S.octEncodeInRange(e,255,t)}},A=new c,w=new Uint8Array(1);function b(e){return w[0]=e,w[0]}S.octEncodeToCartesian4=function(e,t){return S.octEncodeInRange(e,65535,A),t.x=b(.00390625*A.x),t.y=b(A.x),t.z=b(.00390625*A.y),t.w=b(A.y),t},S.octDecodeInRange=function(e,t,n,r){if(r.x=a.fromSNorm(e,n),r.y=a.fromSNorm(t,n),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){var i=r.x;r.x=(1-Math.abs(r.y))*a.signNotZero(i),r.y=(1-Math.abs(i))*a.signNotZero(r.y)}return p.normalize(r,r)},S.octDecode=function(e,t,n){return S.octDecodeInRange(e,t,255,n)},S.octDecodeFromCartesian4=function(e,t){var n=256*e.x+e.y,r=256*e.z+e.w;return S.octDecodeInRange(n,r,65535,t)},S.octPackFloat=function(e){return 256*e.x+e.y};var D=new c;function I(e){return e>>1^-(1&e)}S.octEncodeFloat=function(e){return S.octEncode(e,D),S.octPackFloat(D)},S.octDecodeFloat=function(e,t){var n=e/256,r=Math.floor(n),i=256*(n-r);return S.octDecode(r,i,t)},S.octPack=function(e,t,n,r){var i=S.octEncodeFloat(e),o=S.octEncodeFloat(t),a=S.octEncode(n,D);return r.x=65536*a.x+i,r.y=65536*a.y+o,r},S.octUnpack=function(e,t,n,r){var i=e.x/65536,o=Math.floor(i),a=65536*(i-o);i=e.y/65536;var s=Math.floor(i),u=65536*(i-s);S.octDecodeFloat(a,t),S.octDecodeFloat(u,n),S.octDecode(o,s,r)},S.compressTextureCoordinates=function(e){return 4096*(4095*e.x|0)+(4095*e.y|0)},S.decompressTextureCoordinates=function(e,t){var n=e/4096,r=Math.floor(n);return t.x=r/4095,t.y=(e-4096*r)/4095,t},S.zigZagDeltaDecode=function(t,n,r){for(var i=t.length,o=0,a=0,s=0,u=0;u<i;++u)o+=I(t[u]),a+=I(n[u]),t[u]=o,n[u]=a,e(r)&&(s+=I(r[u]),r[u]=s)};var R=new p,P=new p;function O(t,n,r,i,o){var s=t.x,u=t.y,c=t.z,l=n.x,h=n.y,d=n.z,f=s*s*l*l,m=u*u*h*h,_=c*c*d*d,g=f+m+_,v=Math.sqrt(1/g),y=p.multiplyByScalar(t,v,R);if(g<i)return isFinite(v)?p.clone(y,o):void 0;var T=r.x,E=r.y,x=r.z,C=P;C.x=y.x*T*2,C.y=y.y*E*2,C.z=y.z*x*2;var S,A,w,b,D,I,O,N=(1-v)*p.magnitude(t)/(.5*p.magnitude(C)),M=0;do{M=(S=f*(D=(A=1/(1+(N-=M)*T))*A)+m*(I=(w=1/(1+N*E))*w)+_*(O=(b=1/(1+N*x))*b)-1)/(-2*(f*(D*A)*T+m*(I*w)*E+_*(O*b)*x))}while(Math.abs(S)>a.EPSILON12);return e(o)?(o.x=s*A,o.y=u*w,o.z=c*b,o):new p(s*A,u*w,c*b)}function N(e,t,n){this.longitude=i(e,0),this.latitude=i(t,0),this.height=i(n,0)}N.fromRadians=function(t,n,r,o){return r=i(r,0),e(o)?(o.longitude=t,o.latitude=n,o.height=r,o):new N(t,n,r)},N.fromDegrees=function(e,t,n,r){return e=a.toRadians(e),t=a.toRadians(t),N.fromRadians(e,t,n,r)};var M=new p,L=new p,F=new p,z=new p(1/6378137,1/6378137,1/6356752.314245179),B=new p(1/40680631590769,1/40680631590769,1/40408299984661.445),U=a.EPSILON1;function V(e,t,n,r){t=i(t,0),n=i(n,0),r=i(r,0),e._radii=new p(t,n,r),e._radiiSquared=new p(t*t,n*n,r*r),e._radiiToTheFourth=new p(t*t*t*t,n*n*n*n,r*r*r*r),e._oneOverRadii=new p(0===t?0:1/t,0===n?0:1/n,0===r?0:1/r),e._oneOverRadiiSquared=new p(0===t?0:1/(t*t),0===n?0:1/(n*n),0===r?0:1/(r*r)),e._minimumRadius=Math.min(t,n,r),e._maximumRadius=Math.max(t,n,r),e._centerToleranceSquared=a.EPSILON1,0!==e._radiiSquared.z&&(e._squaredXOverSquaredZ=e._radiiSquared.x/e._radiiSquared.z)}function H(e,t,n){this._radii=void 0,this._radiiSquared=void 0,this._radiiToTheFourth=void 0,this._oneOverRadii=void 0,this._oneOverRadiiSquared=void 0,this._minimumRadius=void 0,this._maximumRadius=void 0,this._centerToleranceSquared=void 0,this._squaredXOverSquaredZ=void 0,V(this,e,t,n)}N.fromCartesian=function(t,n,r){var i=e(n)?n.oneOverRadii:z,o=e(n)?n.oneOverRadiiSquared:B,s=O(t,i,o,e(n)?n._centerToleranceSquared:U,L);if(e(s)){var u=p.multiplyComponents(s,o,M);u=p.normalize(u,u);var c=p.subtract(t,s,F),l=Math.atan2(u.y,u.x),h=Math.asin(u.z),d=a.sign(p.dot(c,t))*p.magnitude(c);return e(r)?(r.longitude=l,r.latitude=h,r.height=d,r):new N(l,h,d)}},N.toCartesian=function(e,t,n){return p.fromRadians(e.longitude,e.latitude,e.height,t,n)},N.clone=function(t,n){if(e(t))return e(n)?(n.longitude=t.longitude,n.latitude=t.latitude,n.height=t.height,n):new N(t.longitude,t.latitude,t.height)},N.equals=function(t,n){return t===n||e(t)&&e(n)&&t.longitude===n.longitude&&t.latitude===n.latitude&&t.height===n.height},N.equalsEpsilon=function(t,n,r){return r=i(r,0),t===n||e(t)&&e(n)&&Math.abs(t.longitude-n.longitude)<=r&&Math.abs(t.latitude-n.latitude)<=r&&Math.abs(t.height-n.height)<=r},N.ZERO=Object.freeze(new N(0,0,0)),N.prototype.clone=function(e){return N.clone(this,e)},N.prototype.equals=function(e){return N.equals(this,e)},N.prototype.equalsEpsilon=function(e,t){return N.equalsEpsilon(this,e,t)},N.prototype.toString=function(){return"("+this.longitude+", "+this.latitude+", "+this.height+")"},Object.defineProperties(H.prototype,{radii:{get:function(){return this._radii}},radiiSquared:{get:function(){return this._radiiSquared}},radiiToTheFourth:{get:function(){return this._radiiToTheFourth}},oneOverRadii:{get:function(){return this._oneOverRadii}},oneOverRadiiSquared:{get:function(){return this._oneOverRadiiSquared}},minimumRadius:{get:function(){return this._minimumRadius}},maximumRadius:{get:function(){return this._maximumRadius}}}),H.clone=function(t,n){if(e(t)){var r=t._radii;return e(n)?(p.clone(r,n._radii),p.clone(t._radiiSquared,n._radiiSquared),p.clone(t._radiiToTheFourth,n._radiiToTheFourth),p.clone(t._oneOverRadii,n._oneOverRadii),p.clone(t._oneOverRadiiSquared,n._oneOverRadiiSquared),n._minimumRadius=t._minimumRadius,n._maximumRadius=t._maximumRadius,n._centerToleranceSquared=t._centerToleranceSquared,n):new H(r.x,r.y,r.z)}},H.fromCartesian3=function(t,n){return e(n)||(n=new H),e(t)?(V(n,t.x,t.y,t.z),n):n},H.WGS84=Object.freeze(new H(6378137,6378137,6356752.314245179)),H.UNIT_SPHERE=Object.freeze(new H(1,1,1)),H.MOON=Object.freeze(new H(a.LUNAR_RADIUS,a.LUNAR_RADIUS,a.LUNAR_RADIUS)),H.prototype.clone=function(e){return H.clone(this,e)},H.packedLength=p.packedLength,H.pack=function(e,t,n){return n=i(n,0),p.pack(e._radii,t,n),t},H.unpack=function(e,t,n){t=i(t,0);var r=p.unpack(e,t);return H.fromCartesian3(r,n)},H.prototype.geocentricSurfaceNormal=p.normalize,H.prototype.geodeticSurfaceNormalCartographic=function(t,n){var r=t.longitude,i=t.latitude,o=Math.cos(i),a=o*Math.cos(r),s=o*Math.sin(r),u=Math.sin(i);return e(n)||(n=new p),n.x=a,n.y=s,n.z=u,p.normalize(n,n)},H.prototype.geodeticSurfaceNormal=function(t,n){if(!p.equalsEpsilon(t,p.ZERO,a.EPSILON14))return e(n)||(n=new p),n=p.multiplyComponents(t,this._oneOverRadiiSquared,n),p.normalize(n,n)};var G=new p,k=new p;H.prototype.cartographicToCartesian=function(t,n){var r=G,i=k;this.geodeticSurfaceNormalCartographic(t,r),p.multiplyComponents(this._radiiSquared,r,i);var o=Math.sqrt(p.dot(r,i));return p.divideByScalar(i,o,i),p.multiplyByScalar(r,t.height,r),e(n)||(n=new p),p.add(i,r,n)},H.prototype.cartographicArrayToCartesianArray=function(t,n){var r=t.length;e(n)?n.length=r:n=new Array(r);for(var i=0;i<r;i++)n[i]=this.cartographicToCartesian(t[i],n[i]);return n};var W=new p,q=new p,Y=new p;H.prototype.cartesianToCartographic=function(t,n){var r=this.scaleToGeodeticSurface(t,q);if(e(r)){var i=this.geodeticSurfaceNormal(r,W),o=p.subtract(t,r,Y),s=Math.atan2(i.y,i.x),u=Math.asin(i.z),c=a.sign(p.dot(o,t))*p.magnitude(o);return e(n)?(n.longitude=s,n.latitude=u,n.height=c,n):new N(s,u,c)}},H.prototype.cartesianArrayToCartographicArray=function(t,n){var r=t.length;e(n)?n.length=r:n=new Array(r);for(var i=0;i<r;++i)n[i]=this.cartesianToCartographic(t[i],n[i]);return n},H.prototype.scaleToGeodeticSurface=function(e,t){return O(e,this._oneOverRadii,this._oneOverRadiiSquared,this._centerToleranceSquared,t)},H.prototype.scaleToGeocentricSurface=function(t,n){e(n)||(n=new p);var r=t.x,i=t.y,o=t.z,a=this._oneOverRadiiSquared,s=1/Math.sqrt(r*r*a.x+i*i*a.y+o*o*a.z);return p.multiplyByScalar(t,s,n)},H.prototype.transformPositionToScaledSpace=function(t,n){return e(n)||(n=new p),p.multiplyComponents(t,this._oneOverRadii,n)},H.prototype.transformPositionFromScaledSpace=function(t,n){return e(n)||(n=new p),p.multiplyComponents(t,this._radii,n)},H.prototype.equals=function(t){return this===t||e(t)&&p.equals(this._radii,t._radii)},H.prototype.toString=function(){return this._radii.toString()},H.prototype.getSurfaceNormalIntersectionWithZAxis=function(t,n,r){n=i(n,0);var o=this._squaredXOverSquaredZ;if(e(r)||(r=new p),r.x=0,r.y=0,r.z=t.z*(1-o),!(Math.abs(r.z)>=this._radii.z-n))return r};var j=[.14887433898163,.43339539412925,.67940956829902,.86506336668898,.97390652851717,0],X=[.29552422471475,.26926671930999,.21908636251598,.14945134915058,.066671344308684,0];function Z(e,t,n){for(var r=.5*(t+e),i=.5*(t-e),o=0,a=0;a<5;a++){var s=i*j[a];o+=X[a]*(n(r+s)+n(r-s))}return o*=i}function K(e){this._ellipsoid=i(e,H.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis}H.prototype.surfaceArea=function(e){for(var t=e.west,n=e.east,r=e.south,i=e.north;n<t;)n+=a.TWO_PI;var o=this._radiiSquared,s=o.x,u=o.y,c=o.z,l=s*u;return Z(r,i,(function(e){var r=Math.cos(e),i=Math.sin(e);return Math.cos(e)*Z(t,n,(function(e){var t=Math.cos(e),n=Math.sin(e);return Math.sqrt(l*i*i+c*(u*t*t+s*n*n)*r*r)}))}))},Object.defineProperties(K.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),K.prototype.project=function(t,n){var r=this._semimajorAxis,i=t.longitude*r,o=t.latitude*r,a=t.height;return e(n)?(n.x=i,n.y=o,n.z=a,n):new p(i,o,a)},K.prototype.unproject=function(t,n){var r=this._oneOverSemimajorAxis,i=t.x*r,o=t.y*r,a=t.z;return e(n)?(n.longitude=i,n.latitude=o,n.height=a,n):new N(i,o,a)};var Q=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1});function J(e,t){this.start=i(e,0),this.stop=i(t,0)}function $(e,t,n,r,o,a,s,u,c){this[0]=i(e,0),this[1]=i(r,0),this[2]=i(s,0),this[3]=i(t,0),this[4]=i(o,0),this[5]=i(u,0),this[6]=i(n,0),this[7]=i(a,0),this[8]=i(c,0)}$.packedLength=9,$.pack=function(e,t,n){return n=i(n,0),t[n++]=e[0],t[n++]=e[1],t[n++]=e[2],t[n++]=e[3],t[n++]=e[4],t[n++]=e[5],t[n++]=e[6],t[n++]=e[7],t[n++]=e[8],t},$.unpack=function(t,n,r){return n=i(n,0),e(r)||(r=new $),r[0]=t[n++],r[1]=t[n++],r[2]=t[n++],r[3]=t[n++],r[4]=t[n++],r[5]=t[n++],r[6]=t[n++],r[7]=t[n++],r[8]=t[n++],r},$.clone=function(t,n){if(e(t))return e(n)?(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n):new $(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])},$.fromArray=function(t,n,r){return n=i(n,0),e(r)||(r=new $),r[0]=t[n],r[1]=t[n+1],r[2]=t[n+2],r[3]=t[n+3],r[4]=t[n+4],r[5]=t[n+5],r[6]=t[n+6],r[7]=t[n+7],r[8]=t[n+8],r},$.fromColumnMajorArray=function(e,t){return $.clone(e,t)},$.fromRowMajorArray=function(t,n){return e(n)?(n[0]=t[0],n[1]=t[3],n[2]=t[6],n[3]=t[1],n[4]=t[4],n[5]=t[7],n[6]=t[2],n[7]=t[5],n[8]=t[8],n):new $(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},$.fromQuaternion=function(t,n){var r=t.x*t.x,i=t.x*t.y,o=t.x*t.z,a=t.x*t.w,s=t.y*t.y,u=t.y*t.z,c=t.y*t.w,l=t.z*t.z,h=t.z*t.w,d=t.w*t.w,f=r-s-l+d,m=2*(i-h),p=2*(o+c),_=2*(i+h),g=-r+s-l+d,v=2*(u-a),y=2*(o-c),T=2*(u+a),E=-r-s+l+d;return e(n)?(n[0]=f,n[1]=_,n[2]=y,n[3]=m,n[4]=g,n[5]=T,n[6]=p,n[7]=v,n[8]=E,n):new $(f,m,p,_,g,v,y,T,E)},$.fromHeadingPitchRoll=function(t,n){var r=Math.cos(-t.pitch),i=Math.cos(-t.heading),o=Math.cos(t.roll),a=Math.sin(-t.pitch),s=Math.sin(-t.heading),u=Math.sin(t.roll),c=r*i,l=-o*s+u*a*i,h=u*s+o*a*i,d=r*s,f=o*i+u*a*s,m=-u*i+o*a*s,p=-a,_=u*r,g=o*r;return e(n)?(n[0]=c,n[1]=d,n[2]=p,n[3]=l,n[4]=f,n[5]=_,n[6]=h,n[7]=m,n[8]=g,n):new $(c,l,h,d,f,m,p,_,g)},$.fromScale=function(t,n){return e(n)?(n[0]=t.x,n[1]=0,n[2]=0,n[3]=0,n[4]=t.y,n[5]=0,n[6]=0,n[7]=0,n[8]=t.z,n):new $(t.x,0,0,0,t.y,0,0,0,t.z)},$.fromUniformScale=function(t,n){return e(n)?(n[0]=t,n[1]=0,n[2]=0,n[3]=0,n[4]=t,n[5]=0,n[6]=0,n[7]=0,n[8]=t,n):new $(t,0,0,0,t,0,0,0,t)},$.fromCrossProduct=function(t,n){return e(n)?(n[0]=0,n[1]=t.z,n[2]=-t.y,n[3]=-t.z,n[4]=0,n[5]=t.x,n[6]=t.y,n[7]=-t.x,n[8]=0,n):new $(0,-t.z,t.y,t.z,0,-t.x,-t.y,t.x,0)},$.fromRotationX=function(t,n){var r=Math.cos(t),i=Math.sin(t);return e(n)?(n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=r,n[5]=i,n[6]=0,n[7]=-i,n[8]=r,n):new $(1,0,0,0,r,-i,0,i,r)},$.fromRotationY=function(t,n){var r=Math.cos(t),i=Math.sin(t);return e(n)?(n[0]=r,n[1]=0,n[2]=-i,n[3]=0,n[4]=1,n[5]=0,n[6]=i,n[7]=0,n[8]=r,n):new $(r,0,i,0,1,0,-i,0,r)},$.fromRotationZ=function(t,n){var r=Math.cos(t),i=Math.sin(t);return e(n)?(n[0]=r,n[1]=i,n[2]=0,n[3]=-i,n[4]=r,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n):new $(r,-i,0,i,r,0,0,0,1)},$.toArray=function(t,n){return e(n)?(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n):[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]},$.getElementIndex=function(e,t){return 3*e+t},$.getColumn=function(e,t,n){var r=3*t,i=e[r],o=e[r+1],a=e[r+2];return n.x=i,n.y=o,n.z=a,n},$.setColumn=function(e,t,n,r){var i=3*t;return(r=$.clone(e,r))[i]=n.x,r[i+1]=n.y,r[i+2]=n.z,r},$.getRow=function(e,t,n){var r=e[t],i=e[t+3],o=e[t+6];return n.x=r,n.y=i,n.z=o,n},$.setRow=function(e,t,n,r){return(r=$.clone(e,r))[t]=n.x,r[t+3]=n.y,r[t+6]=n.z,r};var ee=new p;$.getScale=function(e,t){return t.x=p.magnitude(p.fromElements(e[0],e[1],e[2],ee)),t.y=p.magnitude(p.fromElements(e[3],e[4],e[5],ee)),t.z=p.magnitude(p.fromElements(e[6],e[7],e[8],ee)),t};var te=new p;$.getMaximumScale=function(e){return $.getScale(e,te),p.maximumComponent(te)},$.multiply=function(e,t,n){var r=e[0]*t[0]+e[3]*t[1]+e[6]*t[2],i=e[1]*t[0]+e[4]*t[1]+e[7]*t[2],o=e[2]*t[0]+e[5]*t[1]+e[8]*t[2],a=e[0]*t[3]+e[3]*t[4]+e[6]*t[5],s=e[1]*t[3]+e[4]*t[4]+e[7]*t[5],u=e[2]*t[3]+e[5]*t[4]+e[8]*t[5],c=e[0]*t[6]+e[3]*t[7]+e[6]*t[8],l=e[1]*t[6]+e[4]*t[7]+e[7]*t[8],h=e[2]*t[6]+e[5]*t[7]+e[8]*t[8];return n[0]=r,n[1]=i,n[2]=o,n[3]=a,n[4]=s,n[5]=u,n[6]=c,n[7]=l,n[8]=h,n},$.add=function(e,t,n){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n[4]=e[4]+t[4],n[5]=e[5]+t[5],n[6]=e[6]+t[6],n[7]=e[7]+t[7],n[8]=e[8]+t[8],n},$.subtract=function(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n[4]=e[4]-t[4],n[5]=e[5]-t[5],n[6]=e[6]-t[6],n[7]=e[7]-t[7],n[8]=e[8]-t[8],n},$.multiplyByVector=function(e,t,n){var r=t.x,i=t.y,o=t.z,a=e[0]*r+e[3]*i+e[6]*o,s=e[1]*r+e[4]*i+e[7]*o,u=e[2]*r+e[5]*i+e[8]*o;return n.x=a,n.y=s,n.z=u,n},$.multiplyByScalar=function(e,t,n){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7]*t,n[8]=e[8]*t,n},$.multiplyByScale=function(e,t,n){return n[0]=e[0]*t.x,n[1]=e[1]*t.x,n[2]=e[2]*t.x,n[3]=e[3]*t.y,n[4]=e[4]*t.y,n[5]=e[5]*t.y,n[6]=e[6]*t.z,n[7]=e[7]*t.z,n[8]=e[8]*t.z,n},$.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t},$.transpose=function(e,t){var n=e[0],r=e[3],i=e[6],o=e[1],a=e[4],s=e[7],u=e[2],c=e[5],l=e[8];return t[0]=n,t[1]=r,t[2]=i,t[3]=o,t[4]=a,t[5]=s,t[6]=u,t[7]=c,t[8]=l,t};var ne=new p(1,1,1);$.getRotation=function(e,t){var n=p.divideComponents(ne,$.getScale(e,te),te);return t=$.multiplyByScale(e,n,t)};var re=[1,0,0],ie=[2,2,1];function oe(e){for(var t=0,n=0;n<3;++n){var r=e[$.getElementIndex(ie[n],re[n])];t+=2*r*r}return Math.sqrt(t)}function ae(e,t){for(var n=a.EPSILON15,r=0,i=1,o=0;o<3;++o){var s=Math.abs(e[$.getElementIndex(ie[o],re[o])]);s>r&&(i=o,r=s)}var u=1,c=0,l=re[i],h=ie[i];if(Math.abs(e[$.getElementIndex(h,l)])>n){var d,f=(e[$.getElementIndex(h,h)]-e[$.getElementIndex(l,l)])/2/e[$.getElementIndex(h,l)];c=(d=f<0?-1/(-f+Math.sqrt(1+f*f)):1/(f+Math.sqrt(1+f*f)))*(u=1/Math.sqrt(1+d*d))}return(t=$.clone($.IDENTITY,t))[$.getElementIndex(l,l)]=t[$.getElementIndex(h,h)]=u,t[$.getElementIndex(h,l)]=c,t[$.getElementIndex(l,h)]=-c,t}var se=new $,ue=new $;$.computeEigenDecomposition=function(t,n){var r=a.EPSILON20,i=0,o=0;e(n)||(n={});for(var s=n.unitary=$.clone($.IDENTITY,n.unitary),u=n.diagonal=$.clone(t,n.diagonal),c=r*function(e){for(var t=0,n=0;n<9;++n){var r=e[n];t+=r*r}return Math.sqrt(t)}(u);o<10&&oe(u)>c;)ae(u,se),$.transpose(se,ue),$.multiply(u,se,u),$.multiply(ue,u,u),$.multiply(s,se,s),++i>2&&(++o,i=0);return n},$.abs=function(e,t){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t[4]=Math.abs(e[4]),t[5]=Math.abs(e[5]),t[6]=Math.abs(e[6]),t[7]=Math.abs(e[7]),t[8]=Math.abs(e[8]),t},$.determinant=function(e){var t=e[0],n=e[3],r=e[6],i=e[1],o=e[4],a=e[7],s=e[2],u=e[5],c=e[8];return t*(o*c-u*a)+i*(u*r-n*c)+s*(n*a-o*r)},$.inverse=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],h=$.determinant(e);t[0]=a*l-c*s,t[1]=c*i-r*l,t[2]=r*s-a*i,t[3]=u*s-o*l,t[4]=n*l-u*i,t[5]=o*i-n*s,t[6]=o*c-u*a,t[7]=u*r-n*c,t[8]=n*a-o*r;var d=1/h;return $.multiplyByScalar(t,d,t)};var ce=new $;function le(e,t,n,r){this.x=i(e,0),this.y=i(t,0),this.z=i(n,0),this.w=i(r,0)}$.inverseTranspose=function(e,t){return $.inverse($.transpose(e,ce),t)},$.equals=function(t,n){return t===n||e(t)&&e(n)&&t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]},$.equalsEpsilon=function(t,n,r){return r=i(r,0),t===n||e(t)&&e(n)&&Math.abs(t[0]-n[0])<=r&&Math.abs(t[1]-n[1])<=r&&Math.abs(t[2]-n[2])<=r&&Math.abs(t[3]-n[3])<=r&&Math.abs(t[4]-n[4])<=r&&Math.abs(t[5]-n[5])<=r&&Math.abs(t[6]-n[6])<=r&&Math.abs(t[7]-n[7])<=r&&Math.abs(t[8]-n[8])<=r},$.IDENTITY=Object.freeze(new $(1,0,0,0,1,0,0,0,1)),$.ZERO=Object.freeze(new $(0,0,0,0,0,0,0,0,0)),$.COLUMN0ROW0=0,$.COLUMN0ROW1=1,$.COLUMN0ROW2=2,$.COLUMN1ROW0=3,$.COLUMN1ROW1=4,$.COLUMN1ROW2=5,$.COLUMN2ROW0=6,$.COLUMN2ROW1=7,$.COLUMN2ROW2=8,Object.defineProperties($.prototype,{length:{get:function(){return $.packedLength}}}),$.prototype.clone=function(e){return $.clone(this,e)},$.prototype.equals=function(e){return $.equals(this,e)},$.equalsArray=function(e,t,n){return e[0]===t[n]&&e[1]===t[n+1]&&e[2]===t[n+2]&&e[3]===t[n+3]&&e[4]===t[n+4]&&e[5]===t[n+5]&&e[6]===t[n+6]&&e[7]===t[n+7]&&e[8]===t[n+8]},$.prototype.equalsEpsilon=function(e,t){return $.equalsEpsilon(this,e,t)},$.prototype.toString=function(){return"("+this[0]+", "+this[3]+", "+this[6]+")\n("+this[1]+", "+this[4]+", "+this[7]+")\n("+this[2]+", "+this[5]+", "+this[8]+")"},le.fromElements=function(t,n,r,i,o){return e(o)?(o.x=t,o.y=n,o.z=r,o.w=i,o):new le(t,n,r,i)},le.fromColor=function(t,n){return e(n)?(n.x=t.red,n.y=t.green,n.z=t.blue,n.w=t.alpha,n):new le(t.red,t.green,t.blue,t.alpha)},le.clone=function(t,n){if(e(t))return e(n)?(n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w,n):new le(t.x,t.y,t.z,t.w)},le.packedLength=4,le.pack=function(e,t,n){return n=i(n,0),t[n++]=e.x,t[n++]=e.y,t[n++]=e.z,t[n]=e.w,t},le.unpack=function(t,n,r){return n=i(n,0),e(r)||(r=new le),r.x=t[n++],r.y=t[n++],r.z=t[n++],r.w=t[n],r},le.packArray=function(n,r){var i=n.length,o=4*i;if(e(r)){if(!Array.isArray(r)&&r.length!==o)throw new t("If result is a typed array, it must have exactly array.length * 4 elements");r.length!==o&&(r.length=o)}else r=new Array(o);for(var a=0;a<i;++a)le.pack(n[a],r,4*a);return r},le.unpackArray=function(t,n){var r=t.length;e(n)?n.length=r/4:n=new Array(r/4);for(var i=0;i<r;i+=4){var o=i/4;n[o]=le.unpack(t,i,n[o])}return n},le.fromArray=le.unpack,le.maximumComponent=function(e){return Math.max(e.x,e.y,e.z,e.w)},le.minimumComponent=function(e){return Math.min(e.x,e.y,e.z,e.w)},le.minimumByComponent=function(e,t,n){return n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.z=Math.min(e.z,t.z),n.w=Math.min(e.w,t.w),n},le.maximumByComponent=function(e,t,n){return n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n.z=Math.max(e.z,t.z),n.w=Math.max(e.w,t.w),n},le.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},le.magnitude=function(e){return Math.sqrt(le.magnitudeSquared(e))};var he=new le;le.distance=function(e,t){return le.subtract(e,t,he),le.magnitude(he)},le.distanceSquared=function(e,t){return le.subtract(e,t,he),le.magnitudeSquared(he)},le.normalize=function(e,t){var n=le.magnitude(e);return t.x=e.x/n,t.y=e.y/n,t.z=e.z/n,t.w=e.w/n,t},le.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},le.multiplyComponents=function(e,t,n){return n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z,n.w=e.w*t.w,n},le.divideComponents=function(e,t,n){return n.x=e.x/t.x,n.y=e.y/t.y,n.z=e.z/t.z,n.w=e.w/t.w,n},le.add=function(e,t,n){return n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n.w=e.w+t.w,n},le.subtract=function(e,t,n){return n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n.w=e.w-t.w,n},le.multiplyByScalar=function(e,t,n){return n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n.w=e.w*t,n},le.divideByScalar=function(e,t,n){return n.x=e.x/t,n.y=e.y/t,n.z=e.z/t,n.w=e.w/t,n},le.negate=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t},le.abs=function(e,t){return t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t.w=Math.abs(e.w),t};var de=new le;le.lerp=function(e,t,n,r){return le.multiplyByScalar(t,n,de),r=le.multiplyByScalar(e,1-n,r),le.add(de,r,r)};var fe=new le;le.mostOrthogonalAxis=function(e,t){var n=le.normalize(e,fe);return le.abs(n,n),t=n.x<=n.y?n.x<=n.z?n.x<=n.w?le.clone(le.UNIT_X,t):le.clone(le.UNIT_W,t):n.z<=n.w?le.clone(le.UNIT_Z,t):le.clone(le.UNIT_W,t):n.y<=n.z?n.y<=n.w?le.clone(le.UNIT_Y,t):le.clone(le.UNIT_W,t):n.z<=n.w?le.clone(le.UNIT_Z,t):le.clone(le.UNIT_W,t)},le.equals=function(t,n){return t===n||e(t)&&e(n)&&t.x===n.x&&t.y===n.y&&t.z===n.z&&t.w===n.w},le.equalsArray=function(e,t,n){return e.x===t[n]&&e.y===t[n+1]&&e.z===t[n+2]&&e.w===t[n+3]},le.equalsEpsilon=function(t,n,r,i){return t===n||e(t)&&e(n)&&a.equalsEpsilon(t.x,n.x,r,i)&&a.equalsEpsilon(t.y,n.y,r,i)&&a.equalsEpsilon(t.z,n.z,r,i)&&a.equalsEpsilon(t.w,n.w,r,i)},le.ZERO=Object.freeze(new le(0,0,0,0)),le.UNIT_X=Object.freeze(new le(1,0,0,0)),le.UNIT_Y=Object.freeze(new le(0,1,0,0)),le.UNIT_Z=Object.freeze(new le(0,0,1,0)),le.UNIT_W=Object.freeze(new le(0,0,0,1)),le.prototype.clone=function(e){return le.clone(this,e)},le.prototype.equals=function(e){return le.equals(this,e)},le.prototype.equalsEpsilon=function(e,t,n){return le.equalsEpsilon(this,e,t,n)},le.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"};var me=new Float32Array(1),pe=new Uint8Array(me.buffer),_e=new Uint32Array([287454020]),ge=68===new Uint8Array(_e.buffer)[0];function ve(e){var t;this.name="RuntimeError",this.message=e;try{throw new Error}catch(n){t=n.stack}this.stack=t}function ye(e,t,n,r,o,a,s,u,c,l,h,d,f,m,p,_){this[0]=i(e,0),this[1]=i(o,0),this[2]=i(c,0),this[3]=i(f,0),this[4]=i(t,0),this[5]=i(a,0),this[6]=i(l,0),this[7]=i(m,0),this[8]=i(n,0),this[9]=i(s,0),this[10]=i(h,0),this[11]=i(p,0),this[12]=i(r,0),this[13]=i(u,0),this[14]=i(d,0),this[15]=i(_,0)}le.packFloat=function(t,n){return e(n)||(n=new le),me[0]=t,ge?(n.x=pe[0],n.y=pe[1],n.z=pe[2],n.w=pe[3]):(n.x=pe[3],n.y=pe[2],n.z=pe[1],n.w=pe[0]),n},le.unpackFloat=function(e){return ge?(pe[0]=e.x,pe[1]=e.y,pe[2]=e.z,pe[3]=e.w):(pe[0]=e.w,pe[1]=e.z,pe[2]=e.y,pe[3]=e.x),me[0]},e(Object.create)&&(ve.prototype=Object.create(Error.prototype),ve.prototype.constructor=ve),ve.prototype.toString=function(){var t=this.name+": "+this.message;return e(this.stack)&&(t+="\n"+this.stack.toString()),t},ye.packedLength=16,ye.pack=function(e,t,n){return n=i(n,0),t[n++]=e[0],t[n++]=e[1],t[n++]=e[2],t[n++]=e[3],t[n++]=e[4],t[n++]=e[5],t[n++]=e[6],t[n++]=e[7],t[n++]=e[8],t[n++]=e[9],t[n++]=e[10],t[n++]=e[11],t[n++]=e[12],t[n++]=e[13],t[n++]=e[14],t[n]=e[15],t},ye.unpack=function(t,n,r){return n=i(n,0),e(r)||(r=new ye),r[0]=t[n++],r[1]=t[n++],r[2]=t[n++],r[3]=t[n++],r[4]=t[n++],r[5]=t[n++],r[6]=t[n++],r[7]=t[n++],r[8]=t[n++],r[9]=t[n++],r[10]=t[n++],r[11]=t[n++],r[12]=t[n++],r[13]=t[n++],r[14]=t[n++],r[15]=t[n],r},ye.clone=function(t,n){if(e(t))return e(n)?(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n):new ye(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])},ye.fromArray=ye.unpack,ye.fromColumnMajorArray=function(e,t){return ye.clone(e,t)},ye.fromRowMajorArray=function(t,n){return e(n)?(n[0]=t[0],n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=t[1],n[5]=t[5],n[6]=t[9],n[7]=t[13],n[8]=t[2],n[9]=t[6],n[10]=t[10],n[11]=t[14],n[12]=t[3],n[13]=t[7],n[14]=t[11],n[15]=t[15],n):new ye(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},ye.fromRotationTranslation=function(t,n,r){return n=i(n,p.ZERO),e(r)?(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=0,r[4]=t[3],r[5]=t[4],r[6]=t[5],r[7]=0,r[8]=t[6],r[9]=t[7],r[10]=t[8],r[11]=0,r[12]=n.x,r[13]=n.y,r[14]=n.z,r[15]=1,r):new ye(t[0],t[3],t[6],n.x,t[1],t[4],t[7],n.y,t[2],t[5],t[8],n.z,0,0,0,1)},ye.fromTranslationQuaternionRotationScale=function(t,n,r,i){e(i)||(i=new ye);var o=r.x,a=r.y,s=r.z,u=n.x*n.x,c=n.x*n.y,l=n.x*n.z,h=n.x*n.w,d=n.y*n.y,f=n.y*n.z,m=n.y*n.w,p=n.z*n.z,_=n.z*n.w,g=n.w*n.w,v=u-d-p+g,y=2*(c-_),T=2*(l+m),E=2*(c+_),x=-u+d-p+g,C=2*(f-h),S=2*(l-m),A=2*(f+h),w=-u-d+p+g;return i[0]=v*o,i[1]=E*o,i[2]=S*o,i[3]=0,i[4]=y*a,i[5]=x*a,i[6]=A*a,i[7]=0,i[8]=T*s,i[9]=C*s,i[10]=w*s,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,i},ye.fromTranslationRotationScale=function(e,t){return ye.fromTranslationQuaternionRotationScale(e.translation,e.rotation,e.scale,t)},ye.fromTranslation=function(e,t){return ye.fromRotationTranslation($.IDENTITY,e,t)},ye.fromScale=function(t,n){return e(n)?(n[0]=t.x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t.y,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t.z,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n):new ye(t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1)},ye.fromUniformScale=function(t,n){return e(n)?(n[0]=t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n):new ye(t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1)};var Te=new p,Ee=new p,xe=new p;ye.fromCamera=function(t,n){var r=t.position,i=t.direction,o=t.up;p.normalize(i,Te),p.normalize(p.cross(Te,o,Ee),Ee),p.normalize(p.cross(Ee,Te,xe),xe);var a=Ee.x,s=Ee.y,u=Ee.z,c=Te.x,l=Te.y,h=Te.z,d=xe.x,f=xe.y,m=xe.z,_=r.x,g=r.y,v=r.z,y=a*-_+s*-g+u*-v,T=d*-_+f*-g+m*-v,E=c*_+l*g+h*v;return e(n)?(n[0]=a,n[1]=d,n[2]=-c,n[3]=0,n[4]=s,n[5]=f,n[6]=-l,n[7]=0,n[8]=u,n[9]=m,n[10]=-h,n[11]=0,n[12]=y,n[13]=T,n[14]=E,n[15]=1,n):new ye(a,s,u,y,d,f,m,T,-c,-l,-h,E,0,0,0,1)},ye.computePerspectiveFieldOfView=function(e,t,n,r,i){var o=1/Math.tan(.5*e),a=o/t,s=(r+n)/(n-r),u=2*r*n/(n-r);return i[0]=a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=s,i[11]=-1,i[12]=0,i[13]=0,i[14]=u,i[15]=0,i},ye.computeOrthographicOffCenter=function(e,t,n,r,i,o,a){var s=1/(t-e),u=1/(r-n),c=1/(o-i),l=-(t+e)*s,h=-(r+n)*u,d=-(o+i)*c;return s*=2,u*=2,c*=-2,a[0]=s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=u,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=c,a[11]=0,a[12]=l,a[13]=h,a[14]=d,a[15]=1,a},ye.computePerspectiveOffCenter=function(e,t,n,r,i,o,a){var s=2*i/(t-e),u=2*i/(r-n),c=(t+e)/(t-e),l=(r+n)/(r-n),h=-(o+i)/(o-i),d=-2*o*i/(o-i);return a[0]=s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=u,a[6]=0,a[7]=0,a[8]=c,a[9]=l,a[10]=h,a[11]=-1,a[12]=0,a[13]=0,a[14]=d,a[15]=0,a},ye.computeInfinitePerspectiveOffCenter=function(e,t,n,r,i,o){var a=2*i/(t-e),s=2*i/(r-n),u=(t+e)/(t-e),c=(r+n)/(r-n),l=-2*i;return o[0]=a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=s,o[6]=0,o[7]=0,o[8]=u,o[9]=c,o[10]=-1,o[11]=-1,o[12]=0,o[13]=0,o[14]=l,o[15]=0,o},ye.computeViewportTransformation=function(t,n,r,o){e(o)||(o=new ye),t=i(t,i.EMPTY_OBJECT);var a=i(t.x,0),s=i(t.y,0),u=i(t.width,0),c=i(t.height,0);n=i(n,0);var l=.5*u,h=.5*c,d=.5*((r=i(r,1))-n),f=l,m=h,p=d,_=a+l,g=s+h,v=n+d;return o[0]=f,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=m,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=p,o[11]=0,o[12]=_,o[13]=g,o[14]=v,o[15]=1,o},ye.computeView=function(e,t,n,r,i){return i[0]=r.x,i[1]=n.x,i[2]=-t.x,i[3]=0,i[4]=r.y,i[5]=n.y,i[6]=-t.y,i[7]=0,i[8]=r.z,i[9]=n.z,i[10]=-t.z,i[11]=0,i[12]=-p.dot(r,e),i[13]=-p.dot(n,e),i[14]=p.dot(t,e),i[15]=1,i},ye.toArray=function(t,n){return e(n)?(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n):[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]},ye.getElementIndex=function(e,t){return 4*e+t},ye.getColumn=function(e,t,n){var r=4*t,i=e[r],o=e[r+1],a=e[r+2],s=e[r+3];return n.x=i,n.y=o,n.z=a,n.w=s,n},ye.setColumn=function(e,t,n,r){var i=4*t;return(r=ye.clone(e,r))[i]=n.x,r[i+1]=n.y,r[i+2]=n.z,r[i+3]=n.w,r},ye.setTranslation=function(e,t,n){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=e[15],n};var Ce=new p;ye.setScale=function(e,t,n){var r=ye.getScale(e,Ce),i=p.divideComponents(t,r,Ce);return ye.multiplyByScale(e,i,n)},ye.getRow=function(e,t,n){var r=e[t],i=e[t+4],o=e[t+8],a=e[t+12];return n.x=r,n.y=i,n.z=o,n.w=a,n},ye.setRow=function(e,t,n,r){return(r=ye.clone(e,r))[t]=n.x,r[t+4]=n.y,r[t+8]=n.z,r[t+12]=n.w,r};var Se=new p;ye.getScale=function(e,t){return t.x=p.magnitude(p.fromElements(e[0],e[1],e[2],Se)),t.y=p.magnitude(p.fromElements(e[4],e[5],e[6],Se)),t.z=p.magnitude(p.fromElements(e[8],e[9],e[10],Se)),t};var Ae=new p;ye.getMaximumScale=function(e){return ye.getScale(e,Ae),p.maximumComponent(Ae)},ye.multiply=function(e,t,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],d=e[9],f=e[10],m=e[11],p=e[12],_=e[13],g=e[14],v=e[15],y=t[0],T=t[1],E=t[2],x=t[3],C=t[4],S=t[5],A=t[6],w=t[7],b=t[8],D=t[9],I=t[10],R=t[11],P=t[12],O=t[13],N=t[14],M=t[15],L=r*y+s*T+h*E+p*x,F=i*y+u*T+d*E+_*x,z=o*y+c*T+f*E+g*x,B=a*y+l*T+m*E+v*x,U=r*C+s*S+h*A+p*w,V=i*C+u*S+d*A+_*w,H=o*C+c*S+f*A+g*w,G=a*C+l*S+m*A+v*w,k=r*b+s*D+h*I+p*R,W=i*b+u*D+d*I+_*R,q=o*b+c*D+f*I+g*R,Y=a*b+l*D+m*I+v*R,j=r*P+s*O+h*N+p*M,X=i*P+u*O+d*N+_*M,Z=o*P+c*O+f*N+g*M,K=a*P+l*O+m*N+v*M;return n[0]=L,n[1]=F,n[2]=z,n[3]=B,n[4]=U,n[5]=V,n[6]=H,n[7]=G,n[8]=k,n[9]=W,n[10]=q,n[11]=Y,n[12]=j,n[13]=X,n[14]=Z,n[15]=K,n},ye.add=function(e,t,n){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n[4]=e[4]+t[4],n[5]=e[5]+t[5],n[6]=e[6]+t[6],n[7]=e[7]+t[7],n[8]=e[8]+t[8],n[9]=e[9]+t[9],n[10]=e[10]+t[10],n[11]=e[11]+t[11],n[12]=e[12]+t[12],n[13]=e[13]+t[13],n[14]=e[14]+t[14],n[15]=e[15]+t[15],n},ye.subtract=function(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n[4]=e[4]-t[4],n[5]=e[5]-t[5],n[6]=e[6]-t[6],n[7]=e[7]-t[7],n[8]=e[8]-t[8],n[9]=e[9]-t[9],n[10]=e[10]-t[10],n[11]=e[11]-t[11],n[12]=e[12]-t[12],n[13]=e[13]-t[13],n[14]=e[14]-t[14],n[15]=e[15]-t[15],n},ye.multiplyTransformation=function(e,t,n){var r=e[0],i=e[1],o=e[2],a=e[4],s=e[5],u=e[6],c=e[8],l=e[9],h=e[10],d=e[12],f=e[13],m=e[14],p=t[0],_=t[1],g=t[2],v=t[4],y=t[5],T=t[6],E=t[8],x=t[9],C=t[10],S=t[12],A=t[13],w=t[14],b=r*p+a*_+c*g,D=i*p+s*_+l*g,I=o*p+u*_+h*g,R=r*v+a*y+c*T,P=i*v+s*y+l*T,O=o*v+u*y+h*T,N=r*E+a*x+c*C,M=i*E+s*x+l*C,L=o*E+u*x+h*C,F=r*S+a*A+c*w+d,z=i*S+s*A+l*w+f,B=o*S+u*A+h*w+m;return n[0]=b,n[1]=D,n[2]=I,n[3]=0,n[4]=R,n[5]=P,n[6]=O,n[7]=0,n[8]=N,n[9]=M,n[10]=L,n[11]=0,n[12]=F,n[13]=z,n[14]=B,n[15]=1,n},ye.multiplyByMatrix3=function(e,t,n){var r=e[0],i=e[1],o=e[2],a=e[4],s=e[5],u=e[6],c=e[8],l=e[9],h=e[10],d=t[0],f=t[1],m=t[2],p=t[3],_=t[4],g=t[5],v=t[6],y=t[7],T=t[8],E=r*d+a*f+c*m,x=i*d+s*f+l*m,C=o*d+u*f+h*m,S=r*p+a*_+c*g,A=i*p+s*_+l*g,w=o*p+u*_+h*g,b=r*v+a*y+c*T,D=i*v+s*y+l*T,I=o*v+u*y+h*T;return n[0]=E,n[1]=x,n[2]=C,n[3]=0,n[4]=S,n[5]=A,n[6]=w,n[7]=0,n[8]=b,n[9]=D,n[10]=I,n[11]=0,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},ye.multiplyByTranslation=function(e,t,n){var r=t.x,i=t.y,o=t.z,a=r*e[0]+i*e[4]+o*e[8]+e[12],s=r*e[1]+i*e[5]+o*e[9]+e[13],u=r*e[2]+i*e[6]+o*e[10]+e[14];return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=a,n[13]=s,n[14]=u,n[15]=e[15],n};var we=new p;ye.multiplyByUniformScale=function(e,t,n){return we.x=t,we.y=t,we.z=t,ye.multiplyByScale(e,we,n)},ye.multiplyByScale=function(e,t,n){var r=t.x,i=t.y,o=t.z;return 1===r&&1===i&&1===o?ye.clone(e,n):(n[0]=r*e[0],n[1]=r*e[1],n[2]=r*e[2],n[3]=0,n[4]=i*e[4],n[5]=i*e[5],n[6]=i*e[6],n[7]=0,n[8]=o*e[8],n[9]=o*e[9],n[10]=o*e[10],n[11]=0,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=1,n)},ye.multiplyByVector=function(e,t,n){var r=t.x,i=t.y,o=t.z,a=t.w,s=e[0]*r+e[4]*i+e[8]*o+e[12]*a,u=e[1]*r+e[5]*i+e[9]*o+e[13]*a,c=e[2]*r+e[6]*i+e[10]*o+e[14]*a,l=e[3]*r+e[7]*i+e[11]*o+e[15]*a;return n.x=s,n.y=u,n.z=c,n.w=l,n},ye.multiplyByPointAsVector=function(e,t,n){var r=t.x,i=t.y,o=t.z,a=e[0]*r+e[4]*i+e[8]*o,s=e[1]*r+e[5]*i+e[9]*o,u=e[2]*r+e[6]*i+e[10]*o;return n.x=a,n.y=s,n.z=u,n},ye.multiplyByPoint=function(e,t,n){var r=t.x,i=t.y,o=t.z,a=e[0]*r+e[4]*i+e[8]*o+e[12],s=e[1]*r+e[5]*i+e[9]*o+e[13],u=e[2]*r+e[6]*i+e[10]*o+e[14];return n.x=a,n.y=s,n.z=u,n},ye.multiplyByScalar=function(e,t,n){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7]*t,n[8]=e[8]*t,n[9]=e[9]*t,n[10]=e[10]*t,n[11]=e[11]*t,n[12]=e[12]*t,n[13]=e[13]*t,n[14]=e[14]*t,n[15]=e[15]*t,n},ye.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t},ye.transpose=function(e,t){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[10]=e[10],t[11]=e[14],t[12]=i,t[13]=a,t[14]=s,t[15]=e[15],t},ye.abs=function(e,t){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t[4]=Math.abs(e[4]),t[5]=Math.abs(e[5]),t[6]=Math.abs(e[6]),t[7]=Math.abs(e[7]),t[8]=Math.abs(e[8]),t[9]=Math.abs(e[9]),t[10]=Math.abs(e[10]),t[11]=Math.abs(e[11]),t[12]=Math.abs(e[12]),t[13]=Math.abs(e[13]),t[14]=Math.abs(e[14]),t[15]=Math.abs(e[15]),t},ye.equals=function(t,n){return t===n||e(t)&&e(n)&&t[12]===n[12]&&t[13]===n[13]&&t[14]===n[14]&&t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]&&t[3]===n[3]&&t[7]===n[7]&&t[11]===n[11]&&t[15]===n[15]},ye.equalsEpsilon=function(t,n,r){return r=i(r,0),t===n||e(t)&&e(n)&&Math.abs(t[0]-n[0])<=r&&Math.abs(t[1]-n[1])<=r&&Math.abs(t[2]-n[2])<=r&&Math.abs(t[3]-n[3])<=r&&Math.abs(t[4]-n[4])<=r&&Math.abs(t[5]-n[5])<=r&&Math.abs(t[6]-n[6])<=r&&Math.abs(t[7]-n[7])<=r&&Math.abs(t[8]-n[8])<=r&&Math.abs(t[9]-n[9])<=r&&Math.abs(t[10]-n[10])<=r&&Math.abs(t[11]-n[11])<=r&&Math.abs(t[12]-n[12])<=r&&Math.abs(t[13]-n[13])<=r&&Math.abs(t[14]-n[14])<=r&&Math.abs(t[15]-n[15])<=r},ye.getTranslation=function(e,t){return t.x=e[12],t.y=e[13],t.z=e[14],t},ye.getMatrix3=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t};var be=new $,De=new $,Ie=new le,Re=new le(0,0,0,1);ye.inverse=function(e,t){var n=e[0],r=e[4],i=e[8],o=e[12],s=e[1],u=e[5],c=e[9],l=e[13],h=e[2],d=e[6],f=e[10],m=e[14],p=e[3],_=e[7],g=e[11],v=e[15],y=f*v,T=m*g,E=d*v,x=m*_,C=d*g,S=f*_,A=h*v,w=m*p,b=h*g,D=f*p,I=h*_,R=d*p,P=y*u+x*c+C*l-(T*u+E*c+S*l),O=T*s+A*c+D*l-(y*s+w*c+b*l),N=E*s+w*u+I*l-(x*s+A*u+R*l),M=S*s+b*u+R*c-(C*s+D*u+I*c),L=T*r+E*i+S*o-(y*r+x*i+C*o),F=y*n+w*i+b*o-(T*n+A*i+D*o),z=x*n+A*r+R*o-(E*n+w*r+I*o),B=C*n+D*r+I*i-(S*n+b*r+R*i),U=(y=i*l)*_+(x=o*u)*g+(C=r*c)*v-((T=o*c)*_+(E=r*l)*g+(S=i*u)*v),V=T*p+(A=n*l)*g+(D=i*s)*v-(y*p+(w=o*s)*g+(b=n*c)*v),H=E*p+w*_+(I=n*u)*v-(x*p+A*_+(R=r*s)*v),G=S*p+b*_+R*g-(C*p+D*_+I*g),k=E*f+S*m+T*d-(C*m+y*d+x*f),W=b*m+y*h+w*f-(A*f+D*m+T*h),q=A*d+R*m+x*h-(I*m+E*h+w*d),Y=I*f+C*h+D*d-(b*d+R*f+S*h),j=n*P+r*O+i*N+o*M;if(Math.abs(j)<a.EPSILON21){if($.equalsEpsilon(ye.getMatrix3(e,be),De,a.EPSILON7)&&le.equals(ye.getRow(e,3,Ie),Re))return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=0,t[11]=0,t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=1,t;throw new ve("matrix is not invertible because its determinate is zero.")}return j=1/j,t[0]=P*j,t[1]=O*j,t[2]=N*j,t[3]=M*j,t[4]=L*j,t[5]=F*j,t[6]=z*j,t[7]=B*j,t[8]=U*j,t[9]=V*j,t[10]=H*j,t[11]=G*j,t[12]=k*j,t[13]=W*j,t[14]=q*j,t[15]=Y*j,t},ye.inverseTransformation=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[4],a=e[5],s=e[6],u=e[8],c=e[9],l=e[10],h=e[12],d=e[13],f=e[14],m=-n*h-r*d-i*f,p=-o*h-a*d-s*f,_=-u*h-c*d-l*f;return t[0]=n,t[1]=o,t[2]=u,t[3]=0,t[4]=r,t[5]=a,t[6]=c,t[7]=0,t[8]=i,t[9]=s,t[10]=l,t[11]=0,t[12]=m,t[13]=p,t[14]=_,t[15]=1,t};var Pe=new ye;function Oe(e,t,n,r){this.west=i(e,0),this.south=i(t,0),this.east=i(n,0),this.north=i(r,0)}ye.inverseTranspose=function(e,t){return ye.inverse(ye.transpose(e,Pe),t)},ye.IDENTITY=Object.freeze(new ye(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),ye.ZERO=Object.freeze(new ye(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)),ye.COLUMN0ROW0=0,ye.COLUMN0ROW1=1,ye.COLUMN0ROW2=2,ye.COLUMN0ROW3=3,ye.COLUMN1ROW0=4,ye.COLUMN1ROW1=5,ye.COLUMN1ROW2=6,ye.COLUMN1ROW3=7,ye.COLUMN2ROW0=8,ye.COLUMN2ROW1=9,ye.COLUMN2ROW2=10,ye.COLUMN2ROW3=11,ye.COLUMN3ROW0=12,ye.COLUMN3ROW1=13,ye.COLUMN3ROW2=14,ye.COLUMN3ROW3=15,Object.defineProperties(ye.prototype,{length:{get:function(){return ye.packedLength}}}),ye.prototype.clone=function(e){return ye.clone(this,e)},ye.prototype.equals=function(e){return ye.equals(this,e)},ye.equalsArray=function(e,t,n){return e[0]===t[n]&&e[1]===t[n+1]&&e[2]===t[n+2]&&e[3]===t[n+3]&&e[4]===t[n+4]&&e[5]===t[n+5]&&e[6]===t[n+6]&&e[7]===t[n+7]&&e[8]===t[n+8]&&e[9]===t[n+9]&&e[10]===t[n+10]&&e[11]===t[n+11]&&e[12]===t[n+12]&&e[13]===t[n+13]&&e[14]===t[n+14]&&e[15]===t[n+15]},ye.prototype.equalsEpsilon=function(e,t){return ye.equalsEpsilon(this,e,t)},ye.prototype.toString=function(){return"("+this[0]+", "+this[4]+", "+this[8]+", "+this[12]+")\n("+this[1]+", "+this[5]+", "+this[9]+", "+this[13]+")\n("+this[2]+", "+this[6]+", "+this[10]+", "+this[14]+")\n("+this[3]+", "+this[7]+", "+this[11]+", "+this[15]+")"},Object.defineProperties(Oe.prototype,{width:{get:function(){return Oe.computeWidth(this)}},height:{get:function(){return Oe.computeHeight(this)}}}),Oe.packedLength=4,Oe.pack=function(e,t,n){return n=i(n,0),t[n++]=e.west,t[n++]=e.south,t[n++]=e.east,t[n]=e.north,t},Oe.unpack=function(t,n,r){return n=i(n,0),e(r)||(r=new Oe),r.west=t[n++],r.south=t[n++],r.east=t[n++],r.north=t[n],r},Oe.computeWidth=function(e){var t=e.east,n=e.west;return t<n&&(t+=a.TWO_PI),t-n},Oe.computeHeight=function(e){return e.north-e.south},Oe.fromDegrees=function(t,n,r,o,s){return t=a.toRadians(i(t,0)),n=a.toRadians(i(n,0)),r=a.toRadians(i(r,0)),o=a.toRadians(i(o,0)),e(s)?(s.west=t,s.south=n,s.east=r,s.north=o,s):new Oe(t,n,r,o)},Oe.fromRadians=function(t,n,r,o,a){return e(a)?(a.west=i(t,0),a.south=i(n,0),a.east=i(r,0),a.north=i(o,0),a):new Oe(t,n,r,o)},Oe.fromCartographicArray=function(t,n){for(var r=Number.MAX_VALUE,i=-Number.MAX_VALUE,o=Number.MAX_VALUE,s=-Number.MAX_VALUE,u=Number.MAX_VALUE,c=-Number.MAX_VALUE,l=0,h=t.length;l<h;l++){var d=t[l];r=Math.min(r,d.longitude),i=Math.max(i,d.longitude),u=Math.min(u,d.latitude),c=Math.max(c,d.latitude);var f=d.longitude>=0?d.longitude:d.longitude+a.TWO_PI;o=Math.min(o,f),s=Math.max(s,f)}return i-r>s-o&&(r=o,(i=s)>a.PI&&(i-=a.TWO_PI),r>a.PI&&(r-=a.TWO_PI)),e(n)?(n.west=r,n.south=u,n.east=i,n.north=c,n):new Oe(r,u,i,c)},Oe.fromCartesianArray=function(t,n,r){n=i(n,H.WGS84);for(var o=Number.MAX_VALUE,s=-Number.MAX_VALUE,u=Number.MAX_VALUE,c=-Number.MAX_VALUE,l=Number.MAX_VALUE,h=-Number.MAX_VALUE,d=0,f=t.length;d<f;d++){var m=n.cartesianToCartographic(t[d]);o=Math.min(o,m.longitude),s=Math.max(s,m.longitude),l=Math.min(l,m.latitude),h=Math.max(h,m.latitude);var p=m.longitude>=0?m.longitude:m.longitude+a.TWO_PI;u=Math.min(u,p),c=Math.max(c,p)}return s-o>c-u&&(o=u,(s=c)>a.PI&&(s-=a.TWO_PI),o>a.PI&&(o-=a.TWO_PI)),e(r)?(r.west=o,r.south=l,r.east=s,r.north=h,r):new Oe(o,l,s,h)},Oe.clone=function(t,n){if(e(t))return e(n)?(n.west=t.west,n.south=t.south,n.east=t.east,n.north=t.north,n):new Oe(t.west,t.south,t.east,t.north)},Oe.equalsEpsilon=function(t,n,r){return r=i(r,0),t===n||e(t)&&e(n)&&Math.abs(t.west-n.west)<=r&&Math.abs(t.south-n.south)<=r&&Math.abs(t.east-n.east)<=r&&Math.abs(t.north-n.north)<=r},Oe.prototype.clone=function(e){return Oe.clone(this,e)},Oe.prototype.equals=function(e){return Oe.equals(this,e)},Oe.equals=function(t,n){return t===n||e(t)&&e(n)&&t.west===n.west&&t.south===n.south&&t.east===n.east&&t.north===n.north},Oe.prototype.equalsEpsilon=function(e,t){return Oe.equalsEpsilon(this,e,t)},Oe.validate=function(e){},Oe.southwest=function(t,n){return e(n)?(n.longitude=t.west,n.latitude=t.south,n.height=0,n):new N(t.west,t.south)},Oe.northwest=function(t,n){return e(n)?(n.longitude=t.west,n.latitude=t.north,n.height=0,n):new N(t.west,t.north)},Oe.northeast=function(t,n){return e(n)?(n.longitude=t.east,n.latitude=t.north,n.height=0,n):new N(t.east,t.north)},Oe.southeast=function(t,n){return e(n)?(n.longitude=t.east,n.latitude=t.south,n.height=0,n):new N(t.east,t.south)},Oe.center=function(t,n){var r=t.east,i=t.west;r<i&&(r+=a.TWO_PI);var o=a.negativePiToPi(.5*(i+r)),s=.5*(t.south+t.north);return e(n)?(n.longitude=o,n.latitude=s,n.height=0,n):new N(o,s)},Oe.intersection=function(t,n,r){var i=t.east,o=t.west,s=n.east,u=n.west;i<o&&s>0?i+=a.TWO_PI:s<u&&i>0&&(s+=a.TWO_PI),i<o&&u<0?u+=a.TWO_PI:s<u&&o<0&&(o+=a.TWO_PI);var c=a.negativePiToPi(Math.max(o,u)),l=a.negativePiToPi(Math.min(i,s));if(!((t.west<t.east||n.west<n.east)&&l<=c)){var h=Math.max(t.south,n.south),d=Math.min(t.north,n.north);if(!(h>=d))return e(r)?(r.west=c,r.south=h,r.east=l,r.north=d,r):new Oe(c,h,l,d)}},Oe.simpleIntersection=function(t,n,r){var i=Math.max(t.west,n.west),o=Math.max(t.south,n.south),a=Math.min(t.east,n.east),s=Math.min(t.north,n.north);if(!(o>=s||i>=a))return e(r)?(r.west=i,r.south=o,r.east=a,r.north=s,r):new Oe(i,o,a,s)},Oe.union=function(t,n,r){e(r)||(r=new Oe);var i=t.east,o=t.west,s=n.east,u=n.west;i<o&&s>0?i+=a.TWO_PI:s<u&&i>0&&(s+=a.TWO_PI),i<o&&u<0?u+=a.TWO_PI:s<u&&o<0&&(o+=a.TWO_PI);var c=a.convertLongitudeRange(Math.min(o,u)),l=a.convertLongitudeRange(Math.max(i,s));return r.west=c,r.south=Math.min(t.south,n.south),r.east=l,r.north=Math.max(t.north,n.north),r},Oe.expand=function(t,n,r){return e(r)||(r=new Oe),r.west=Math.min(t.west,n.longitude),r.south=Math.min(t.south,n.latitude),r.east=Math.max(t.east,n.longitude),r.north=Math.max(t.north,n.latitude),r},Oe.contains=function(e,t){var n=t.longitude,r=t.latitude,i=e.west,o=e.east;return o<i&&(o+=a.TWO_PI,n<0&&(n+=a.TWO_PI)),(n>i||a.equalsEpsilon(n,i,a.EPSILON14))&&(n<o||a.equalsEpsilon(n,o,a.EPSILON14))&&r>=e.south&&r<=e.north};var Ne=new N;function Me(e,t){this.center=p.clone(i(e,p.ZERO)),this.radius=i(t,0)}Oe.subsample=function(t,n,r,o){n=i(n,H.WGS84),r=i(r,0),e(o)||(o=[]);var s=0,u=t.north,c=t.south,l=t.east,h=t.west,d=Ne;d.height=r,d.longitude=h,d.latitude=u,o[s]=n.cartographicToCartesian(d,o[s]),s++,d.longitude=l,o[s]=n.cartographicToCartesian(d,o[s]),s++,d.latitude=c,o[s]=n.cartographicToCartesian(d,o[s]),s++,d.longitude=h,o[s]=n.cartographicToCartesian(d,o[s]),s++,d.latitude=u<0?u:c>0?c:0;for(var f=1;f<8;++f)d.longitude=-Math.PI+f*a.PI_OVER_TWO,Oe.contains(t,d)&&(o[s]=n.cartographicToCartesian(d,o[s]),s++);return 0===d.latitude&&(d.longitude=h,o[s]=n.cartographicToCartesian(d,o[s]),s++,d.longitude=l,o[s]=n.cartographicToCartesian(d,o[s]),s++),o.length=s,o},Oe.MAX_VALUE=Object.freeze(new Oe(-Math.PI,-a.PI_OVER_TWO,Math.PI,a.PI_OVER_TWO));var Le=new p,Fe=new p,ze=new p,Be=new p,Ue=new p,Ve=new p,He=new p,Ge=new p,ke=new p,We=new p,qe=new p,Ye=new p,je=4/3*a.PI;Me.fromPoints=function(t,n){if(e(n)||(n=new Me),!e(t)||0===t.length)return n.center=p.clone(p.ZERO,n.center),n.radius=0,n;var r,i=p.clone(t[0],He),o=p.clone(i,Le),a=p.clone(i,Fe),s=p.clone(i,ze),u=p.clone(i,Be),c=p.clone(i,Ue),l=p.clone(i,Ve),h=t.length;for(r=1;r<h;r++){p.clone(t[r],i);var d=i.x,f=i.y,m=i.z;d<o.x&&p.clone(i,o),d>u.x&&p.clone(i,u),f<a.y&&p.clone(i,a),f>c.y&&p.clone(i,c),m<s.z&&p.clone(i,s),m>l.z&&p.clone(i,l)}var _=p.magnitudeSquared(p.subtract(u,o,Ge)),g=p.magnitudeSquared(p.subtract(c,a,Ge)),v=p.magnitudeSquared(p.subtract(l,s,Ge)),y=o,T=u,E=_;g>E&&(E=g,y=a,T=c),v>E&&(E=v,y=s,T=l);var x=ke;x.x=.5*(y.x+T.x),x.y=.5*(y.y+T.y),x.z=.5*(y.z+T.z);var C=p.magnitudeSquared(p.subtract(T,x,Ge)),S=Math.sqrt(C),A=We;A.x=o.x,A.y=a.y,A.z=s.z;var w=qe;w.x=u.x,w.y=c.y,w.z=l.z;var b=p.midpoint(A,w,Ye),D=0;for(r=0;r<h;r++){p.clone(t[r],i);var I=p.magnitude(p.subtract(i,b,Ge));I>D&&(D=I);var R=p.magnitudeSquared(p.subtract(i,x,Ge));if(R>C){var P=Math.sqrt(R);C=(S=.5*(S+P))*S;var O=P-S;x.x=(S*x.x+O*i.x)/P,x.y=(S*x.y+O*i.y)/P,x.z=(S*x.z+O*i.z)/P}}return S<D?(p.clone(x,n.center),n.radius=S):(p.clone(b,n.center),n.radius=D),n};var Xe=new K,Ze=new p,Ke=new p,Qe=new N,Je=new N;Me.fromRectangle2D=function(e,t,n){return Me.fromRectangleWithHeights2D(e,t,0,0,n)},Me.fromRectangleWithHeights2D=function(t,n,r,o,a){if(e(a)||(a=new Me),!e(t))return a.center=p.clone(p.ZERO,a.center),a.radius=0,a;n=i(n,Xe),Oe.southwest(t,Qe),Qe.height=r,Oe.northeast(t,Je),Je.height=o;var s=n.project(Qe,Ze),u=n.project(Je,Ke),c=u.x-s.x,l=u.y-s.y,h=u.z-s.z;a.radius=.5*Math.sqrt(c*c+l*l+h*h);var d=a.center;return d.x=s.x+.5*c,d.y=s.y+.5*l,d.z=s.z+.5*h,a};var $e=[];Me.fromRectangle3D=function(t,n,r,o){if(n=i(n,H.WGS84),r=i(r,0),e(o)||(o=new Me),!e(t))return o.center=p.clone(p.ZERO,o.center),o.radius=0,o;var a=Oe.subsample(t,n,r,$e);return Me.fromPoints(a,o)},Me.fromVertices=function(t,n,r,o){if(e(o)||(o=new Me),!e(t)||0===t.length)return o.center=p.clone(p.ZERO,o.center),o.radius=0,o;n=i(n,p.ZERO),r=i(r,3);var a=He;a.x=t[0]+n.x,a.y=t[1]+n.y,a.z=t[2]+n.z;var s,u=p.clone(a,Le),c=p.clone(a,Fe),l=p.clone(a,ze),h=p.clone(a,Be),d=p.clone(a,Ue),f=p.clone(a,Ve),m=t.length;for(s=0;s<m;s+=r){var _=t[s]+n.x,g=t[s+1]+n.y,v=t[s+2]+n.z;a.x=_,a.y=g,a.z=v,_<u.x&&p.clone(a,u),_>h.x&&p.clone(a,h),g<c.y&&p.clone(a,c),g>d.y&&p.clone(a,d),v<l.z&&p.clone(a,l),v>f.z&&p.clone(a,f)}var y=p.magnitudeSquared(p.subtract(h,u,Ge)),T=p.magnitudeSquared(p.subtract(d,c,Ge)),E=p.magnitudeSquared(p.subtract(f,l,Ge)),x=u,C=h,S=y;T>S&&(S=T,x=c,C=d),E>S&&(S=E,x=l,C=f);var A=ke;A.x=.5*(x.x+C.x),A.y=.5*(x.y+C.y),A.z=.5*(x.z+C.z);var w=p.magnitudeSquared(p.subtract(C,A,Ge)),b=Math.sqrt(w),D=We;D.x=u.x,D.y=c.y,D.z=l.z;var I=qe;I.x=h.x,I.y=d.y,I.z=f.z;var R=p.midpoint(D,I,Ye),P=0;for(s=0;s<m;s+=r){a.x=t[s]+n.x,a.y=t[s+1]+n.y,a.z=t[s+2]+n.z;var O=p.magnitude(p.subtract(a,R,Ge));O>P&&(P=O);var N=p.magnitudeSquared(p.subtract(a,A,Ge));if(N>w){var M=Math.sqrt(N);w=(b=.5*(b+M))*b;var L=M-b;A.x=(b*A.x+L*a.x)/M,A.y=(b*A.y+L*a.y)/M,A.z=(b*A.z+L*a.z)/M}}return b<P?(p.clone(A,o.center),o.radius=b):(p.clone(R,o.center),o.radius=P),o},Me.fromEncodedCartesianVertices=function(t,n,r){if(e(r)||(r=new Me),!e(t)||!e(n)||t.length!==n.length||0===t.length)return r.center=p.clone(p.ZERO,r.center),r.radius=0,r;var i=He;i.x=t[0]+n[0],i.y=t[1]+n[1],i.z=t[2]+n[2];var o,a=p.clone(i,Le),s=p.clone(i,Fe),u=p.clone(i,ze),c=p.clone(i,Be),l=p.clone(i,Ue),h=p.clone(i,Ve),d=t.length;for(o=0;o<d;o+=3){var f=t[o]+n[o],m=t[o+1]+n[o+1],_=t[o+2]+n[o+2];i.x=f,i.y=m,i.z=_,f<a.x&&p.clone(i,a),f>c.x&&p.clone(i,c),m<s.y&&p.clone(i,s),m>l.y&&p.clone(i,l),_<u.z&&p.clone(i,u),_>h.z&&p.clone(i,h)}var g=p.magnitudeSquared(p.subtract(c,a,Ge)),v=p.magnitudeSquared(p.subtract(l,s,Ge)),y=p.magnitudeSquared(p.subtract(h,u,Ge)),T=a,E=c,x=g;v>x&&(x=v,T=s,E=l),y>x&&(x=y,T=u,E=h);var C=ke;C.x=.5*(T.x+E.x),C.y=.5*(T.y+E.y),C.z=.5*(T.z+E.z);var S=p.magnitudeSquared(p.subtract(E,C,Ge)),A=Math.sqrt(S),w=We;w.x=a.x,w.y=s.y,w.z=u.z;var b=qe;b.x=c.x,b.y=l.y,b.z=h.z;var D=p.midpoint(w,b,Ye),I=0;for(o=0;o<d;o+=3){i.x=t[o]+n[o],i.y=t[o+1]+n[o+1],i.z=t[o+2]+n[o+2];var R=p.magnitude(p.subtract(i,D,Ge));R>I&&(I=R);var P=p.magnitudeSquared(p.subtract(i,C,Ge));if(P>S){var O=Math.sqrt(P);S=(A=.5*(A+O))*A;var N=O-A;C.x=(A*C.x+N*i.x)/O,C.y=(A*C.y+N*i.y)/O,C.z=(A*C.z+N*i.z)/O}}return A<I?(p.clone(C,r.center),r.radius=A):(p.clone(D,r.center),r.radius=I),r},Me.fromCornerPoints=function(t,n,r){e(r)||(r=new Me);var i=p.midpoint(t,n,r.center);return r.radius=p.distance(i,n),r},Me.fromEllipsoid=function(t,n){return e(n)||(n=new Me),p.clone(p.ZERO,n.center),n.radius=t.maximumRadius,n};var et=new p;Me.fromBoundingSpheres=function(t,n){if(e(n)||(n=new Me),!e(t)||0===t.length)return n.center=p.clone(p.ZERO,n.center),n.radius=0,n;var r=t.length;if(1===r)return Me.clone(t[0],n);if(2===r)return Me.union(t[0],t[1],n);var i,o=[];for(i=0;i<r;i++)o.push(t[i].center);var a=(n=Me.fromPoints(o,n)).center,s=n.radius;for(i=0;i<r;i++){var u=t[i];s=Math.max(s,p.distance(a,u.center,et)+u.radius)}return n.radius=s,n};var tt=new p,nt=new p,rt=new p;Me.fromOrientedBoundingBox=function(t,n){e(n)||(n=new Me);var r=t.halfAxes,i=$.getColumn(r,0,tt),o=$.getColumn(r,1,nt),a=$.getColumn(r,2,rt);return p.add(i,o,i),p.add(i,a,i),n.center=p.clone(t.center,n.center),n.radius=p.magnitude(i),n},Me.clone=function(t,n){if(e(t))return e(n)?(n.center=p.clone(t.center,n.center),n.radius=t.radius,n):new Me(t.center,t.radius)},Me.packedLength=4,Me.pack=function(e,t,n){n=i(n,0);var r=e.center;return t[n++]=r.x,t[n++]=r.y,t[n++]=r.z,t[n]=e.radius,t},Me.unpack=function(t,n,r){n=i(n,0),e(r)||(r=new Me);var o=r.center;return o.x=t[n++],o.y=t[n++],o.z=t[n++],r.radius=t[n],r};var it=new p,ot=new p;Me.union=function(t,n,r){e(r)||(r=new Me);var i=t.center,o=t.radius,a=n.center,s=n.radius,u=p.subtract(a,i,it),c=p.magnitude(u);if(o>=c+s)return t.clone(r),r;if(s>=c+o)return n.clone(r),r;var l=.5*(o+c+s),h=p.multiplyByScalar(u,(-o+l)/c,ot);return p.add(h,i,h),p.clone(h,r.center),r.radius=l,r};var at=new p;Me.expand=function(e,t,n){n=Me.clone(e,n);var r=p.magnitude(p.subtract(t,n.center,at));return r>n.radius&&(n.radius=r),n},Me.intersectPlane=function(e,t){var n=e.center,r=e.radius,i=t.normal,o=p.dot(i,n)+t.distance;return o<-r?Q.OUTSIDE:o<r?Q.INTERSECTING:Q.INSIDE},Me.transform=function(t,n,r){return e(r)||(r=new Me),r.center=ye.multiplyByPoint(n,t.center,r.center),r.radius=ye.getMaximumScale(n)*t.radius,r};var st=new p;Me.distanceSquaredTo=function(e,t){var n=p.subtract(e.center,t,st);return p.magnitudeSquared(n)-e.radius*e.radius},Me.transformWithoutScale=function(t,n,r){return e(r)||(r=new Me),r.center=ye.multiplyByPoint(n,t.center,r.center),r.radius=t.radius,r};var ut=new p;Me.computePlaneDistances=function(t,n,r,i){e(i)||(i=new J);var o=p.subtract(t.center,n,ut),a=p.dot(r,o);return i.start=a-t.radius,i.stop=a+t.radius,i};for(var ct=new p,lt=new p,ht=new p,dt=new p,ft=new p,mt=new N,pt=new Array(8),_t=0;_t<8;++_t)pt[_t]=new p;var gt,vt,yt,Tt=new K;function Et(e,t,n,r){return xt(e).then(t,n,r)}function xt(e){var t,n,r;return e instanceof Ct?t=e:wt(e)?(n=At(),e.then((function(e){n.resolve(e)}),(function(e){n.reject(e)}),(function(e){n.progress(e)})),t=n.promise):(r=e,t=new Ct((function(e){try{return xt(e?e(r):r)}catch(t){return St(t)}}))),t}function Ct(e){this.then=e}function St(e){return new Ct((function(t,n){try{return n?xt(n(e)):St(e)}catch(r){return St(r)}}))}function At(){var e,t,n,r,i,o;return e=new Ct(a),t=[],n=[],r=function(e,r,i){var o,a;return o=At(),a="function"==typeof i?function(e){try{o.progress(i(e))}catch(t){o.progress(t)}}:function(e){o.progress(e)},t.push((function(t){t.then(e,r).then(o.resolve,o.reject,a)})),n.push(a),o.promise},i=function(e){return Rt(n,e),e},o=function(e){return e=xt(e),r=e.then,o=xt,i=Ot,Rt(t,e),n=t=undefined,e},{then:a,resolve:s,reject:u,progress:c,promise:e,resolver:{resolve:s,reject:u,progress:c}};function a(e,t,n){return r(e,t,n)}function s(e){return o(e)}function u(e){return o(St(e))}function c(e){return i(e)}}function wt(e){return e&&"function"==typeof e.then}function bt(e,t,n,r,i){return Pt(2,arguments),Et(e,(function(e){var o,a,s,u,c,l,h,d,f,m;if(f=e.length>>>0,o=Math.max(0,Math.min(t,f)),s=[],a=f-o+1,u=[],c=At(),o)for(d=c.progress,h=function(e){u.push(e),--a||(l=h=Ot,c.reject(u))},l=function(e){s.push(e),--o||(l=h=Ot,c.resolve(s))},m=0;m<f;++m)m in e&&Et(e[m],_,p,d);else c.resolve(s);return c.then(n,r,i);function p(e){h(e)}function _(e){l(e)}}))}function Dt(e,t,n,r){return Pt(1,arguments),It(e,Nt).then(t,n,r)}function It(e,t){return Et(e,(function(e){var n,r,i,o,a,s;if(i=r=e.length>>>0,n=[],s=At(),i)for(o=function(e,r){Et(e,t).then((function(e){n[r]=e,--i||s.resolve(n)}),s.reject)},a=0;a<r;a++)a in e?o(e[a],a):--i;else s.resolve(n);return s.promise}))}function Rt(e,t){for(var n,r=0;n=e[r++];)n(t)}function Pt(e,t){for(var n,r=t.length;r>e;)if(null!=(n=t[--r])&&"function"!=typeof n)throw new Error("arg "+r+" must be a function")}function Ot(){}function Nt(e){return e}Me.projectTo2D=function(e,t,n){var r,o=(t=i(t,Tt)).ellipsoid,a=e.center,s=e.radius;r=p.equals(a,p.ZERO)?p.clone(p.UNIT_X,ct):o.geodeticSurfaceNormal(a,ct);var u=p.cross(p.UNIT_Z,r,lt);p.normalize(u,u);var c=p.cross(r,u,ht);p.normalize(c,c),p.multiplyByScalar(r,s,r),p.multiplyByScalar(c,s,c),p.multiplyByScalar(u,s,u);var l=p.negate(c,ft),h=p.negate(u,dt),d=pt,f=d[0];p.add(r,c,f),p.add(f,u,f),f=d[1],p.add(r,c,f),p.add(f,h,f),f=d[2],p.add(r,l,f),p.add(f,h,f),f=d[3],p.add(r,l,f),p.add(f,u,f),p.negate(r,r),f=d[4],p.add(r,c,f),p.add(f,u,f),f=d[5],p.add(r,c,f),p.add(f,h,f),f=d[6],p.add(r,l,f),p.add(f,h,f),f=d[7],p.add(r,l,f),p.add(f,u,f);for(var m=d.length,_=0;_<m;++_){var g=d[_];p.add(a,g,g);var v=o.cartesianToCartographic(g,mt);t.project(v,g)}var y=(a=(n=Me.fromPoints(d,n)).center).x,T=a.y,E=a.z;return a.x=E,a.y=y,a.z=T,n},Me.isOccluded=function(e,t){return!t.isBoundingSphereVisible(e)},Me.equals=function(t,n){return t===n||e(t)&&e(n)&&p.equals(t.center,n.center)&&t.radius===n.radius},Me.prototype.intersectPlane=function(e){return Me.intersectPlane(this,e)},Me.prototype.distanceSquaredTo=function(e){return Me.distanceSquaredTo(this,e)},Me.prototype.computePlaneDistances=function(e,t,n){return Me.computePlaneDistances(this,e,t,n)},Me.prototype.isOccluded=function(e){return Me.isOccluded(this,e)},Me.prototype.equals=function(e){return Me.equals(this,e)},Me.prototype.clone=function(e){return Me.clone(this,e)},Me.prototype.volume=function(){var e=this.radius;return je*e*e*e},Et.defer=At,Et.resolve=xt,Et.reject=function(e){return Et(e,St)},Et.join=function(){return It(arguments,Nt)},Et.all=Dt,Et.map=It,Et.reduce=function(e,t){var n=vt.call(arguments,1);return Et(e,(function(e){var r;return r=e.length,n[0]=function(e,n,i){return Et(e,(function(e){return Et(n,(function(n){return t(e,n,i,r)}))}))},gt.apply(e,n)}))},Et.any=function(e,t,n,r){return bt(e,1,(function(e){return t?t(e[0]):e[0]}),n,r)},Et.some=bt,Et.chain=function(e,t,n){var r=arguments.length>2;return Et(e,(function(e){return e=r?n:e,t.resolve(e),e}),(function(e){return t.reject(e),St(e)}),t.progress)},Et.isPromise=wt,Ct.prototype={always:function(e,t){return this.then(e,e,t)},otherwise:function(e){return this.then(undefined,e)},yield:function(e){return this.then((function(){return e}))},spread:function(e){return this.then((function(t){return Dt(t,(function(t){return e.apply(undefined,t)}))}))}},vt=[].slice,gt=[].reduce||function(e){var t,n,r,i,o;if(o=0,i=(t=Object(this)).length>>>0,(n=arguments).length<=1)for(;;){if(o in t){r=t[o++];break}if(++o>=i)throw new TypeError}else r=n[1];for(;o<i;++o)o in t&&(r=e(r,t[o],o,t));return r};var Mt,Lt,Ft,zt,Bt,Ut,Vt,Ht,Gt,kt,Wt,qt,Yt,jt,Xt,Zt,Kt,Qt={requestFullscreen:void 0,exitFullscreen:void 0,fullscreenEnabled:void 0,fullscreenElement:void 0,fullscreenchange:void 0,fullscreenerror:void 0},Jt={};function $t(e){for(var t=e.split("."),n=0,r=t.length;n<r;++n)t[n]=parseInt(t[n],10);return t}function en(){if(!e(Lt)&&(Lt=!1,!on())){var t=/ Chrome\/([\.0-9]+)/.exec(Mt.userAgent);null!==t&&(Lt=!0,Ft=$t(t[1]))}return Lt}function tn(){if(!e(zt)&&(zt=!1,!en()&&!on()&&/ Safari\/[\.0-9]+/.test(Mt.userAgent))){var t=/ Version\/([\.0-9]+)/.exec(Mt.userAgent);null!==t&&(zt=!0,Bt=$t(t[1]))}return zt}function nn(){if(!e(Ut)){Ut=!1;var t=/ AppleWebKit\/([\.0-9]+)(\+?)/.exec(Mt.userAgent);null!==t&&(Ut=!0,(Vt=$t(t[1])).isNightly=!!t[2])}return Ut}function rn(){var t;e(Ht)||(Ht=!1,"Microsoft Internet Explorer"===Mt.appName?null!==(t=/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(Mt.userAgent))&&(Ht=!0,Gt=$t(t[1])):"Netscape"===Mt.appName&&null!==(t=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(Mt.userAgent))&&(Ht=!0,Gt=$t(t[1])));return Ht}function on(){if(!e(kt)){kt=!1;var t=/ Edge\/([\.0-9]+)/.exec(Mt.userAgent);null!==t&&(kt=!0,Wt=$t(t[1]))}return kt}function an(){if(!e(qt)){qt=!1;var t=/Firefox\/([\.0-9]+)/.exec(Mt.userAgent);null!==t&&(qt=!0,Yt=$t(t[1]))}return qt}function sn(){if(!e(Kt)){var t=document.createElement("canvas");t.setAttribute("style","image-rendering: -moz-crisp-edges;image-rendering: pixelated;");var n=t.style.imageRendering;(Kt=e(n)&&""!==n)&&(Zt=n)}return Kt}function un(){return un._result}Object.defineProperties(Jt,{element:{get:function(){if(Jt.supportsFullscreen())return document[Qt.fullscreenElement]}},changeEventName:{get:function(){if(Jt.supportsFullscreen())return Qt.fullscreenchange}},errorEventName:{get:function(){if(Jt.supportsFullscreen())return Qt.fullscreenerror}},enabled:{get:function(){if(Jt.supportsFullscreen())return document[Qt.fullscreenEnabled]}},fullscreen:{get:function(){if(Jt.supportsFullscreen())return null!==Jt.element}}}),Jt.supportsFullscreen=function(){if(e(yt))return yt;yt=!1;var t=document.body;if("function"==typeof t.requestFullscreen)return Qt.requestFullscreen="requestFullscreen",Qt.exitFullscreen="exitFullscreen",Qt.fullscreenEnabled="fullscreenEnabled",Qt.fullscreenElement="fullscreenElement",Qt.fullscreenchange="fullscreenchange",Qt.fullscreenerror="fullscreenerror",yt=!0;for(var n,r=["webkit","moz","o","ms","khtml"],i=0,o=r.length;i<o;++i){var a=r[i];("function"==typeof t[n=a+"RequestFullscreen"]||"function"==typeof t[n=a+"RequestFullScreen"])&&(Qt.requestFullscreen=n,yt=!0),n=a+"ExitFullscreen","function"==typeof document[n]?Qt.exitFullscreen=n:(n=a+"CancelFullScreen","function"==typeof document[n]&&(Qt.exitFullscreen=n)),n=a+"FullscreenEnabled",void 0!==document[n]?Qt.fullscreenEnabled=n:(n=a+"FullScreenEnabled",void 0!==document[n]&&(Qt.fullscreenEnabled=n)),n=a+"FullscreenElement",void 0!==document[n]?Qt.fullscreenElement=n:(n=a+"FullScreenElement",void 0!==document[n]&&(Qt.fullscreenElement=n)),n=a+"fullscreenchange",void 0!==document["on"+n]&&("ms"===a&&(n="MSFullscreenChange"),Qt.fullscreenchange=n),n=a+"fullscreenerror",void 0!==document["on"+n]&&("ms"===a&&(n="MSFullscreenError"),Qt.fullscreenerror=n)}return yt},Jt.requestFullscreen=function(e,t){Jt.supportsFullscreen()&&e[Qt.requestFullscreen]({vrDisplay:t})},Jt.exitFullscreen=function(){Jt.supportsFullscreen()&&document[Qt.exitFullscreen]()},Jt._names=Qt,Mt="undefined"!=typeof navigator?navigator:{},un._promise=void 0,un._result=void 0,un.initialize=function(){if(e(un._promise))return un._promise;var t=Et.defer();if(un._promise=t.promise,on())return un._result=!1,t.resolve(un._result),t.promise;var n=new Image;return n.onload=function(){un._result=n.width>0&&n.height>0,t.resolve(un._result)},n.onerror=function(){un._result=!1,t.resolve(un._result)},n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.promise},Object.defineProperties(un,{initialized:{get:function(){return e(un._result)}}});var cn=[];"undefined"!=typeof ArrayBuffer&&(cn.push(Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array),"undefined"!=typeof Uint8ClampedArray&&cn.push(Uint8ClampedArray),"undefined"!=typeof Uint8ClampedArray&&cn.push(Uint8ClampedArray));var ln,hn,dn,fn={isChrome:en,chromeVersion:function(){return en()&&Ft},isSafari:tn,safariVersion:function(){return tn()&&Bt},isWebkit:nn,webkitVersion:function(){return nn()&&Vt},isInternetExplorer:rn,internetExplorerVersion:function(){return rn()&&Gt},isEdge:on,edgeVersion:function(){return on()&&Wt},isFirefox:an,firefoxVersion:function(){return an()&&Yt},isWindows:function(){return e(jt)||(jt=/Windows/i.test(Mt.appVersion)),jt},hardwareConcurrency:i(Mt.hardwareConcurrency,3),supportsPointerEvents:function(){return e(Xt)||(Xt=!an()&&"undefined"!=typeof PointerEvent&&(!e(Mt.pointerEnabled)||Mt.pointerEnabled)),Xt},supportsImageRenderingPixelated:sn,supportsWebP:un,imageRenderingValue:function(){return sn()?Zt:void 0},typedArrayTypes:cn};function mn(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),6*n<1?e+6*(t-e)*n:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}function pn(e,t,n,r){this.red=i(e,1),this.green=i(t,1),this.blue=i(n,1),this.alpha=i(r,1)}fn.supportsFullscreen=function(){return Jt.supportsFullscreen()},fn.supportsTypedArrays=function(){return"undefined"!=typeof ArrayBuffer},fn.supportsWebWorkers=function(){return"undefined"!=typeof Worker},fn.supportsWebAssembly=function(){return"undefined"!=typeof WebAssembly&&!fn.isEdge()},pn.fromCartesian4=function(t,n){return e(n)?(n.red=t.x,n.green=t.y,n.blue=t.z,n.alpha=t.w,n):new pn(t.x,t.y,t.z,t.w)},pn.fromBytes=function(t,n,r,o,a){return t=pn.byteToFloat(i(t,255)),n=pn.byteToFloat(i(n,255)),r=pn.byteToFloat(i(r,255)),o=pn.byteToFloat(i(o,255)),e(a)?(a.red=t,a.green=n,a.blue=r,a.alpha=o,a):new pn(t,n,r,o)},pn.fromAlpha=function(t,n,r){return e(r)?(r.red=t.red,r.green=t.green,r.blue=t.blue,r.alpha=n,r):new pn(t.red,t.green,t.blue,n)},fn.supportsTypedArrays()&&(ln=new ArrayBuffer(4),hn=new Uint32Array(ln),dn=new Uint8Array(ln)),pn.fromRgba=function(e,t){return hn[0]=e,pn.fromBytes(dn[0],dn[1],dn[2],dn[3],t)},pn.fromHsl=function(t,n,r,o,a){t=i(t,0)%1,n=i(n,0),r=i(r,0),o=i(o,1);var s=r,u=r,c=r;if(0!==n){var l,h=2*r-(l=r<.5?r*(1+n):r+n-r*n);s=mn(h,l,t+1/3),u=mn(h,l,t),c=mn(h,l,t-1/3)}return e(a)?(a.red=s,a.green=u,a.blue=c,a.alpha=o,a):new pn(s,u,c,o)},pn.fromRandom=function(t,n){var r=(t=i(t,i.EMPTY_OBJECT)).red;if(!e(r)){var o=i(t.minimumRed,0),s=i(t.maximumRed,1);r=o+a.nextRandomNumber()*(s-o)}var u=t.green;if(!e(u)){var c=i(t.minimumGreen,0),l=i(t.maximumGreen,1);u=c+a.nextRandomNumber()*(l-c)}var h=t.blue;if(!e(h)){var d=i(t.minimumBlue,0),f=i(t.maximumBlue,1);h=d+a.nextRandomNumber()*(f-d)}var m=t.alpha;if(!e(m)){var p=i(t.minimumAlpha,0),_=i(t.maximumAlpha,1);m=p+a.nextRandomNumber()*(_-p)}return e(n)?(n.red=r,n.green=u,n.blue=h,n.alpha=m,n):new pn(r,u,h,m)};var _n=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,gn=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,vn=/^rgba?\(\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)(?:\s*,\s*([0-9.]+))?\s*\)$/i,yn=/^hsla?\(\s*([0-9.]+)\s*,\s*([0-9.]+%)\s*,\s*([0-9.]+%)(?:\s*,\s*([0-9.]+))?\s*\)$/i;pn.fromCssColorString=function(t,n){e(n)||(n=new pn);var r=pn[(t=t.replace(/\s/g,"")).toUpperCase()];if(e(r))return pn.clone(r,n),n;var o=_n.exec(t);return null!==o?(n.red=parseInt(o[1],16)/15,n.green=parseInt(o[2],16)/15,n.blue=parseInt(o[3],16)/15,n.alpha=parseInt(i(o[4],"f"),16)/15,n):null!==(o=gn.exec(t))?(n.red=parseInt(o[1],16)/255,n.green=parseInt(o[2],16)/255,n.blue=parseInt(o[3],16)/255,n.alpha=parseInt(i(o[4],"ff"),16)/255,n):null!==(o=vn.exec(t))?(n.red=parseFloat(o[1])/("%"===o[1].substr(-1)?100:255),n.green=parseFloat(o[2])/("%"===o[2].substr(-1)?100:255),n.blue=parseFloat(o[3])/("%"===o[3].substr(-1)?100:255),n.alpha=parseFloat(i(o[4],"1.0")),n):null!==(o=yn.exec(t))?pn.fromHsl(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,parseFloat(i(o[4],"1.0")),n):n=void 0},pn.packedLength=4,pn.pack=function(e,t,n){return n=i(n,0),t[n++]=e.red,t[n++]=e.green,t[n++]=e.blue,t[n]=e.alpha,t},pn.unpack=function(t,n,r){return n=i(n,0),e(r)||(r=new pn),r.red=t[n++],r.green=t[n++],r.blue=t[n++],r.alpha=t[n],r},pn.byteToFloat=function(e){return e/255},pn.floatToByte=function(e){return 1===e?255:256*e|0},pn.clone=function(t,n){if(e(t))return e(n)?(n.red=t.red,n.green=t.green,n.blue=t.blue,n.alpha=t.alpha,n):new pn(t.red,t.green,t.blue,t.alpha)},pn.equals=function(t,n){return t===n||e(t)&&e(n)&&t.red===n.red&&t.green===n.green&&t.blue===n.blue&&t.alpha===n.alpha},pn.equalsArray=function(e,t,n){return e.red===t[n]&&e.green===t[n+1]&&e.blue===t[n+2]&&e.alpha===t[n+3]},pn.prototype.clone=function(e){return pn.clone(this,e)},pn.prototype.equals=function(e){return pn.equals(this,e)},pn.prototype.equalsEpsilon=function(t,n){return this===t||e(t)&&Math.abs(this.red-t.red)<=n&&Math.abs(this.green-t.green)<=n&&Math.abs(this.blue-t.blue)<=n&&Math.abs(this.alpha-t.alpha)<=n},pn.prototype.toString=function(){return"("+this.red+", "+this.green+", "+this.blue+", "+this.alpha+")"},pn.prototype.toCssColorString=function(){var e=pn.floatToByte(this.red),t=pn.floatToByte(this.green),n=pn.floatToByte(this.blue);return 1===this.alpha?"rgb("+e+","+t+","+n+")":"rgba("+e+","+t+","+n+","+this.alpha+")"},pn.prototype.toCssHexString=function(){var e=pn.floatToByte(this.red).toString(16);e.length<2&&(e="0"+e);var t=pn.floatToByte(this.green).toString(16);t.length<2&&(t="0"+t);var n=pn.floatToByte(this.blue).toString(16);if(n.length<2&&(n="0"+n),this.alpha<1){var r=pn.floatToByte(this.alpha).toString(16);return r.length<2&&(r="0"+r),"#"+e+t+n+r}return"#"+e+t+n},pn.prototype.toBytes=function(t){var n=pn.floatToByte(this.red),r=pn.floatToByte(this.green),i=pn.floatToByte(this.blue),o=pn.floatToByte(this.alpha);return e(t)?(t[0]=n,t[1]=r,t[2]=i,t[3]=o,t):[n,r,i,o]},pn.prototype.toRgba=function(){return dn[0]=pn.floatToByte(this.red),dn[1]=pn.floatToByte(this.green),dn[2]=pn.floatToByte(this.blue),dn[3]=pn.floatToByte(this.alpha),hn[0]},pn.prototype.brighten=function(e,t){return e=1-e,t.red=1-(1-this.red)*e,t.green=1-(1-this.green)*e,t.blue=1-(1-this.blue)*e,t.alpha=this.alpha,t},pn.prototype.darken=function(e,t){return e=1-e,t.red=this.red*e,t.green=this.green*e,t.blue=this.blue*e,t.alpha=this.alpha,t},pn.prototype.withAlpha=function(e,t){return pn.fromAlpha(this,e,t)},pn.add=function(e,t,n){return n.red=e.red+t.red,n.green=e.green+t.green,n.blue=e.blue+t.blue,n.alpha=e.alpha+t.alpha,n},pn.subtract=function(e,t,n){return n.red=e.red-t.red,n.green=e.green-t.green,n.blue=e.blue-t.blue,n.alpha=e.alpha-t.alpha,n},pn.multiply=function(e,t,n){return n.red=e.red*t.red,n.green=e.green*t.green,n.blue=e.blue*t.blue,n.alpha=e.alpha*t.alpha,n},pn.divide=function(e,t,n){return n.red=e.red/t.red,n.green=e.green/t.green,n.blue=e.blue/t.blue,n.alpha=e.alpha/t.alpha,n},pn.mod=function(e,t,n){return n.red=e.red%t.red,n.green=e.green%t.green,n.blue=e.blue%t.blue,n.alpha=e.alpha%t.alpha,n},pn.lerp=function(e,t,n,r){return r.red=a.lerp(e.red,t.red,n),r.green=a.lerp(e.green,t.green,n),r.blue=a.lerp(e.blue,t.blue,n),r.alpha=a.lerp(e.alpha,t.alpha,n),r},pn.multiplyByScalar=function(e,t,n){return n.red=e.red*t,n.green=e.green*t,n.blue=e.blue*t,n.alpha=e.alpha*t,n},pn.divideByScalar=function(e,t,n){return n.red=e.red/t,n.green=e.green/t,n.blue=e.blue/t,n.alpha=e.alpha/t,n},pn.WHITE=Object.freeze(pn.fromCssColorString("#FFFFFF")),pn.TRANSPARENT=Object.freeze(new pn(0,0,0,0));var Tn=Object.freeze({DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047}),En={BYTE:Tn.BYTE,UNSIGNED_BYTE:Tn.UNSIGNED_BYTE,SHORT:Tn.SHORT,UNSIGNED_SHORT:Tn.UNSIGNED_SHORT,INT:Tn.INT,UNSIGNED_INT:Tn.UNSIGNED_INT,FLOAT:Tn.FLOAT,DOUBLE:Tn.DOUBLE,getSizeInBytes:function(e){switch(e){case En.BYTE:return Int8Array.BYTES_PER_ELEMENT;case En.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case En.SHORT:return Int16Array.BYTES_PER_ELEMENT;case En.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case En.INT:return Int32Array.BYTES_PER_ELEMENT;case En.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case En.FLOAT:return Float32Array.BYTES_PER_ELEMENT;case En.DOUBLE:return Float64Array.BYTES_PER_ELEMENT}},fromTypedArray:function(e){return e instanceof Int8Array?En.BYTE:e instanceof Uint8Array?En.UNSIGNED_BYTE:e instanceof Int16Array?En.SHORT:e instanceof Uint16Array?En.UNSIGNED_SHORT:e instanceof Int32Array?En.INT:e instanceof Uint32Array?En.UNSIGNED_INT:e instanceof Float32Array?En.FLOAT:e instanceof Float64Array?En.DOUBLE:void 0},validate:function(t){return e(t)&&(t===En.BYTE||t===En.UNSIGNED_BYTE||t===En.SHORT||t===En.UNSIGNED_SHORT||t===En.INT||t===En.UNSIGNED_INT||t===En.FLOAT||t===En.DOUBLE)},createTypedArray:function(e,t){switch(e){case En.BYTE:return new Int8Array(t);case En.UNSIGNED_BYTE:return new Uint8Array(t);case En.SHORT:return new Int16Array(t);case En.UNSIGNED_SHORT:return new Uint16Array(t);case En.INT:return new Int32Array(t);case En.UNSIGNED_INT:return new Uint32Array(t);case En.FLOAT:return new Float32Array(t);case En.DOUBLE:return new Float64Array(t)}},createArrayBufferView:function(e,t,n,r){switch(n=i(n,0),r=i(r,(t.byteLength-n)/En.getSizeInBytes(e)),e){case En.BYTE:return new Int8Array(t,n,r);case En.UNSIGNED_BYTE:return new Uint8Array(t,n,r);case En.SHORT:return new Int16Array(t,n,r);case En.UNSIGNED_SHORT:return new Uint16Array(t,n,r);case En.INT:return new Int32Array(t,n,r);case En.UNSIGNED_INT:return new Uint32Array(t,n,r);case En.FLOAT:return new Float32Array(t,n,r);case En.DOUBLE:return new Float64Array(t,n,r)}},fromName:function(e){switch(e){case"BYTE":return En.BYTE;case"UNSIGNED_BYTE":return En.UNSIGNED_BYTE;case"SHORT":return En.SHORT;case"UNSIGNED_SHORT":return En.UNSIGNED_SHORT;case"INT":return En.INT;case"UNSIGNED_INT":return En.UNSIGNED_INT;case"FLOAT":return En.FLOAT;case"DOUBLE":return En.DOUBLE}}},xn=Object.freeze(En);function Cn(){this.high=p.clone(p.ZERO),this.low=p.clone(p.ZERO)}Cn.encode=function(t,n){var r;return e(n)||(n={high:0,low:0}),t>=0?(r=65536*Math.floor(t/65536),n.high=r,n.low=t-r):(r=65536*Math.floor(-t/65536),n.high=-r,n.low=t+r),n};var Sn={high:0,low:0};Cn.fromCartesian=function(t,n){e(n)||(n=new Cn);var r=n.high,i=n.low;return Cn.encode(t.x,Sn),r.x=Sn.high,i.x=Sn.low,Cn.encode(t.y,Sn),r.y=Sn.high,i.y=Sn.low,Cn.encode(t.z,Sn),r.z=Sn.high,i.z=Sn.low,n};var An=new Cn;function wn(e,t,n){this.heading=i(e,0),this.pitch=i(t,0),this.roll=i(n,0)}Cn.writeElements=function(e,t,n){Cn.fromCartesian(e,An);var r=An.high,i=An.low;t[n]=r.x,t[n+1]=r.y,t[n+2]=r.z,t[n+3]=i.x,t[n+4]=i.y,t[n+5]=i.z},wn.fromQuaternion=function(t,n){e(n)||(n=new wn);var r=2*(t.w*t.y-t.z*t.x),i=1-2*(t.x*t.x+t.y*t.y),o=2*(t.w*t.x+t.y*t.z),s=1-2*(t.y*t.y+t.z*t.z),u=2*(t.w*t.z+t.x*t.y);return n.heading=-Math.atan2(u,s),n.roll=Math.atan2(o,i),n.pitch=-a.asinClamped(r),n},wn.fromDegrees=function(t,n,r,i){return e(i)||(i=new wn),i.heading=t*a.RADIANS_PER_DEGREE,i.pitch=n*a.RADIANS_PER_DEGREE,i.roll=r*a.RADIANS_PER_DEGREE,i},wn.clone=function(t,n){if(e(t))return e(n)?(n.heading=t.heading,n.pitch=t.pitch,n.roll=t.roll,n):new wn(t.heading,t.pitch,t.roll)},wn.equals=function(t,n){return t===n||e(t)&&e(n)&&t.heading===n.heading&&t.pitch===n.pitch&&t.roll===n.roll},wn.equalsEpsilon=function(t,n,r,i){return t===n||e(t)&&e(n)&&a.equalsEpsilon(t.heading,n.heading,r,i)&&a.equalsEpsilon(t.pitch,n.pitch,r,i)&&a.equalsEpsilon(t.roll,n.roll,r,i)},wn.prototype.clone=function(e){return wn.clone(this,e)},wn.prototype.equals=function(e){return wn.equals(this,e)},wn.prototype.equalsEpsilon=function(e,t,n){return wn.equalsEpsilon(this,e,t,n)},wn.prototype.toString=function(){return"("+this.heading+", "+this.pitch+", "+this.roll+")"};var bn={UNSIGNED_BYTE:Tn.UNSIGNED_BYTE,UNSIGNED_SHORT:Tn.UNSIGNED_SHORT,UNSIGNED_INT:Tn.UNSIGNED_INT,getSizeInBytes:function(e){switch(e){case bn.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case bn.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case bn.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT}},fromSizeInBytes:function(e){switch(e){case 2:return bn.UNSIGNED_SHORT;case 4:return bn.UNSIGNED_INT;case 1:return bn.UNSIGNED_BYTE}},validate:function(t){return e(t)&&(t===bn.UNSIGNED_BYTE||t===bn.UNSIGNED_SHORT||t===bn.UNSIGNED_INT)},createTypedArray:function(e,t){return e>=a.SIXTY_FOUR_KILOBYTES?new Uint32Array(t):new Uint16Array(t)},createTypedArrayFromArrayBuffer:function(e,t,n,r){return e>=a.SIXTY_FOUR_KILOBYTES?new Uint32Array(t,n,r):new Uint16Array(t,n,r)}},Dn=Object.freeze(bn),In={};function Rn(e,t,n){var r=e+t;return a.sign(e)!==a.sign(t)&&Math.abs(r/Math.max(Math.abs(e),Math.abs(t)))<n?0:r}In.computeDiscriminant=function(e,t,n){return t*t-4*e*n},In.computeRealRoots=function(e,t,n){var r;if(0===e)return 0===t?[]:[-n/t];if(0===t){if(0===n)return[0,0];var i=Math.abs(n),o=Math.abs(e);if(i<o&&i/o<a.EPSILON14)return[0,0];if(i>o&&o/i<a.EPSILON14)return[];if((r=-n/e)<0)return[];var s=Math.sqrt(r);return[-s,s]}if(0===n)return(r=-t/e)<0?[r,0]:[0,r];var u=Rn(t*t,-(4*e*n),a.EPSILON14);if(u<0)return[];var c=-.5*Rn(t,a.sign(t)*Math.sqrt(u),a.EPSILON14);return t>0?[c/e,n/c]:[n/c,c/e]};var Pn={};function On(e,t,n,r){var i,o,a=e,s=t/3,u=n/3,c=r,l=a*u,h=s*c,d=s*s,f=u*u,m=a*u-d,p=a*c-s*u,_=s*c-f,g=4*m*_-p*p;if(g<0){var v,y,T;d*h>=l*f?(v=a,y=m,T=-2*s*m+a*p):(v=c,y=_,T=-c*p+2*u*_);var E=-(T<0?-1:1)*Math.abs(v)*Math.sqrt(-g),x=(o=-T+E)/2,C=x<0?-Math.pow(-x,1/3):Math.pow(x,1/3),S=o===E?-C:-y/C;return i=y<=0?C+S:-T/(C*C+S*S+y),d*h>=l*f?[(i-s)/a]:[-c/(i+u)]}var A=m,w=-2*s*m+a*p,b=_,D=-c*p+2*u*_,I=Math.sqrt(g),R=Math.sqrt(3)/2,P=Math.abs(Math.atan2(a*I,-w)/3);i=2*Math.sqrt(-A);var O=Math.cos(P);o=i*O;var N=i*(-O/2-R*Math.sin(P)),M=o+N>2*s?o-s:N-s,L=a,F=M/L;P=Math.abs(Math.atan2(c*I,-D)/3);var z=-c,B=(o=(i=2*Math.sqrt(-b))*(O=Math.cos(P)))+(N=i*(-O/2-R*Math.sin(P)))<2*u?o+u:N+u,U=z/B,V=-M*B-L*z,H=(u*V-s*(M*z))/(-s*V+u*(L*B));return F<=H?F<=U?H<=U?[F,H,U]:[F,U,H]:[U,F,H]:F<=U?[H,F,U]:H<=U?[H,U,F]:[U,H,F]}Pn.computeDiscriminant=function(e,t,n,r){var i=t*t,o=n*n;return 18*e*t*n*r+i*o-27*(e*e)*(r*r)-4*(e*o*n+i*t*r)},Pn.computeRealRoots=function(e,t,n,r){var i,o;if(0===e)return In.computeRealRoots(t,n,r);if(0===t){if(0===n){if(0===r)return[0,0,0];var a=(o=-r/e)<0?-Math.pow(-o,1/3):Math.pow(o,1/3);return[a,a,a]}return 0===r?0===(i=In.computeRealRoots(e,0,n)).Length?[0]:[i[0],0,i[1]]:On(e,0,n,r)}return 0===n?0===r?(o=-t/e)<0?[o,0,0]:[0,0,o]:On(e,t,0,r):0===r?0===(i=In.computeRealRoots(e,t,n)).length?[0]:i[1]<=0?[i[0],i[1],0]:i[0]>=0?[0,i[0],i[1]]:[i[0],0,i[1]]:On(e,t,n,r)};var Nn={};function Mn(e,t,n,r){var i=e*e,o=t-3*i/8,s=n-t*e/2+i*e/8,u=r-n*e/4+t*i/16-3*i*i/256,c=Pn.computeRealRoots(1,2*o,o*o-4*u,-s*s);if(c.length>0){var l=-e/4,h=c[c.length-1];if(Math.abs(h)<a.EPSILON14){var d=In.computeRealRoots(1,o,u);if(2===d.length){var f,m=d[0],p=d[1];if(m>=0&&p>=0){var _=Math.sqrt(m),g=Math.sqrt(p);return[l-g,l-_,l+_,l+g]}if(m>=0&&p<0)return[l-(f=Math.sqrt(m)),l+f];if(m<0&&p>=0)return[l-(f=Math.sqrt(p)),l+f]}return[]}if(h>0){var v=Math.sqrt(h),y=(o+h-s/v)/2,T=(o+h+s/v)/2,E=In.computeRealRoots(1,v,y),x=In.computeRealRoots(1,-v,T);return 0!==E.length?(E[0]+=l,E[1]+=l,0!==x.length?(x[0]+=l,x[1]+=l,E[1]<=x[0]?[E[0],E[1],x[0],x[1]]:x[1]<=E[0]?[x[0],x[1],E[0],E[1]]:E[0]>=x[0]&&E[1]<=x[1]?[x[0],E[0],E[1],x[1]]:x[0]>=E[0]&&x[1]<=E[1]?[E[0],x[0],x[1],E[1]]:E[0]>x[0]&&E[0]<x[1]?[x[0],E[0],x[1],E[1]]:[E[0],x[0],E[1],x[1]]):E):0!==x.length?(x[0]+=l,x[1]+=l,x):[]}}return[]}function Ln(e,t,n,r){var i=e*e,o=-2*t,s=n*e+t*t-4*r,u=i*r-n*t*e+n*n,c=Pn.computeRealRoots(1,o,s,u);if(c.length>0){var l,h,d,f,m,p,_=c[0],g=t-_,v=g*g,y=e/2,T=g/2,E=v-4*r,x=v+4*Math.abs(r),C=i-4*_,S=i+4*Math.abs(_);if(_<0||E*S<C*x){var A=Math.sqrt(C);l=A/2,h=0===A?0:(e*T-n)/A}else{var w=Math.sqrt(E);l=0===w?0:(e*T-n)/w,h=w/2}0===y&&0===l?(d=0,f=0):a.sign(y)===a.sign(l)?f=_/(d=y+l):d=_/(f=y-l),0===T&&0===h?(m=0,p=0):a.sign(T)===a.sign(h)?p=r/(m=T+h):m=r/(p=T-h);var b=In.computeRealRoots(1,d,m),D=In.computeRealRoots(1,f,p);if(0!==b.length)return 0!==D.length?b[1]<=D[0]?[b[0],b[1],D[0],D[1]]:D[1]<=b[0]?[D[0],D[1],b[0],b[1]]:b[0]>=D[0]&&b[1]<=D[1]?[D[0],b[0],b[1],D[1]]:D[0]>=b[0]&&D[1]<=b[1]?[b[0],D[0],D[1],b[1]]:b[0]>D[0]&&b[0]<D[1]?[D[0],b[0],D[1],b[1]]:[b[0],D[0],b[1],D[1]]:b;if(0!==D.length)return D}return[]}function Fn(e,t){t=p.clone(i(t,p.ZERO)),p.equals(t,p.ZERO)||p.normalize(t,t),this.origin=p.clone(i(e,p.ZERO)),this.direction=t}Nn.computeDiscriminant=function(e,t,n,r,i){var o=e*e,a=t*t,s=a*t,u=n*n,c=u*n,l=r*r,h=l*r,d=i*i;return a*u*l-4*s*h-4*e*c*l+18*e*t*n*h-27*o*l*l+256*(o*e)*(d*i)+i*(18*s*n*r-4*a*c+16*e*u*u-80*e*t*u*r-6*e*a*l+144*o*n*l)+d*(144*e*a*n-27*a*a-128*o*u-192*o*t*r)},Nn.computeRealRoots=function(e,t,n,r,i){if(Math.abs(e)<a.EPSILON15)return Pn.computeRealRoots(t,n,r,i);var o=t/e,s=n/e,u=r/e,c=i/e,l=o<0?1:0;switch(l+=s<0?l+1:l,l+=u<0?l+1:l,l+=c<0?l+1:l){case 0:case 3:case 4:case 6:case 7:case 9:case 10:case 12:case 13:case 14:case 15:return Mn(o,s,u,c);case 1:case 2:case 5:case 8:case 11:return Ln(o,s,u,c);default:return}},Fn.clone=function(t,n){if(e(t))return e(n)?(n.origin=p.clone(t.origin),n.direction=p.clone(t.direction),n):new Fn(t.origin,t.direction)},Fn.getPoint=function(t,n,r){return e(r)||(r=new p),r=p.multiplyByScalar(t.direction,n,r),p.add(t.origin,r,r)};var zn={rayPlane:function(t,n,r){e(r)||(r=new p);var i=t.origin,o=t.direction,s=n.normal,u=p.dot(s,o);if(!(Math.abs(u)<a.EPSILON15)){var c=(-n.distance-p.dot(s,i))/u;if(!(c<0))return r=p.multiplyByScalar(o,c,r),p.add(i,r,r)}}},Bn=new p,Un=new p,Vn=new p,Hn=new p,Gn=new p;zn.rayTriangleParametric=function(e,t,n,r,o){o=i(o,!1);var s,u,c,l,h,d=e.origin,f=e.direction,m=p.subtract(n,t,Bn),_=p.subtract(r,t,Un),g=p.cross(f,_,Vn),v=p.dot(m,g);if(o){if(v<a.EPSILON6)return;if(s=p.subtract(d,t,Hn),(c=p.dot(s,g))<0||c>v)return;if(u=p.cross(s,m,Gn),(l=p.dot(f,u))<0||c+l>v)return;h=p.dot(_,u)/v}else{if(Math.abs(v)<a.EPSILON6)return;var y=1/v;if(s=p.subtract(d,t,Hn),(c=p.dot(s,g)*y)<0||c>1)return;if(u=p.cross(s,m,Gn),(l=p.dot(f,u)*y)<0||c+l>1)return;h=p.dot(_,u)*y}return h},zn.rayTriangle=function(t,n,r,i,o,a){var s=zn.rayTriangleParametric(t,n,r,i,o);if(e(s)&&!(s<0))return e(a)||(a=new p),p.multiplyByScalar(t.direction,s,a),p.add(t.origin,a,a)};var kn=new Fn;zn.lineSegmentTriangle=function(t,n,r,i,o,a,s){var u=kn;p.clone(t,u.origin),p.subtract(n,t,u.direction),p.normalize(u.direction,u.direction);var c=zn.rayTriangleParametric(u,r,i,o,a);if(!(!e(c)||c<0||c>p.distance(t,n)))return e(s)||(s=new p),p.multiplyByScalar(u.direction,c,s),p.add(u.origin,s,s)};var Wn={root0:0,root1:0};function qn(t,n,r){e(r)||(r=new J);var i=t.origin,o=t.direction,a=n.center,s=n.radius*n.radius,u=p.subtract(i,a,Vn),c=function(e,t,n,r){var i=t*t-4*e*n;if(!(i<0)){if(i>0){var o=1/(2*e),a=Math.sqrt(i),s=(-t+a)*o,u=(-t-a)*o;return s<u?(r.root0=s,r.root1=u):(r.root0=u,r.root1=s),r}var c=-t/(2*e);if(0!==c)return r.root0=r.root1=c,r}}(p.dot(o,o),2*p.dot(o,u),p.magnitudeSquared(u)-s,Wn);if(e(c))return r.start=c.root0,r.stop=c.root1,r}zn.raySphere=function(t,n,r){if(e(r=qn(t,n,r))&&!(r.stop<0))return r.start=Math.max(r.start,0),r};var Yn=new Fn;zn.lineSegmentSphere=function(t,n,r,i){var o=Yn;p.clone(t,o.origin);var a=p.subtract(n,t,o.direction),s=p.magnitude(a);if(p.normalize(a,a),!(!e(i=qn(o,r,i))||i.stop<0||i.start>s))return i.start=Math.max(i.start,0),i.stop=Math.min(i.stop,s),i};var jn=new p,Xn=new p;function Zn(e,t,n){var r=e+t;return a.sign(e)!==a.sign(t)&&Math.abs(r/Math.max(Math.abs(e),Math.abs(t)))<n?0:r}zn.rayEllipsoid=function(e,t){var n,r,i,o,a,s=t.oneOverRadii,u=p.multiplyComponents(s,e.origin,jn),c=p.multiplyComponents(s,e.direction,Xn),l=p.magnitudeSquared(u),h=p.dot(u,c);if(l>1){if(h>=0)return;var d=h*h;if(n=l-1,d<(i=(r=p.magnitudeSquared(c))*n))return;if(d>i){o=h*h-i;var f=(a=-h+Math.sqrt(o))/r,m=n/a;return f<m?new J(f,m):{start:m,stop:f}}var _=Math.sqrt(n/r);return new J(_,_)}return l<1?(n=l-1,o=h*h-(i=(r=p.magnitudeSquared(c))*n),new J(0,(a=-h+Math.sqrt(o))/r)):h<0?new J(0,-h/(r=p.magnitudeSquared(c))):void 0};var Kn=new p,Qn=new p,Jn=new p,$n=new p,er=new p,tr=new $,nr=new $,rr=new $,ir=new $,or=new $,ar=new $,sr=new $,ur=new p,cr=new p,lr=new N;zn.grazingAltitudeLocation=function(t,n){var r=t.origin,i=t.direction;if(!p.equals(r,p.ZERO)){var o=n.geodeticSurfaceNormal(r,Kn);if(p.dot(i,o)>=0)return r}var s=e(this.rayEllipsoid(t,n)),u=n.transformPositionToScaledSpace(i,Kn),c=p.normalize(u,u),l=p.mostOrthogonalAxis(u,$n),h=p.normalize(p.cross(l,c,Qn),Qn),d=p.normalize(p.cross(c,h,Jn),Jn),f=tr;f[0]=c.x,f[1]=c.y,f[2]=c.z,f[3]=h.x,f[4]=h.y,f[5]=h.z,f[6]=d.x,f[7]=d.y,f[8]=d.z;var m=$.transpose(f,nr),_=$.fromScale(n.radii,rr),g=$.fromScale(n.oneOverRadii,ir),v=or;v[0]=0,v[1]=-i.z,v[2]=i.y,v[3]=i.z,v[4]=0,v[5]=-i.x,v[6]=-i.y,v[7]=i.x,v[8]=0;var y,T,E=$.multiply($.multiply(m,g,ar),v,ar),x=$.multiply($.multiply(E,_,sr),f,sr),C=$.multiplyByVector(E,r,er),S=function(e,t,n,r,i){var o,s=r*r,u=i*i,c=(e[$.COLUMN1ROW1]-e[$.COLUMN2ROW2])*u,l=i*(r*Zn(e[$.COLUMN1ROW0],e[$.COLUMN0ROW1],a.EPSILON15)+t.y),h=e[$.COLUMN0ROW0]*s+e[$.COLUMN2ROW2]*u+r*t.x+n,d=u*Zn(e[$.COLUMN2ROW1],e[$.COLUMN1ROW2],a.EPSILON15),f=i*(r*Zn(e[$.COLUMN2ROW0],e[$.COLUMN0ROW2])+t.z),m=[];if(0===f&&0===d){if(0===(o=In.computeRealRoots(c,l,h)).length)return m;var _=o[0],g=Math.sqrt(Math.max(1-_*_,0));if(m.push(new p(r,i*_,i*-g)),m.push(new p(r,i*_,i*g)),2===o.length){var v=o[1],y=Math.sqrt(Math.max(1-v*v,0));m.push(new p(r,i*v,i*-y)),m.push(new p(r,i*v,i*y))}return m}var T=f*f,E=d*d,x=f*d,C=c*c+E,S=2*(l*c+x),A=2*h*c+l*l-E+T,w=2*(h*l-x),b=h*h-T;if(0===C&&0===S&&0===A&&0===w)return m;var D=(o=Nn.computeRealRoots(C,S,A,w,b)).length;if(0===D)return m;for(var I=0;I<D;++I){var R=o[I],P=R*R,O=Math.max(1-P,0),N=Math.sqrt(O),M=(a.sign(c)===a.sign(h)?Zn(c*P+h,l*R,a.EPSILON12):a.sign(h)===a.sign(l*R)?Zn(c*P,l*R+h,a.EPSILON12):Zn(c*P+l*R,h,a.EPSILON12))*Zn(d*R,f,a.EPSILON15);M<0?m.push(new p(r,i*R,i*N)):M>0?m.push(new p(r,i*R,i*-N)):0!==N?(m.push(new p(r,i*R,i*-N)),m.push(new p(r,i*R,i*N)),++I):m.push(new p(r,i*R,i*N))}return m}(x,p.negate(C,Kn),0,0,1),A=S.length;if(A>0){for(var w=p.clone(p.ZERO,cr),b=Number.NEGATIVE_INFINITY,D=0;D<A;++D){y=$.multiplyByVector(_,$.multiplyByVector(f,S[D],ur),ur);var I=p.normalize(p.subtract(y,r,$n),$n),R=p.dot(I,i);R>b&&(b=R,w=p.clone(y,w))}var P=n.cartesianToCartographic(w,lr);return b=a.clamp(b,0,1),T=p.magnitude(p.subtract(w,r,$n))*Math.sqrt(1-b*b),T=s?-T:T,P.height=T,n.cartographicToCartesian(P,new p)}};var hr=new p;zn.lineSegmentPlane=function(t,n,r,i){e(i)||(i=new p);var o=p.subtract(n,t,hr),s=r.normal,u=p.dot(s,o);if(!(Math.abs(u)<a.EPSILON6)){var c=p.dot(s,t),l=-(r.distance+c)/u;if(!(l<0||l>1))return p.multiplyByScalar(o,l,i),p.add(t,i,i),i}},zn.trianglePlaneIntersection=function(e,t,n,r){var i,o,a=r.normal,s=r.distance,u=p.dot(a,e)+s<0,c=p.dot(a,t)+s<0,l=p.dot(a,n)+s<0,h=0;if(h+=u?1:0,h+=c?1:0,1!==(h+=l?1:0)&&2!==h||(i=new p,o=new p),1===h){if(u)return zn.lineSegmentPlane(e,t,r,i),zn.lineSegmentPlane(e,n,r,o),{positions:[e,t,n,i,o],indices:[0,3,4,1,2,4,1,4,3]};if(c)return zn.lineSegmentPlane(t,n,r,i),zn.lineSegmentPlane(t,e,r,o),{positions:[e,t,n,i,o],indices:[1,3,4,2,0,4,2,4,3]};if(l)return zn.lineSegmentPlane(n,e,r,i),zn.lineSegmentPlane(n,t,r,o),{positions:[e,t,n,i,o],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===h){if(!u)return zn.lineSegmentPlane(t,e,r,i),zn.lineSegmentPlane(n,e,r,o),{positions:[e,t,n,i,o],indices:[1,2,4,1,4,3,0,3,4]};if(!c)return zn.lineSegmentPlane(n,t,r,i),zn.lineSegmentPlane(e,t,r,o),{positions:[e,t,n,i,o],indices:[2,0,4,2,4,3,1,3,4]};if(!l)return zn.lineSegmentPlane(e,n,r,i),zn.lineSegmentPlane(t,n,r,o),{positions:[e,t,n,i,o],indices:[0,1,4,0,4,3,2,3,4]}}};var dr=Object.freeze({SHIFT:0,CTRL:1,ALT:2});function fr(e,t,n,r){this.near=i(e,0),this.nearValue=i(t,0),this.far=i(n,1),this.farValue=i(r,0)}function mr(e,t){this.normal=p.clone(e),this.distance=t}fr.clone=function(t,n){if(e(t))return e(n)?(n.near=t.near,n.nearValue=t.nearValue,n.far=t.far,n.farValue=t.farValue,n):new fr(t.near,t.nearValue,t.far,t.farValue)},fr.packedLength=4,fr.pack=function(e,t,n){return n=i(n,0),t[n++]=e.near,t[n++]=e.nearValue,t[n++]=e.far,t[n]=e.farValue,t},fr.unpack=function(t,n,r){return n=i(n,0),e(r)||(r=new fr),r.near=t[n++],r.nearValue=t[n++],r.far=t[n++],r.farValue=t[n],r},fr.equals=function(t,n){return t===n||e(t)&&e(n)&&t.near===n.near&&t.nearValue===n.nearValue&&t.far===n.far&&t.farValue===n.farValue},fr.prototype.clone=function(e){return fr.clone(this,e)},fr.prototype.equals=function(e){return fr.equals(this,e)},mr.fromPointNormal=function(t,n,r){var i=-p.dot(n,t);return e(r)?(p.clone(n,r.normal),r.distance=i,r):new mr(n,i)};var pr=new p;mr.fromCartesian4=function(t,n){var r=p.fromCartesian4(t,pr),i=t.w;return e(n)?(p.clone(r,n.normal),n.distance=i,n):new mr(r,i)},mr.getPointDistance=function(e,t){return p.dot(e.normal,t)+e.distance};var _r=new p;mr.projectPointOntoPlane=function(t,n,r){e(r)||(r=new p);var i=mr.getPointDistance(t,n),o=p.multiplyByScalar(t.normal,i,_r);return p.subtract(n,o,r)};var gr=new ye,vr=new le,yr=new p;function Tr(e){this.planes=i(e,[])}mr.transform=function(e,t,n){var r=e.normal,i=e.distance,o=ye.inverseTranspose(t,gr),a=le.fromElements(r.x,r.y,r.z,i,vr);a=ye.multiplyByVector(o,a,a);var s=p.fromCartesian4(a,yr);return a=le.divideByScalar(a,p.magnitude(s),a),mr.fromCartesian4(a,n)},mr.clone=function(t,n){return e(n)?(p.clone(t.normal,n.normal),n.distance=t.distance,n):new mr(t.normal,t.distance)},mr.equals=function(e,t){return e.distance===t.distance&&p.equals(e.normal,t.normal)},mr.ORIGIN_XY_PLANE=Object.freeze(new mr(p.UNIT_Z,0)),mr.ORIGIN_YZ_PLANE=Object.freeze(new mr(p.UNIT_X,0)),mr.ORIGIN_ZX_PLANE=Object.freeze(new mr(p.UNIT_Y,0));var Er=[new p,new p,new p];p.clone(p.UNIT_X,Er[0]),p.clone(p.UNIT_Y,Er[1]),p.clone(p.UNIT_Z,Er[2]);var xr=new p,Cr=new p,Sr=new mr(new p(1,0,0),0);function Ar(e){e=i(e,i.EMPTY_OBJECT),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=i(e.near,1),this._near=this.near,this.far=i(e.far,5e8),this._far=this.far,this._cullingVolume=new Tr,this._orthographicMatrix=new ye}function wr(e){e.top===e._top&&e.bottom===e._bottom&&e.left===e._left&&e.right===e._right&&e.near===e._near&&e.far===e._far||(e._left=e.left,e._right=e.right,e._top=e.top,e._bottom=e.bottom,e._near=e.near,e._far=e.far,e._orthographicMatrix=ye.computeOrthographicOffCenter(e.left,e.right,e.bottom,e.top,e.near,e.far,e._orthographicMatrix))}Tr.fromBoundingSphere=function(t,n){e(n)||(n=new Tr);var r=Er.length,i=n.planes;i.length=2*r;for(var o=t.center,a=t.radius,s=0,u=0;u<r;++u){var c=Er[u],l=i[s],h=i[s+1];e(l)||(l=i[s]=new le),e(h)||(h=i[s+1]=new le),p.multiplyByScalar(c,-a,xr),p.add(o,xr,xr),l.x=c.x,l.y=c.y,l.z=c.z,l.w=-p.dot(c,xr),p.multiplyByScalar(c,a,xr),p.add(o,xr,xr),h.x=-c.x,h.y=-c.y,h.z=-c.z,h.w=-p.dot(p.negate(c,Cr),xr),s+=2}return n},Tr.prototype.computeVisibility=function(e){for(var t=this.planes,n=!1,r=0,i=t.length;r<i;++r){var o=e.intersectPlane(mr.fromCartesian4(t[r],Sr));if(o===Q.OUTSIDE)return Q.OUTSIDE;o===Q.INTERSECTING&&(n=!0)}return n?Q.INTERSECTING:Q.INSIDE},Tr.prototype.computeVisibilityWithPlaneMask=function(e,t){if(t===Tr.MASK_OUTSIDE||t===Tr.MASK_INSIDE)return t;for(var n=Tr.MASK_INSIDE,r=this.planes,i=0,o=r.length;i<o;++i){var a=i<31?1<<i:0;if(!(i<31&&0==(t&a))){var s=e.intersectPlane(mr.fromCartesian4(r[i],Sr));if(s===Q.OUTSIDE)return Tr.MASK_OUTSIDE;s===Q.INTERSECTING&&(n|=a)}}return n},Tr.MASK_OUTSIDE=4294967295,Tr.MASK_INSIDE=0,Tr.MASK_INDETERMINATE=2147483647,Object.defineProperties(Ar.prototype,{projectionMatrix:{get:function(){return wr(this),this._orthographicMatrix}}});var br=new p,Dr=new p,Ir=new p,Rr=new p;function Pr(e){e=i(e,i.EMPTY_OBJECT),this._offCenterFrustum=new Ar,this.width=e.width,this._width=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=i(e.near,1),this._near=this.near,this.far=i(e.far,5e8),this._far=this.far}function Or(e){var t=e._offCenterFrustum;if(e.width!==e._width||e.aspectRatio!==e._aspectRatio||e.near!==e._near||e.far!==e._far){e._aspectRatio=e.aspectRatio,e._width=e.width,e._near=e.near,e._far=e.far;var n=1/e.aspectRatio;t.right=.5*e.width,t.left=-t.right,t.top=n*t.right,t.bottom=-t.top,t.near=e.near,t.far=e.far}}function Nr(e,t,n,r){this.x=i(e,0),this.y=i(t,0),this.z=i(n,0),this.w=i(r,0)}Ar.prototype.computeCullingVolume=function(t,n,r){var i=this._cullingVolume.planes,o=this.top,a=this.bottom,s=this.right,u=this.left,c=this.near,l=this.far,h=p.cross(n,r,br);p.normalize(h,h);var d=Dr;p.multiplyByScalar(n,c,d),p.add(t,d,d);var f=Ir;p.multiplyByScalar(h,u,f),p.add(d,f,f);var m=i[0];return e(m)||(m=i[0]=new le),m.x=h.x,m.y=h.y,m.z=h.z,m.w=-p.dot(h,f),p.multiplyByScalar(h,s,f),p.add(d,f,f),e(m=i[1])||(m=i[1]=new le),m.x=-h.x,m.y=-h.y,m.z=-h.z,m.w=-p.dot(p.negate(h,Rr),f),p.multiplyByScalar(r,a,f),p.add(d,f,f),e(m=i[2])||(m=i[2]=new le),m.x=r.x,m.y=r.y,m.z=r.z,m.w=-p.dot(r,f),p.multiplyByScalar(r,o,f),p.add(d,f,f),e(m=i[3])||(m=i[3]=new le),m.x=-r.x,m.y=-r.y,m.z=-r.z,m.w=-p.dot(p.negate(r,Rr),f),e(m=i[4])||(m=i[4]=new le),m.x=n.x,m.y=n.y,m.z=n.z,m.w=-p.dot(n,d),p.multiplyByScalar(n,l,f),p.add(t,f,f),e(m=i[5])||(m=i[5]=new le),m.x=-n.x,m.y=-n.y,m.z=-n.z,m.w=-p.dot(p.negate(n,Rr),f),this._cullingVolume},Ar.prototype.getPixelDimensions=function(e,t,n,r,i){wr(this);var o=r*(this.right-this.left)/e,a=r*(this.top-this.bottom)/t;return i.x=o,i.y=a,i},Ar.prototype.clone=function(t){return e(t)||(t=new Ar),t.left=this.left,t.right=this.right,t.top=this.top,t.bottom=this.bottom,t.near=this.near,t.far=this.far,t._left=void 0,t._right=void 0,t._top=void 0,t._bottom=void 0,t._near=void 0,t._far=void 0,t},Ar.prototype.equals=function(t){return e(t)&&t instanceof Ar&&this.right===t.right&&this.left===t.left&&this.top===t.top&&this.bottom===t.bottom&&this.near===t.near&&this.far===t.far},Ar.prototype.equalsEpsilon=function(t,n,r){return t===this||e(t)&&t instanceof Ar&&a.equalsEpsilon(this.right,t.right,n,r)&&a.equalsEpsilon(this.left,t.left,n,r)&&a.equalsEpsilon(this.top,t.top,n,r)&&a.equalsEpsilon(this.bottom,t.bottom,n,r)&&a.equalsEpsilon(this.near,t.near,n,r)&&a.equalsEpsilon(this.far,t.far,n,r)},Pr.packedLength=4,Pr.pack=function(e,t,n){return n=i(n,0),t[n++]=e.width,t[n++]=e.aspectRatio,t[n++]=e.near,t[n]=e.far,t},Pr.unpack=function(t,n,r){return n=i(n,0),e(r)||(r=new Pr),r.width=t[n++],r.aspectRatio=t[n++],r.near=t[n++],r.far=t[n],r},Object.defineProperties(Pr.prototype,{projectionMatrix:{get:function(){return Or(this),this._offCenterFrustum.projectionMatrix}}}),Pr.prototype.computeCullingVolume=function(e,t,n){return Or(this),this._offCenterFrustum.computeCullingVolume(e,t,n)},Pr.prototype.getPixelDimensions=function(e,t,n,r,i){return Or(this),this._offCenterFrustum.getPixelDimensions(e,t,n,r,i)},Pr.prototype.clone=function(t){return e(t)||(t=new Pr),t.aspectRatio=this.aspectRatio,t.width=this.width,t.near=this.near,t.far=this.far,t._aspectRatio=void 0,t._width=void 0,t._near=void 0,t._far=void 0,this._offCenterFrustum.clone(t._offCenterFrustum),t},Pr.prototype.equals=function(t){return!!(e(t)&&t instanceof Pr)&&(Or(this),Or(t),this.width===t.width&&this.aspectRatio===t.aspectRatio&&this._offCenterFrustum.equals(t._offCenterFrustum))},Pr.prototype.equalsEpsilon=function(t,n,r){return!!(e(t)&&t instanceof Pr)&&(Or(this),Or(t),a.equalsEpsilon(this.width,t.width,n,r)&&a.equalsEpsilon(this.aspectRatio,t.aspectRatio,n,r)&&this._offCenterFrustum.equalsEpsilon(t._offCenterFrustum,n,r))};var Mr=new p;Nr.fromAxisAngle=function(t,n,r){var i=n/2,o=Math.sin(i),a=(Mr=p.normalize(t,Mr)).x*o,s=Mr.y*o,u=Mr.z*o,c=Math.cos(i);return e(r)?(r.x=a,r.y=s,r.z=u,r.w=c,r):new Nr(a,s,u,c)};var Lr=[1,2,0],Fr=new Array(3);Nr.fromRotationMatrix=function(t,n){var r,i,o,a,s,u=t[$.COLUMN0ROW0],c=t[$.COLUMN1ROW1],l=t[$.COLUMN2ROW2],h=u+c+l;if(h>0)s=.5*(r=Math.sqrt(h+1)),r=.5/r,i=(t[$.COLUMN1ROW2]-t[$.COLUMN2ROW1])*r,o=(t[$.COLUMN2ROW0]-t[$.COLUMN0ROW2])*r,a=(t[$.COLUMN0ROW1]-t[$.COLUMN1ROW0])*r;else{var d=0;c>u&&(d=1),l>u&&l>c&&(d=2);var f=Lr[d],m=Lr[f];r=Math.sqrt(t[$.getElementIndex(d,d)]-t[$.getElementIndex(f,f)]-t[$.getElementIndex(m,m)]+1);var p=Fr;p[d]=.5*r,r=.5/r,s=(t[$.getElementIndex(m,f)]-t[$.getElementIndex(f,m)])*r,p[f]=(t[$.getElementIndex(f,d)]+t[$.getElementIndex(d,f)])*r,p[m]=(t[$.getElementIndex(m,d)]+t[$.getElementIndex(d,m)])*r,i=-p[0],o=-p[1],a=-p[2]}return e(n)?(n.x=i,n.y=o,n.z=a,n.w=s,n):new Nr(i,o,a,s)};var zr=new Nr,Br=new Nr,Ur=new Nr,Vr=new Nr;Nr.fromHeadingPitchRoll=function(e,t){return Vr=Nr.fromAxisAngle(p.UNIT_X,e.roll,zr),Ur=Nr.fromAxisAngle(p.UNIT_Y,-e.pitch,t),t=Nr.multiply(Ur,Vr,Ur),Br=Nr.fromAxisAngle(p.UNIT_Z,-e.heading,zr),Nr.multiply(Br,t,t)};var Hr=new p,Gr=new p,kr=new Nr,Wr=new Nr,qr=new Nr;Nr.packedLength=4,Nr.pack=function(e,t,n){return n=i(n,0),t[n++]=e.x,t[n++]=e.y,t[n++]=e.z,t[n]=e.w,t},Nr.unpack=function(t,n,r){return n=i(n,0),e(r)||(r=new Nr),r.x=t[n],r.y=t[n+1],r.z=t[n+2],r.w=t[n+3],r},Nr.packedInterpolationLength=3,Nr.convertPackedArrayForInterpolation=function(t,n,r,i){Nr.unpack(t,4*r,qr),Nr.conjugate(qr,qr);for(var o=0,a=r-n+1;o<a;o++){var s=3*o;Nr.unpack(t,4*(n+o),kr),Nr.multiply(kr,qr,kr),kr.w<0&&Nr.negate(kr,kr),Nr.computeAxis(kr,Hr);var u=Nr.computeAngle(kr);e(i)||(i=[]),i[s]=Hr.x*u,i[s+1]=Hr.y*u,i[s+2]=Hr.z*u}},Nr.unpackInterpolationResult=function(t,n,r,i,o){e(o)||(o=new Nr),p.fromArray(t,0,Gr);var a=p.magnitude(Gr);return Nr.unpack(n,4*i,Wr),0===a?Nr.clone(Nr.IDENTITY,kr):Nr.fromAxisAngle(Gr,a,kr),Nr.multiply(kr,Wr,o)},Nr.clone=function(t,n){if(e(t))return e(n)?(n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w,n):new Nr(t.x,t.y,t.z,t.w)},Nr.conjugate=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t},Nr.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},Nr.magnitude=function(e){return Math.sqrt(Nr.magnitudeSquared(e))},Nr.normalize=function(e,t){var n=1/Nr.magnitude(e),r=e.x*n,i=e.y*n,o=e.z*n,a=e.w*n;return t.x=r,t.y=i,t.z=o,t.w=a,t},Nr.inverse=function(e,t){var n=Nr.magnitudeSquared(e);return t=Nr.conjugate(e,t),Nr.multiplyByScalar(t,1/n,t)},Nr.add=function(e,t,n){return n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n.w=e.w+t.w,n},Nr.subtract=function(e,t,n){return n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n.w=e.w-t.w,n},Nr.negate=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t},Nr.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},Nr.multiply=function(e,t,n){var r=e.x,i=e.y,o=e.z,a=e.w,s=t.x,u=t.y,c=t.z,l=t.w,h=a*s+r*l+i*c-o*u,d=a*u-r*c+i*l+o*s,f=a*c+r*u-i*s+o*l,m=a*l-r*s-i*u-o*c;return n.x=h,n.y=d,n.z=f,n.w=m,n},Nr.multiplyByScalar=function(e,t,n){return n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n.w=e.w*t,n},Nr.divideByScalar=function(e,t,n){return n.x=e.x/t,n.y=e.y/t,n.z=e.z/t,n.w=e.w/t,n},Nr.computeAxis=function(e,t){var n=e.w;if(Math.abs(n-1)<a.EPSILON6)return t.x=t.y=t.z=0,t;var r=1/Math.sqrt(1-n*n);return t.x=e.x*r,t.y=e.y*r,t.z=e.z*r,t},Nr.computeAngle=function(e){return Math.abs(e.w-1)<a.EPSILON6?0:2*Math.acos(e.w)};var Yr=new Nr;Nr.lerp=function(e,t,n,r){return Yr=Nr.multiplyByScalar(t,n,Yr),r=Nr.multiplyByScalar(e,1-n,r),Nr.add(Yr,r,r)};var jr=new Nr,Xr=new Nr,Zr=new Nr;Nr.slerp=function(e,t,n,r){var i=Nr.dot(e,t),o=t;if(i<0&&(i=-i,o=jr=Nr.negate(t,jr)),1-i<a.EPSILON6)return Nr.lerp(e,o,n,r);var s=Math.acos(i);return Xr=Nr.multiplyByScalar(e,Math.sin((1-n)*s),Xr),Zr=Nr.multiplyByScalar(o,Math.sin(n*s),Zr),r=Nr.add(Xr,Zr,r),Nr.multiplyByScalar(r,1/Math.sin(s),r)},Nr.log=function(e,t){var n=a.acosClamped(e.w),r=0;return 0!==n&&(r=n/Math.sin(n)),p.multiplyByScalar(e,r,t)},Nr.exp=function(e,t){var n=p.magnitude(e),r=0;return 0!==n&&(r=Math.sin(n)/n),t.x=e.x*r,t.y=e.y*r,t.z=e.z*r,t.w=Math.cos(n),t};var Kr=new p,Qr=new p,Jr=new Nr,$r=new Nr;Nr.computeInnerQuadrangle=function(e,t,n,r){var i=Nr.conjugate(t,Jr);Nr.multiply(i,n,$r);var o=Nr.log($r,Kr);Nr.multiply(i,e,$r);var a=Nr.log($r,Qr);return p.add(o,a,o),p.multiplyByScalar(o,.25,o),p.negate(o,o),Nr.exp(o,Jr),Nr.multiply(t,Jr,r)},Nr.squad=function(e,t,n,r,i,o){var a=Nr.slerp(e,t,i,Jr),s=Nr.slerp(n,r,i,$r);return Nr.slerp(a,s,2*i*(1-i),o)};for(var ei=new Nr,ti=1.9011074535173003,ni=fn.supportsTypedArrays()?new Float32Array(8):[],ri=fn.supportsTypedArrays()?new Float32Array(8):[],ii=fn.supportsTypedArrays()?new Float32Array(8):[],oi=fn.supportsTypedArrays()?new Float32Array(8):[],ai=0;ai<7;++ai){var si=ai+1,ui=2*si+1;ni[ai]=1/(si*ui),ri[ai]=si/ui}function ci(){this._array=[],this._hash={}}function li(){return!0}function hi(e,t){function n(){}for(var r in e)"function"==typeof e[r]&&(e[r]=n);e.isDestroyed=li}ni[7]=ti/136,ri[7]=8*ti/17,Nr.fastSlerp=function(e,t,n,r){var i,o=Nr.dot(e,t);o>=0?i=1:(i=-1,o=-o);for(var a=o-1,s=1-n,u=n*n,c=s*s,l=7;l>=0;--l)ii[l]=(ni[l]*u-ri[l])*a,oi[l]=(ni[l]*c-ri[l])*a;var h=i*n*(1+ii[0]*(1+ii[1]*(1+ii[2]*(1+ii[3]*(1+ii[4]*(1+ii[5]*(1+ii[6]*(1+ii[7])))))))),d=s*(1+oi[0]*(1+oi[1]*(1+oi[2]*(1+oi[3]*(1+oi[4]*(1+oi[5]*(1+oi[6]*(1+oi[7])))))))),f=Nr.multiplyByScalar(e,d,ei);return Nr.multiplyByScalar(t,h,r),Nr.add(f,r,r)},Nr.fastSquad=function(e,t,n,r,i,o){var a=Nr.fastSlerp(e,t,i,Jr),s=Nr.fastSlerp(n,r,i,$r);return Nr.fastSlerp(a,s,2*i*(1-i),o)},Nr.equals=function(t,n){return t===n||e(t)&&e(n)&&t.x===n.x&&t.y===n.y&&t.z===n.z&&t.w===n.w},Nr.equalsEpsilon=function(t,n,r){return r=i(r,0),t===n||e(t)&&e(n)&&Math.abs(t.x-n.x)<=r&&Math.abs(t.y-n.y)<=r&&Math.abs(t.z-n.z)<=r&&Math.abs(t.w-n.w)<=r},Nr.ZERO=Object.freeze(new Nr(0,0,0,0)),Nr.IDENTITY=Object.freeze(new Nr(0,0,0,1)),Nr.prototype.clone=function(e){return Nr.clone(this,e)},Nr.prototype.equals=function(e){return Nr.equals(this,e)},Nr.prototype.equalsEpsilon=function(e,t){return Nr.equalsEpsilon(this,e,t)},Nr.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},Object.defineProperties(ci.prototype,{length:{get:function(){return this._array.length}},values:{get:function(){return this._array}}}),ci.prototype.contains=function(t){return e(this._hash[t])},ci.prototype.set=function(e,t){t!==this._hash[e]&&(this.remove(e),this._hash[e]=t,this._array.push(t))},ci.prototype.get=function(e){return this._hash[e]},ci.prototype.remove=function(t){var n=this._hash[t],r=e(n);if(r){var i=this._array;i.splice(i.indexOf(n),1),delete this._hash[t]}return r},ci.prototype.removeAll=function(){var e=this._array;e.length>0&&(this._hash={},e.length=0)};var di="undefined"!=typeof performance&&"function"==typeof performance.now&&isFinite(performance.now())?function(){return performance.now()}:function(){return Date.now()},fi=Object.freeze({LEFT_DOWN:0,LEFT_UP:1,LEFT_CLICK:2,LEFT_DOUBLE_CLICK:3,RIGHT_DOWN:5,RIGHT_UP:6,RIGHT_CLICK:7,MIDDLE_DOWN:10,MIDDLE_UP:11,MIDDLE_CLICK:12,MOUSE_MOVE:15,WHEEL:16,PINCH_START:17,PINCH_END:18,PINCH_MOVE:19});function mi(e,t,n){var r=e._element;if(r===document)return n.x=t.clientX,n.y=t.clientY,n;var i=r.getBoundingClientRect();return n.x=t.clientX-i.left,n.y=t.clientY-i.top,n}function pi(t,n){var r=t;return e(n)&&(r+="+"+n),r}function _i(e){return e.shiftKey?dr.SHIFT:e.ctrlKey?dr.CTRL:e.altKey?dr.ALT:void 0}var gi=0,vi=1,yi=2;function Ti(e,t,n,r){function i(t){r(e,t)}fn.isInternetExplorer()?n.addEventListener(t,i,!1):n.addEventListener(t,i,{capture:!1,passive:!1}),e._removalFunctions.push((function(){n.removeEventListener(t,i,!1)}))}var Ei={position:new c};function xi(e){e._lastSeenTouchEvent=di()}function Ci(e){return di()-e._lastSeenTouchEvent>Ki.mouseEmulationIgnoreMilliseconds}function Si(e,t,n){var r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)<n}function Ai(t,n){if(Ci(t)){var r,i=n.button;if(t._buttonDown[i]=!0,i===gi)r=fi.LEFT_DOWN;else if(i===vi)r=fi.MIDDLE_DOWN;else{if(i!==yi)return;r=fi.RIGHT_DOWN}var o=mi(t,n,t._primaryPosition);c.clone(o,t._primaryStartPosition),c.clone(o,t._primaryPreviousPosition);var a=_i(n),s=t.getInputAction(r,a);e(s)&&(c.clone(o,Ei.position),s(Ei),n.preventDefault())}}var wi={position:new c},bi={position:new c};function Di(t,n,r,i){var o=_i(i),a=t.getInputAction(n,o),s=t.getInputAction(r,o);if(e(a)||e(s)){var u=mi(t,i,t._primaryPosition);if(e(a)&&(c.clone(u,wi.position),a(wi)),e(s))Si(t._primaryStartPosition,u,t._clickPixelTolerance)&&(c.clone(u,bi.position),s(bi))}}function Ii(e,t){if(Ci(e)){var n=t.button;n!==gi&&n!==vi&&n!==yi||(e._buttonDown[gi]&&(Di(e,fi.LEFT_UP,fi.LEFT_CLICK,t),e._buttonDown[gi]=!1),e._buttonDown[vi]&&(Di(e,fi.MIDDLE_UP,fi.MIDDLE_CLICK,t),e._buttonDown[vi]=!1),e._buttonDown[yi]&&(Di(e,fi.RIGHT_UP,fi.RIGHT_CLICK,t),e._buttonDown[yi]=!1))}}var Ri={startPosition:new c,endPosition:new c};function Pi(t,n){if(Ci(t)){var r=_i(n),i=mi(t,n,t._primaryPosition),o=t._primaryPreviousPosition,a=t.getInputAction(fi.MOUSE_MOVE,r);e(a)&&(c.clone(o,Ri.startPosition),c.clone(i,Ri.endPosition),a(Ri)),c.clone(i,o),(t._buttonDown[gi]||t._buttonDown[vi]||t._buttonDown[yi])&&n.preventDefault()}}var Oi={position:new c};function Ni(t,n){var r;if(n.button===gi){r=fi.LEFT_DOUBLE_CLICK;var i=_i(n),o=t.getInputAction(r,i);e(o)&&(mi(t,n,Oi.position),o(Oi))}}function Mi(t,n){var r;if(e(n.deltaY)){var i=n.deltaMode;r=i===n.DOM_DELTA_PIXEL?-n.deltaY:i===n.DOM_DELTA_LINE?40*-n.deltaY:120*-n.deltaY}else r=n.detail>0?-120*n.detail:n.wheelDelta;if(e(r)){var o=_i(n),a=t.getInputAction(fi.WHEEL,o);e(a)&&(a(r),n.preventDefault())}}function Li(e,t){xi(e);var n,r,i,o=t.changedTouches,a=o.length,s=e._positions;for(n=0;n<a;++n)i=(r=o[n]).identifier,s.set(i,mi(e,r,new c));Gi(e,t);var u=e._previousPositions;for(n=0;n<a;++n)i=(r=o[n]).identifier,u.set(i,c.clone(s.get(i)))}function Fi(e,t){xi(e);var n,r,i=t.changedTouches,o=i.length,a=e._positions;for(n=0;n<o;++n)r=i[n].identifier,a.remove(r);Gi(e,t);var s=e._previousPositions;for(n=0;n<o;++n)r=i[n].identifier,s.remove(r)}var zi={position:new c},Bi={position1:new c,position2:new c},Ui={position:new c},Vi={position:new c},Hi={position:new c};function Gi(t,n){var r,i,o=_i(n),a=t._positions,s=a.length,u=t._isPinching;if(1!==s&&t._buttonDown[gi]){if(t._buttonDown[gi]=!1,e(t._touchHoldTimer)&&(clearTimeout(t._touchHoldTimer),t._touchHoldTimer=void 0),e(r=t.getInputAction(fi.LEFT_UP,o))&&(c.clone(t._primaryPosition,Ui.position),r(Ui)),0===s&&!t._isTouchHolding)if(e(i=t.getInputAction(fi.LEFT_CLICK,o)))Si(t._primaryStartPosition,t._previousPositions.values[0],t._clickPixelTolerance)&&(c.clone(t._primaryPosition,Vi.position),i(Vi));t._isTouchHolding=!1}if(0===s&&u&&(t._isPinching=!1,e(r=t.getInputAction(fi.PINCH_END,o))&&r()),1===s&&!u){var l=a.values[0];c.clone(l,t._primaryPosition),c.clone(l,t._primaryStartPosition),c.clone(l,t._primaryPreviousPosition),t._buttonDown[gi]=!0,e(r=t.getInputAction(fi.LEFT_DOWN,o))&&(c.clone(l,zi.position),r(zi)),t._touchHoldTimer=setTimeout((function(){t.isDestroyed()||(t._touchHoldTimer=void 0,t._isTouchHolding=!0,e(i=t.getInputAction(fi.RIGHT_CLICK,o))&&Si(t._primaryStartPosition,t._previousPositions.values[0],t._holdPixelTolerance)&&(c.clone(t._primaryPosition,Hi.position),i(Hi)))}),Ki.touchHoldDelayMilliseconds),n.preventDefault()}2!==s||u||(t._isPinching=!0,e(r=t.getInputAction(fi.PINCH_START,o))&&(c.clone(a.values[0],Bi.position1),c.clone(a.values[1],Bi.position2),r(Bi),n.preventDefault()))}function ki(t,n){xi(t);var r,i,o,a=n.changedTouches,s=a.length,u=t._positions;for(r=0;r<s;++r){o=(i=a[r]).identifier;var l=u.get(o);e(l)&&mi(t,i,l)}Yi(t,n);var h=t._previousPositions;for(r=0;r<s;++r)o=(i=a[r]).identifier,c.clone(u.get(o),h.get(o))}var Wi={startPosition:new c,endPosition:new c},qi={distance:{startPosition:new c,endPosition:new c},angleAndHeight:{startPosition:new c,endPosition:new c}};function Yi(t,n){var r,i=_i(n),o=t._positions,a=t._previousPositions,s=o.length;if(1===s&&t._buttonDown[gi]){var u=o.values[0];c.clone(u,t._primaryPosition);var l=t._primaryPreviousPosition;e(r=t.getInputAction(fi.MOUSE_MOVE,i))&&(c.clone(l,Wi.startPosition),c.clone(u,Wi.endPosition),r(Wi)),c.clone(u,l),n.preventDefault()}else if(2===s&&t._isPinching&&e(r=t.getInputAction(fi.PINCH_MOVE,i))){var h=o.values[0],d=o.values[1],f=a.values[0],m=a.values[1],p=d.x-h.x,_=d.y-h.y,g=Math.sqrt(p*p+_*_),v=m.x-f.x,y=m.y-f.y,T=Math.sqrt(v*v+y*y),E=.125*(d.y+h.y),x=.125*(m.y+f.y),C=Math.atan2(_,p),S=Math.atan2(y,v);c.fromElements(0,T,qi.distance.startPosition),c.fromElements(0,g,qi.distance.endPosition),c.fromElements(S,x,qi.angleAndHeight.startPosition),c.fromElements(C,E,qi.angleAndHeight.endPosition),r(qi)}}function ji(e,t){if(t.target.setPointerCapture(t.pointerId),"touch"===t.pointerType){var n=e._positions,r=t.pointerId;n.set(r,mi(e,t,new c)),Gi(e,t),e._previousPositions.set(r,c.clone(n.get(r)))}else Ai(e,t)}function Xi(e,t){if("touch"===t.pointerType){var n=e._positions,r=t.pointerId;n.remove(r),Gi(e,t),e._previousPositions.remove(r)}else Ii(e,t)}function Zi(t,n){if("touch"===n.pointerType){var r=t._positions,i=n.pointerId,o=r.get(i);if(!e(o))return;mi(t,n,o),Yi(t,n);var a=t._previousPositions;c.clone(r.get(i),a.get(i))}else Pi(t,n)}function Ki(t){this._inputEvents={},this._buttonDown={LEFT:!1,MIDDLE:!1,RIGHT:!1},this._isPinching=!1,this._isTouchHolding=!1,this._lastSeenTouchEvent=-Ki.mouseEmulationIgnoreMilliseconds,this._primaryStartPosition=new c,this._primaryPosition=new c,this._primaryPreviousPosition=new c,this._positions=new ci,this._previousPositions=new ci,this._removalFunctions=[],this._touchHoldTimer=void 0,this._clickPixelTolerance=5,this._holdPixelTolerance=25,this._element=i(t,document),function(t){var n=t._element,r=e(n.disableRootEvents)?n:document;fn.supportsPointerEvents()?(Ti(t,"pointerdown",n,ji),Ti(t,"pointerup",n,Xi),Ti(t,"pointermove",n,Zi),Ti(t,"pointercancel",n,Xi)):(Ti(t,"mousedown",n,Ai),Ti(t,"mouseup",r,Ii),Ti(t,"mousemove",r,Pi),Ti(t,"touchstart",n,Li),Ti(t,"touchend",r,Fi),Ti(t,"touchmove",r,ki),Ti(t,"touchcancel",r,Fi)),Ti(t,"dblclick",n,Ni),Ti(t,"onwheel"in n?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",n,Mi)}(this)}function Qi(e,t,n){for(var r,i,o=0,a=e.length-1;o<=a;)if((i=n(e[r=~~((o+a)/2)],t))<0)o=r+1;else{if(!(i>0))return r;a=r-1}return~(a+1)}function Ji(e,t,n,r,i){this.xPoleWander=e,this.yPoleWander=t,this.xPoleOffset=n,this.yPoleOffset=r,this.ut1MinusUtc=i}function $i(){var e=/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g,t=arguments,n=0,r=t[n++],i=function(e,t,n,r){n||(n=" ");var i=e.length>=t?"":Array(1+t-e.length>>>0).join(n);return r?e+i:i+e},o=function(e,t,n,r,o,a){var s=r-e.length;return s>0&&(e=n||!o?i(e,r,a,n):e.slice(0,t.length)+i("",s,"0",!0)+e.slice(t.length)),e},a=function(e,t,n,r,a,s,u){var c=e>>>0;return e=(n=n&&c&&{2:"0b",8:"0",16:"0x"}[t]||"")+i(c.toString(t),s||0,"0",!1),o(e,n,r,a,u)},s=function(e,t,n,r,i,a){return null!=r&&(e=e.slice(0,r)),o(e,"",t,n,i,a)},u=function(e,r,u,c,l,h,d){var f,m,p,_,g;if("%%"==e)return"%";for(var v=!1,y="",T=!1,E=!1,x=" ",C=u.length,S=0;u&&S<C;S++)switch(u.charAt(S)){case" ":y=" ";break;case"+":y="+";break;case"-":v=!0;break;case"'":x=u.charAt(S+1);break;case"0":T=!0;break;case"#":E=!0}if((c=c?"*"==c?+t[n++]:"*"==c.charAt(0)?+t[c.slice(1,-1)]:+c:0)<0&&(c=-c,v=!0),!isFinite(c))throw new Error("sprintf: (minimum-)width must be finite");switch(h=h?"*"==h?+t[n++]:"*"==h.charAt(0)?+t[h.slice(1,-1)]:+h:"fFeE".indexOf(d)>-1?6:"d"==d?0:void 0,g=r?t[r.slice(0,-1)]:t[n++],d){case"s":return s(String(g),v,c,h,T,x);case"c":return s(String.fromCharCode(+g),v,c,h,T);case"b":return a(g,2,E,v,c,h,T);case"o":return a(g,8,E,v,c,h,T);case"x":return a(g,16,E,v,c,h,T);case"X":return a(g,16,E,v,c,h,T).toUpperCase();case"u":return a(g,10,E,v,c,h,T);case"i":case"d":return f=+g||0,g=(m=(f=Math.round(f-f%1))<0?"-":y)+i(String(Math.abs(f)),h,"0",!1),o(g,m,v,c,T);case"e":case"E":case"f":case"F":case"g":case"G":return m=(f=+g)<0?"-":y,p=["toExponential","toFixed","toPrecision"]["efg".indexOf(d.toLowerCase())],_=["toString","toUpperCase"]["eEfFgG".indexOf(d)%2],g=m+Math.abs(f)[p](h),o(g,m,v,c,T)[_]();default:return e}};return r.replace(e,u)}function eo(e,t,n,r,i,o,a,s){this.year=e,this.month=t,this.day=n,this.hour=r,this.minute=i,this.second=o,this.millisecond=a,this.isLeapSecond=s}function to(e){return e%4==0&&e%100!=0||e%400==0}function no(e,t){this.julianDate=e,this.offset=t}Ki.prototype.setInputAction=function(e,t,n){var r=pi(t,n);this._inputEvents[r]=e},Ki.prototype.getInputAction=function(e,t){var n=pi(e,t);return this._inputEvents[n]},Ki.prototype.removeInputAction=function(e,t){var n=pi(e,t);delete this._inputEvents[n]},Ki.prototype.isDestroyed=function(){return!1},Ki.prototype.destroy=function(){return function(e){for(var t=e._removalFunctions,n=0;n<t.length;++n)t[n]()}(this),hi(this)},Ki.mouseEmulationIgnoreMilliseconds=800,Ki.touchHoldDelayMilliseconds=1500;var ro=Object.freeze({SECONDS_PER_MILLISECOND:.001,SECONDS_PER_MINUTE:60,MINUTES_PER_HOUR:60,HOURS_PER_DAY:24,SECONDS_PER_HOUR:3600,MINUTES_PER_DAY:1440,SECONDS_PER_DAY:86400,DAYS_PER_JULIAN_CENTURY:36525,PICOSECOND:1e-9,MODIFIED_JULIAN_DATE_DIFFERENCE:2400000.5}),io=Object.freeze({UTC:0,TAI:1}),oo=new eo,ao=[31,28,31,30,31,30,31,31,30,31,30,31];function so(e,t){return Co.compare(e.julianDate,t.julianDate)}var uo=new no;function co(e){uo.julianDate=e;var t=Co.leapSeconds,n=Qi(t,uo,so);n<0&&(n=~n),n>=t.length&&(n=t.length-1);var r=t[n].offset;n>0&&(Co.secondsDifference(t[n].julianDate,e)>r&&(r=t[--n].offset));Co.addSeconds(e,r,e)}function lo(e,t){uo.julianDate=e;var n=Co.leapSeconds,r=Qi(n,uo,so);if(r<0&&(r=~r),0===r)return Co.addSeconds(e,-n[0].offset,t);if(r>=n.length)return Co.addSeconds(e,-n[r-1].offset,t);var i=Co.secondsDifference(n[r].julianDate,e);return 0===i?Co.addSeconds(e,-n[r].offset,t):i<=1?void 0:Co.addSeconds(e,-n[--r].offset,t)}function ho(e,t,n){var r=t/ro.SECONDS_PER_DAY|0;return e+=r,(t-=ro.SECONDS_PER_DAY*r)<0&&(e--,t+=ro.SECONDS_PER_DAY),n.dayNumber=e,n.secondsOfDay=t,n}function fo(e,t,n,r,i,o,a){var s=(t-14)/12|0,u=e+4800+s,c=(1461*u/4|0)+(367*(t-2-12*s)/12|0)-(3*((u+100)/100|0)/4|0)+n-32075;(r-=12)<0&&(r+=24);var l=o+(r*ro.SECONDS_PER_HOUR+i*ro.SECONDS_PER_MINUTE+a*ro.SECONDS_PER_MILLISECOND);return l>=43200&&(c-=1),[c,l]}var mo=/^(\d{4})$/,po=/^(\d{4})-(\d{2})$/,_o=/^(\d{4})-?(\d{3})$/,go=/^(\d{4})-?W(\d{2})-?(\d{1})?$/,vo=/^(\d{4})-?(\d{2})-?(\d{2})$/,yo=/([Z+\-])?(\d{2})?:?(\d{2})?$/,To=/^(\d{2})(\.\d+)?/.source+yo.source,Eo=/^(\d{2}):?(\d{2})(\.\d+)?/.source+yo.source,xo=/^(\d{2}):?(\d{2}):?(\d{2})(\.\d+)?/.source+yo.source;function Co(e,t,n){this.dayNumber=void 0,this.secondsOfDay=void 0,e=i(e,0),t=i(t,0),n=i(n,io.UTC);var r=0|e;ho(r,t+=(e-r)*ro.SECONDS_PER_DAY,this),n===io.UTC&&co(this)}Co.fromGregorianDate=function(t,n){var r=fo(t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond);return e(n)?(ho(r[0],r[1],n),co(n),n):new Co(r[0],r[1],io.UTC)},Co.fromDate=function(t,n){var r=fo(t.getUTCFullYear(),t.getUTCMonth()+1,t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds());return e(n)?(ho(r[0],r[1],n),co(n),n):new Co(r[0],r[1],io.UTC)},Co.fromIso8601=function(t,n){var r,i,o,a,s=(t=t.replace(",",".")).split("T"),u=1,c=1,l=0,h=0,d=0,f=0,m=s[0],p=s[1];if(null!==(s=m.match(vo)))r=+s[1],u=+s[2],c=+s[3];else if(null!==(s=m.match(po)))r=+s[1],u=+s[2];else if(null!==(s=m.match(mo)))r=+s[1];else{var _;if(null!==(s=m.match(_o)))r=+s[1],_=+s[2],o=to(r);else if(null!==(s=m.match(go)))r=+s[1],_=7*+s[2]+(+s[3]||0)-new Date(Date.UTC(r,0,4)).getUTCDay()-3;(i=new Date(Date.UTC(r,0,1))).setUTCDate(_),u=i.getUTCMonth()+1,c=i.getUTCDate()}if(o=to(r),e(p)){null!==(s=p.match(xo))?(l=+s[1],h=+s[2],d=+s[3],f=1e3*+(s[4]||0),a=5):null!==(s=p.match(Eo))?(l=+s[1],h=+s[2],d=60*+(s[3]||0),a=4):null!==(s=p.match(To))&&(l=+s[1],h=60*+(s[2]||0),a=3);var g=s[a],v=+s[a+1],y=+(s[a+2]||0);switch(g){case"+":l-=v,h-=y;break;case"-":l+=v,h+=y;break;case"Z":break;default:h+=new Date(Date.UTC(r,u-1,c,l,h)).getTimezoneOffset()}}var T=60===d;for(T&&d--;h>=60;)h-=60,l++;for(;l>=24;)l-=24,c++;for(i=o&&2===u?29:ao[u-1];c>i;)c-=i,++u>12&&(u-=12,r++),i=o&&2===u?29:ao[u-1];for(;h<0;)h+=60,l--;for(;l<0;)l+=24,c--;for(;c<1;)--u<1&&(u+=12,r--),c+=i=o&&2===u?29:ao[u-1];var E=fo(r,u,c,l,h,d,f);return e(n)?(ho(E[0],E[1],n),co(n)):n=new Co(E[0],E[1],io.UTC),T&&Co.addSeconds(n,1,n),n},Co.now=function(e){return Co.fromDate(new Date,e)};var So=new Co(0,0,io.TAI);function Ao(e){if(e instanceof Ao)this.scheme=e.scheme,this.authority=e.authority,this.path=e.path,this.query=e.query,this.fragment=e.fragment;else if(e){var t=wo.exec(e);this.scheme=t[1],this.authority=t[2],this.path=t[3],this.query=t[4],this.fragment=t[5]}}Co.toGregorianDate=function(t,n){var r=!1,i=lo(t,So);e(i)||(Co.addSeconds(t,-1,So),i=lo(So,So),r=!0);var o=i.dayNumber,a=i.secondsOfDay;a>=43200&&(o+=1);var s=o+68569|0,u=4*s/146097|0,c=4e3*((s=s-((146097*u+3)/4|0)|0)+1)/1461001|0,l=80*(s=s-(1461*c/4|0)+31|0)/2447|0,h=s-(2447*l/80|0)|0,d=l+2-12*(s=l/11|0)|0,f=100*(u-49)+c+s|0,m=a/ro.SECONDS_PER_HOUR|0,p=a-m*ro.SECONDS_PER_HOUR,_=p/ro.SECONDS_PER_MINUTE|0,g=0|(p-=_*ro.SECONDS_PER_MINUTE),v=(p-g)/ro.SECONDS_PER_MILLISECOND;return(m+=12)>23&&(m-=24),r&&(g+=1),e(n)?(n.year=f,n.month=d,n.day=h,n.hour=m,n.minute=_,n.second=g,n.millisecond=v,n.isLeapSecond=r,n):new eo(f,d,h,m,_,g,v,r)},Co.toDate=function(e){var t=Co.toGregorianDate(e,oo),n=t.second;return t.isLeapSecond&&(n-=1),new Date(Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,n,t.millisecond))},Co.toIso8601=function(t,n){var r=Co.toGregorianDate(t,oo),i=r.year,o=r.month,a=r.day,s=r.hour,u=r.minute,c=r.second,l=r.millisecond;return 1e4===i&&1===o&&1===a&&0===s&&0===u&&0===c&&0===l&&(i=9999,o=12,a=31,s=24),e(n)||0===l?e(n)&&0!==n?$i("%04d-%02d-%02dT%02d:%02d:%02d.%sZ",i,o,a,s,u,c,(.01*l).toFixed(n).replace(".","").slice(0,n)):$i("%04d-%02d-%02dT%02d:%02d:%02dZ",i,o,a,s,u,c):$i("%04d-%02d-%02dT%02d:%02d:%02d.%sZ",i,o,a,s,u,c,(.01*l).toString().replace(".",""))},Co.clone=function(t,n){if(e(t))return e(n)?(n.dayNumber=t.dayNumber,n.secondsOfDay=t.secondsOfDay,n):new Co(t.dayNumber,t.secondsOfDay,io.TAI)},Co.compare=function(e,t){var n=e.dayNumber-t.dayNumber;return 0!==n?n:e.secondsOfDay-t.secondsOfDay},Co.equals=function(t,n){return t===n||e(t)&&e(n)&&t.dayNumber===n.dayNumber&&t.secondsOfDay===n.secondsOfDay},Co.equalsEpsilon=function(t,n,r){return r=i(r,0),t===n||e(t)&&e(n)&&Math.abs(Co.secondsDifference(t,n))<=r},Co.totalDays=function(e){return e.dayNumber+e.secondsOfDay/ro.SECONDS_PER_DAY},Co.secondsDifference=function(e,t){return(e.dayNumber-t.dayNumber)*ro.SECONDS_PER_DAY+(e.secondsOfDay-t.secondsOfDay)},Co.daysDifference=function(e,t){return e.dayNumber-t.dayNumber+(e.secondsOfDay-t.secondsOfDay)/ro.SECONDS_PER_DAY},Co.computeTaiMinusUtc=function(e){uo.julianDate=e;var t=Co.leapSeconds,n=Qi(t,uo,so);return n<0&&(n=~n,--n<0&&(n=0)),t[n].offset},Co.addSeconds=function(e,t,n){return ho(e.dayNumber,e.secondsOfDay+t,n)},Co.addMinutes=function(e,t,n){var r=e.secondsOfDay+t*ro.SECONDS_PER_MINUTE;return ho(e.dayNumber,r,n)},Co.addHours=function(e,t,n){var r=e.secondsOfDay+t*ro.SECONDS_PER_HOUR;return ho(e.dayNumber,r,n)},Co.addDays=function(e,t,n){return ho(e.dayNumber+t,e.secondsOfDay,n)},Co.lessThan=function(e,t){return Co.compare(e,t)<0},Co.lessThanOrEquals=function(e,t){return Co.compare(e,t)<=0},Co.greaterThan=function(e,t){return Co.compare(e,t)>0},Co.greaterThanOrEquals=function(e,t){return Co.compare(e,t)>=0},Co.prototype.clone=function(e){return Co.clone(this,e)},Co.prototype.equals=function(e){return Co.equals(this,e)},Co.prototype.equalsEpsilon=function(e,t){return Co.equalsEpsilon(this,e,t)},Co.prototype.toString=function(){return Co.toIso8601(this)},Co.leapSeconds=[new no(new Co(2441317,43210,io.TAI),10),new no(new Co(2441499,43211,io.TAI),11),new no(new Co(2441683,43212,io.TAI),12),new no(new Co(2442048,43213,io.TAI),13),new no(new Co(2442413,43214,io.TAI),14),new no(new Co(2442778,43215,io.TAI),15),new no(new Co(2443144,43216,io.TAI),16),new no(new Co(2443509,43217,io.TAI),17),new no(new Co(2443874,43218,io.TAI),18),new no(new Co(2444239,43219,io.TAI),19),new no(new Co(2444786,43220,io.TAI),20),new no(new Co(2445151,43221,io.TAI),21),new no(new Co(2445516,43222,io.TAI),22),new no(new Co(2446247,43223,io.TAI),23),new no(new Co(2447161,43224,io.TAI),24),new no(new Co(2447892,43225,io.TAI),25),new no(new Co(2448257,43226,io.TAI),26),new no(new Co(2448804,43227,io.TAI),27),new no(new Co(2449169,43228,io.TAI),28),new no(new Co(2449534,43229,io.TAI),29),new no(new Co(2450083,43230,io.TAI),30),new no(new Co(2450630,43231,io.TAI),31),new no(new Co(2451179,43232,io.TAI),32),new no(new Co(2453736,43233,io.TAI),33),new no(new Co(2454832,43234,io.TAI),34),new no(new Co(2456109,43235,io.TAI),35),new no(new Co(2457204,43236,io.TAI),36),new no(new Co(2457754,43237,io.TAI),37)],Ao.prototype.scheme=null,Ao.prototype.authority=null,Ao.prototype.path="",Ao.prototype.query=null,Ao.prototype.fragment=null;var wo=new RegExp("^(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$");Ao.prototype.getScheme=function(){return this.scheme},Ao.prototype.getAuthority=function(){return this.authority},Ao.prototype.getPath=function(){return this.path},Ao.prototype.getQuery=function(){return this.query},Ao.prototype.getFragment=function(){return this.fragment},Ao.prototype.isAbsolute=function(){return!!this.scheme&&!this.fragment},Ao.prototype.isSameDocumentAs=function(e){return e.scheme==this.scheme&&e.authority==this.authority&&e.path==this.path&&e.query==this.query},Ao.prototype.equals=function(e){return this.isSameDocumentAs(e)&&e.fragment==this.fragment},Ao.prototype.normalize=function(){this.removeDotSegments(),this.scheme&&(this.scheme=this.scheme.toLowerCase()),this.authority&&(this.authority=this.authority.replace(Io,Po).replace(bo,Ro)),this.path&&(this.path=this.path.replace(bo,Ro)),this.query&&(this.query=this.query.replace(bo,Ro)),this.fragment&&(this.fragment=this.fragment.replace(bo,Ro))};var bo=/%[0-9a-z]{2}/gi,Do=/[a-zA-Z0-9\-\._~]/,Io=/(.*@)?([^@:]*)(:.*)?/;function Ro(e){var t=unescape(e);return Do.test(t)?t:e.toUpperCase()}function Po(e,t,n,r){return(t||"")+n.toLowerCase()+(r||"")}function Oo(e,t){if(null===e||"object"!=typeof e)return e;t=i(t,!1);var n=new e.constructor;for(var r in e)if(e.hasOwnProperty(r)){var o=e[r];t&&(o=Oo(o,t)),n[r]=o}return n}function No(t,n,r){r=i(r,!1);var o,a,s,u={},c=e(t),l=e(n);if(c)for(o in t)t.hasOwnProperty(o)&&(a=t[o],l&&r&&"object"==typeof a&&n.hasOwnProperty(o)?(s=n[o],u[o]="object"==typeof s?No(a,s,r):a):u[o]=a);if(l)for(o in n)n.hasOwnProperty(o)&&!u.hasOwnProperty(o)&&(s=n[o],u[o]=s);return u}function Mo(e,t){var n;return"undefined"!=typeof document&&(n=document),Mo._implementation(e,t,n)}Ao.prototype.resolve=function(e){var t=new Ao;return this.scheme?(t.scheme=this.scheme,t.authority=this.authority,t.path=this.path,t.query=this.query):(t.scheme=e.scheme,this.authority?(t.authority=this.authority,t.path=this.path,t.query=this.query):(t.authority=e.authority,""==this.path?(t.path=e.path,t.query=this.query||e.query):("/"==this.path.charAt(0)?(t.path=this.path,t.removeDotSegments()):(e.authority&&""==e.path?t.path="/"+this.path:t.path=e.path.substring(0,e.path.lastIndexOf("/")+1)+this.path,t.removeDotSegments()),t.query=this.query))),t.fragment=this.fragment,t},Ao.prototype.removeDotSegments=function(){var e,t=this.path.split("/"),n=[],r=""==t[0];for(r&&t.shift(),""==t[0]&&t.shift();t.length;)".."==(e=t.shift())?n.pop():"."!=e&&n.push(e);"."!=e&&".."!=e||n.push(""),r&&n.unshift(""),this.path=n.join("/")},Ao.prototype.toString=function(){var e="";return this.scheme&&(e+=this.scheme+":"),this.authority&&(e+="//"+this.authority),e+=this.path,this.query&&(e+="?"+this.query),this.fragment&&(e+="#"+this.fragment),e},Mo._implementation=function(t,n,r){if(!e(n)){if(void 0===r)return t;n=i(r.baseURI,r.location.href)}var o=new Ao(n);return new Ao(t).resolve(o).toString()};var Lo,Fo=/^blob:/i;function zo(e){return Fo.test(e)}function Bo(t){e(Lo)||(Lo=document.createElement("a")),Lo.href=window.location.href;var n=Lo.host,r=Lo.protocol;return Lo.href=t,Lo.href=Lo.href,r!==Lo.protocol||n!==Lo.host}var Uo=/^data:/i;function Vo(e){return Uo.test(e)}var Ho=Object.freeze({UNISSUED:0,ISSUED:1,ACTIVE:2,RECEIVED:3,CANCELLED:4,FAILED:5}),Go=Object.freeze({TERRAIN:0,IMAGERY:1,TILES3D:2,OTHER:3});function ko(e){e=i(e,i.EMPTY_OBJECT);var t=i(e.throttleByServer,!1),n=i(e.throttle,!1);this.url=e.url,this.requestFunction=e.requestFunction,this.cancelFunction=e.cancelFunction,this.priorityFunction=e.priorityFunction,this.priority=i(e.priority,0),this.throttle=n,this.throttleByServer=t,this.type=i(e.type,Go.OTHER),this.serverKey=void 0,this.state=Ho.UNISSUED,this.deferred=void 0,this.cancelled=!1}function Wo(e,t,n){this.statusCode=e,this.response=t,this.responseHeaders=n,"string"==typeof this.responseHeaders&&(this.responseHeaders=function(e){var t={};if(!e)return t;for(var n=e.split("\r\n"),r=0;r<n.length;++r){var i=n[r],o=i.indexOf(": ");if(o>0){var a=i.substring(0,o),s=i.substring(o+2);t[a]=s}}return t}(this.responseHeaders))}function qo(){this._listeners=[],this._scopes=[],this._toRemove=[],this._insideRaiseEvent=!1}function Yo(e,t){return t-e}function jo(e){this._comparator=e.comparator,this._array=[],this._length=0,this._maximumLength=void 0}function Xo(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}ko.prototype.cancel=function(){this.cancelled=!0},ko.prototype.clone=function(t){return e(t)?(t.url=this.url,t.requestFunction=this.requestFunction,t.cancelFunction=this.cancelFunction,t.priorityFunction=this.priorityFunction,t.priority=this.priority,t.throttle=this.throttle,t.throttleByServer=this.throttleByServer,t.type=this.type,t.serverKey=this.serverKey,t.state=this.RequestState.UNISSUED,t.deferred=void 0,t.cancelled=!1,t):new ko(this)},Wo.prototype.toString=function(){var t="Request has failed.";return e(this.statusCode)&&(t+=" Status Code: "+this.statusCode),t},Object.defineProperties(qo.prototype,{numberOfListeners:{get:function(){return this._listeners.length-this._toRemove.length}}}),qo.prototype.addEventListener=function(e,t){this._listeners.push(e),this._scopes.push(t);var n=this;return function(){n.removeEventListener(e,t)}},qo.prototype.removeEventListener=function(e,t){for(var n=this._listeners,r=this._scopes,i=-1,o=0;o<n.length;o++)if(n[o]===e&&r[o]===t){i=o;break}return-1!==i&&(this._insideRaiseEvent?(this._toRemove.push(i),n[i]=void 0,r[i]=void 0):(n.splice(i,1),r.splice(i,1)),!0)},qo.prototype.raiseEvent=function(){var t;this._insideRaiseEvent=!0;var n=this._listeners,r=this._scopes,i=n.length;for(t=0;t<i;t++){var o=n[t];e(o)&&n[t].apply(r[t],arguments)}var a=this._toRemove;if((i=a.length)>0){for(a.sort(Yo),t=0;t<i;t++){var s=a[t];n.splice(s,1),r.splice(s,1)}a.length=0}this._insideRaiseEvent=!1},Object.defineProperties(jo.prototype,{length:{get:function(){return this._length}},internalArray:{get:function(){return this._array}},maximumLength:{get:function(){return this._maximumLength},set:function(e){var t=this._length;if(e<t){for(var n=this._array,r=e;r<t;++r)n[r]=void 0;this._length=e,n.length=e}this._maximumLength=e}},comparator:{get:function(){return this._comparator}}}),jo.prototype.reserve=function(e){e=i(e,this._length),this._array.length=e},jo.prototype.heapify=function(e){e=i(e,0);for(var t=this._length,n=this._comparator,r=this._array,o=-1,a=!0;a;){var s=2*(e+1),u=s-1;o=u<t&&n(r[u],r[e])<0?u:e,s<t&&n(r[s],r[o])<0&&(o=s),o!==e?(Xo(r,o,e),e=o):a=!1}},jo.prototype.resort=function(){for(var e=this._length,t=Math.ceil(e/2);t>=0;--t)this.heapify(t)},jo.prototype.insert=function(t){var n,r=this._array,i=this._comparator,o=this._maximumLength,a=this._length++;for(a<r.length?r[a]=t:r.push(t);0!==a;){var s=Math.floor((a-1)/2);if(!(i(r[a],r[s])<0))break;Xo(r,a,s),a=s}return e(o)&&this._length>o&&(n=r[o],this._length=o),n},jo.prototype.pop=function(e){if(e=i(e,0),0!==this._length){var t=this._array,n=t[e];return Xo(t,e,--this._length),this.heapify(e),t[this._length]=void 0,n}};var Zo={numberOfAttemptedRequests:0,numberOfActiveRequests:0,numberOfCancelledRequests:0,numberOfCancelledActiveRequests:0,numberOfFailedRequests:0,numberOfActiveRequestsEver:0,lastNumberOfActiveRequests:0},Ko=20,Qo=new jo({comparator:function(e,t){return e.priority-t.priority}});Qo.maximumLength=Ko,Qo.reserve(Ko);var Jo=[],$o={},ea="undefined"!=typeof document?new Ao(document.location.href):new Ao,ta=new qo;function na(){}function ra(t){e(t.priorityFunction)&&(t.priority=t.priorityFunction())}function ia(e){var t=i(na.requestsByServer[e],na.maximumRequestsPerServer);return $o[e]<t}function oa(e){return e.state===Ho.UNISSUED&&(e.state=Ho.ISSUED,e.deferred=Et.defer()),e.deferred.promise}function aa(e){var t=oa(e);return e.state=Ho.ACTIVE,Jo.push(e),++Zo.numberOfActiveRequests,++Zo.numberOfActiveRequestsEver,++$o[e.serverKey],e.requestFunction().then(function(e){return function(t){if(e.state!==Ho.CANCELLED){var n=e.deferred;--Zo.numberOfActiveRequests,--$o[e.serverKey],ta.raiseEvent(),e.state=Ho.RECEIVED,e.deferred=void 0,n.resolve(t)}}}(e)).otherwise(function(e){return function(t){e.state!==Ho.CANCELLED&&(++Zo.numberOfFailedRequests,--Zo.numberOfActiveRequests,--$o[e.serverKey],ta.raiseEvent(t),e.state=Ho.FAILED,e.deferred.reject(t))}}(e)),t}function sa(t){var n=t.state===Ho.ACTIVE;if(t.state=Ho.CANCELLED,++Zo.numberOfCancelledRequests,e(t.deferred)){var r=t.deferred;t.deferred=void 0,r.reject()}n&&(--Zo.numberOfActiveRequests,--$o[t.serverKey],++Zo.numberOfCancelledActiveRequests),e(t.cancelFunction)&&t.cancelFunction()}na.maximumRequests=50,na.maximumRequestsPerServer=6,na.requestsByServer={"api.cesium.com:443":18,"assets.cesium.com:443":18},na.throttleRequests=!0,na.debugShowStatistics=!1,na.requestCompletedEvent=ta,Object.defineProperties(na,{statistics:{get:function(){return Zo}},priorityHeapLength:{get:function(){return Ko},set:function(e){if(e<Ko)for(;Qo.length>e;){sa(Qo.pop())}Ko=e,Qo.maximumLength=e,Qo.reserve(e)}}}),na.update=function(){var e,t,n=0,r=Jo.length;for(e=0;e<r;++e)(t=Jo[e]).cancelled&&sa(t),t.state===Ho.ACTIVE?n>0&&(Jo[e-n]=t):++n;Jo.length-=n;var i=Qo.internalArray,o=Qo.length;for(e=0;e<o;++e)ra(i[e]);Qo.resort();for(var a=Math.max(na.maximumRequests-Jo.length,0),s=0;s<a&&Qo.length>0;)(t=Qo.pop()).cancelled?sa(t):!t.throttleByServer||ia(t.serverKey)?(aa(t),++s):sa(t);!function(){if(!na.debugShowStatistics)return;0===Zo.numberOfActiveRequests&&Zo.lastNumberOfActiveRequests>0&&(Zo.numberOfAttemptedRequests>0&&(console.log("Number of attempted requests: "+Zo.numberOfAttemptedRequests),Zo.numberOfAttemptedRequests=0),Zo.numberOfCancelledRequests>0&&(console.log("Number of cancelled requests: "+Zo.numberOfCancelledRequests),Zo.numberOfCancelledRequests=0),Zo.numberOfCancelledActiveRequests>0&&(console.log("Number of cancelled active requests: "+Zo.numberOfCancelledActiveRequests),Zo.numberOfCancelledActiveRequests=0),Zo.numberOfFailedRequests>0&&(console.log("Number of failed requests: "+Zo.numberOfFailedRequests),Zo.numberOfFailedRequests=0));Zo.lastNumberOfActiveRequests=Zo.numberOfActiveRequests}()},na.getServerKey=function(t){var n=new Ao(t).resolve(ea);n.normalize();var r=n.authority;return/:/.test(r)||(r=r+":"+("https"===n.scheme?"443":"80")),e($o[r])||($o[r]=0),r},na.request=function(t){if(Vo(t.url)||zo(t.url))return ta.raiseEvent(),t.state=Ho.RECEIVED,t.requestFunction();if(++Zo.numberOfAttemptedRequests,e(t.serverKey)||(t.serverKey=na.getServerKey(t.url)),!na.throttleRequests||!t.throttleByServer||ia(t.serverKey)){if(!na.throttleRequests||!t.throttle)return aa(t);if(!(Jo.length>=na.maximumRequests)){ra(t);var n=Qo.insert(t);if(e(n)){if(n===t)return;sa(n)}return oa(t)}}},na.clearForSpecs=function(){for(;Qo.length>0;){sa(Qo.pop())}for(var e=Jo.length,t=0;t<e;++t)sa(Jo[t]);Jo.length=0,$o={},Zo.numberOfAttemptedRequests=0,Zo.numberOfActiveRequests=0,Zo.numberOfCancelledRequests=0,Zo.numberOfCancelledActiveRequests=0,Zo.numberOfFailedRequests=0,Zo.numberOfActiveRequestsEver=0,Zo.lastNumberOfActiveRequests=0},na.numberOfActiveRequestsByServer=function(e){return $o[e]},na.requestHeap=Qo;var ua={},ca={};ua.add=function(t,n){var r=t.toLowerCase()+":"+n;e(ca[r])||(ca[r]=!0)},ua.remove=function(t,n){var r=t.toLowerCase()+":"+n;e(ca[r])&&delete ca[r]},ua.contains=function(t){var n=function(t){var n=new Ao(t);n.normalize();var r=n.getAuthority();if(e(r)){if(-1!==r.indexOf("@")){var i=r.split("@");r=i[1]}if(-1===r.indexOf(":")){var o=n.getScheme();if(e(o)||(o=(o=window.location.protocol).substring(0,o.length-1)),"http"===o)r+=":80";else{if("https"!==o)return;r+=":443"}}return r}}(t);return!(!e(n)||!e(ca[n]))},ua.clear=function(){ca={}};var la,ha=function(){try{var e=new XMLHttpRequest;return e.open("GET","#",!0),e.responseType="blob","blob"===e.responseType}catch(t){return!1}}();function da(t,n,r,i){var o,a=t.query;if(!e(a)||0===a.length)return{};if(-1===a.indexOf("=")){var s={};s[a]=void 0,o=s}else o=function(t){var n={};if(""===t)return n;for(var r=t.replace(/\+/g,"%20").split(/[&;]/),i=0,o=r.length;i<o;++i){var a=r[i].split("="),s=decodeURIComponent(a[0]),u=a[1];u=e(u)?decodeURIComponent(u):"";var c=n[s];"string"==typeof c?n[s]=[c,u]:Array.isArray(c)?c.push(u):n[s]=u}return n}(a);n._queryParameters=r?_a(o,n._queryParameters,i):o,t.query=void 0}function fa(t,n){var r=n._queryParameters,i=Object.keys(r);1!==i.length||e(r[i[0]])?t.query=function(e){var t="";for(var n in e)if(e.hasOwnProperty(n)){var r=e[n],i=encodeURIComponent(n)+"=";if(Array.isArray(r))for(var o=0,a=r.length;o<a;++o)t+=i+encodeURIComponent(r[o])+"&";else t+=i+encodeURIComponent(r)+"&"}return t.slice(0,-1)}(r):t.query=i[0]}function ma(t,n){return e(t)?e(t.clone)?t.clone():Oo(t):n}function pa(e){if(e.state===Ho.ISSUED||e.state===Ho.ACTIVE)throw new ve("The Resource is already being fetched.");e.state=Ho.UNISSUED,e.deferred=void 0}function _a(t,n,r){if(!r)return No(t,n);var i=Oo(t,!0);for(var o in n)if(n.hasOwnProperty(o)){var a=i[o],s=n[o];e(a)?(Array.isArray(a)||(a=i[o]=[a]),i[o]=a.concat(s)):i[o]=Array.isArray(s)?s.slice():s}return i}function ga(e){"string"==typeof(e=i(e,i.EMPTY_OBJECT))&&(e={url:e}),this._url=void 0,this._templateValues=ma(e.templateValues,{}),this._queryParameters=ma(e.queryParameters,{}),this.headers=ma(e.headers,{}),this.request=i(e.request,new ko),this.proxy=e.proxy,this.retryCallback=e.retryCallback,this.retryAttempts=i(e.retryAttempts,0),this._retryCount=0;var t=new Ao(e.url);da(t,this,!0,!0),t.fragment=void 0,this._url=t.toString()}function va(t){var n=t.resource,r=t.flipY,i=t.preferImageBitmap,o=n.request;o.url=n.url,o.requestFunction=function(){var e=!1;n.isDataUri||n.isBlobUri||(e=n.isCrossOriginUrl);var t=Et.defer();return ga._Implementations.createImage(o,e,t,r,i),t.promise};var a=na.request(o);if(e(a))return a.otherwise((function(e){return o.state!==Ho.FAILED?Et.reject(e):n.retryOnError(e).then((function(t){return t?(o.state=Ho.UNISSUED,o.deferred=void 0,va({resource:n,flipY:r,preferImageBitmap:i})):Et.reject(e)}))}))}function ya(t,n,r){var i={};i[n]=r,t.setQueryParameters(i);var o=t.request;o.url=t.url,o.requestFunction=function(){var e=Et.defer();return window[r]=function(t){e.resolve(t);try{delete window[r]}catch(n){window[r]=void 0}},ga._Implementations.loadAndExecuteScript(t.url,r,e),e.promise};var a=na.request(o);if(e(a))return a.otherwise((function(e){return o.state!==Ho.FAILED?Et.reject(e):t.retryOnError(e).then((function(i){return i?(o.state=Ho.UNISSUED,o.deferred=void 0,ya(t,n,r)):Et.reject(e)}))}))}ga.createIfNeeded=function(e){return e instanceof ga?e.getDerivedResource({request:e.request}):"string"!=typeof e?e:new ga({url:e})},ga.supportsImageBitmapOptions=function(){if(e(la))return la;if("function"!=typeof createImageBitmap)return la=Et.resolve(!1);return la=ga.fetchBlob({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWP4////fwAJ+wP9CNHoHgAAAABJRU5ErkJggg=="}).then((function(e){return createImageBitmap(e,{imageOrientation:"flipY",premultiplyAlpha:"none"})})).then((function(e){return!0})).otherwise((function(){return!1}))},Object.defineProperties(ga,{isBlobSupported:{get:function(){return ha}}}),Object.defineProperties(ga.prototype,{queryParameters:{get:function(){return this._queryParameters}},templateValues:{get:function(){return this._templateValues}},url:{get:function(){return this.getUrlComponent(!0,!0)},set:function(e){var t=new Ao(e);da(t,this,!1),t.fragment=void 0,this._url=t.toString()}},extension:{get:function(){return function(e){var t=new Ao(e);t.normalize();var n=t.path,r=n.lastIndexOf("/");return-1!==r&&(n=n.substr(r+1)),r=n.lastIndexOf("."),-1===r?"":n.substr(r+1)}(this._url)}},isDataUri:{get:function(){return Vo(this._url)}},isBlobUri:{get:function(){return zo(this._url)}},isCrossOriginUrl:{get:function(){return Bo(this._url)}},hasHeaders:{get:function(){return Object.keys(this.headers).length>0}}}),ga.prototype.toString=function(){return this.getUrlComponent(!0,!0)},ga.prototype.getUrlComponent=function(t,n){if(this.isDataUri)return this._url;var r=new Ao(this._url);t&&fa(r,this);var i=r.toString().replace(/%7B/g,"{").replace(/%7D/g,"}"),o=this._templateValues;return i=i.replace(/{(.*?)}/g,(function(t,n){var r=o[n];return e(r)?encodeURIComponent(r):t})),n&&e(this.proxy)&&(i=this.proxy.getURL(i)),i},ga.prototype.setQueryParameters=function(e,t){this._queryParameters=t?_a(this._queryParameters,e,!1):_a(e,this._queryParameters,!1)},ga.prototype.appendQueryParameters=function(e){this._queryParameters=_a(e,this._queryParameters,!0)},ga.prototype.setTemplateValues=function(e,t){this._templateValues=t?No(this._templateValues,e):No(e,this._templateValues)},ga.prototype.getDerivedResource=function(t){var n=this.clone();if(n._retryCount=0,e(t.url)){var r=new Ao(t.url);da(r,n,!0,i(t.preserveQueryParameters,!1)),r.fragment=void 0,n._url=r.resolve(new Ao(Mo(this._url))).toString()}return e(t.queryParameters)&&(n._queryParameters=No(t.queryParameters,n._queryParameters)),e(t.templateValues)&&(n._templateValues=No(t.templateValues,n.templateValues)),e(t.headers)&&(n.headers=No(t.headers,n.headers)),e(t.proxy)&&(n.proxy=t.proxy),e(t.request)&&(n.request=t.request),e(t.retryCallback)&&(n.retryCallback=t.retryCallback),e(t.retryAttempts)&&(n.retryAttempts=t.retryAttempts),n},ga.prototype.retryOnError=function(e){var t=this.retryCallback;if("function"!=typeof t||this._retryCount>=this.retryAttempts)return Et(!1);var n=this;return Et(t(this,e)).then((function(e){return++n._retryCount,e}))},ga.prototype.clone=function(t){return e(t)||(t=new ga({url:this._url})),t._url=this._url,t._queryParameters=Oo(this._queryParameters),t._templateValues=Oo(this._templateValues),t.headers=Oo(this.headers),t.proxy=this.proxy,t.retryCallback=this.retryCallback,t.retryAttempts=this.retryAttempts,t._retryCount=0,t.request=this.request.clone(),t},ga.prototype.getBaseUri=function(t){return function(t,n){var r="",i=t.lastIndexOf("/");return-1!==i&&(r=t.substring(0,i+1)),n?(e((t=new Ao(t)).query)&&(r+="?"+t.query),e(t.fragment)&&(r+="#"+t.fragment),r):r}(this.getUrlComponent(t),t)},ga.prototype.appendForwardSlash=function(){var e;this._url=(0!==(e=this._url).length&&"/"===e[e.length-1]||(e+="/"),e)},ga.prototype.fetchArrayBuffer=function(){return this.fetch({responseType:"arraybuffer"})},ga.fetchArrayBuffer=function(e){return new ga(e).fetchArrayBuffer()},ga.prototype.fetchBlob=function(){return this.fetch({responseType:"blob"})},ga.fetchBlob=function(e){return new ga(e).fetchBlob()},ga.prototype.fetchImage=function(t){t=i(t,i.EMPTY_OBJECT);var n=i(t.preferImageBitmap,!1),r=i(t.preferBlob,!1),o=i(t.flipY,!1);if(pa(this.request),!ha||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!r)return va({resource:this,flipY:o,preferImageBitmap:n});var a,s,u,c=this.fetchBlob();return e(c)?ga.supportsImageBitmapOptions().then((function(e){return a=e&&n,c})).then((function(t){if(e(t)){if(u=t,a)return ga.createImageBitmapFromBlob(t,{flipY:o,premultiplyAlpha:!1});var n=window.URL.createObjectURL(t);return va({resource:s=new ga({url:n}),flipY:o,preferImageBitmap:!1})}})).then((function(t){if(e(t))return t.blob=u,a||window.URL.revokeObjectURL(s.url),t})).otherwise((function(t){return e(s)&&window.URL.revokeObjectURL(s.url),t.blob=u,Et.reject(t)})):void 0},ga.fetchImage=function(e){return new ga(e).fetchImage({flipY:e.flipY,preferBlob:e.preferBlob,preferImageBitmap:e.preferImageBitmap})},ga.prototype.fetchText=function(){return this.fetch({responseType:"text"})},ga.fetchText=function(e){return new ga(e).fetchText()},ga.prototype.fetchJson=function(){var t=this.fetch({responseType:"text",headers:{Accept:"application/json,*/*;q=0.01"}});if(e(t))return t.then((function(t){if(e(t))return JSON.parse(t)}))},ga.fetchJson=function(e){return new ga(e).fetchJson()},ga.prototype.fetchXML=function(){return this.fetch({responseType:"document",overrideMimeType:"text/xml"})},ga.fetchXML=function(e){return new ga(e).fetchXML()},ga.prototype.fetchJsonp=function(t){var n;t=i(t,"callback"),pa(this.request);do{n="loadJsonp"+Math.random().toString().substring(2,8)}while(e(window[n]));return ya(this,t,n)},ga.fetchJsonp=function(e){return new ga(e).fetchJsonp(e.callbackParameterName)},ga.prototype._makeRequest=function(t){var n=this;pa(n.request);var r=n.request;r.url=n.url,r.requestFunction=function(){var i=t.responseType,o=No(t.headers,n.headers),a=t.overrideMimeType,s=t.method,u=t.data,c=Et.defer(),l=ga._Implementations.loadWithXhr(n.url,i,s,u,o,c,a);return e(l)&&e(l.abort)&&(r.cancelFunction=function(){l.abort()}),c.promise};var i=na.request(r);if(e(i))return i.then((function(e){return r.cancelFunction=void 0,e})).otherwise((function(e){return r.cancelFunction=void 0,r.state!==Ho.FAILED?Et.reject(e):n.retryOnError(e).then((function(i){return i?(r.state=Ho.UNISSUED,r.deferred=void 0,n.fetch(t)):Et.reject(e)}))}))};var Ta=/^data:(.*?)(;base64)?,(.*)$/;function Ea(e,t){var n=decodeURIComponent(t);return e?atob(n):n}function xa(e,t){for(var n=Ea(e,t),r=new ArrayBuffer(n.length),i=new Uint8Array(r),o=0;o<n.length;o++)i[o]=n.charCodeAt(o);return r}function Ca(e,t){switch(t){case"text":return e.toString("utf8");case"json":return JSON.parse(e.toString("utf8"));default:return new Uint8Array(e).buffer}}ga.prototype.fetch=function(e){return(e=ma(e,{})).method="GET",this._makeRequest(e)},ga.fetch=function(e){return new ga(e).fetch({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},ga.prototype.delete=function(e){return(e=ma(e,{})).method="DELETE",this._makeRequest(e)},ga.delete=function(e){return new ga(e).delete({responseType:e.responseType,overrideMimeType:e.overrideMimeType,data:e.data})},ga.prototype.head=function(e){return(e=ma(e,{})).method="HEAD",this._makeRequest(e)},ga.head=function(e){return new ga(e).head({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},ga.prototype.options=function(e){return(e=ma(e,{})).method="OPTIONS",this._makeRequest(e)},ga.options=function(e){return new ga(e).options({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},ga.prototype.post=function(e,t){return n.defined("data",e),(t=ma(t,{})).method="POST",t.data=e,this._makeRequest(t)},ga.post=function(e){return new ga(e).post(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},ga.prototype.put=function(e,t){return n.defined("data",e),(t=ma(t,{})).method="PUT",t.data=e,this._makeRequest(t)},ga.put=function(e){return new ga(e).put(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},ga.prototype.patch=function(e,t){return n.defined("data",e),(t=ma(t,{})).method="PATCH",t.data=e,this._makeRequest(t)},ga.patch=function(e){return new ga(e).patch(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},ga._Implementations={},ga._Implementations.createImage=function(t,n,r,i,o){var a=t.url;ga.supportsImageBitmapOptions().then((function(s){if(s&&o){var u=Et.defer(),c=ga._Implementations.loadWithXhr(a,"blob","GET",void 0,void 0,u,void 0,void 0,void 0);return e(c)&&e(c.abort)&&(t.cancelFunction=function(){c.abort()}),u.promise.then((function(t){if(e(t))return ga.createImageBitmapFromBlob(t,{flipY:i,premultiplyAlpha:!1});r.reject(new ve("Successfully retrieved "+a+" but it contained no content."))})).then(r.resolve)}!function(e,t,n){var r=new Image;r.onload=function(){n.resolve(r)},r.onerror=function(e){n.reject(e)},t&&(ua.contains(e)?r.crossOrigin="use-credentials":r.crossOrigin=""),r.src=e}(a,n,r)})).otherwise(r.reject)},ga.createImageBitmapFromBlob=function(e,t){return n.defined("options",t),n.typeOf.bool("options.flipY",t.flipY),n.typeOf.bool("options.premultiplyAlpha",t.premultiplyAlpha),createImageBitmap(e,{imageOrientation:t.flipY?"flipY":"none",premultiplyAlpha:t.premultiplyAlpha?"premultiply":"none"})};var Sa="undefined"==typeof XMLHttpRequest;function Aa(t){if(t=i(t,i.EMPTY_OBJECT),this._dates=void 0,this._samples=void 0,this._dateColumn=-1,this._xPoleWanderRadiansColumn=-1,this._yPoleWanderRadiansColumn=-1,this._ut1MinusUtcSecondsColumn=-1,this._xCelestialPoleOffsetRadiansColumn=-1,this._yCelestialPoleOffsetRadiansColumn=-1,this._taiMinusUtcSecondsColumn=-1,this._columnCount=0,this._lastIndex=-1,this._downloadPromise=void 0,this._dataError=void 0,this._addNewLeapSeconds=i(t.addNewLeapSeconds,!0),e(t.data))ba(this,t.data);else if(e(t.url)){var n=ga.createIfNeeded(t.url),r=this;this._downloadPromise=n.fetchJson().then((function(e){ba(r,e)})).otherwise((function(){r._dataError="An error occurred while retrieving the EOP data from the URL "+n.url+"."}))}else ba(this,{columnNames:["dateIso8601","modifiedJulianDateUtc","xPoleWanderRadians","yPoleWanderRadians","ut1MinusUtcSeconds","lengthOfDayCorrectionSeconds","xCelestialPoleOffsetRadians","yCelestialPoleOffsetRadians","taiMinusUtcSeconds"],samples:[]})}function wa(e,t){return Co.compare(e.julianDate,t)}function ba(t,n){if(e(n.columnNames))if(e(n.samples)){var r=n.columnNames.indexOf("modifiedJulianDateUtc"),i=n.columnNames.indexOf("xPoleWanderRadians"),o=n.columnNames.indexOf("yPoleWanderRadians"),a=n.columnNames.indexOf("ut1MinusUtcSeconds"),s=n.columnNames.indexOf("xCelestialPoleOffsetRadians"),u=n.columnNames.indexOf("yCelestialPoleOffsetRadians"),c=n.columnNames.indexOf("taiMinusUtcSeconds");if(r<0||i<0||o<0||a<0||s<0||u<0||c<0)t._dataError="Error in loaded EOP data: The columnNames property must include modifiedJulianDateUtc, xPoleWanderRadians, yPoleWanderRadians, ut1MinusUtcSeconds, xCelestialPoleOffsetRadians, yCelestialPoleOffsetRadians, and taiMinusUtcSeconds columns";else{var l,h=t._samples=n.samples,d=t._dates=[];t._dateColumn=r,t._xPoleWanderRadiansColumn=i,t._yPoleWanderRadiansColumn=o,t._ut1MinusUtcSecondsColumn=a,t._xCelestialPoleOffsetRadiansColumn=s,t._yCelestialPoleOffsetRadiansColumn=u,t._taiMinusUtcSecondsColumn=c,t._columnCount=n.columnNames.length,t._lastIndex=void 0;for(var f=t._addNewLeapSeconds,m=0,p=h.length;m<p;m+=t._columnCount){var _=h[m+r],g=h[m+c],v=new Co(_+ro.MODIFIED_JULIAN_DATE_DIFFERENCE,g,io.TAI);if(d.push(v),f){if(g!==l&&e(l)){var y=Co.leapSeconds,T=Qi(y,v,wa);if(T<0){var E=new no(v,g);y.splice(~T,0,E)}}l=g}}}}else t._dataError="Error in loaded EOP data: The samples property is required.";else t._dataError="Error in loaded EOP data: The columnNames property is required."}function Da(e,t,n,r,i){var o=n*r;i.xPoleWander=t[o+e._xPoleWanderRadiansColumn],i.yPoleWander=t[o+e._yPoleWanderRadiansColumn],i.xPoleOffset=t[o+e._xCelestialPoleOffsetRadiansColumn],i.yPoleOffset=t[o+e._yCelestialPoleOffsetRadiansColumn],i.ut1MinusUtc=t[o+e._ut1MinusUtcSecondsColumn]}function Ia(e,t,n){return t+e*(n-t)}function Ra(e,t,n,r,i,o,a){var s=e._columnCount;if(o>t.length-1)return a.xPoleWander=0,a.yPoleWander=0,a.xPoleOffset=0,a.yPoleOffset=0,a.ut1MinusUtc=0,a;var u=t[i],c=t[o];if(u.equals(c)||r.equals(u))return Da(e,n,i,s,a),a;if(r.equals(c))return Da(e,n,o,s,a),a;var l=Co.secondsDifference(r,u)/Co.secondsDifference(c,u),h=i*s,d=o*s,f=n[h+e._ut1MinusUtcSecondsColumn],m=n[d+e._ut1MinusUtcSecondsColumn],p=m-f;if(p>.5||p<-.5){var _=n[h+e._taiMinusUtcSecondsColumn],g=n[d+e._taiMinusUtcSecondsColumn];_!==g&&(c.equals(r)?f=m:m-=g-_)}return a.xPoleWander=Ia(l,n[h+e._xPoleWanderRadiansColumn],n[d+e._xPoleWanderRadiansColumn]),a.yPoleWander=Ia(l,n[h+e._yPoleWanderRadiansColumn],n[d+e._yPoleWanderRadiansColumn]),a.xPoleOffset=Ia(l,n[h+e._xCelestialPoleOffsetRadiansColumn],n[d+e._xCelestialPoleOffsetRadiansColumn]),a.yPoleOffset=Ia(l,n[h+e._yCelestialPoleOffsetRadiansColumn],n[d+e._yCelestialPoleOffsetRadiansColumn]),a.ut1MinusUtc=Ia(l,f,m),a}ga._Implementations.loadWithXhr=function(t,n,r,o,a,s,u){var c=Ta.exec(t);if(null===c){if(!Sa){var l=new XMLHttpRequest;if(ua.contains(t)&&(l.withCredentials=!0),l.open(r,t,!0),e(u)&&e(l.overrideMimeType)&&l.overrideMimeType(u),e(a))for(var h in a)a.hasOwnProperty(h)&&l.setRequestHeader(h,a[h]);e(n)&&(l.responseType=n);var d=!1;return"string"==typeof t&&(d=0===t.indexOf("file://")||"undefined"!=typeof window&&"file://"===window.location.origin),l.onload=function(){if(!(l.status<200||l.status>=300)||d&&0===l.status){var t=l.response,i=l.responseType;if("HEAD"===r||"OPTIONS"===r){var o=l.getAllResponseHeaders().trim().split(/[\r\n]+/),a={};return o.forEach((function(e){var t=e.split(": "),n=t.shift();a[n]=t.join(": ")})),void s.resolve(a)}if(204===l.status)s.resolve();else if(!e(t)||e(n)&&i!==n)if("json"===n&&"string"==typeof t)try{s.resolve(JSON.parse(t))}catch(u){s.reject(u)}else(""===i||"document"===i)&&e(l.responseXML)&&l.responseXML.hasChildNodes()?s.resolve(l.responseXML):""!==i&&"text"!==i||!e(l.responseText)?s.reject(new ve("Invalid XMLHttpRequest response type.")):s.resolve(l.responseText);else s.resolve(t)}else s.reject(new Wo(l.status,l.response,l.getAllResponseHeaders()))},l.onerror=function(e){s.reject(new Wo)},l.send(o),l}!function(e,t,n,r,i,o,a){var s=require("url").parse(e),u="https:"===s.protocol?require("https"):require("http"),c=require("zlib"),l={protocol:s.protocol,hostname:s.hostname,port:s.port,path:s.path,query:s.query,method:n,headers:i};u.request(l).on("response",(function(e){if(e.statusCode<200||e.statusCode>=300)o.reject(new Wo(e.statusCode,e,e.headers));else{var n=[];e.on("data",(function(e){n.push(e)})),e.on("end",(function(){var r=Buffer.concat(n);"gzip"===e.headers["content-encoding"]?c.gunzip(r,(function(e,n){e?o.reject(new ve("Error decompressing response.")):o.resolve(Ca(n,t))})):o.resolve(Ca(r,t))}))}})).on("error",(function(e){o.reject(new Wo)})).end()}(t,n,r,0,a,s)}else s.resolve(function(e,t){t=i(t,"");var n=e[1],r=!!e[2],o=e[3];switch(t){case"":case"text":return Ea(r,o);case"arraybuffer":return xa(r,o);case"blob":var a=xa(r,o);return new Blob([a],{type:n});case"document":return(new DOMParser).parseFromString(Ea(r,o),n);case"json":return JSON.parse(Ea(r,o))}}(c,n))},ga._Implementations.loadAndExecuteScript=function(e,t,n){return function(e){var t=Et.defer(),n=document.createElement("script");n.async=!0,n.src=e;var r=document.getElementsByTagName("head")[0];return n.onload=function(){n.onload=void 0,r.removeChild(n),t.resolve()},n.onerror=function(e){t.reject(e)},r.appendChild(n),t.promise}(e).otherwise(n.reject)},ga._DefaultImplementations={},ga._DefaultImplementations.createImage=ga._Implementations.createImage,ga._DefaultImplementations.loadWithXhr=ga._Implementations.loadWithXhr,ga._DefaultImplementations.loadAndExecuteScript=ga._Implementations.loadAndExecuteScript,ga.DEFAULT=Object.freeze(new ga({url:"undefined"==typeof document?"":document.location.href.split("?")[0]})),Aa.NONE=Object.freeze({getPromiseToLoad:function(){return Et.resolve()},compute:function(t,n){return e(n)?(n.xPoleWander=0,n.yPoleWander=0,n.xPoleOffset=0,n.yPoleOffset=0,n.ut1MinusUtc=0):n=new Ji(0,0,0,0,0),n}}),Aa.prototype.getPromiseToLoad=function(){return Et(this._downloadPromise)},Aa.prototype.compute=function(t,n){if(e(this._samples)){if(e(n)||(n=new Ji(0,0,0,0,0)),0===this._samples.length)return n.xPoleWander=0,n.yPoleWander=0,n.xPoleOffset=0,n.yPoleOffset=0,n.ut1MinusUtc=0,n;var r=this._dates,i=this._lastIndex,o=0,a=0;if(e(i)){var s=r[i],u=r[i+1],c=Co.lessThanOrEquals(s,t),l=!e(u),h=l||Co.greaterThanOrEquals(u,t);if(c&&h)return o=i,!l&&u.equals(t)&&++o,a=o+1,Ra(this,r,this._samples,t,o,a,n),n}var d=Qi(r,t,Co.compare,this._dateColumn);return d>=0?(d<r.length-1&&r[d+1].equals(t)&&++d,o=d,a=d):(o=(a=~d)-1)<0&&(o=0),this._lastIndex=o,Ra(this,r,this._samples,t,o,a,n),n}if(e(this._dataError))throw new ve(this._dataError)};var Pa,Oa,Na,Ma=/((?:.*\/)|^)Cesium\.js(?:\?|\#|$)/;function La(){return e(Oa)||(t="undefined"!=typeof CESIUM_BASE_URL?CESIUM_BASE_URL:"object"==typeof define&&e(define.amd)&&!define.amd.toUrlUndefined&&e(require.toUrl)?Mo("..",za("Core/buildModuleUrl.js")):function(){for(var e=document.getElementsByTagName("script"),t=0,n=e.length;t<n;++t){var r=e[t].getAttribute("src"),i=Ma.exec(r);if(null!==i)return i[1]}}(),(Oa=new ga({url:(n=t,"undefined"==typeof document?n:(e(Pa)||(Pa=document.createElement("a")),Pa.href=n,Pa.href=Pa.href,Pa.href))})).appendForwardSlash()),Oa;var t,n}function Fa(e){return La().getDerivedResource({url:e}).url}function za(t){return e(Na)||(Na=Fa),Na(t)}function Ba(e,t,n){this.x=e,this.y=t,this.s=n}function Ua(e){e=i(e,i.EMPTY_OBJECT),this._xysFileUrlTemplate=ga.createIfNeeded(e.xysFileUrlTemplate),this._interpolationOrder=i(e.interpolationOrder,9),this._sampleZeroJulianEphemerisDate=i(e.sampleZeroJulianEphemerisDate,2442396.5),this._sampleZeroDateTT=new Co(this._sampleZeroJulianEphemerisDate,0,io.TAI),this._stepSizeDays=i(e.stepSizeDays,1),this._samplesPerXysFile=i(e.samplesPerXysFile,1e3),this._totalSamples=i(e.totalSamples,27426),this._samples=new Array(3*this._totalSamples),this._chunkDownloadsInProgress=[];for(var t=this._interpolationOrder,n=this._denominators=new Array(t+1),r=this._xTable=new Array(t+1),o=Math.pow(this._stepSizeDays,t),a=0;a<=t;++a){n[a]=o,r[a]=a*this._stepSizeDays;for(var s=0;s<=t;++s)s!==a&&(n[a]*=a-s);n[a]=1/n[a]}this._work=new Array(t+1),this._coef=new Array(t+1)}za._cesiumScriptRegex=Ma,za._buildModuleUrlFromBaseUrl=Fa,za._clearBaseResource=function(){Oa=void 0},za.setBaseUrl=function(e){Oa=ga.DEFAULT.getDerivedResource({url:e})},za.getCesiumBaseUrl=La;var Va=new Co(0,0,io.TAI);function Ha(e,t,n){var r=Va;return r.dayNumber=t,r.secondsOfDay=n,Co.daysDifference(r,e._sampleZeroDateTT)}function Ga(t,n){if(t._chunkDownloadsInProgress[n])return t._chunkDownloadsInProgress[n];var r=Et.defer();t._chunkDownloadsInProgress[n]=r;var i=t._xysFileUrlTemplate;return Et((e(i)?i.getDerivedResource({templateValues:{0:n}}):new ga({url:za("Assets/IAU2006_XYS/IAU2006_XYS_"+n+".json")})).fetchJson(),(function(e){t._chunkDownloadsInProgress[n]=!1;for(var i=t._samples,o=e.samples,a=n*t._samplesPerXysFile*3,s=0,u=o.length;s<u;++s)i[a+s]=o[s];r.resolve()})),r.promise}Ua.prototype.preload=function(e,t,n,r){var i=Ha(this,e,t),o=Ha(this,n,r),a=i/this._stepSizeDays-this._interpolationOrder/2|0;a<0&&(a=0);var s=o/this._stepSizeDays-this._interpolationOrder/2|0+this._interpolationOrder;s>=this._totalSamples&&(s=this._totalSamples-1);for(var u=a/this._samplesPerXysFile|0,c=s/this._samplesPerXysFile|0,l=[],h=u;h<=c;++h)l.push(Ga(this,h));return Et.all(l)},Ua.prototype.computeXysRadians=function(t,n,r){var i=Ha(this,t,n);if(!(i<0)){var o=i/this._stepSizeDays|0;if(!(o>=this._totalSamples)){var a=this._interpolationOrder,s=o-(a/2|0);s<0&&(s=0);var u=s+a;u>=this._totalSamples&&(s=(u=this._totalSamples-1)-a)<0&&(s=0);var c=!1,l=this._samples;if(e(l[3*s])||(Ga(this,s/this._samplesPerXysFile|0),c=!0),e(l[3*u])||(Ga(this,u/this._samplesPerXysFile|0),c=!0),!c){e(r)?(r.x=0,r.y=0,r.s=0):r=new Ba(0,0,0);var h,d,f=i-s*this._stepSizeDays,m=this._work,p=this._denominators,_=this._coef,g=this._xTable;for(h=0;h<=a;++h)m[h]=f-g[h];for(h=0;h<=a;++h){for(_[h]=1,d=0;d<=a;++d)d!==h&&(_[h]*=m[d]);_[h]*=p[h];var v=3*(s+h);r.x+=_[h]*l[v++],r.y+=_[h]*l[v++],r.s+=_[h]*l[v]}return r}}}};var ka={},Wa={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},qa={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Ya={},ja={east:new p,north:new p,up:new p,west:new p,south:new p,down:new p},Xa=new p,Za=new p,Ka=new p;ka.localFrameToFixedFrameGenerator=function(n,r){if(!Wa.hasOwnProperty(n)||!Wa[n].hasOwnProperty(r))throw new t("firstAxis and secondAxis must be east, north, up, west, south or down.");var o,s=Wa[n][r],u=n+r;return e(Ya[u])?o=Ya[u]:(o=function(t,o,u){if(e(u)||(u=new ye),p.equalsEpsilon(t,p.ZERO,a.EPSILON14))p.unpack(qa[n],0,Xa),p.unpack(qa[r],0,Za),p.unpack(qa[s],0,Ka);else if(a.equalsEpsilon(t.x,0,a.EPSILON14)&&a.equalsEpsilon(t.y,0,a.EPSILON14)){var c=a.sign(t.z);p.unpack(qa[n],0,Xa),"east"!==n&&"west"!==n&&p.multiplyByScalar(Xa,c,Xa),p.unpack(qa[r],0,Za),"east"!==r&&"west"!==r&&p.multiplyByScalar(Za,c,Za),p.unpack(qa[s],0,Ka),"east"!==s&&"west"!==s&&p.multiplyByScalar(Ka,c,Ka)}else{(o=i(o,H.WGS84)).geodeticSurfaceNormal(t,ja.up);var l=ja.up,h=ja.east;h.x=-t.y,h.y=t.x,h.z=0,p.normalize(h,ja.east),p.cross(l,h,ja.north),p.multiplyByScalar(ja.up,-1,ja.down),p.multiplyByScalar(ja.east,-1,ja.west),p.multiplyByScalar(ja.north,-1,ja.south),Xa=ja[n],Za=ja[r],Ka=ja[s]}return u[0]=Xa.x,u[1]=Xa.y,u[2]=Xa.z,u[3]=0,u[4]=Za.x,u[5]=Za.y,u[6]=Za.z,u[7]=0,u[8]=Ka.x,u[9]=Ka.y,u[10]=Ka.z,u[11]=0,u[12]=t.x,u[13]=t.y,u[14]=t.z,u[15]=1,u},Ya[u]=o),o},ka.eastNorthUpToFixedFrame=ka.localFrameToFixedFrameGenerator("east","north"),ka.northEastDownToFixedFrame=ka.localFrameToFixedFrameGenerator("north","east"),ka.northUpEastToFixedFrame=ka.localFrameToFixedFrameGenerator("north","up"),ka.northWestUpToFixedFrame=ka.localFrameToFixedFrameGenerator("north","west");var Qa=new Nr,Ja=new p(1,1,1),$a=new ye;ka.headingPitchRollToFixedFrame=function(e,t,n,r,o){r=i(r,ka.eastNorthUpToFixedFrame);var a=Nr.fromHeadingPitchRoll(t,Qa),s=ye.fromTranslationQuaternionRotationScale(p.ZERO,a,Ja,$a);return o=r(e,n,o),ye.multiply(o,s,o)};var es=new ye,ts=new $;ka.headingPitchRollQuaternion=function(e,t,n,r,i){var o=ka.headingPitchRollToFixedFrame(e,t,n,r,es),a=ye.getMatrix3(o,ts);return Nr.fromRotationMatrix(a,i)};var ns=new p(1,1,1),rs=new p,is=new ye,os=new ye,as=new $,ss=new Nr;ka.fixedFrameToHeadingPitchRoll=function(t,n,r,o){n=i(n,H.WGS84),r=i(r,ka.eastNorthUpToFixedFrame),e(o)||(o=new wn);var a=ye.getTranslation(t,rs);if(p.equals(a,p.ZERO))return o.heading=0,o.pitch=0,o.roll=0,o;var s=ye.inverseTransformation(r(a,n,is),is),u=ye.setScale(t,ns,os);u=ye.setTranslation(u,p.ZERO,u),s=ye.multiply(s,u,s);var c=Nr.fromRotationMatrix(ye.getMatrix3(s,as),ss);return c=Nr.normalize(c,c),wn.fromQuaternion(c,o)};var us=a.TWO_PI/86400,cs=new Co;ka.computeTemeToPseudoFixedMatrix=function(t,n){var r,i=(cs=Co.addSeconds(t,-Co.computeTaiMinusUtc(t),cs)).dayNumber,o=cs.secondsOfDay,s=i-2451545,u=(24110.54841+(r=o>=43200?(s+.5)/ro.DAYS_PER_JULIAN_CENTURY:(s-.5)/ro.DAYS_PER_JULIAN_CENTURY)*(8640184.812866+r*(.093104+-62e-7*r)))*us%a.TWO_PI+(72921158553e-15+11772758384668e-32*(i-2451545.5))*((o+.5*ro.SECONDS_PER_DAY)%ro.SECONDS_PER_DAY),c=Math.cos(u),l=Math.sin(u);return e(n)?(n[0]=c,n[1]=-l,n[2]=0,n[3]=l,n[4]=c,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n):new $(c,l,0,-l,c,0,0,0,1)},ka.iau2006XysData=new Ua,ka.earthOrientationParameters=Aa.NONE;ka.preloadIcrfFixed=function(e){var t=e.start.dayNumber,n=e.start.secondsOfDay+32.184,r=e.stop.dayNumber,i=e.stop.secondsOfDay+32.184,o=ka.iau2006XysData.preload(t,n,r,i),a=ka.earthOrientationParameters.getPromiseToLoad();return Et.all([o,a])},ka.computeIcrfToFixedMatrix=function(t,n){e(n)||(n=new $);var r=ka.computeFixedToIcrfMatrix(t,n);if(e(r))return $.transpose(r,n)};var ls=new Ba(0,0,0),hs=new Ji(0,0,0,0,0,0),ds=new $,fs=new $;ka.computeFixedToIcrfMatrix=function(t,n){e(n)||(n=new $);var r=ka.earthOrientationParameters.compute(t,hs);if(e(r)){var i=t.dayNumber,o=t.secondsOfDay+32.184,s=ka.iau2006XysData.computeXysRadians(i,o,ls);if(e(s)){var u=s.x+r.xPoleOffset,c=s.y+r.yPoleOffset,l=1/(1+Math.sqrt(1-u*u-c*c)),h=ds;h[0]=1-l*u*u,h[3]=-l*u*c,h[6]=u,h[1]=-l*u*c,h[4]=1-l*c*c,h[7]=c,h[2]=-u,h[5]=-c,h[8]=1-l*(u*u+c*c);var d=$.fromRotationZ(-s.s,fs),f=$.multiply(h,d,ds),m=t.dayNumber-2451545,p=(t.secondsOfDay-Co.computeTaiMinusUtc(t)+r.ut1MinusUtc)/ro.SECONDS_PER_DAY,_=.779057273264+p+.00273781191135448*(m+p);_=_%1*a.TWO_PI;var g=$.fromRotationZ(_,fs),v=$.multiply(f,g,ds),y=Math.cos(r.xPoleWander),T=Math.cos(r.yPoleWander),E=Math.sin(r.xPoleWander),x=Math.sin(r.yPoleWander),C=i-2451545+o/ro.SECONDS_PER_DAY,S=-47e-6*(C/=36525)*a.RADIANS_PER_DEGREE/3600,A=Math.cos(S),w=Math.sin(S),b=fs;return b[0]=y*A,b[1]=y*w,b[2]=E,b[3]=-T*w+x*E*A,b[4]=T*A+x*E*w,b[5]=-x*y,b[6]=-x*w-T*E*A,b[7]=x*A-T*E*w,b[8]=T*y,$.multiply(v,b,n)}}};var ms=new le;ka.pointToWindowCoordinates=function(e,t,n,r){return(r=ka.pointToGLWindowCoordinates(e,t,n,r)).y=2*t[5]-r.y,r},ka.pointToGLWindowCoordinates=function(t,n,r,i){e(i)||(i=new c);var o=ms;return ye.multiplyByVector(t,le.fromElements(r.x,r.y,r.z,1,o),o),le.multiplyByScalar(o,1/o.w,o),ye.multiplyByVector(n,o,o),c.fromCartesian4(o,i)};var ps=new p,_s=new p,gs=new p;ka.rotationMatrixFromPositionVelocity=function(t,n,r,o){var s=i(r,H.WGS84).geodeticSurfaceNormal(t,ps),u=p.cross(n,s,_s);p.equalsEpsilon(u,p.ZERO,a.EPSILON6)&&(u=p.clone(p.UNIT_X,u));var c=p.cross(u,n,gs);return p.normalize(c,c),p.cross(n,c,u),p.negate(u,u),p.normalize(u,u),e(o)||(o=new $),o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=u.x,o[4]=u.y,o[5]=u.z,o[6]=c.x,o[7]=c.y,o[8]=c.z,o};var vs=new ye(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),ys=new N,Ts=new p,Es=new p,xs=new $,Cs=new ye,Ss=new ye;ka.basisTo2D=function(e,t,n){var r=ye.getTranslation(t,Es),i=e.ellipsoid,o=i.cartesianToCartographic(r,ys),a=e.project(o,Ts);p.fromElements(a.z,a.x,a.y,a);var s=ka.eastNorthUpToFixedFrame(r,i,Cs),u=ye.inverseTransformation(s,Ss),c=ye.getMatrix3(t,xs),l=ye.multiplyByMatrix3(u,c,n);return ye.multiply(vs,l,n),ye.setTranslation(n,a,n),n},ka.wgs84To2DModelMatrix=function(e,t,n){var r=e.ellipsoid,i=ka.eastNorthUpToFixedFrame(t,r,Cs),o=ye.inverseTransformation(i,Ss),a=r.cartesianToCartographic(t,ys),s=e.project(a,Ts);p.fromElements(s.z,s.x,s.y,s);var u=ye.fromTranslation(s,Cs);return ye.multiply(vs,o,n),ye.multiply(u,n,n),n};var As={STREAM_DRAW:Tn.STREAM_DRAW,STATIC_DRAW:Tn.STATIC_DRAW,DYNAMIC_DRAW:Tn.DYNAMIC_DRAW,validate:function(e){return e===As.STREAM_DRAW||e===As.STATIC_DRAW||e===As.DYNAMIC_DRAW}},ws=Object.freeze(As);function bs(t){var n=(t=i(t,i.EMPTY_OBJECT)).context._gl,r=t.bufferTarget,o=t.typedArray,a=t.sizeInBytes,s=t.usage,u=e(o);u&&(a=o.byteLength);var c=n.createBuffer();n.bindBuffer(r,c),n.bufferData(r,u?o:a,s),n.bindBuffer(r,null),this._gl=n,this._webgl2=t.context._webgl2,this._bufferTarget=r,this._sizeInBytes=a,this._usage=s,this._buffer=c,this.vertexArrayDestroyable=!0}bs.createVertexBuffer=function(e){return new bs({context:e.context,bufferTarget:Tn.ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage})},bs.createIndexBuffer=function(e){var t=e.context,n=e.indexDatatype,r=Dn.getSizeInBytes(n),i=new bs({context:t,bufferTarget:Tn.ELEMENT_ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage}),o=i.sizeInBytes/r;return Object.defineProperties(i,{indexDatatype:{get:function(){return n}},bytesPerIndex:{get:function(){return r}},numberOfIndices:{get:function(){return o}}}),i},Object.defineProperties(bs.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}}}),bs.prototype._getBuffer=function(){return this._buffer},bs.prototype.copyFromArrayView=function(e,t){t=i(t,0);var n=this._gl,r=this._bufferTarget;n.bindBuffer(r,this._buffer),n.bufferSubData(r,t,e),n.bindBuffer(r,null)},bs.prototype.copyFromBuffer=function(e,t,n,r){var i=Tn.COPY_READ_BUFFER,o=Tn.COPY_WRITE_BUFFER,a=this._gl;a.bindBuffer(o,this._buffer),a.bindBuffer(i,e._buffer),a.copyBufferSubData(i,o,t,n,r),a.bindBuffer(o,null),a.bindBuffer(i,null)},bs.prototype.getBufferData=function(e,t,n,r){t=i(t,0),n=i(n,0);var o=this._gl,a=Tn.COPY_READ_BUFFER;o.bindBuffer(a,this._buffer),o.getBufferSubData(a,t,e,n,r),o.bindBuffer(a,null)},bs.prototype.isDestroyed=function(){return!1},bs.prototype.destroy=function(){return this._gl.deleteBuffer(this._buffer),hi(this)};var Ds={_maximumCombinedTextureImageUnits:0,_maximumCubeMapSize:0,_maximumFragmentUniformVectors:0,_maximumTextureImageUnits:0,_maximumRenderbufferSize:0,_maximumTextureSize:0,_maximumVaryingVectors:0,_maximumVertexAttributes:0,_maximumVertexTextureImageUnits:0,_maximumVertexUniformVectors:0,_minimumAliasedLineWidth:0,_maximumAliasedLineWidth:0,_minimumAliasedPointSize:0,_maximumAliasedPointSize:0,_maximumViewportWidth:0,_maximumViewportHeight:0,_maximumTextureFilterAnisotropy:0,_maximumDrawBuffers:0,_maximumColorAttachments:0,_highpFloatSupported:!1,_highpIntSupported:!1};Object.defineProperties(Ds,{maximumCombinedTextureImageUnits:{get:function(){return Ds._maximumCombinedTextureImageUnits}},maximumCubeMapSize:{get:function(){return Ds._maximumCubeMapSize}},maximumFragmentUniformVectors:{get:function(){return Ds._maximumFragmentUniformVectors}},maximumTextureImageUnits:{get:function(){return Ds._maximumTextureImageUnits}},maximumRenderbufferSize:{get:function(){return Ds._maximumRenderbufferSize}},maximumTextureSize:{get:function(){return Ds._maximumTextureSize}},maximumVaryingVectors:{get:function(){return Ds._maximumVaryingVectors}},maximumVertexAttributes:{get:function(){return Ds._maximumVertexAttributes}},maximumVertexTextureImageUnits:{get:function(){return Ds._maximumVertexTextureImageUnits}},maximumVertexUniformVectors:{get:function(){return Ds._maximumVertexUniformVectors}},minimumAliasedLineWidth:{get:function(){return Ds._minimumAliasedLineWidth}},maximumAliasedLineWidth:{get:function(){return Ds._maximumAliasedLineWidth}},minimumAliasedPointSize:{get:function(){return Ds._minimumAliasedPointSize}},maximumAliasedPointSize:{get:function(){return Ds._maximumAliasedPointSize}},maximumViewportWidth:{get:function(){return Ds._maximumViewportWidth}},maximumViewportHeight:{get:function(){return Ds._maximumViewportHeight}},maximumTextureFilterAnisotropy:{get:function(){return Ds._maximumTextureFilterAnisotropy}},maximumDrawBuffers:{get:function(){return Ds._maximumDrawBuffers}},maximumColorAttachments:{get:function(){return Ds._maximumColorAttachments}},highpFloatSupported:{get:function(){return Ds._highpFloatSupported}},highpIntSupported:{get:function(){return Ds._highpIntSupported}}});var Is={POINTS:Tn.POINTS,LINES:Tn.LINES,LINE_LOOP:Tn.LINE_LOOP,LINE_STRIP:Tn.LINE_STRIP,TRIANGLES:Tn.TRIANGLES,TRIANGLE_STRIP:Tn.TRIANGLE_STRIP,TRIANGLE_FAN:Tn.TRIANGLE_FAN,validate:function(e){return e===Is.POINTS||e===Is.LINES||e===Is.LINE_LOOP||e===Is.LINE_STRIP||e===Is.TRIANGLES||e===Is.TRIANGLE_STRIP||e===Is.TRIANGLE_FAN}},Rs=Object.freeze(Is);function Ps(e){e=i(e,i.EMPTY_OBJECT),this._boundingVolume=e.boundingVolume,this._orientedBoundingBox=e.orientedBoundingBox,this._cull=i(e.cull,!0),this._occlude=i(e.occlude,!0),this._modelMatrix=e.modelMatrix,this._primitiveType=i(e.primitiveType,Rs.TRIANGLES),this._vertexArray=e.vertexArray,this._count=e.count,this._offset=i(e.offset,0),this._instanceCount=i(e.instanceCount,0),this._shaderProgram=e.shaderProgram,this._uniformMap=e.uniformMap,this._renderState=e.renderState,this._framebuffer=e.framebuffer,this._pass=e.pass,this._executeInClosestFrustum=i(e.executeInClosestFrustum,!1),this._owner=e.owner,this._debugShowBoundingVolume=i(e.debugShowBoundingVolume,!1),this._debugOverlappingFrustums=0,this._castShadows=i(e.castShadows,!1),this._receiveShadows=i(e.receiveShadows,!1),this._pickId=e.pickId,this._pickOnly=i(e.pickOnly,!1),this.dirty=!0,this.lastDirtyTime=0,this.derivedCommands={}}Object.defineProperties(Ps.prototype,{boundingVolume:{get:function(){return this._boundingVolume},set:function(e){this._boundingVolume!==e&&(this._boundingVolume=e,this.dirty=!0)}},orientedBoundingBox:{get:function(){return this._orientedBoundingBox},set:function(e){this._orientedBoundingBox!==e&&(this._orientedBoundingBox=e,this.dirty=!0)}},cull:{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this.dirty=!0)}},occlude:{get:function(){return this._occlude},set:function(e){this._occlude!==e&&(this._occlude=e,this.dirty=!0)}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix!==e&&(this._modelMatrix=e,this.dirty=!0)}},primitiveType:{get:function(){return this._primitiveType},set:function(e){this._primitiveType!==e&&(this._primitiveType=e,this.dirty=!0)}},vertexArray:{get:function(){return this._vertexArray},set:function(e){this._vertexArray!==e&&(this._vertexArray=e,this.dirty=!0)}},count:{get:function(){return this._count},set:function(e){this._count!==e&&(this._count=e,this.dirty=!0)}},offset:{get:function(){return this._offset},set:function(e){this._offset!==e&&(this._offset=e,this.dirty=!0)}},instanceCount:{get:function(){return this._instanceCount},set:function(e){this._instanceCount!==e&&(this._instanceCount=e,this.dirty=!0)}},shaderProgram:{get:function(){return this._shaderProgram},set:function(e){this._shaderProgram!==e&&(this._shaderProgram=e,this.dirty=!0)}},castShadows:{get:function(){return this._castShadows},set:function(e){this._castShadows!==e&&(this._castShadows=e,this.dirty=!0)}},receiveShadows:{get:function(){return this._receiveShadows},set:function(e){this._receiveShadows!==e&&(this._receiveShadows=e,this.dirty=!0)}},uniformMap:{get:function(){return this._uniformMap},set:function(e){this._uniformMap!==e&&(this._uniformMap=e,this.dirty=!0)}},renderState:{get:function(){return this._renderState},set:function(e){this._renderState!==e&&(this._renderState=e,this.dirty=!0)}},framebuffer:{get:function(){return this._framebuffer},set:function(e){this._framebuffer!==e&&(this._framebuffer=e,this.dirty=!0)}},pass:{get:function(){return this._pass},set:function(e){this._pass!==e&&(this._pass=e,this.dirty=!0)}},executeInClosestFrustum:{get:function(){return this._executeInClosestFrustum},set:function(e){this._executeInClosestFrustum!==e&&(this._executeInClosestFrustum=e,this.dirty=!0)}},owner:{get:function(){return this._owner},set:function(e){this._owner!==e&&(this._owner=e,this.dirty=!0)}},debugShowBoundingVolume:{get:function(){return this._debugShowBoundingVolume},set:function(e){this._debugShowBoundingVolume!==e&&(this._debugShowBoundingVolume=e,this.dirty=!0)}},debugOverlappingFrustums:{get:function(){return this._debugOverlappingFrustums},set:function(e){this._debugOverlappingFrustums!==e&&(this._debugOverlappingFrustums=e,this.dirty=!0)}},pickId:{get:function(){return this._pickId},set:function(e){this._pickId!==e&&(this._pickId=e,this.dirty=!0)}},pickOnly:{get:function(){return this._pickOnly},set:function(e){this._pickOnly!==e&&(this._pickOnly=e,this.dirty=!0)}}}),Ps.shallowClone=function(t,n){if(e(t))return e(n)||(n=new Ps),n._boundingVolume=t._boundingVolume,n._orientedBoundingBox=t._orientedBoundingBox,n._cull=t._cull,n._occlude=t._occlude,n._modelMatrix=t._modelMatrix,n._primitiveType=t._primitiveType,n._vertexArray=t._vertexArray,n._count=t._count,n._offset=t._offset,n._instanceCount=t._instanceCount,n._shaderProgram=t._shaderProgram,n._uniformMap=t._uniformMap,n._renderState=t._renderState,n._framebuffer=t._framebuffer,n._pass=t._pass,n._executeInClosestFrustum=t._executeInClosestFrustum,n._owner=t._owner,n._debugShowBoundingVolume=t._debugShowBoundingVolume,n._debugOverlappingFrustums=t._debugOverlappingFrustums,n._castShadows=t._castShadows,n._receiveShadows=t._receiveShadows,n._pickId=t._pickId,n._pickOnly=t._pickOnly,n.dirty=!0,n.lastDirtyTime=0,n},Ps.prototype.execute=function(e,t){e.draw(this,t)};var Os=Object.freeze({ENVIRONMENT:0,COMPUTE:1,GLOBE:2,TERRAIN_CLASSIFICATION:3,CESIUM_3D_TILE:4,CESIUM_3D_TILE_CLASSIFICATION:5,CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW:6,OPAQUE:7,TRANSLUCENT:8,OVERLAY:9,NUMBER_OF_PASSES:10});function Ns(e,t,n,r){this.x=i(e,0),this.y=i(t,0),this.width=i(n,0),this.height=i(r,0)}Ns.packedLength=4,Ns.pack=function(e,t,n){return n=i(n,0),t[n++]=e.x,t[n++]=e.y,t[n++]=e.width,t[n]=e.height,t},Ns.unpack=function(t,n,r){return n=i(n,0),e(r)||(r=new Ns),r.x=t[n++],r.y=t[n++],r.width=t[n++],r.height=t[n],r},Ns.fromPoints=function(t,n){if(e(n)||(n=new Ns),!e(t)||0===t.length)return n.x=0,n.y=0,n.width=0,n.height=0,n;for(var r=t.length,i=t[0].x,o=t[0].y,a=t[0].x,s=t[0].y,u=1;u<r;u++){var c=t[u],l=c.x,h=c.y;i=Math.min(l,i),a=Math.max(l,a),o=Math.min(h,o),s=Math.max(h,s)}return n.x=i,n.y=o,n.width=a-i,n.height=s-o,n};var Ms=new K,Ls=new N,Fs=new N;Ns.fromRectangle=function(t,n,r){if(e(r)||(r=new Ns),!e(t))return r.x=0,r.y=0,r.width=0,r.height=0,r;var o=(n=i(n,Ms)).project(Oe.southwest(t,Ls)),a=n.project(Oe.northeast(t,Fs));return c.subtract(a,o,a),r.x=o.x,r.y=o.y,r.width=a.x,r.height=a.y,r},Ns.clone=function(t,n){if(e(t))return e(n)?(n.x=t.x,n.y=t.y,n.width=t.width,n.height=t.height,n):new Ns(t.x,t.y,t.width,t.height)},Ns.union=function(t,n,r){e(r)||(r=new Ns);var i=Math.min(t.x,n.x),o=Math.min(t.y,n.y),a=Math.max(t.x+t.width,n.x+n.width),s=Math.max(t.y+t.height,n.y+n.height);return r.x=i,r.y=o,r.width=a-i,r.height=s-o,r},Ns.expand=function(e,t,n){n=Ns.clone(e,n);var r=t.x-n.x,i=t.y-n.y;return r>n.width?n.width=r:r<0&&(n.width-=r,n.x=t.x),i>n.height?n.height=i:i<0&&(n.height-=i,n.y=t.y),n},Ns.intersect=function(e,t){var n=e.x,r=e.y,i=t.x,o=t.y;return n>i+t.width||n+e.width<i||r+e.height<o||r>o+t.height?Q.OUTSIDE:Q.INTERSECTING},Ns.equals=function(t,n){return t===n||e(t)&&e(n)&&t.x===n.x&&t.y===n.y&&t.width===n.width&&t.height===n.height},Ns.prototype.clone=function(e){return Ns.clone(this,e)},Ns.prototype.intersect=function(e){return Ns.intersect(this,e)},Ns.prototype.equals=function(e){return Ns.equals(this,e)};var zs={CLOCKWISE:Tn.CW,COUNTER_CLOCKWISE:Tn.CCW,validate:function(e){return e===zs.CLOCKWISE||e===zs.COUNTER_CLOCKWISE}},Bs=Object.freeze(zs);function Us(t){var n=i(t,i.EMPTY_OBJECT),r=i(n.cull,i.EMPTY_OBJECT),o=i(n.polygonOffset,i.EMPTY_OBJECT),a=i(n.scissorTest,i.EMPTY_OBJECT),s=i(a.rectangle,i.EMPTY_OBJECT),u=i(n.depthRange,i.EMPTY_OBJECT),c=i(n.depthTest,i.EMPTY_OBJECT),l=i(n.colorMask,i.EMPTY_OBJECT),h=i(n.blending,i.EMPTY_OBJECT),d=i(h.color,i.EMPTY_OBJECT),f=i(n.stencilTest,i.EMPTY_OBJECT),m=i(f.frontOperation,i.EMPTY_OBJECT),p=i(f.backOperation,i.EMPTY_OBJECT),_=i(n.sampleCoverage,i.EMPTY_OBJECT),g=n.viewport;this.frontFace=i(n.frontFace,Bs.COUNTER_CLOCKWISE),this.cull={enabled:i(r.enabled,!1),face:i(r.face,Tn.BACK)},this.lineWidth=i(n.lineWidth,1),this.polygonOffset={enabled:i(o.enabled,!1),factor:i(o.factor,0),units:i(o.units,0)},this.scissorTest={enabled:i(a.enabled,!1),rectangle:Ns.clone(s)},this.depthRange={near:i(u.near,0),far:i(u.far,1)},this.depthTest={enabled:i(c.enabled,!1),func:i(c.func,Tn.LESS)},this.colorMask={red:i(l.red,!0),green:i(l.green,!0),blue:i(l.blue,!0),alpha:i(l.alpha,!0)},this.depthMask=i(n.depthMask,!0),this.stencilMask=i(n.stencilMask,-1),this.blending={enabled:i(h.enabled,!1),color:new pn(i(d.red,0),i(d.green,0),i(d.blue,0),i(d.alpha,0)),equationRgb:i(h.equationRgb,Tn.FUNC_ADD),equationAlpha:i(h.equationAlpha,Tn.FUNC_ADD),functionSourceRgb:i(h.functionSourceRgb,Tn.ONE),functionSourceAlpha:i(h.functionSourceAlpha,Tn.ONE),functionDestinationRgb:i(h.functionDestinationRgb,Tn.ZERO),functionDestinationAlpha:i(h.functionDestinationAlpha,Tn.ZERO)},this.stencilTest={enabled:i(f.enabled,!1),frontFunction:i(f.frontFunction,Tn.ALWAYS),backFunction:i(f.backFunction,Tn.ALWAYS),reference:i(f.reference,0),mask:i(f.mask,-1),frontOperation:{fail:i(m.fail,Tn.KEEP),zFail:i(m.zFail,Tn.KEEP),zPass:i(m.zPass,Tn.KEEP)},backOperation:{fail:i(p.fail,Tn.KEEP),zFail:i(p.zFail,Tn.KEEP),zPass:i(p.zPass,Tn.KEEP)}},this.sampleCoverage={enabled:i(_.enabled,!1),value:i(_.value,1),invert:i(_.invert,!1)},this.viewport=e(g)?new Ns(g.x,g.y,g.width,g.height):void 0,this.id=0,this._applyFunctions=[]}var Vs=0,Hs={};function Gs(e,t,n){n?e.enable(t):e.disable(t)}function ks(e,t){e.frontFace(t.frontFace)}function Ws(e,t){var n=t.cull,r=n.enabled;Gs(e,e.CULL_FACE,r),r&&e.cullFace(n.face)}function qs(e,t){e.lineWidth(t.lineWidth)}function Ys(e,t){var n=t.polygonOffset,r=n.enabled;Gs(e,e.POLYGON_OFFSET_FILL,r),r&&e.polygonOffset(n.factor,n.units)}function js(t,n,r){var i=n.scissorTest,o=e(r.scissorTest)?r.scissorTest.enabled:i.enabled;if(Gs(t,t.SCISSOR_TEST,o),o){var a=e(r.scissorTest)?r.scissorTest.rectangle:i.rectangle;t.scissor(a.x,a.y,a.width,a.height)}}function Xs(e,t){var n=t.depthRange;e.depthRange(n.near,n.far)}function Zs(e,t){var n=t.depthTest,r=n.enabled;Gs(e,e.DEPTH_TEST,r),r&&e.depthFunc(n.func)}function Ks(e,t){var n=t.colorMask;e.colorMask(n.red,n.green,n.blue,n.alpha)}function Qs(e,t){e.depthMask(t.depthMask)}function Js(e,t){e.stencilMask(t.stencilMask)}function $s(t,n,r){var i=n.blending,o=e(r.blendingEnabled)?r.blendingEnabled:i.enabled;Gs(t,t.BLEND,o),o&&(!function(e,t){e.blendColor(t.red,t.green,t.blue,t.alpha)}(t,i.color),t.blendEquationSeparate(i.equationRgb,i.equationAlpha),t.blendFuncSeparate(i.functionSourceRgb,i.functionDestinationRgb,i.functionSourceAlpha,i.functionDestinationAlpha))}function eu(e,t){var n=t.stencilTest,r=n.enabled;if(Gs(e,e.STENCIL_TEST,r),r){var i=n.frontFunction,o=n.backFunction,a=n.reference,s=n.mask;e.stencilFunc(i,a,s),e.stencilFuncSeparate(e.BACK,o,a,s),e.stencilFuncSeparate(e.FRONT,i,a,s);var u=n.frontOperation,c=u.fail,l=u.zFail,h=u.zPass;e.stencilOpSeparate(e.FRONT,c,l,h);var d=n.backOperation,f=d.fail,m=d.zFail,p=d.zPass;e.stencilOpSeparate(e.BACK,f,m,p)}}function tu(e,t){var n=t.sampleCoverage,r=n.enabled;Gs(e,e.SAMPLE_COVERAGE,r),r&&e.sampleCoverage(n.value,n.invert)}Us.fromCache=function(t){var n=JSON.stringify(t),r=Hs[n];if(e(r))return++r.referenceCount,r.state;var i=new Us(t),o=JSON.stringify(i);return e(r=Hs[o])||(i.id=Vs++,r={referenceCount:0,state:i},Hs[o]=r),++r.referenceCount,Hs[n]={referenceCount:1,state:r.state},r.state},Us.removeFromCache=function(t){var n=new Us(t),r=JSON.stringify(n),i=Hs[r],o=JSON.stringify(t),a=Hs[o];e(a)&&(--a.referenceCount,0===a.referenceCount&&(delete Hs[o],e(i)&&--i.referenceCount)),e(i)&&0===i.referenceCount&&delete Hs[r]},Us.getCache=function(){return Hs},Us.clearCache=function(){Hs={}};var nu=new Ns;function ru(t,n,r){var o=i(n.viewport,r.viewport);e(o)||((o=nu).width=r.context.drawingBufferWidth,o.height=r.context.drawingBufferHeight),r.context.uniformState.viewport=o,t.viewport(o.x,o.y,o.width,o.height)}Us.apply=function(e,t,n){ks(e,t),Ws(e,t),qs(e,t),Ys(e,t),Xs(e,t),Zs(e,t),Ks(e,t),Qs(e,t),Js(e,t),eu(e,t),tu(e,t),js(e,t,n),$s(e,t,n),ru(e,t,n)},Us.partialApply=function(t,n,r,i,o,a){if(n!==r){var s=r._applyFunctions[n.id];e(s)||(s=function(e,t){var n=[];return e.frontFace!==t.frontFace&&n.push(ks),e.cull.enabled===t.cull.enabled&&e.cull.face===t.cull.face||n.push(Ws),e.lineWidth!==t.lineWidth&&n.push(qs),e.polygonOffset.enabled===t.polygonOffset.enabled&&e.polygonOffset.factor===t.polygonOffset.factor&&e.polygonOffset.units===t.polygonOffset.units||n.push(Ys),e.depthRange.near===t.depthRange.near&&e.depthRange.far===t.depthRange.far||n.push(Xs),e.depthTest.enabled===t.depthTest.enabled&&e.depthTest.func===t.depthTest.func||n.push(Zs),e.colorMask.red===t.colorMask.red&&e.colorMask.green===t.colorMask.green&&e.colorMask.blue===t.colorMask.blue&&e.colorMask.alpha===t.colorMask.alpha||n.push(Ks),e.depthMask!==t.depthMask&&n.push(Qs),e.stencilMask!==t.stencilMask&&n.push(Js),e.stencilTest.enabled===t.stencilTest.enabled&&e.stencilTest.frontFunction===t.stencilTest.frontFunction&&e.stencilTest.backFunction===t.stencilTest.backFunction&&e.stencilTest.reference===t.stencilTest.reference&&e.stencilTest.mask===t.stencilTest.mask&&e.stencilTest.frontOperation.fail===t.stencilTest.frontOperation.fail&&e.stencilTest.frontOperation.zFail===t.stencilTest.frontOperation.zFail&&e.stencilTest.backOperation.fail===t.stencilTest.backOperation.fail&&e.stencilTest.backOperation.zFail===t.stencilTest.backOperation.zFail&&e.stencilTest.backOperation.zPass===t.stencilTest.backOperation.zPass||n.push(eu),e.sampleCoverage.enabled===t.sampleCoverage.enabled&&e.sampleCoverage.value===t.sampleCoverage.value&&e.sampleCoverage.invert===t.sampleCoverage.invert||n.push(tu),n}(n,r),r._applyFunctions[n.id]=s);for(var u=s.length,c=0;c<u;++c)s[c](t,r)}((e(i.scissorTest)?i.scissorTest:n.scissorTest)!==(e(o.scissorTest)?o.scissorTest:r.scissorTest)||a)&&js(t,r,o);var l=e(i.blendingEnabled)?i.blendingEnabled:n.blending.enabled,h=e(o.blendingEnabled)?o.blendingEnabled:r.blending.enabled;(l!==h||h&&n.blending!==r.blending)&&$s(t,r,o),n===r&&i===o&&i.context===o.context||ru(t,r,o)},Us.getState=function(t){return{frontFace:t.frontFace,cull:{enabled:t.cull.enabled,face:t.cull.face},lineWidth:t.lineWidth,polygonOffset:{enabled:t.polygonOffset.enabled,factor:t.polygonOffset.factor,units:t.polygonOffset.units},scissorTest:{enabled:t.scissorTest.enabled,rectangle:Ns.clone(t.scissorTest.rectangle)},depthRange:{near:t.depthRange.near,far:t.depthRange.far},depthTest:{enabled:t.depthTest.enabled,func:t.depthTest.func},colorMask:{red:t.colorMask.red,green:t.colorMask.green,blue:t.colorMask.blue,alpha:t.colorMask.alpha},depthMask:t.depthMask,stencilMask:t.stencilMask,blending:{enabled:t.blending.enabled,color:pn.clone(t.blending.color),equationRgb:t.blending.equationRgb,equationAlpha:t.blending.equationAlpha,functionSourceRgb:t.blending.functionSourceRgb,functionSourceAlpha:t.blending.functionSourceAlpha,functionDestinationRgb:t.blending.functionDestinationRgb,functionDestinationAlpha:t.blending.functionDestinationAlpha},stencilTest:{enabled:t.stencilTest.enabled,frontFunction:t.stencilTest.frontFunction,backFunction:t.stencilTest.backFunction,reference:t.stencilTest.reference,mask:t.stencilTest.mask,frontOperation:{fail:t.stencilTest.frontOperation.fail,zFail:t.stencilTest.frontOperation.zFail,zPass:t.stencilTest.frontOperation.zPass},backOperation:{fail:t.stencilTest.backOperation.fail,zFail:t.stencilTest.backOperation.zFail,zPass:t.stencilTest.backOperation.zPass}},sampleCoverage:{enabled:t.sampleCoverage.enabled,value:t.sampleCoverage.value,invert:t.sampleCoverage.invert},viewport:e(t.viewport)?Ns.clone(t.viewport):void 0}};var iu=new p;function ou(e){this._size=e.size,this._datatype=e.datatype,this.getValue=e.getValue}var au={};au[Tn.FLOAT]="float",au[Tn.FLOAT_VEC2]="vec2",au[Tn.FLOAT_VEC3]="vec3",au[Tn.FLOAT_VEC4]="vec4",au[Tn.INT]="int",au[Tn.INT_VEC2]="ivec2",au[Tn.INT_VEC3]="ivec3",au[Tn.INT_VEC4]="ivec4",au[Tn.BOOL]="bool",au[Tn.BOOL_VEC2]="bvec2",au[Tn.BOOL_VEC3]="bvec3",au[Tn.BOOL_VEC4]="bvec4",au[Tn.FLOAT_MAT2]="mat2",au[Tn.FLOAT_MAT3]="mat3",au[Tn.FLOAT_MAT4]="mat4",au[Tn.SAMPLER_2D]="sampler2D",au[Tn.SAMPLER_CUBE]="samplerCube",ou.prototype.getDeclaration=function(e){var t="uniform "+au[this._datatype]+" "+e,n=this._size;return t+=1===n?";":"["+n.toString()+"];"};var su={czm_viewport:new ou({size:1,datatype:Tn.FLOAT_VEC4,getValue:function(e){return e.viewportCartesian4}}),czm_viewportOrthographic:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.viewportOrthographic}}),czm_viewportTransformation:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.viewportTransformation}}),czm_globeDepthTexture:new ou({size:1,datatype:Tn.SAMPLER_2D,getValue:function(e){return e.globeDepthTexture}}),czm_model:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.model}}),czm_inverseModel:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.inverseModel}}),czm_view:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.view}}),czm_view3D:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.view3D}}),czm_viewRotation:new ou({size:1,datatype:Tn.FLOAT_MAT3,getValue:function(e){return e.viewRotation}}),czm_viewRotation3D:new ou({size:1,datatype:Tn.FLOAT_MAT3,getValue:function(e){return e.viewRotation3D}}),czm_inverseView:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.inverseView}}),czm_inverseView3D:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.inverseView3D}}),czm_inverseViewRotation:new ou({size:1,datatype:Tn.FLOAT_MAT3,getValue:function(e){return e.inverseViewRotation}}),czm_inverseViewRotation3D:new ou({size:1,datatype:Tn.FLOAT_MAT3,getValue:function(e){return e.inverseViewRotation3D}}),czm_projection:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.projection}}),czm_inverseProjection:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.inverseProjection}}),czm_infiniteProjection:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.infiniteProjection}}),czm_modelView:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.modelView}}),czm_modelView3D:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.modelView3D}}),czm_modelViewRelativeToEye:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.modelViewRelativeToEye}}),czm_inverseModelView:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.inverseModelView}}),czm_inverseModelView3D:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.inverseModelView3D}}),czm_viewProjection:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.viewProjection}}),czm_inverseViewProjection:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.inverseViewProjection}}),czm_modelViewProjection:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.modelViewProjection}}),czm_inverseModelViewProjection:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.inverseModelViewProjection}}),czm_modelViewProjectionRelativeToEye:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.modelViewProjectionRelativeToEye}}),czm_modelViewInfiniteProjection:new ou({size:1,datatype:Tn.FLOAT_MAT4,getValue:function(e){return e.modelViewInfiniteProjection}}),czm_orthographicIn3D:new ou({size:1,datatype:Tn.FLOAT,getValue:function(e){return e.orthographicIn3D?1:0}}),czm_normal:new ou({size:1,datatype:Tn.FLOAT_MAT3,getValue:function(e){return e.normal}}),czm_normal3D:new ou({size:1,datatype:Tn.FLOAT_MAT3,getValue:function(e){return e.normal3D}}),czm_inverseNormal:new ou({size:1,datatype:Tn.FLOAT_MAT3,getValue:function(e){return e.inverseNormal}}),czm_inverseNormal3D:new ou({size:1,datatype:Tn.FLOAT_MAT3,getValue:function(e){return e.inverseNormal3D}}),czm_eyeHeight:new ou({size:1,datatype:Tn.FLOAT,getValue:function(e){return e.eyeHeight}}),czm_eyeHeight2D:new ou({size:1,datatype:Tn.FLOAT_VEC2,getValue:function(e){return e.eyeHeight2D}}),czm_entireFrustum:new ou({size:1,datatype:Tn.FLOAT_VEC2,getValue:function(e){return e.entireFrustum}}),czm_currentFrustum:new ou({size:1,datatype:Tn.FLOAT_VEC2,getValue:function(e){return e.currentFrustum}}),czm_frustumPlanes:new ou({size:1,datatype:Tn.FLOAT_VEC4,getValue:function(e){return e.frustumPlanes}}),czm_farDepthFromNearPlusOne:new ou({size:1,datatype:Tn.FLOAT,getValue:function(e){return e.farDepthFromNearPlusOne}}),czm_log2FarDepthFromNearPlusOne:new ou({size:1,datatype:Tn.FLOAT,getValue:function(e){return e.log2FarDepthFromNearPlusOne}}),czm_oneOverLog2FarDepthFromNearPlusOne:new ou({size:1,datatype:Tn.FLOAT,getValue:function(e){return e.oneOverLog2FarDepthFromNearPlusOne}}),czm_sunPositionWC:new ou({size:1,datatype:Tn.FLOAT_VEC3,getValue:function(e){return e.sunPositionWC}}),czm_sunPositionColumbusView:new ou({size:1,datatype:Tn.FLOAT_VEC3,getValue:function(e){return e.sunPositionColumbusView}}),czm_sunDirectionEC:new ou({size:1,datatype:Tn.FLOAT_VEC3,getValue:function(e){return e.sunDirectionEC}}),czm_sunDirectionWC:new ou({size:1,datatype:Tn.FLOAT_VEC3,getValue:function(e){return e.sunDirectionWC}}),czm_moonDirectionEC:new ou({size:1,datatype:Tn.FLOAT_VEC3,getValue:function(e){return e.moonDirectionEC}}),czm_lightDirectionEC:new ou({size:1,datatype:Tn.FLOAT_VEC3,getValue:function(e){return e.lightDirectionEC}}),czm_lightDirectionWC:new ou({size:1,datatype:Tn.FLOAT_VEC3,getValue:function(e){return e.lightDirectionWC}}),czm_lightColor:new ou({size:1,datatype:Tn.FLOAT_VEC3,getValue:function(e){return e.lightColor}}),czm_lightColorHdr:new ou({size:1,datatype:Tn.FLOAT_VEC3,getValue:function(e){return e.lightColorHdr}}),czm_encodedCameraPositionMCHigh:new ou({size:1,datatype:Tn.FLOAT_VEC3,getValue:function(e){return e.encodedCameraPositionMCHigh}}),czm_encodedCameraPositionMCLow:new ou({size:1,datatype:Tn.FLOAT_VEC3,getValue:function(e){return e.encodedCameraPositionMCLow}}),czm_viewerPositionWC:new ou({size:1,datatype:Tn.FLOAT_VEC3,getValue:function(e){return ye.getTranslation(e.inverseView,iu)}}),czm_frameNumber:new ou({size:1,datatype:Tn.FLOAT,getValue:function(e){return e.frameState.frameNumber}}),czm_morphTime:new ou({size:1,datatype:Tn.FLOAT,getValue:function(e){return e.frameState.morphTime}}),czm_sceneMode:new ou({size:1,datatype:Tn.FLOAT,getValue:function(e){return e.frameState.mode}}),czm_pass:new ou({size:1,datatype:Tn.FLOAT,getValue:function(e){return e.pass}}),czm_backgroundColor:new ou({size:1,datatype:Tn.FLOAT_VEC4,getValue:function(e){return e.backgroundColor}}),czm_brdfLut:new ou({size:1,datatype:Tn.SAMPLER_2D,getValue:function(e){return e.brdfLut}}),czm_environmentMap:new ou({size:1,datatype:Tn.SAMPLER_CUBE,getValue:function(e){return e.environmentMap}}),czm_specularEnvironmentMaps:new ou({size:1,datatype:Tn.SAMPLER_2D,getValue:function(e){return e.specularEnvironmentMaps}}),czm_specularEnvironmentMapSize:new ou({size:1,datatype:Tn.FLOAT_VEC2,getValue:function(e){return e.specularEnvironmentMapsDimensions}}),czm_specularEnvironmentMapsMaximumLOD:new ou({size:1,datatype:Tn.FLOAT,getValue:function(e){return e.specularEnvironmentMapsMaximumLOD}}),czm_sphericalHarmonicCoefficients:new ou({size:9,datatype:Tn.FLOAT_VEC3,getValue:function(e){return e.sphericalHarmonicCoefficients}}),czm_temeToPseudoFixed:new ou({size:1,datatype:Tn.FLOAT_MAT3,getValue:function(e){return e.temeToPseudoFixedMatrix}}),czm_pixelRatio:new ou({size:1,datatype:Tn.FLOAT,getValue:function(e){return e.pixelRatio}}),czm_fogDensity:new ou({size:1,datatype:Tn.FLOAT,getValue:function(e){return e.fogDensity}}),czm_imagerySplitPosition:new ou({size:1,datatype:Tn.FLOAT,getValue:function(e){return e.imagerySplitPosition}}),czm_geometricToleranceOverMeter:new ou({size:1,datatype:Tn.FLOAT,getValue:function(e){return e.geometricToleranceOverMeter}}),czm_minimumDisableDepthTestDistance:new ou({size:1,datatype:Tn.FLOAT,getValue:function(e){return e.minimumDisableDepthTestDistance}}),czm_invertClassificationColor:new ou({size:1,datatype:Tn.FLOAT_VEC4,getValue:function(e){return e.invertClassificationColor}}),czm_gamma:new ou({size:1,datatype:Tn.FLOAT,getValue:function(e){return e.gamma}}),czm_ellipsoidRadii:new ou({size:1,datatype:Tn.FLOAT_VEC3,getValue:function(e){return e.ellipsoid.radii}}),czm_ellipsoidInverseRadii:new ou({size:1,datatype:Tn.FLOAT_VEC3,getValue:function(e){return e.ellipsoid.oneOverRadii}})};function uu(e,t,n,r){this[0]=i(e,0),this[1]=i(n,0),this[2]=i(t,0),this[3]=i(r,0)}uu.packedLength=4,uu.pack=function(e,t,n){return n=i(n,0),t[n++]=e[0],t[n++]=e[1],t[n++]=e[2],t[n++]=e[3],t},uu.unpack=function(t,n,r){return n=i(n,0),e(r)||(r=new uu),r[0]=t[n++],r[1]=t[n++],r[2]=t[n++],r[3]=t[n++],r},uu.clone=function(t,n){if(e(t))return e(n)?(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n):new uu(t[0],t[2],t[1],t[3])},uu.fromArray=function(t,n,r){return n=i(n,0),e(r)||(r=new uu),r[0]=t[n],r[1]=t[n+1],r[2]=t[n+2],r[3]=t[n+3],r},uu.fromColumnMajorArray=function(e,t){return uu.clone(e,t)},uu.fromRowMajorArray=function(t,n){return e(n)?(n[0]=t[0],n[1]=t[2],n[2]=t[1],n[3]=t[3],n):new uu(t[0],t[1],t[2],t[3])},uu.fromScale=function(t,n){return e(n)?(n[0]=t.x,n[1]=0,n[2]=0,n[3]=t.y,n):new uu(t.x,0,0,t.y)},uu.fromUniformScale=function(t,n){return e(n)?(n[0]=t,n[1]=0,n[2]=0,n[3]=t,n):new uu(t,0,0,t)},uu.fromRotation=function(t,n){var r=Math.cos(t),i=Math.sin(t);return e(n)?(n[0]=r,n[1]=i,n[2]=-i,n[3]=r,n):new uu(r,-i,i,r)},uu.toArray=function(t,n){return e(n)?(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n):[t[0],t[1],t[2],t[3]]},uu.getElementIndex=function(e,t){return 2*e+t},uu.getColumn=function(e,t,n){var r=2*t,i=e[r],o=e[r+1];return n.x=i,n.y=o,n},uu.setColumn=function(e,t,n,r){var i=2*t;return(r=uu.clone(e,r))[i]=n.x,r[i+1]=n.y,r},uu.getRow=function(e,t,n){var r=e[t],i=e[t+2];return n.x=r,n.y=i,n},uu.setRow=function(e,t,n,r){return(r=uu.clone(e,r))[t]=n.x,r[t+2]=n.y,r};var cu=new c;uu.getScale=function(e,t){return t.x=c.magnitude(c.fromElements(e[0],e[1],cu)),t.y=c.magnitude(c.fromElements(e[2],e[3],cu)),t};var lu=new c;function hu(e,t,n,r){switch(t.type){case e.FLOAT:return new du(e,t,n,r);case e.FLOAT_VEC2:return new fu(e,t,n,r);case e.FLOAT_VEC3:return new mu(e,t,n,r);case e.FLOAT_VEC4:return new pu(e,t,n,r);case e.SAMPLER_2D:case e.SAMPLER_CUBE:return new _u(e,t,n,r);case e.INT:case e.BOOL:return new gu(e,t,n,r);case e.INT_VEC2:case e.BOOL_VEC2:return new vu(e,t,n,r);case e.INT_VEC3:case e.BOOL_VEC3:return new yu(e,t,n,r);case e.INT_VEC4:case e.BOOL_VEC4:return new Tu(e,t,n,r);case e.FLOAT_MAT2:return new xu(e,t,n,r);case e.FLOAT_MAT3:return new Su(e,t,n,r);case e.FLOAT_MAT4:return new wu(e,t,n,r);default:throw new ve("Unrecognized uniform type: "+t.type+' for uniform "'+n+'".')}}function du(e,t,n,r){this.name=n,this.value=void 0,this._value=0,this._gl=e,this._location=r}function fu(e,t,n,r){this.name=n,this.value=void 0,this._value=new c,this._gl=e,this._location=r}function mu(e,t,n,r){this.name=n,this.value=void 0,this._value=void 0,this._gl=e,this._location=r}function pu(e,t,n,r){this.name=n,this.value=void 0,this._value=void 0,this._gl=e,this._location=r}function _u(e,t,n,r){this.name=n,this.value=void 0,this._gl=e,this._location=r,this.textureUnitIndex=void 0}function gu(e,t,n,r){this.name=n,this.value=void 0,this._value=0,this._gl=e,this._location=r}function vu(e,t,n,r){this.name=n,this.value=void 0,this._value=new c,this._gl=e,this._location=r}function yu(e,t,n,r){this.name=n,this.value=void 0,this._value=new p,this._gl=e,this._location=r}function Tu(e,t,n,r){this.name=n,this.value=void 0,this._value=new le,this._gl=e,this._location=r}uu.getMaximumScale=function(e){return uu.getScale(e,lu),c.maximumComponent(lu)},uu.multiply=function(e,t,n){var r=e[0]*t[0]+e[2]*t[1],i=e[0]*t[2]+e[2]*t[3],o=e[1]*t[0]+e[3]*t[1],a=e[1]*t[2]+e[3]*t[3];return n[0]=r,n[1]=o,n[2]=i,n[3]=a,n},uu.add=function(e,t,n){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n},uu.subtract=function(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n},uu.multiplyByVector=function(e,t,n){var r=e[0]*t.x+e[2]*t.y,i=e[1]*t.x+e[3]*t.y;return n.x=r,n.y=i,n},uu.multiplyByScalar=function(e,t,n){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n},uu.multiplyByScale=function(e,t,n){return n[0]=e[0]*t.x,n[1]=e[1]*t.x,n[2]=e[2]*t.y,n[3]=e[3]*t.y,n},uu.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},uu.transpose=function(e,t){var n=e[0],r=e[2],i=e[1],o=e[3];return t[0]=n,t[1]=r,t[2]=i,t[3]=o,t},uu.abs=function(e,t){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t},uu.equals=function(t,n){return t===n||e(t)&&e(n)&&t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]},uu.equalsArray=function(e,t,n){return e[0]===t[n]&&e[1]===t[n+1]&&e[2]===t[n+2]&&e[3]===t[n+3]},uu.equalsEpsilon=function(t,n,r){return r=i(r,0),t===n||e(t)&&e(n)&&Math.abs(t[0]-n[0])<=r&&Math.abs(t[1]-n[1])<=r&&Math.abs(t[2]-n[2])<=r&&Math.abs(t[3]-n[3])<=r},uu.IDENTITY=Object.freeze(new uu(1,0,0,1)),uu.ZERO=Object.freeze(new uu(0,0,0,0)),uu.COLUMN0ROW0=0,uu.COLUMN0ROW1=1,uu.COLUMN1ROW0=2,uu.COLUMN1ROW1=3,Object.defineProperties(uu.prototype,{length:{get:function(){return uu.packedLength}}}),uu.prototype.clone=function(e){return uu.clone(this,e)},uu.prototype.equals=function(e){return uu.equals(this,e)},uu.prototype.equalsEpsilon=function(e,t){return uu.equalsEpsilon(this,e,t)},uu.prototype.toString=function(){return"("+this[0]+", "+this[2]+")\n("+this[1]+", "+this[3]+")"},du.prototype.set=function(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1f(this._location,this.value))},fu.prototype.set=function(){var e=this.value;c.equals(e,this._value)||(c.clone(e,this._value),this._gl.uniform2f(this._location,e.x,e.y))},mu.prototype.set=function(){var t=this.value;e(t.red)?pn.equals(t,this._value)||(this._value=pn.clone(t,this._value),this._gl.uniform3f(this._location,t.red,t.green,t.blue)):e(t.x)&&(p.equals(t,this._value)||(this._value=p.clone(t,this._value),this._gl.uniform3f(this._location,t.x,t.y,t.z)))},pu.prototype.set=function(){var t=this.value;e(t.red)?pn.equals(t,this._value)||(this._value=pn.clone(t,this._value),this._gl.uniform4f(this._location,t.red,t.green,t.blue,t.alpha)):e(t.x)&&(le.equals(t,this._value)||(this._value=le.clone(t,this._value),this._gl.uniform4f(this._location,t.x,t.y,t.z,t.w)))},_u.prototype.set=function(){var e=this._gl;e.activeTexture(e.TEXTURE0+this.textureUnitIndex);var t=this.value;e.bindTexture(t._target,t._texture)},_u.prototype._setSampler=function(e){return this.textureUnitIndex=e,this._gl.uniform1i(this._location,e),e+1},gu.prototype.set=function(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1i(this._location,this.value))},vu.prototype.set=function(){var e=this.value;c.equals(e,this._value)||(c.clone(e,this._value),this._gl.uniform2i(this._location,e.x,e.y))},yu.prototype.set=function(){var e=this.value;p.equals(e,this._value)||(p.clone(e,this._value),this._gl.uniform3i(this._location,e.x,e.y,e.z))},Tu.prototype.set=function(){var e=this.value;le.equals(e,this._value)||(le.clone(e,this._value),this._gl.uniform4i(this._location,e.x,e.y,e.z,e.w))};var Eu=new Float32Array(4);function xu(e,t,n,r){this.name=n,this.value=void 0,this._value=new uu,this._gl=e,this._location=r}xu.prototype.set=function(){if(!uu.equalsArray(this.value,this._value,0)){uu.clone(this.value,this._value);var e=uu.toArray(this.value,Eu);this._gl.uniformMatrix2fv(this._location,!1,e)}};var Cu=new Float32Array(9);function Su(e,t,n,r){this.name=n,this.value=void 0,this._value=new $,this._gl=e,this._location=r}Su.prototype.set=function(){if(!$.equalsArray(this.value,this._value,0)){$.clone(this.value,this._value);var e=$.toArray(this.value,Cu);this._gl.uniformMatrix3fv(this._location,!1,e)}};var Au=new Float32Array(16);function wu(e,t,n,r){this.name=n,this.value=void 0,this._value=new ye,this._gl=e,this._location=r}function bu(e,t,n,r){switch(t.type){case e.FLOAT:return new Du(e,t,n,r);case e.FLOAT_VEC2:return new Iu(e,t,n,r);case e.FLOAT_VEC3:return new Ru(e,t,n,r);case e.FLOAT_VEC4:return new Pu(e,t,n,r);case e.SAMPLER_2D:case e.SAMPLER_CUBE:return new Ou(e,t,n,r);case e.INT:case e.BOOL:return new Nu(e,t,n,r);case e.INT_VEC2:case e.BOOL_VEC2:return new Mu(e,t,n,r);case e.INT_VEC3:case e.BOOL_VEC3:return new Lu(e,t,n,r);case e.INT_VEC4:case e.BOOL_VEC4:return new Fu(e,t,n,r);case e.FLOAT_MAT2:return new zu(e,t,n,r);case e.FLOAT_MAT3:return new Bu(e,t,n,r);case e.FLOAT_MAT4:return new Uu(e,t,n,r);default:throw new ve("Unrecognized uniform type: "+t.type+' for uniform "'+n+'".')}}function Du(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Float32Array(i),this._gl=e,this._location=r[0]}function Iu(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Float32Array(2*i),this._gl=e,this._location=r[0]}function Ru(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Float32Array(3*i),this._gl=e,this._location=r[0]}function Pu(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Float32Array(4*i),this._gl=e,this._location=r[0]}function Ou(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Float32Array(i),this._gl=e,this._locations=r,this.textureUnitIndex=void 0}function Nu(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Int32Array(i),this._gl=e,this._location=r[0]}function Mu(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Int32Array(2*i),this._gl=e,this._location=r[0]}function Lu(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Int32Array(3*i),this._gl=e,this._location=r[0]}function Fu(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Int32Array(4*i),this._gl=e,this._location=r[0]}function zu(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Float32Array(4*i),this._gl=e,this._location=r[0]}function Bu(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Float32Array(9*i),this._gl=e,this._location=r[0]}function Uu(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Float32Array(16*i),this._gl=e,this._location=r[0]}wu.prototype.set=function(){if(!ye.equalsArray(this.value,this._value,0)){ye.clone(this.value,this._value);var e=ye.toArray(this.value,Au);this._gl.uniformMatrix4fv(this._location,!1,e)}},Du.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0;i<t;++i){var o=e[i];o!==n[i]&&(n[i]=o,r=!0)}r&&this._gl.uniform1fv(this._location,n)},Iu.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0,o=0;o<t;++o){var a=e[o];c.equalsArray(a,n,i)||(c.pack(a,n,i),r=!0),i+=2}r&&this._gl.uniform2fv(this._location,n)},Ru.prototype.set=function(){for(var t=this.value,n=t.length,r=this._value,i=!1,o=0,a=0;a<n;++a){var s=t[a];e(s.red)?s.red===r[o]&&s.green===r[o+1]&&s.blue===r[o+2]||(r[o]=s.red,r[o+1]=s.green,r[o+2]=s.blue,i=!0):e(s.x)&&(p.equalsArray(s,r,o)||(p.pack(s,r,o),i=!0)),o+=3}i&&this._gl.uniform3fv(this._location,r)},Pu.prototype.set=function(){for(var t=this.value,n=t.length,r=this._value,i=!1,o=0,a=0;a<n;++a){var s=t[a];e(s.red)?pn.equalsArray(s,r,o)||(pn.pack(s,r,o),i=!0):e(s.x)&&(le.equalsArray(s,r,o)||(le.pack(s,r,o),i=!0)),o+=4}i&&this._gl.uniform4fv(this._location,r)},Ou.prototype.set=function(){for(var e=this._gl,t=e.TEXTURE0+this.textureUnitIndex,n=this.value,r=n.length,i=0;i<r;++i){var o=n[i];e.activeTexture(t+i),e.bindTexture(o._target,o._texture)}},Ou.prototype._setSampler=function(e){this.textureUnitIndex=e;for(var t=this._locations,n=t.length,r=0;r<n;++r){var i=e+r;this._gl.uniform1i(t[r],i)}return e+n},Nu.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0;i<t;++i){var o=e[i];o!==n[i]&&(n[i]=o,r=!0)}r&&this._gl.uniform1iv(this._location,n)},Mu.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0,o=0;o<t;++o){var a=e[o];c.equalsArray(a,n,i)||(c.pack(a,n,i),r=!0),i+=2}r&&this._gl.uniform2iv(this._location,n)},Lu.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0,o=0;o<t;++o){var a=e[o];p.equalsArray(a,n,i)||(p.pack(a,n,i),r=!0),i+=3}r&&this._gl.uniform3iv(this._location,n)},Fu.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0,o=0;o<t;++o){var a=e[o];le.equalsArray(a,n,i)||(le.pack(a,n,i),r=!0),i+=4}r&&this._gl.uniform4iv(this._location,n)},zu.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0,o=0;o<t;++o){var a=e[o];uu.equalsArray(a,n,i)||(uu.pack(a,n,i),r=!0),i+=4}r&&this._gl.uniformMatrix2fv(this._location,!1,n)},Bu.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0,o=0;o<t;++o){var a=e[o];$.equalsArray(a,n,i)||($.pack(a,n,i),r=!0),i+=9}r&&this._gl.uniformMatrix3fv(this._location,!1,n)},Uu.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0,o=0;o<t;++o){var a=e[o];ye.equalsArray(a,n,i)||(ye.pack(a,n,i),r=!0),i+=16}r&&this._gl.uniformMatrix4fv(this._location,!1,n)};var Vu=0;function Hu(e){var t=e.vertexShaderText,n=e.fragmentShaderText;"undefined"!=typeof spector&&(t=t.replace(/^#line/gm,"//#line"),n=n.replace(/^#line/gm,"//#line"));var r=function(e,t){var n={};if(!Ds.highpFloatSupported||!Ds.highpIntSupported){var r,i,o,a,s=Gu(e),u=Gu(t),c=s.length,l=u.length;for(r=0;r<c;r++)for(i=0;i<l;i++)if(s[r]===u[i]){a="czm_mediump_"+(o=s[r]);var h=new RegExp(o+"\\b","g");t=t.replace(h,a),n[a]=o}}return{fragmentShaderText:t,duplicateUniformNames:n}}(t,n);this._gl=e.gl,this._logShaderCompilation=e.logShaderCompilation,this._debugShaders=e.debugShaders,this._attributeLocations=e.attributeLocations,this._program=void 0,this._numberOfVertexAttributes=void 0,this._vertexAttributes=void 0,this._uniformsByName=void 0,this._uniforms=void 0,this._automaticUniforms=void 0,this._manualUniforms=void 0,this._duplicateUniformNames=r.duplicateUniformNames,this._cachedShader=void 0,this.maximumTextureUnitIndex=void 0,this._vertexShaderSource=e.vertexShaderSource,this._vertexShaderText=e.vertexShaderText,this._fragmentShaderSource=e.fragmentShaderSource,this._fragmentShaderText=r.fragmentShaderText,this.id=Vu++}function Gu(t){var n=[],r=t.match(/uniform.*?(?![^{]*})(?=[=\[;])/g);if(e(r))for(var i=r.length,o=0;o<i;o++){var a=r[o].trim(),s=a.slice(a.lastIndexOf(" ")+1);n.push(s)}return n}Hu.fromCache=function(e){return(e=i(e,i.EMPTY_OBJECT)).context.shaderCache.getShaderProgram(e)},Hu.replaceCache=function(e){return(e=i(e,i.EMPTY_OBJECT)).context.shaderCache.replaceShaderProgram(e)},Object.defineProperties(Hu.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},vertexAttributes:{get:function(){return Wu(this),this._vertexAttributes}},numberOfVertexAttributes:{get:function(){return Wu(this),this._numberOfVertexAttributes}},allUniforms:{get:function(){return Wu(this),this._uniformsByName}}});var ku="[Cesium WebGL] ";function Wu(t){e(t._program)||qu(t)}function qu(t){var n=t._program,r=t._gl,i=function(t,n){var r=n._vertexShaderText,i=n._fragmentShaderText,o=t.createShader(t.VERTEX_SHADER);t.shaderSource(o,r),t.compileShader(o);var a=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(a,i),t.compileShader(a);var s=t.createProgram();t.attachShader(s,o),t.attachShader(s,a),t.deleteShader(o),t.deleteShader(a);var u,c=n._attributeLocations;if(e(c))for(var l in c)c.hasOwnProperty(l)&&t.bindAttribLocation(s,c[l],l);if(t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS)){var h=n._debugShaders;if(!t.getShaderParameter(a,t.COMPILE_STATUS)){if(u=t.getShaderInfoLog(a),console.error(ku+"Fragment shader compile log: "+u),e(h)){var d=h.getTranslatedShaderSource(a);""!==d?console.error(ku+"Translated fragment shader source:\n"+d):console.error(ku+"Fragment shader translation failed.")}throw t.deleteProgram(s),new ve("Fragment shader failed to compile.  Compile log: "+u)}if(!t.getShaderParameter(o,t.COMPILE_STATUS)){if(u=t.getShaderInfoLog(o),console.error(ku+"Vertex shader compile log: "+u),e(h)){var f=h.getTranslatedShaderSource(o);""!==f?console.error(ku+"Translated vertex shader source:\n"+f):console.error(ku+"Vertex shader translation failed.")}throw t.deleteProgram(s),new ve("Vertex shader failed to compile.  Compile log: "+u)}throw u=t.getProgramInfoLog(s),console.error(ku+"Shader program link log: "+u),e(h)&&(console.error(ku+"Translated vertex shader source:\n"+h.getTranslatedShaderSource(o)),console.error(ku+"Translated fragment shader source:\n"+h.getTranslatedShaderSource(a))),t.deleteProgram(s),new ve("Program failed to link.  Link log: "+u)}var m=n._logShaderCompilation;return m&&e(u=t.getShaderInfoLog(o))&&u.length>0&&console.log(ku+"Vertex shader compile log: "+u),m&&e(u=t.getShaderInfoLog(a))&&u.length>0&&console.log(ku+"Fragment shader compile log: "+u),m&&e(u=t.getProgramInfoLog(s))&&u.length>0&&console.log(ku+"Shader program link log: "+u),s}(r,t,t._debugShaders),o=r.getProgramParameter(i,r.ACTIVE_ATTRIBUTES),a=function(t,n){for(var r={},i=[],o=[],a=t.getProgramParameter(n,t.ACTIVE_UNIFORMS),s=0;s<a;++s){var u=t.getActiveUniform(n,s),c=-1!==u.name.indexOf("[0]",u.name.length-"[0]".length)?u.name.slice(0,u.name.length-3):u.name;if(0!==c.indexOf("gl_"))if(u.name.indexOf("[")<0){var l=t.getUniformLocation(n,c);if(null!==l){var h=hu(t,u,c,l);r[c]=h,i.push(h),h._setSampler&&o.push(h)}}else{var d,f,m,p,_=c.indexOf("[");if(_>=0){if(!e(d=r[c.slice(0,_)]))continue;(f=d._locations).length<=1&&(m=d.value,null!==(p=t.getUniformLocation(n,c))&&(f.push(p),m.push(t.getUniform(n,p))))}else{f=[];for(var g=0;g<u.size;++g)null!==(p=t.getUniformLocation(n,c+"["+g+"]"))&&f.push(p);d=bu(t,u,c,f),r[c]=d,i.push(d),d._setSampler&&o.push(d)}}}return{uniformsByName:r,uniforms:i,samplerUniforms:o}}(r,i),s=function(t,n){var r=[],i=[];for(var o in n)if(n.hasOwnProperty(o)){var a=n[o],s=o,u=t._duplicateUniformNames[s];e(u)&&(a.name=u,s=u);var c=su[s];e(c)?r.push({uniform:a,automaticUniform:c}):i.push(a)}return{automaticUniforms:r,manualUniforms:i}}(t,a.uniformsByName);t._program=i,t._numberOfVertexAttributes=o,t._vertexAttributes=function(e,t,n){for(var r={},i=0;i<n;++i){var o=e.getActiveAttrib(t,i),a=e.getAttribLocation(t,o.name);r[o.name]={name:o.name,type:o.type,index:a}}return r}(r,i,o),t._uniformsByName=a.uniformsByName,t._uniforms=a.uniforms,t._automaticUniforms=s.automaticUniforms,t._manualUniforms=s.manualUniforms,t.maximumTextureUnitIndex=function(e,t,n){e.useProgram(t);for(var r=0,i=n.length,o=0;o<i;++o)r=n[o]._setSampler(r);return e.useProgram(null),r}(r,i,a.samplerUniforms),n&&t._gl.deleteProgram(n),"undefined"!=typeof spector&&(t._program.__SPECTOR_rebuildProgram=function(e,n,r,i){var o=t._vertexShaderText,a=t._fragmentShaderText,s=/ ! = /g;t._vertexShaderText=e.replace(s," != "),t._fragmentShaderText=n.replace(s," != ");try{qu(t),r(t._program)}catch(c){t._vertexShaderText=o,t._fragmentShaderText=a;var u=/(?:Compile|Link) error: ([^]*)/.exec(c.message);i(u?u[1]:c.message)}})}function Yu(n,r){var i=/#define OUTPUT_DECLARATION/,o=n.split("\n");if(/#version 300 es/g.test(n))return n;var a,s,u=-1;for(a=0;a<o.length;++a)if(s=o[a],i.test(s)){u=a;break}if(-1===u)throw new t("Could not find a #define OUTPUT_DECLARATION!");var c=[];for(a=0;a<10;a++){var l="gl_FragData\\["+a+"\\]",h="czm_out"+a;new RegExp(l,"g").test(n)&&(Xu(h,c),ju(l,h,o),o.splice(u,0,"layout(location = "+a+") out vec4 "+h+";"),u+=1)}var d="czm_fragColor";(function(e,t){for(var n=new RegExp("(^|[^\\w])("+e+")($|[^\\w])","g"),r=t.length,i=0;i<r;++i){var o=t[i];if(n.test(o))return!0}return!1})("gl_FragColor",o)&&(Xu(d,c),ju("gl_FragColor",d,o),o.splice(u,0,"layout(location = 0) out vec4 czm_fragColor;"),u+=1);var f=function(t,n){for(var r={},i=t.length,o=[],a=0;a<n.length;++a){var s=n[a],u=/(#ifdef|#if)/g.test(s),c=/#else/g.test(s),l=/#endif/g.test(s);if(u)o.push(s);else if(c){var h=o[o.length-1].replace("ifdef","ifndef");/if/g.test(h)&&(h=h.replace(/(#if\s+)(\S*)([^]*)/,"$1!($2)$3")),o.pop(),o.push(h)}else if(l)o.pop();else if(!/layout/g.test(s))for(var d=0;d<i;++d){var f=t[d];-1!==s.indexOf(f)&&(e(r[f])?r[f]=r[f].filter((function(e){return o.indexOf(e)>=0})):r[f]=o.slice())}}return r}(c,o),m={};for(a=0;a<o.length;a++)for(var p in s=o[a],f){if(f.hasOwnProperty(p))new RegExp("(layout)[^]+(out)[^]+("+p+")[^]+","g").test(s)&&(m[s]=p)}for(var _ in m)if(m.hasOwnProperty(_)){var g,v=m[_],y=o.indexOf(_),T=f[v],E=T.length;for(g=0;g<E;g++)o.splice(y,0,T[g]);for(y+=E+1,g=E-1;g>=0;g--)o.splice(y,0,"#endif //"+T[g])}var x="WEBGL_2",C="#version 300 es",S=!1;for(a=0;a<o.length;a++)if(/#version/.test(o[a])){o[a]=C,S=!0;break}return S||o.splice(0,0,C),o.splice(1,0,"#define WEBGL_2"),Zu("EXT_draw_buffers",x,o),Zu("EXT_frag_depth",x,o),Zu("OES_standard_derivatives",x,o),ju("texture2D","texture",o),ju("texture3D","texture",o),ju("textureCube","texture",o),ju("gl_FragDepthEXT","gl_FragDepth",o),r?ju("varying","in",o):(ju("attribute","in",o),ju("varying","out",o)),function(e){for(var t="",n=e.length,r=0;r<n;++r)t+=e[r]+"\n";return t}(o)}function ju(e,t,n){for(var r=new RegExp("(^|[^\\w])("+e+")($|[^\\w])","g"),i=n.length,o=0;o<i;++o){var a=n[o];n[o]=a.replace(r,"$1"+t+"$3")}}function Xu(e,t){-1===t.indexOf(e)&&t.push(e)}function Zu(e,t,n){!function(e,t,n){for(var r=n.length,i=0;i<r;++i){var o=n[i];n[i]=o.replace(e,t)}}(new RegExp("#extension\\s+GL_"+e+"\\s+:\\s+[a-zA-Z0-9]+\\s*$","g"),"",n),ju("GL_"+e,t,n)}Hu.prototype._bind=function(){Wu(this),this._gl.useProgram(this._program)},Hu.prototype._setUniforms=function(t,n,r){var i,o;if(e(t)){var a=this._manualUniforms;for(i=a.length,o=0;o<i;++o){var s=a[o];s.value=t[s.name]()}}var u=this._automaticUniforms;for(i=u.length,o=0;o<i;++o){var c=u[o];c.uniform.value=c.automaticUniform.getValue(n)}var l=this._uniforms;for(i=l.length,o=0;o<i;++o)l[o].set();if(r){var h=this._gl,d=this._program;h.validateProgram(d)}},Hu.prototype.isDestroyed=function(){return!1},Hu.prototype.destroy=function(){this._cachedShader.cache.releaseShaderProgram(this)},Hu.prototype.finalDestroy=function(){return this._gl.deleteProgram(this._program),hi(this)};var Ku={czm_degreesPerRadian:"const float czm_degreesPerRadian = 57.29577951308232;\n",czm_depthRange:"const czm_depthRangeStruct czm_depthRange = czm_depthRangeStruct(0.0, 1.0);\n",czm_epsilon1:"const float czm_epsilon1 = 0.1;\n",czm_epsilon2:"const float czm_epsilon2 = 0.01;\n",czm_epsilon3:"const float czm_epsilon3 = 0.001;\n",czm_epsilon4:"const float czm_epsilon4 = 0.0001;\n",czm_epsilon5:"const float czm_epsilon5 = 0.00001;\n",czm_epsilon6:"const float czm_epsilon6 = 0.000001;\n",czm_epsilon7:"const float czm_epsilon7 = 0.0000001;\n",czm_infinity:"const float czm_infinity = 5906376272000.0;\n",czm_oneOverPi:"const float czm_oneOverPi = 0.3183098861837907;\n",czm_oneOverTwoPi:"const float czm_oneOverTwoPi = 0.15915494309189535;\n",czm_passCesium3DTile:"const float czm_passCesium3DTile = 4.0;\n",czm_passCesium3DTileClassification:"const float czm_passCesium3DTileClassification = 5.0;\n",czm_passCesium3DTileClassificationIgnoreShow:"const float czm_passCesium3DTileClassificationIgnoreShow = 6.0;\n",czm_passClassification:"const float czm_passClassification = 7.0;\n",czm_passCompute:"const float czm_passCompute = 1.0;\n",czm_passEnvironment:"const float czm_passEnvironment = 0.0;\n",czm_passGlobe:"const float czm_passGlobe = 2.0;\n",czm_passOpaque:"const float czm_passOpaque = 7.0;\n",czm_passOverlay:"const float czm_passOverlay = 9.0;\n",czm_passTerrainClassification:"const float czm_passTerrainClassification = 3.0;\n",czm_passTranslucent:"const float czm_passTranslucent = 8.0;\n",czm_pi:"const float czm_pi = 3.141592653589793;\n",czm_piOverFour:"const float czm_piOverFour = 0.7853981633974483;\n",czm_piOverSix:"const float czm_piOverSix = 0.5235987755982988;\n",czm_piOverThree:"const float czm_piOverThree = 1.0471975511965976;\n",czm_piOverTwo:"const float czm_piOverTwo = 1.5707963267948966;\n",czm_radiansPerDegree:"const float czm_radiansPerDegree = 0.017453292519943295;\n",czm_sceneMode2D:"const float czm_sceneMode2D = 2.0;\n",czm_sceneMode3D:"const float czm_sceneMode3D = 3.0;\n",czm_sceneModeColumbusView:"const float czm_sceneModeColumbusView = 1.0;\n",czm_sceneModeMorphing:"const float czm_sceneModeMorphing = 0.0;\n",czm_solarRadius:"const float czm_solarRadius = 695500000.0;\n",czm_threePiOver2:"const float czm_threePiOver2 = 4.71238898038469;\n",czm_twoPi:"const float czm_twoPi = 6.283185307179586;\n",czm_webMercatorMaxLatitude:"const float czm_webMercatorMaxLatitude = 1.4844222297453324;\n",czm_depthRangeStruct:"struct czm_depthRangeStruct\n{\nfloat near;\nfloat far;\n};\n",czm_material:"struct czm_material\n{\nvec3 diffuse;\nfloat specular;\nfloat shininess;\nvec3 normal;\nvec3 emission;\nfloat alpha;\n};\n",czm_materialInput:"struct czm_materialInput\n{\nfloat s;\nvec2 st;\nvec3 str;\nvec3 normalEC;\nmat3 tangentToEyeMatrix;\nvec3 positionToEyeEC;\nfloat height;\nfloat slope;\nfloat aspect;\n};\n",czm_ray:"struct czm_ray\n{\nvec3 origin;\nvec3 direction;\n};\n",czm_raySegment:"struct czm_raySegment\n{\nfloat start;\nfloat stop;\n};\nconst czm_raySegment czm_emptyRaySegment = czm_raySegment(-czm_infinity, -czm_infinity);\nconst czm_raySegment czm_fullRaySegment = czm_raySegment(0.0, czm_infinity);\n",czm_shadowParameters:"struct czm_shadowParameters\n{\n#ifdef USE_CUBE_MAP_SHADOW\nvec3 texCoords;\n#else\nvec2 texCoords;\n#endif\nfloat depthBias;\nfloat depth;\nfloat nDotL;\nvec2 texelStepSize;\nfloat normalShadingSmooth;\nfloat darkness;\n};\n",czm_HSBToRGB:"const vec4 K_HSB2RGB = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 czm_HSBToRGB(vec3 hsb)\n{\nvec3 p = abs(fract(hsb.xxx + K_HSB2RGB.xyz) * 6.0 - K_HSB2RGB.www);\nreturn hsb.z * mix(K_HSB2RGB.xxx, clamp(p - K_HSB2RGB.xxx, 0.0, 1.0), hsb.y);\n}\n",czm_HSLToRGB:"vec3 hueToRGB(float hue)\n{\nfloat r = abs(hue * 6.0 - 3.0) - 1.0;\nfloat g = 2.0 - abs(hue * 6.0 - 2.0);\nfloat b = 2.0 - abs(hue * 6.0 - 4.0);\nreturn clamp(vec3(r, g, b), 0.0, 1.0);\n}\nvec3 czm_HSLToRGB(vec3 hsl)\n{\nvec3 rgb = hueToRGB(hsl.x);\nfloat c = (1.0 - abs(2.0 * hsl.z - 1.0)) * hsl.y;\nreturn (rgb - 0.5) * c + hsl.z;\n}\n",czm_RGBToHSB:"const vec4 K_RGB2HSB = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec3 czm_RGBToHSB(vec3 rgb)\n{\nvec4 p = mix(vec4(rgb.bg, K_RGB2HSB.wz), vec4(rgb.gb, K_RGB2HSB.xy), step(rgb.b, rgb.g));\nvec4 q = mix(vec4(p.xyw, rgb.r), vec4(rgb.r, p.yzx), step(p.x, rgb.r));\nfloat d = q.x - min(q.w, q.y);\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + czm_epsilon7)), d / (q.x + czm_epsilon7), q.x);\n}\n",czm_RGBToHSL:"vec3 RGBtoHCV(vec3 rgb)\n{\nvec4 p = (rgb.g < rgb.b) ? vec4(rgb.bg, -1.0, 2.0 / 3.0) : vec4(rgb.gb, 0.0, -1.0 / 3.0);\nvec4 q = (rgb.r < p.x) ? vec4(p.xyw, rgb.r) : vec4(rgb.r, p.yzx);\nfloat c = q.x - min(q.w, q.y);\nfloat h = abs((q.w - q.y) / (6.0 * c + czm_epsilon7) + q.z);\nreturn vec3(h, c, q.x);\n}\nvec3 czm_RGBToHSL(vec3 rgb)\n{\nvec3 hcv = RGBtoHCV(rgb);\nfloat l = hcv.z - hcv.y * 0.5;\nfloat s = hcv.y / (1.0 - abs(l * 2.0 - 1.0) + czm_epsilon7);\nreturn vec3(hcv.x, s, l);\n}\n",czm_RGBToXYZ:"vec3 czm_RGBToXYZ(vec3 rgb)\n{\nconst mat3 RGB2XYZ = mat3(0.4124, 0.2126, 0.0193,\n0.3576, 0.7152, 0.1192,\n0.1805, 0.0722, 0.9505);\nvec3 xyz = RGB2XYZ * rgb;\nvec3 Yxy;\nYxy.r = xyz.g;\nfloat temp = dot(vec3(1.0), xyz);\nYxy.gb = xyz.rg / temp;\nreturn Yxy;\n}\n",czm_XYZToRGB:"vec3 czm_XYZToRGB(vec3 Yxy)\n{\nconst mat3 XYZ2RGB = mat3( 3.2405, -0.9693,  0.0556,\n-1.5371,  1.8760, -0.2040,\n-0.4985,  0.0416,  1.0572);\nvec3 xyz;\nxyz.r = Yxy.r * Yxy.g / Yxy.b;\nxyz.g = Yxy.r;\nxyz.b = Yxy.r * (1.0 - Yxy.g - Yxy.b) / Yxy.b;\nreturn XYZ2RGB * xyz;\n}\n",czm_acesTonemapping:"vec3 czm_acesTonemapping(vec3 color) {\nfloat g = 0.985;\nfloat a = 0.065;\nfloat b = 0.0001;\nfloat c = 0.433;\nfloat d = 0.238;\ncolor = (color * (color + a) - b) / (color * (g * color + c) + d);\ncolor = clamp(color, 0.0, 1.0);\nreturn color;\n}\n",czm_alphaWeight:"float czm_alphaWeight(float a)\n{\nfloat z = (gl_FragCoord.z - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];\nreturn pow(a + 0.01, 4.0) + max(1e-2, min(3.0 * 1e3, 0.003 / (1e-5 + pow(abs(z) / 200.0, 4.0))));\n}\n",czm_antialias:"vec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist, float fuzzFactor)\n{\nfloat val1 = clamp(dist / fuzzFactor, 0.0, 1.0);\nfloat val2 = clamp((dist - 0.5) / fuzzFactor, 0.0, 1.0);\nval1 = val1 * (1.0 - val2);\nval1 = val1 * val1 * (3.0 - (2.0 * val1));\nval1 = pow(val1, 0.5);\nvec4 midColor = (color1 + color2) * 0.5;\nreturn mix(midColor, currentColor, val1);\n}\nvec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist)\n{\nreturn czm_antialias(color1, color2, currentColor, dist, 0.1);\n}\n",czm_approximateSphericalCoordinates:"vec2 czm_approximateSphericalCoordinates(vec3 normal) {\nfloat latitudeApproximation = czm_fastApproximateAtan(sqrt(normal.x * normal.x + normal.y * normal.y), normal.z);\nfloat longitudeApproximation = czm_fastApproximateAtan(normal.x, normal.y);\nreturn vec2(latitudeApproximation, longitudeApproximation);\n}\n",czm_backFacing:"bool czm_backFacing()\n{\nreturn gl_FrontFacing == false;\n}\n",czm_branchFreeTernary:"float czm_branchFreeTernary(bool comparison, float a, float b) {\nfloat useA = float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\nvec2 czm_branchFreeTernary(bool comparison, vec2 a, vec2 b) {\nfloat useA = float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\nvec3 czm_branchFreeTernary(bool comparison, vec3 a, vec3 b) {\nfloat useA = float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\nvec4 czm_branchFreeTernary(bool comparison, vec4 a, vec4 b) {\nfloat useA = float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\n",czm_cascadeColor:"vec4 czm_cascadeColor(vec4 weights)\n{\nreturn vec4(1.0, 0.0, 0.0, 1.0) * weights.x +\nvec4(0.0, 1.0, 0.0, 1.0) * weights.y +\nvec4(0.0, 0.0, 1.0, 1.0) * weights.z +\nvec4(1.0, 0.0, 1.0, 1.0) * weights.w;\n}\n",czm_cascadeDistance:"uniform vec4 shadowMap_cascadeDistances;\nfloat czm_cascadeDistance(vec4 weights)\n{\nreturn dot(shadowMap_cascadeDistances, weights);\n}\n",czm_cascadeMatrix:"uniform mat4 shadowMap_cascadeMatrices[4];\nmat4 czm_cascadeMatrix(vec4 weights)\n{\nreturn shadowMap_cascadeMatrices[0] * weights.x +\nshadowMap_cascadeMatrices[1] * weights.y +\nshadowMap_cascadeMatrices[2] * weights.z +\nshadowMap_cascadeMatrices[3] * weights.w;\n}\n",czm_cascadeWeights:"uniform vec4 shadowMap_cascadeSplits[2];\nvec4 czm_cascadeWeights(float depthEye)\n{\nvec4 near = step(shadowMap_cascadeSplits[0], vec4(depthEye));\nvec4 far = step(depthEye, shadowMap_cascadeSplits[1]);\nreturn near * far;\n}\n",czm_columbusViewMorph:"vec4 czm_columbusViewMorph(vec4 position2D, vec4 position3D, float time)\n{\nvec3 p = mix(position2D.xyz, position3D.xyz, time);\nreturn vec4(p, 1.0);\n}\n",czm_computePosition:"vec4 czm_computePosition();\n",czm_cosineAndSine:"vec2 cordic(float angle)\n{\nvec2 vector = vec2(6.0725293500888267e-1, 0.0);\nfloat sense = (angle < 0.0) ? -1.0 : 1.0;\nmat2 rotation = mat2(1.0, sense, -sense, 1.0);\nvector = rotation * vector;\nangle -= sense * 7.8539816339744828e-1;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfloat factor = sense * 5.0e-1;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 4.6364760900080609e-1;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 2.5e-1;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 2.4497866312686414e-1;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.25e-1;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.2435499454676144e-1;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 6.25e-2;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 6.2418809995957350e-2;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 3.125e-2;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 3.1239833430268277e-2;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.5625e-2;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.5623728620476831e-2;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 7.8125e-3;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 7.8123410601011111e-3;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 3.90625e-3;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 3.9062301319669718e-3;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.953125e-3;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.9531225164788188e-3;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 9.765625e-4;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 9.7656218955931946e-4;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 4.8828125e-4;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 4.8828121119489829e-4;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 2.44140625e-4;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 2.4414062014936177e-4;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.220703125e-4;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.2207031189367021e-4;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 6.103515625e-5;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 6.1035156174208773e-5;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 3.0517578125e-5;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 3.0517578115526096e-5;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.52587890625e-5;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.5258789061315762e-5;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 7.62939453125e-6;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 7.6293945311019700e-6;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 3.814697265625e-6;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 3.8146972656064961e-6;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.9073486328125e-6;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.9073486328101870e-6;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 9.5367431640625e-7;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 9.5367431640596084e-7;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 4.76837158203125e-7;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 4.7683715820308884e-7;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 2.384185791015625e-7;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 2.3841857910155797e-7;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.1920928955078125e-7;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nreturn vector;\n}\nvec2 czm_cosineAndSine(float angle)\n{\nif (angle < -czm_piOverTwo || angle > czm_piOverTwo)\n{\nif (angle < 0.0)\n{\nreturn -cordic(angle + czm_pi);\n}\nelse\n{\nreturn -cordic(angle - czm_pi);\n}\n}\nelse\n{\nreturn cordic(angle);\n}\n}\n",czm_decompressTextureCoordinates:"vec2 czm_decompressTextureCoordinates(float encoded)\n{\nfloat temp = encoded / 4096.0;\nfloat xZeroTo4095 = floor(temp);\nfloat stx = xZeroTo4095 / 4095.0;\nfloat sty = (encoded - xZeroTo4095 * 4096.0) / 4095.0;\nreturn vec2(stx, sty);\n}\n",czm_depthClamp:"#if defined(GL_EXT_frag_depth) && !defined(LOG_DEPTH)\nvarying float v_WindowZ;\n#endif\nvec4 czm_depthClamp(vec4 coords)\n{\n#ifndef LOG_DEPTH\n#ifdef GL_EXT_frag_depth\nv_WindowZ = (0.5 * (coords.z / coords.w) + 0.5) * coords.w;\ncoords.z = 0.0;\n#else\ncoords.z = min(coords.z, coords.w);\n#endif\n#endif\nreturn coords;\n}\n",czm_eastNorthUpToEyeCoordinates:"mat3 czm_eastNorthUpToEyeCoordinates(vec3 positionMC, vec3 normalEC)\n{\nvec3 tangentMC = normalize(vec3(-positionMC.y, positionMC.x, 0.0));\nvec3 tangentEC = normalize(czm_normal3D * tangentMC);\nvec3 bitangentEC = normalize(cross(normalEC, tangentEC));\nreturn mat3(\ntangentEC.x,   tangentEC.y,   tangentEC.z,\nbitangentEC.x, bitangentEC.y, bitangentEC.z,\nnormalEC.x,    normalEC.y,    normalEC.z);\n}\n",czm_ellipsoidContainsPoint:"bool czm_ellipsoidContainsPoint(vec3 ellipsoid_inverseRadii, vec3 point)\n{\nvec3 scaled = ellipsoid_inverseRadii * (czm_inverseModelView * vec4(point, 1.0)).xyz;\nreturn (dot(scaled, scaled) <= 1.0);\n}\n",czm_ellipsoidWgs84TextureCoordinates:"vec2 czm_ellipsoidWgs84TextureCoordinates(vec3 normal)\n{\nreturn vec2(atan(normal.y, normal.x) * czm_oneOverTwoPi + 0.5, asin(normal.z) * czm_oneOverPi + 0.5);\n}\n",czm_equalsEpsilon:"bool czm_equalsEpsilon(vec4 left, vec4 right, float epsilon) {\nreturn all(lessThanEqual(abs(left - right), vec4(epsilon)));\n}\nbool czm_equalsEpsilon(vec3 left, vec3 right, float epsilon) {\nreturn all(lessThanEqual(abs(left - right), vec3(epsilon)));\n}\nbool czm_equalsEpsilon(vec2 left, vec2 right, float epsilon) {\nreturn all(lessThanEqual(abs(left - right), vec2(epsilon)));\n}\nbool czm_equalsEpsilon(float left, float right, float epsilon) {\nreturn (abs(left - right) <= epsilon);\n}\n",czm_eyeOffset:"vec4 czm_eyeOffset(vec4 positionEC, vec3 eyeOffset)\n{\nvec4 p = positionEC;\nvec4 zEyeOffset = normalize(p) * eyeOffset.z;\np.xy += eyeOffset.xy + zEyeOffset.xy;\np.z += zEyeOffset.z;\nreturn p;\n}\n",czm_eyeToWindowCoordinates:"vec4 czm_eyeToWindowCoordinates(vec4 positionEC)\n{\nvec4 q = czm_projection * positionEC;\nq.xyz /= q.w;\nq.xyz = (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz;\nreturn q;\n}\n",czm_fastApproximateAtan:"float czm_fastApproximateAtan(float x) {\nreturn x * (-0.1784 * x - 0.0663 * x * x + 1.0301);\n}\nfloat czm_fastApproximateAtan(float x, float y) {\nfloat t = abs(x);\nfloat opposite = abs(y);\nfloat adjacent = max(t, opposite);\nopposite = min(t, opposite);\nt = czm_fastApproximateAtan(opposite / adjacent);\nt = czm_branchFreeTernary(abs(y) > abs(x), czm_piOverTwo - t, t);\nt = czm_branchFreeTernary(x < 0.0, czm_pi - t, t);\nt = czm_branchFreeTernary(y < 0.0, -t, t);\nreturn t;\n}\n",czm_fog:"vec3 czm_fog(float distanceToCamera, vec3 color, vec3 fogColor)\n{\nfloat scalar = distanceToCamera * czm_fogDensity;\nfloat fog = 1.0 - exp(-(scalar * scalar));\nreturn mix(color, fogColor, fog);\n}\nvec3 czm_fog(float distanceToCamera, vec3 color, vec3 fogColor, float fogModifierConstant)\n{\nfloat scalar = distanceToCamera * czm_fogDensity;\nfloat fog = 1.0 - exp(-((fogModifierConstant * scalar + fogModifierConstant) * (scalar * (1.0 + fogModifierConstant))));\nreturn mix(color, fogColor, fog);\n}\n",czm_gammaCorrect:"vec3 czm_gammaCorrect(vec3 color) {\n#ifdef HDR\ncolor = pow(color, vec3(czm_gamma));\n#endif\nreturn color;\n}\nvec4 czm_gammaCorrect(vec4 color) {\n#ifdef HDR\ncolor.rgb = pow(color.rgb, vec3(czm_gamma));\n#endif\nreturn color;\n}\n",czm_geodeticSurfaceNormal:"vec3 czm_geodeticSurfaceNormal(vec3 positionOnEllipsoid, vec3 ellipsoidCenter, vec3 oneOverEllipsoidRadiiSquared)\n{\nreturn normalize((positionOnEllipsoid - ellipsoidCenter) * oneOverEllipsoidRadiiSquared);\n}\n",czm_getDefaultMaterial:"czm_material czm_getDefaultMaterial(czm_materialInput materialInput)\n{\nczm_material material;\nmaterial.diffuse = vec3(0.0);\nmaterial.specular = 0.0;\nmaterial.shininess = 1.0;\nmaterial.normal = materialInput.normalEC;\nmaterial.emission = vec3(0.0);\nmaterial.alpha = 1.0;\nreturn material;\n}\n",czm_getLambertDiffuse:"float czm_getLambertDiffuse(vec3 lightDirectionEC, vec3 normalEC)\n{\nreturn max(dot(lightDirectionEC, normalEC), 0.0);\n}\n",czm_getSpecular:"float czm_getSpecular(vec3 lightDirectionEC, vec3 toEyeEC, vec3 normalEC, float shininess)\n{\nvec3 toReflectedLight = reflect(-lightDirectionEC, normalEC);\nfloat specular = max(dot(toReflectedLight, toEyeEC), 0.0);\nreturn pow(specular, max(shininess, czm_epsilon2));\n}\n",czm_getWaterNoise:"vec4 czm_getWaterNoise(sampler2D normalMap, vec2 uv, float time, float angleInRadians)\n{\nfloat cosAngle = cos(angleInRadians);\nfloat sinAngle = sin(angleInRadians);\nvec2 s0 = vec2(1.0/17.0, 0.0);\nvec2 s1 = vec2(-1.0/29.0, 0.0);\nvec2 s2 = vec2(1.0/101.0, 1.0/59.0);\nvec2 s3 = vec2(-1.0/109.0, -1.0/57.0);\ns0 = vec2((cosAngle * s0.x) - (sinAngle * s0.y), (sinAngle * s0.x) + (cosAngle * s0.y));\ns1 = vec2((cosAngle * s1.x) - (sinAngle * s1.y), (sinAngle * s1.x) + (cosAngle * s1.y));\ns2 = vec2((cosAngle * s2.x) - (sinAngle * s2.y), (sinAngle * s2.x) + (cosAngle * s2.y));\ns3 = vec2((cosAngle * s3.x) - (sinAngle * s3.y), (sinAngle * s3.x) + (cosAngle * s3.y));\nvec2 uv0 = (uv/103.0) + (time * s0);\nvec2 uv1 = uv/107.0 + (time * s1) + vec2(0.23);\nvec2 uv2 = uv/vec2(897.0, 983.0) + (time * s2) + vec2(0.51);\nvec2 uv3 = uv/vec2(991.0, 877.0) + (time * s3) + vec2(0.71);\nuv0 = fract(uv0);\nuv1 = fract(uv1);\nuv2 = fract(uv2);\nuv3 = fract(uv3);\nvec4 noise = (texture2D(normalMap, uv0)) +\n(texture2D(normalMap, uv1)) +\n(texture2D(normalMap, uv2)) +\n(texture2D(normalMap, uv3));\nreturn ((noise / 4.0) - 0.5) * 2.0;\n}\n",czm_hue:"vec3 czm_hue(vec3 rgb, float adjustment)\n{\nconst mat3 toYIQ = mat3(0.299,     0.587,     0.114,\n0.595716, -0.274453, -0.321263,\n0.211456, -0.522591,  0.311135);\nconst mat3 toRGB = mat3(1.0,  0.9563,  0.6210,\n1.0, -0.2721, -0.6474,\n1.0, -1.107,   1.7046);\nvec3 yiq = toYIQ * rgb;\nfloat hue = atan(yiq.z, yiq.y) + adjustment;\nfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);\nvec3 color = vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));\nreturn toRGB * color;\n}\n",czm_inverseGamma:"vec3 czm_inverseGamma(vec3 color) {\nreturn pow(color, vec3(1.0 / czm_gamma));\n}\n",czm_isEmpty:"bool czm_isEmpty(czm_raySegment interval)\n{\nreturn (interval.stop < 0.0);\n}\n",czm_isFull:"bool czm_isFull(czm_raySegment interval)\n{\nreturn (interval.start == 0.0 && interval.stop == czm_infinity);\n}\n",czm_latitudeToWebMercatorFraction:"float czm_latitudeToWebMercatorFraction(float latitude, float southMercatorY, float oneOverMercatorHeight)\n{\nfloat sinLatitude = sin(latitude);\nfloat mercatorY = 0.5 * log((1.0 + sinLatitude) / (1.0 - sinLatitude));\nreturn (mercatorY - southMercatorY) * oneOverMercatorHeight;\n}\n",czm_lineDistance:"float czm_lineDistance(vec2 point1, vec2 point2, vec2 point) {\nreturn abs((point2.y - point1.y) * point.x - (point2.x - point1.x) * point.y + point2.x * point1.y - point2.y * point1.x) / distance(point2, point1);\n}\n",czm_luminance:"float czm_luminance(vec3 rgb)\n{\nconst vec3 W = vec3(0.2125, 0.7154, 0.0721);\nreturn dot(rgb, W);\n}\n",czm_metersPerPixel:"float czm_metersPerPixel(vec4 positionEC, float pixelRatio)\n{\nfloat width = czm_viewport.z;\nfloat height = czm_viewport.w;\nfloat pixelWidth;\nfloat pixelHeight;\nfloat top = czm_frustumPlanes.x;\nfloat bottom = czm_frustumPlanes.y;\nfloat left = czm_frustumPlanes.z;\nfloat right = czm_frustumPlanes.w;\nif (czm_sceneMode == czm_sceneMode2D || czm_orthographicIn3D == 1.0)\n{\nfloat frustumWidth = right - left;\nfloat frustumHeight = top - bottom;\npixelWidth = frustumWidth / width;\npixelHeight = frustumHeight / height;\n}\nelse\n{\nfloat distanceToPixel = -positionEC.z;\nfloat inverseNear = 1.0 / czm_currentFrustum.x;\nfloat tanTheta = top * inverseNear;\npixelHeight = 2.0 * distanceToPixel * tanTheta / height;\ntanTheta = right * inverseNear;\npixelWidth = 2.0 * distanceToPixel * tanTheta / width;\n}\nreturn max(pixelWidth, pixelHeight) * pixelRatio;\n}\nfloat czm_metersPerPixel(vec4 positionEC)\n{\nreturn czm_metersPerPixel(positionEC, czm_pixelRatio);\n}\n",czm_modelToWindowCoordinates:"vec4 czm_modelToWindowCoordinates(vec4 position)\n{\nvec4 q = czm_modelViewProjection * position;\nq.xyz /= q.w;\nq.xyz = (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz;\nreturn q;\n}\n",czm_multiplyWithColorBalance:"vec3 czm_multiplyWithColorBalance(vec3 left, vec3 right)\n{\nconst vec3 W = vec3(0.2125, 0.7154, 0.0721);\nvec3 target = left * right;\nfloat leftLuminance = dot(left, W);\nfloat rightLuminance = dot(right, W);\nfloat targetLuminance = dot(target, W);\nreturn ((leftLuminance + rightLuminance) / (2.0 * targetLuminance)) * target;\n}\n",czm_nearFarScalar:"float czm_nearFarScalar(vec4 nearFarScalar, float cameraDistSq)\n{\nfloat valueAtMin = nearFarScalar.y;\nfloat valueAtMax = nearFarScalar.w;\nfloat nearDistanceSq = nearFarScalar.x * nearFarScalar.x;\nfloat farDistanceSq = nearFarScalar.z * nearFarScalar.z;\nfloat t = (cameraDistSq - nearDistanceSq) / (farDistanceSq - nearDistanceSq);\nt = pow(clamp(t, 0.0, 1.0), 0.2);\nreturn mix(valueAtMin, valueAtMax, t);\n}\n",czm_octDecode:"vec3 czm_octDecode(vec2 encoded, float range)\n{\nif (encoded.x == 0.0 && encoded.y == 0.0) {\nreturn vec3(0.0, 0.0, 0.0);\n}\nencoded = encoded / range * 2.0 - 1.0;\nvec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\nif (v.z < 0.0)\n{\nv.xy = (1.0 - abs(v.yx)) * czm_signNotZero(v.xy);\n}\nreturn normalize(v);\n}\nvec3 czm_octDecode(vec2 encoded)\n{\nreturn czm_octDecode(encoded, 255.0);\n}\nvec3 czm_octDecode(float encoded)\n{\nfloat temp = encoded / 256.0;\nfloat x = floor(temp);\nfloat y = (temp - x) * 256.0;\nreturn czm_octDecode(vec2(x, y));\n}\nvoid czm_octDecode(vec2 encoded, out vec3 vector1, out vec3 vector2, out vec3 vector3)\n{\nfloat temp = encoded.x / 65536.0;\nfloat x = floor(temp);\nfloat encodedFloat1 = (temp - x) * 65536.0;\ntemp = encoded.y / 65536.0;\nfloat y = floor(temp);\nfloat encodedFloat2 = (temp - y) * 65536.0;\nvector1 = czm_octDecode(encodedFloat1);\nvector2 = czm_octDecode(encodedFloat2);\nvector3 = czm_octDecode(vec2(x, y));\n}\n",czm_packDepth:"vec4 czm_packDepth(float depth)\n{\nvec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nenc = fract(enc);\nenc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\nreturn enc;\n}\n",czm_phong:"float czm_private_getLambertDiffuseOfMaterial(vec3 lightDirectionEC, czm_material material)\n{\nreturn czm_getLambertDiffuse(lightDirectionEC, material.normal);\n}\nfloat czm_private_getSpecularOfMaterial(vec3 lightDirectionEC, vec3 toEyeEC, czm_material material)\n{\nreturn czm_getSpecular(lightDirectionEC, toEyeEC, material.normal, material.shininess);\n}\nvec4 czm_phong(vec3 toEye, czm_material material, vec3 lightDirectionEC)\n{\nfloat diffuse = czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 0.0, 1.0), material);\nif (czm_sceneMode == czm_sceneMode3D) {\ndiffuse += czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 1.0, 0.0), material);\n}\nfloat specular = czm_private_getSpecularOfMaterial(lightDirectionEC, toEye, material);\nvec3 materialDiffuse = material.diffuse * 0.5;\nvec3 ambient = materialDiffuse;\nvec3 color = ambient + material.emission;\ncolor += materialDiffuse * diffuse * czm_lightColor;\ncolor += material.specular * specular * czm_lightColor;\nreturn vec4(color, material.alpha);\n}\nvec4 czm_private_phong(vec3 toEye, czm_material material, vec3 lightDirectionEC)\n{\nfloat diffuse = czm_private_getLambertDiffuseOfMaterial(lightDirectionEC, material);\nfloat specular = czm_private_getSpecularOfMaterial(lightDirectionEC, toEye, material);\nvec3 ambient = vec3(0.0);\nvec3 color = ambient + material.emission;\ncolor += material.diffuse * diffuse * czm_lightColor;\ncolor += material.specular * specular * czm_lightColor;\nreturn vec4(color, material.alpha);\n}\n",czm_planeDistance:"float czm_planeDistance(vec4 plane, vec3 point) {\nreturn (dot(plane.xyz, point) + plane.w);\n}\nfloat czm_planeDistance(vec3 planeNormal, float planeDistance, vec3 point) {\nreturn (dot(planeNormal, point) + planeDistance);\n}\n",czm_pointAlongRay:"vec3 czm_pointAlongRay(czm_ray ray, float time)\n{\nreturn ray.origin + (time * ray.direction);\n}\n",czm_rayEllipsoidIntersectionInterval:"czm_raySegment czm_rayEllipsoidIntersectionInterval(czm_ray ray, vec3 ellipsoid_center, vec3 ellipsoid_inverseRadii)\n{\nvec3 q = ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ray.origin, 1.0)).xyz;\nvec3 w = ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ray.direction, 0.0)).xyz;\nq = q - ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ellipsoid_center, 1.0)).xyz;\nfloat q2 = dot(q, q);\nfloat qw = dot(q, w);\nif (q2 > 1.0)\n{\nif (qw >= 0.0)\n{\nreturn czm_emptyRaySegment;\n}\nelse\n{\nfloat qw2 = qw * qw;\nfloat difference = q2 - 1.0;\nfloat w2 = dot(w, w);\nfloat product = w2 * difference;\nif (qw2 < product)\n{\nreturn czm_emptyRaySegment;\n}\nelse if (qw2 > product)\n{\nfloat discriminant = qw * qw - product;\nfloat temp = -qw + sqrt(discriminant);\nfloat root0 = temp / w2;\nfloat root1 = difference / temp;\nif (root0 < root1)\n{\nczm_raySegment i = czm_raySegment(root0, root1);\nreturn i;\n}\nelse\n{\nczm_raySegment i = czm_raySegment(root1, root0);\nreturn i;\n}\n}\nelse\n{\nfloat root = sqrt(difference / w2);\nczm_raySegment i = czm_raySegment(root, root);\nreturn i;\n}\n}\n}\nelse if (q2 < 1.0)\n{\nfloat difference = q2 - 1.0;\nfloat w2 = dot(w, w);\nfloat product = w2 * difference;\nfloat discriminant = qw * qw - product;\nfloat temp = -qw + sqrt(discriminant);\nczm_raySegment i = czm_raySegment(0.0, temp / w2);\nreturn i;\n}\nelse\n{\nif (qw < 0.0)\n{\nfloat w2 = dot(w, w);\nczm_raySegment i = czm_raySegment(0.0, -qw / w2);\nreturn i;\n}\nelse\n{\nreturn czm_emptyRaySegment;\n}\n}\n}\n",czm_readDepth:"float czm_readDepth(sampler2D depthTexture, vec2 texCoords)\n{\nreturn czm_reverseLogDepth(texture2D(depthTexture, texCoords).r);\n}\n",czm_readNonPerspective:"float czm_readNonPerspective(float value, float oneOverW) {\nreturn value * oneOverW;\n}\nvec2 czm_readNonPerspective(vec2 value, float oneOverW) {\nreturn value * oneOverW;\n}\nvec3 czm_readNonPerspective(vec3 value, float oneOverW) {\nreturn value * oneOverW;\n}\nvec4 czm_readNonPerspective(vec4 value, float oneOverW) {\nreturn value * oneOverW;\n}\n",czm_reverseLogDepth:"float czm_reverseLogDepth(float logZ)\n{\n#ifdef LOG_DEPTH\nfloat near = czm_currentFrustum.x;\nfloat far = czm_currentFrustum.y;\nfloat log2Depth = logZ * czm_log2FarDepthFromNearPlusOne;\nfloat depthFromNear = pow(2.0, log2Depth) - 1.0;\nreturn far * (1.0 - near / (depthFromNear + near)) / (far - near);\n#endif\nreturn logZ;\n}\n",czm_sampleOctahedralProjection:"vec3 czm_sampleOctahedralProjectionWithFiltering(sampler2D projectedMap, vec2 textureSize, vec3 direction, float lod)\n{\ndirection /= dot(vec3(1.0), abs(direction));\nvec2 rev = abs(direction.zx) - vec2(1.0);\nvec2 neg = vec2(direction.x < 0.0 ? rev.x : -rev.x,\ndirection.z < 0.0 ? rev.y : -rev.y);\nvec2 uv = direction.y < 0.0 ? neg : direction.xz;\nvec2 coord = 0.5 * uv + vec2(0.5);\nvec2 pixel = 1.0 / textureSize;\nif (lod > 0.0)\n{\nfloat scale = 1.0 / pow(2.0, lod);\nfloat offset = ((textureSize.y + 1.0) / textureSize.x);\ncoord.x *= offset;\ncoord *= scale;\ncoord.x += offset + pixel.x;\ncoord.y += (1.0 - (1.0 / pow(2.0, lod - 1.0))) + pixel.y * (lod - 1.0) * 2.0;\n}\nelse\n{\ncoord.x *= (textureSize.y / textureSize.x);\n}\n#ifndef OES_texture_float_linear\nvec3 color1 = texture2D(projectedMap, coord + vec2(0.0, pixel.y)).rgb;\nvec3 color2 = texture2D(projectedMap, coord + vec2(pixel.x, 0.0)).rgb;\nvec3 color3 = texture2D(projectedMap, coord + pixel).rgb;\nvec3 color4 = texture2D(projectedMap, coord).rgb;\nvec2 texturePosition = coord * textureSize;\nfloat fu = fract(texturePosition.x);\nfloat fv = fract(texturePosition.y);\nvec3 average1 = mix(color4, color2, fu);\nvec3 average2 = mix(color1, color3, fu);\nvec3 color = mix(average1, average2, fv);\n#else\nvec3 color = texture2D(projectedMap, coord).rgb;\n#endif\nreturn color;\n}\nvec3 czm_sampleOctahedralProjection(sampler2D projectedMap, vec2 textureSize, vec3 direction, float lod, float maxLod) {\nfloat currentLod = floor(lod + 0.5);\nfloat nextLod = min(currentLod + 1.0, maxLod);\nvec3 colorCurrentLod = czm_sampleOctahedralProjectionWithFiltering(projectedMap, textureSize, direction, currentLod);\nvec3 colorNextLod = czm_sampleOctahedralProjectionWithFiltering(projectedMap, textureSize, direction, nextLod);\nreturn mix(colorNextLod, colorCurrentLod, nextLod - lod);\n}\n",czm_saturation:"vec3 czm_saturation(vec3 rgb, float adjustment)\n{\nconst vec3 W = vec3(0.2125, 0.7154, 0.0721);\nvec3 intensity = vec3(dot(rgb, W));\nreturn mix(intensity, rgb, adjustment);\n}\n",czm_shadowDepthCompare:"float czm_sampleShadowMap(highp samplerCube shadowMap, vec3 d)\n{\nreturn czm_unpackDepth(textureCube(shadowMap, d));\n}\nfloat czm_sampleShadowMap(highp sampler2D shadowMap, vec2 uv)\n{\n#ifdef USE_SHADOW_DEPTH_TEXTURE\nreturn texture2D(shadowMap, uv).r;\n#else\nreturn czm_unpackDepth(texture2D(shadowMap, uv));\n#endif\n}\nfloat czm_shadowDepthCompare(samplerCube shadowMap, vec3 uv, float depth)\n{\nreturn step(depth, czm_sampleShadowMap(shadowMap, uv));\n}\nfloat czm_shadowDepthCompare(sampler2D shadowMap, vec2 uv, float depth)\n{\nreturn step(depth, czm_sampleShadowMap(shadowMap, uv));\n}\n",czm_shadowVisibility:"float czm_private_shadowVisibility(float visibility, float nDotL, float normalShadingSmooth, float darkness)\n{\n#ifdef USE_NORMAL_SHADING\n#ifdef USE_NORMAL_SHADING_SMOOTH\nfloat strength = clamp(nDotL / normalShadingSmooth, 0.0, 1.0);\n#else\nfloat strength = step(0.0, nDotL);\n#endif\nvisibility *= strength;\n#endif\nvisibility = max(visibility, darkness);\nreturn visibility;\n}\n#ifdef USE_CUBE_MAP_SHADOW\nfloat czm_shadowVisibility(samplerCube shadowMap, czm_shadowParameters shadowParameters)\n{\nfloat depthBias = shadowParameters.depthBias;\nfloat depth = shadowParameters.depth;\nfloat nDotL = shadowParameters.nDotL;\nfloat normalShadingSmooth = shadowParameters.normalShadingSmooth;\nfloat darkness = shadowParameters.darkness;\nvec3 uvw = shadowParameters.texCoords;\ndepth -= depthBias;\nfloat visibility = czm_shadowDepthCompare(shadowMap, uvw, depth);\nreturn czm_private_shadowVisibility(visibility, nDotL, normalShadingSmooth, darkness);\n}\n#else\nfloat czm_shadowVisibility(sampler2D shadowMap, czm_shadowParameters shadowParameters)\n{\nfloat depthBias = shadowParameters.depthBias;\nfloat depth = shadowParameters.depth;\nfloat nDotL = shadowParameters.nDotL;\nfloat normalShadingSmooth = shadowParameters.normalShadingSmooth;\nfloat darkness = shadowParameters.darkness;\nvec2 uv = shadowParameters.texCoords;\ndepth -= depthBias;\n#ifdef USE_SOFT_SHADOWS\nvec2 texelStepSize = shadowParameters.texelStepSize;\nfloat radius = 1.0;\nfloat dx0 = -texelStepSize.x * radius;\nfloat dy0 = -texelStepSize.y * radius;\nfloat dx1 = texelStepSize.x * radius;\nfloat dy1 = texelStepSize.y * radius;\nfloat visibility = (\nczm_shadowDepthCompare(shadowMap, uv, depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx0, 0.0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx1, 0.0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy1), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy1), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy1), depth)\n) * (1.0 / 9.0);\n#else\nfloat visibility = czm_shadowDepthCompare(shadowMap, uv, depth);\n#endif\nreturn czm_private_shadowVisibility(visibility, nDotL, normalShadingSmooth, darkness);\n}\n#endif\n",czm_signNotZero:"float czm_signNotZero(float value)\n{\nreturn value >= 0.0 ? 1.0 : -1.0;\n}\nvec2 czm_signNotZero(vec2 value)\n{\nreturn vec2(czm_signNotZero(value.x), czm_signNotZero(value.y));\n}\nvec3 czm_signNotZero(vec3 value)\n{\nreturn vec3(czm_signNotZero(value.x), czm_signNotZero(value.y), czm_signNotZero(value.z));\n}\nvec4 czm_signNotZero(vec4 value)\n{\nreturn vec4(czm_signNotZero(value.x), czm_signNotZero(value.y), czm_signNotZero(value.z), czm_signNotZero(value.w));\n}\n",czm_sphericalHarmonics:"vec3 czm_sphericalHarmonics(vec3 normal, vec3 coefficients[9])\n{\nconst float c1 = 0.429043;\nconst float c2 = 0.511664;\nconst float c3 = 0.743125;\nconst float c4 = 0.886227;\nconst float c5 = 0.247708;\nvec3 L00 = coefficients[0];\nvec3 L1_1 = coefficients[1];\nvec3 L10 = coefficients[2];\nvec3 L11 = coefficients[3];\nvec3 L2_2 = coefficients[4];\nvec3 L2_1 = coefficients[5];\nvec3 L20 = coefficients[6];\nvec3 L21 = coefficients[7];\nvec3 L22 = coefficients[8];\nfloat x = normal.x;\nfloat y = normal.y;\nfloat z = normal.z;\nreturn c1 * L22 * (x * x - y * y) + c3 * L20 * z * z + c4 * L00 - c5 * L20 +\n2.0 * c1 * (L2_2 * x * y + L21 * x * z + L2_1 * y * z) +\n2.0 * c2 * (L11 * x + L1_1 * y + L10 * z);\n}\n",czm_tangentToEyeSpaceMatrix:"mat3 czm_tangentToEyeSpaceMatrix(vec3 normalEC, vec3 tangentEC, vec3 bitangentEC)\n{\nvec3 normal = normalize(normalEC);\nvec3 tangent = normalize(tangentEC);\nvec3 bitangent = normalize(bitangentEC);\nreturn mat3(tangent.x  , tangent.y  , tangent.z,\nbitangent.x, bitangent.y, bitangent.z,\nnormal.x   , normal.y   , normal.z);\n}\n",czm_transformPlane:"vec4 czm_transformPlane(vec4 plane, mat4 transform) {\nvec4 transformedPlane = transform * plane;\nfloat normalMagnitude = length(transformedPlane.xyz);\nreturn transformedPlane / normalMagnitude;\n}\n",czm_translateRelativeToEye:"vec4 czm_translateRelativeToEye(vec3 high, vec3 low)\n{\nvec3 highDifference = high - czm_encodedCameraPositionMCHigh;\nvec3 lowDifference = low - czm_encodedCameraPositionMCLow;\nreturn vec4(highDifference + lowDifference, 1.0);\n}\n",czm_translucentPhong:"vec4 czm_translucentPhong(vec3 toEye, czm_material material, vec3 lightDirectionEC)\n{\nfloat diffuse = czm_getLambertDiffuse(vec3(0.0, 0.0, 1.0), material.normal);\nif (czm_sceneMode == czm_sceneMode3D) {\ndiffuse += czm_getLambertDiffuse(vec3(0.0, 1.0, 0.0), material.normal);\n}\ndiffuse = clamp(diffuse, 0.0, 1.0);\nfloat specular = czm_getSpecular(lightDirectionEC, toEye, material.normal, material.shininess);\nvec3 materialDiffuse = material.diffuse * 0.5;\nvec3 ambient = materialDiffuse;\nvec3 color = ambient + material.emission;\ncolor += materialDiffuse * diffuse * czm_lightColor;\ncolor += material.specular * specular * czm_lightColor;\nreturn vec4(color, material.alpha);\n}\n",czm_transpose:"mat2 czm_transpose(mat2 matrix)\n{\nreturn mat2(\nmatrix[0][0], matrix[1][0],\nmatrix[0][1], matrix[1][1]);\n}\nmat3 czm_transpose(mat3 matrix)\n{\nreturn mat3(\nmatrix[0][0], matrix[1][0], matrix[2][0],\nmatrix[0][1], matrix[1][1], matrix[2][1],\nmatrix[0][2], matrix[1][2], matrix[2][2]);\n}\nmat4 czm_transpose(mat4 matrix)\n{\nreturn mat4(\nmatrix[0][0], matrix[1][0], matrix[2][0], matrix[3][0],\nmatrix[0][1], matrix[1][1], matrix[2][1], matrix[3][1],\nmatrix[0][2], matrix[1][2], matrix[2][2], matrix[3][2],\nmatrix[0][3], matrix[1][3], matrix[2][3], matrix[3][3]);\n}\n",czm_unpackDepth:"float czm_unpackDepth(vec4 packedDepth)\n{\nreturn dot(packedDepth, vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n}\n",czm_unpackFloat:"float czm_unpackFloat(vec4 packedFloat)\n{\npackedFloat = floor(packedFloat * 255.0 + 0.5);\nfloat sign = 1.0 - step(128.0, packedFloat[3]) * 2.0;\nfloat exponent = 2.0 * mod(packedFloat[3], 128.0) + step(128.0, packedFloat[2]) - 127.0;\nif (exponent == -127.0)\n{\nreturn 0.0;\n}\nfloat mantissa = mod(packedFloat[2], 128.0) * 65536.0 + packedFloat[1] * 256.0 + packedFloat[0] + float(0x800000);\nfloat result = sign * exp2(exponent - 23.0) * mantissa;\nreturn result;\n}\n",czm_vertexLogDepth:"#ifdef LOG_DEPTH\nvarying float v_depthFromNearPlusOne;\n#ifdef SHADOW_MAP\nvarying vec3 v_logPositionEC;\n#endif\n#endif\nvec4 czm_updatePositionDepth(vec4 coords) {\n#if defined(LOG_DEPTH)\n#ifdef SHADOW_MAP\nvec3 logPositionEC = (czm_inverseProjection * coords).xyz;\nv_logPositionEC = logPositionEC;\n#endif\ncoords.z = clamp(coords.z / coords.w, -1.0, 1.0) * coords.w;\n#endif\nreturn coords;\n}\nvoid czm_vertexLogDepth()\n{\n#ifdef LOG_DEPTH\nv_depthFromNearPlusOne = (gl_Position.w - czm_currentFrustum.x) + 1.0;\ngl_Position = czm_updatePositionDepth(gl_Position);\n#endif\n}\nvoid czm_vertexLogDepth(vec4 clipCoords)\n{\n#ifdef LOG_DEPTH\nv_depthFromNearPlusOne = (clipCoords.w - czm_currentFrustum.x) + 1.0;\nczm_updatePositionDepth(clipCoords);\n#endif\n}\n",czm_windowToEyeCoordinates:"vec4 czm_windowToEyeCoordinates(vec4 fragmentCoordinate)\n{\nfloat x = 2.0 * (fragmentCoordinate.x - czm_viewport.x) / czm_viewport.z - 1.0;\nfloat y = 2.0 * (fragmentCoordinate.y - czm_viewport.y) / czm_viewport.w - 1.0;\nfloat z = (fragmentCoordinate.z - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];\nvec4 q = vec4(x, y, z, 1.0);\nq /= fragmentCoordinate.w;\nif (!(czm_inverseProjection == mat4(0.0)))\n{\nq = czm_inverseProjection * q;\n}\nelse\n{\nfloat top = czm_frustumPlanes.x;\nfloat bottom = czm_frustumPlanes.y;\nfloat left = czm_frustumPlanes.z;\nfloat right = czm_frustumPlanes.w;\nfloat near = czm_currentFrustum.x;\nfloat far = czm_currentFrustum.y;\nq.x = (q.x * (right - left) + left + right) * 0.5;\nq.y = (q.y * (top - bottom) + bottom + top) * 0.5;\nq.z = (q.z * (near - far) - near - far) * 0.5;\nq.w = 1.0;\n}\nreturn q;\n}\nvec4 czm_windowToEyeCoordinates(vec2 fragmentCoordinateXY, float depthOrLogDepth)\n{\n#ifdef LOG_DEPTH\nfloat near = czm_currentFrustum.x;\nfloat far = czm_currentFrustum.y;\nfloat log2Depth = depthOrLogDepth * czm_log2FarDepthFromNearPlusOne;\nfloat depthFromNear = pow(2.0, log2Depth) - 1.0;\nfloat depthFromCamera = depthFromNear + near;\nvec4 windowCoord = vec4(fragmentCoordinateXY, far * (1.0 - near / depthFromCamera) / (far - near), 1.0);\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(windowCoord);\neyeCoordinate.w = 1.0 / depthFromCamera;\nreturn eyeCoordinate;\n#else\nvec4 windowCoord = vec4(fragmentCoordinateXY, depthOrLogDepth, 1.0);\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(windowCoord);\n#endif\nreturn eyeCoordinate;\n}\n",czm_writeDepthClamp:"#if defined(GL_EXT_frag_depth) && !defined(LOG_DEPTH)\nvarying float v_WindowZ;\n#endif\nvoid czm_writeDepthClamp()\n{\n#if defined(GL_EXT_frag_depth) && !defined(LOG_DEPTH)\ngl_FragDepthEXT = clamp(v_WindowZ * gl_FragCoord.w, 0.0, 1.0);\n#endif\n}\n",czm_writeLogDepth:"#ifdef LOG_DEPTH\nvarying float v_depthFromNearPlusOne;\n#ifdef POLYGON_OFFSET\nuniform vec2 u_polygonOffset;\n#endif\n#endif\nvoid czm_writeLogDepth(float depth)\n{\n#if defined(GL_EXT_frag_depth) && defined(LOG_DEPTH)\nif (depth <= 0.9999999 || depth > czm_farDepthFromNearPlusOne) {\ndiscard;\n}\n#ifdef POLYGON_OFFSET\nfloat factor = u_polygonOffset[0];\nfloat units = u_polygonOffset[1];\n#ifdef GL_OES_standard_derivatives\nfloat x = dFdx(depth);\nfloat y = dFdy(depth);\nfloat m = sqrt(x * x + y * y);\ndepth += m * factor;\n#endif\n#endif\ngl_FragDepthEXT = log2(depth) * czm_oneOverLog2FarDepthFromNearPlusOne;\n#ifdef POLYGON_OFFSET\ngl_FragDepthEXT += czm_epsilon7 * units;\n#endif\n#endif\n}\nvoid czm_writeLogDepth() {\n#ifdef LOG_DEPTH\nczm_writeLogDepth(v_depthFromNearPlusOne);\n#endif\n}\n",czm_writeNonPerspective:"float czm_writeNonPerspective(float value, float w) {\nreturn value * w;\n}\nvec2 czm_writeNonPerspective(vec2 value, float w) {\nreturn value * w;\n}\nvec3 czm_writeNonPerspective(vec3 value, float w) {\nreturn value * w;\n}\nvec4 czm_writeNonPerspective(vec4 value, float w) {\nreturn value * w;\n}\n"};function Qu(e){return(e=e.replace(/\/\/.*/g,"")).replace(/\/\*\*[\s\S]*?\*\//gm,(function(e){for(var t=e.match(/\n/gm).length,n="",r=0;r<t;++r)n+="\n";return n}))}function Ju(t,n,r){for(var i,o=0;o<r.length;++o)r[o].name===t&&(i=r[o]);return e(i)||(i={name:t,glslSource:n=Qu(n),dependsOn:[],requiredBy:[],evaluated:!1},r.push(i)),i}function $u(t,n){if(!t.evaluated){t.evaluated=!0;var r=t.glslSource.match(/\bczm_[a-zA-Z0-9_]*/g);e(r)&&null!==r&&(r=r.filter((function(e,t){return r.indexOf(e)===t}))).forEach((function(e){if(e!==t.name&&nc._czmBuiltinsAndUniforms.hasOwnProperty(e)){var r=Ju(e,nc._czmBuiltinsAndUniforms[e],n);t.dependsOn.push(r),r.requiredBy.push(t),$u(r,n)}}))}}function ec(e){var t=[],n=Ju("main",e,t);$u(n,t),function(e){for(var t=[],n=[];e.length>0;){var r=e.pop();n.push(r),0===r.requiredBy.length&&t.push(r)}for(;t.length>0;){var i=t.shift();e.push(i);for(var o=0;o<i.dependsOn.length;++o){var a=i.dependsOn[o],s=a.requiredBy.indexOf(i);a.requiredBy.splice(s,1),0===a.requiredBy.length&&t.push(a)}}for(var u=0;u<n.length;++u)n[u].requiredBy.length}(t);for(var r="",i=t.length-1;i>=0;--i)r=r+t[i].glslSource+"\n";return r.replace(n.glslSource,"")}function tc(t,n,r){var i,o,a,s="",u=t.sources;if(e(u))for(i=0,o=u.length;i<o;++i)s+="\n#line 0\n"+u[i];s=(s=Qu(s)).replace(/#version\s+(.*?)\n/gm,(function(e,t){return a=t,"\n"}));var c=[];s=(s=s.replace(/#extension.*\n/gm,(function(e){return c.push(e),"\n"}))).replace(/precision\s(lowp|mediump|highp)\s(float|int);/,"");var l=t.pickColorQualifier;e(l)&&(s=nc.createPickFragmentShaderSource(s,l));var h="";e(a)&&(h="#version "+a+"\n");var d=c.length;for(i=0;i<d;i++)h+=c[i];n&&(h+="#ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n#else\n    precision mediump float;\n    #define highp mediump\n#endif\n\n");var f=t.defines;if(e(f))for(i=0,o=f.length;i<o;++i){var m=f[i];0!==m.length&&(h+="#define "+m+"\n")}return r.webgl2&&(h+="#define OUTPUT_DECLARATION\n\n"),r.textureFloatLinear&&(h+="#define OES_texture_float_linear\n\n"),r.floatingPointTexture&&(h+="#define OES_texture_float\n\n"),t.includeBuiltIns&&(h+=ec(s)),h+="\n#line 0\n",h+=s,r.webgl2&&(h=Yu(h,n)),h}function nc(t){var n=(t=i(t,i.EMPTY_OBJECT)).pickColorQualifier;this.defines=e(t.defines)?t.defines.slice(0):[],this.sources=e(t.sources)?t.sources.slice(0):[],this.pickColorQualifier=n,this.includeBuiltIns=i(t.includeBuiltIns,!0)}for(var rc in nc.prototype.clone=function(){return new nc({sources:this.sources,defines:this.defines,pickColorQualifier:this.pickColorQualifier,includeBuiltIns:this.includeBuiltIns})},nc.replaceMain=function(e,t){return t="void "+t+"()",e.replace(/void\s+main\s*\(\s*(?:void)?\s*\)/g,t)},nc.prototype.createCombinedVertexShader=function(e){return tc(this,!1,e)},nc.prototype.createCombinedFragmentShader=function(e){return tc(this,!0,e)},nc._czmBuiltinsAndUniforms={},Ku)Ku.hasOwnProperty(rc)&&(nc._czmBuiltinsAndUniforms[rc]=Ku[rc]);for(var ic in su)if(su.hasOwnProperty(ic)){var oc=su[ic];"function"==typeof oc.getDeclaration&&(nc._czmBuiltinsAndUniforms[ic]=oc.getDeclaration(ic))}nc.createPickVertexShaderSource=function(e){return nc.replaceMain(e,"czm_old_main")+"\nattribute vec4 pickColor; \nvarying vec4 czm_pickColor; \nvoid main() \n{ \n    czm_old_main(); \n    czm_pickColor = pickColor; \n}"},nc.createPickFragmentShaderSource=function(e,t){return nc.replaceMain(e,"czm_old_main")+"\n"+(t+" vec4 czm_pickColor; \nvoid main() \n{ \n    czm_old_main(); \n    if (gl_FragColor.a == 0.0) { \n       discard; \n    } \n    gl_FragColor = czm_pickColor; \n}")},nc.findVarying=function(e,t){for(var n=e.sources,r=t.length,i=0;i<r;++i)for(var o=t[i],a=n.length,s=0;s<a;++s)if(-1!==n[s].indexOf(o))return o};var ac=["v_normalEC","v_normal"];nc.findNormalVarying=function(e){return nc.findVarying(e,ac)};var sc=["v_positionEC"];nc.findPositionVarying=function(e){return nc.findVarying(e,sc)};var uc=Object.freeze({NONE:0,TRIANGLES:1,LINES:2,POLYLINES:3});function cc(e){e=i(e,i.EMPTY_OBJECT),this.attributes=e.attributes,this.indices=e.indices,this.primitiveType=i(e.primitiveType,Rs.TRIANGLES),this.boundingSphere=e.boundingSphere,this.geometryType=i(e.geometryType,uc.NONE),this.boundingSphereCV=e.boundingSphereCV,this.offsetAttribute=e.offsetAttribute}cc.computeNumberOfVertices=function(t){var n=-1;for(var r in t.attributes)if(t.attributes.hasOwnProperty(r)&&e(t.attributes[r])&&e(t.attributes[r].values)){var i=t.attributes[r];n=i.values.length/i.componentsPerAttribute}return n};var lc=new N,hc=new p,dc=new ye,fc=[new N,new N,new N],mc=[new c,new c,new c],pc=[new c,new c,new c],_c=new p,gc=new Nr,vc=new ye,yc=new uu;function Tc(t,n,r,o){var a=e(n.vertexBuffer),s=e(n.value),u=n.value?n.value.length:n.componentsPerAttribute,c={index:i(n.index,r),enabled:i(n.enabled,!0),vertexBuffer:n.vertexBuffer,value:s?n.value.slice(0):void 0,componentsPerAttribute:u,componentDatatype:i(n.componentDatatype,xn.FLOAT),normalize:i(n.normalize,!1),offsetInBytes:i(n.offsetInBytes,0),strideInBytes:i(n.strideInBytes,0),instanceDivisor:i(n.instanceDivisor,0)};if(a)c.vertexAttrib=function(e){var t=this.index;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer._getBuffer()),e.vertexAttribPointer(t,this.componentsPerAttribute,this.componentDatatype,this.normalize,this.strideInBytes,this.offsetInBytes),e.enableVertexAttribArray(t),this.instanceDivisor>0&&(o.glVertexAttribDivisor(t,this.instanceDivisor),o._vertexAttribDivisors[t]=this.instanceDivisor,o._previousDrawInstanced=!0)},c.disableVertexAttribArray=function(e){e.disableVertexAttribArray(this.index),this.instanceDivisor>0&&o.glVertexAttribDivisor(r,0)};else{switch(c.componentsPerAttribute){case 1:c.vertexAttrib=function(e){e.vertexAttrib1fv(this.index,this.value)};break;case 2:c.vertexAttrib=function(e){e.vertexAttrib2fv(this.index,this.value)};break;case 3:c.vertexAttrib=function(e){e.vertexAttrib3fv(this.index,this.value)};break;case 4:c.vertexAttrib=function(e){e.vertexAttrib4fv(this.index,this.value)}}c.disableVertexAttribArray=function(e){}}t.push(c)}function Ec(t,n,r){for(var i=0;i<n.length;++i){var o=n[i];o.enabled&&o.vertexAttrib(t)}e(r)&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r._getBuffer())}function xc(t){var n,r,o=(t=i(t,i.EMPTY_OBJECT)).context,a=o._gl,s=t.attributes,u=t.indexBuffer,c=[],l=1,h=!1,d=!1,f=s.length;for(n=0;n<f;++n)Tc(c,s[n],n,o);for(f=c.length,n=0;n<f;++n){var m=c[n];if(e(m.vertexBuffer)&&0===m.instanceDivisor){var p=m.strideInBytes||m.componentsPerAttribute*xn.getSizeInBytes(m.componentDatatype);l=m.vertexBuffer.sizeInBytes/p;break}}for(n=0;n<f;++n)c[n].instanceDivisor>0&&(h=!0),e(c[n].value)&&(d=!0);o.vertexArrayObject&&(r=o.glCreateVertexArray(),o.glBindVertexArray(r),Ec(a,c,u),o.glBindVertexArray(null)),this._numberOfVertices=l,this._hasInstancedAttributes=h,this._hasConstantAttributes=d,this._context=o,this._gl=a,this._vao=r,this._attributes=c,this._indexBuffer=u}function Cc(e){return e.values.length/e.componentsPerAttribute}function Sc(e){return xn.getSizeInBytes(e.componentDatatype)*e.componentsPerAttribute}function Ac(t,n,r,o){var a=Ac._verifyAttributes(n);r=i(r,0);for(var s,u,c=[],l={},h=a.length,d=0;d<h;++d){var f=a[d];f.vertexBuffer?c.push(f):(e(s=l[u=f.usage])||(s=l[u]=[]),s.push(f))}function m(e,t){return xn.getSizeInBytes(t.componentDatatype)-xn.getSizeInBytes(e.componentDatatype)}for(u in this._allBuffers=[],l)if(l.hasOwnProperty(u)){(s=l[u]).sort(m);var p=Ac._vertexSizeInBytes(s),_={vertexSizeInBytes:p,vertexBuffer:void 0,usage:s[0].usage,needsCommit:!1,arrayBuffer:void 0,arrayViews:Ac._createArrayViews(s,p)};this._allBuffers.push(_)}this._size=0,this._instanced=i(o,!1),this._precreated=c,this._context=t,this.writers=void 0,this.va=void 0,this.resize(r)}cc._textureCoordinateRotationPoints=function(e,t,n,r){var i,o=Oe.center(r,lc),a=N.toCartesian(o,n,hc),s=ka.eastNorthUpToFixedFrame(a,n,dc),u=ye.inverse(s,dc),l=mc,h=fc;h[0].longitude=r.west,h[0].latitude=r.south,h[1].longitude=r.west,h[1].latitude=r.north,h[2].longitude=r.east,h[2].latitude=r.south;var d=_c;for(i=0;i<3;i++)N.toCartesian(h[i],n,d),d=ye.multiplyByPointAsVector(u,d,d),l[i].x=d.x,l[i].y=d.y;var f=Nr.fromAxisAngle(p.UNIT_Z,-t,gc),m=$.fromQuaternion(f,vc),_=e.length,g=Number.POSITIVE_INFINITY,v=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,T=Number.NEGATIVE_INFINITY;for(i=0;i<_;i++)d=ye.multiplyByPointAsVector(u,e[i],d),d=$.multiplyByVector(m,d,d),g=Math.min(g,d.x),v=Math.min(v,d.y),y=Math.max(y,d.x),T=Math.max(T,d.y);var E=uu.fromRotation(t,yc),x=pc;x[0].x=g,x[0].y=v,x[1].x=g,x[1].y=T,x[2].x=y,x[2].y=v;var C=l[0],S=l[2].x-C.x,A=l[1].y-C.y;for(i=0;i<3;i++){var w=x[i];uu.multiplyByVector(E,w,w),w.x=(w.x-C.x)/S,w.y=(w.y-C.y)/A}var b=x[0],D=x[1],I=x[2],R=new Array(6);return c.pack(b,R),c.pack(D,R,2),c.pack(I,R,4),R},xc.fromGeometry=function(t){var n,r,o,s,u=(t=i(t,i.EMPTY_OBJECT)).context,c=i(t.geometry,i.EMPTY_OBJECT),l=i(t.bufferUsage,ws.DYNAMIC_DRAW),h=i(t.attributeLocations,i.EMPTY_OBJECT),d=i(t.interleave,!1),f=t.vertexArrayAttributes,m=e(f)?f:[],p=c.attributes;if(d){var _=function(t){var n,r,i,o,a=[];for(r in t)t.hasOwnProperty(r)&&e(t[r])&&e(t[r].values)&&(a.push(r),t[r].componentDatatype===xn.DOUBLE&&(t[r].componentDatatype=xn.FLOAT,t[r].values=xn.createTypedArray(xn.FLOAT,t[r].values)));var s=a.length;if(s>0)for(o=Cc(t[a[0]]),n=1;n<s;++n){var u=Cc(t[a[n]]);if(u!==o)throw new ve("Each attribute list must have the same number of vertices.  Attribute "+a[n]+" has a different number of vertices ("+u.toString()+") than attribute "+a[0]+" ("+o.toString()+").")}a.sort((function(e,n){return xn.getSizeInBytes(t[n].componentDatatype)-xn.getSizeInBytes(t[e].componentDatatype)}));var c=0,l={};for(n=0;n<s;++n)r=a[n],i=t[r],l[r]=c,c+=Sc(i);if(c>0){var h=xn.getSizeInBytes(t[a[0]].componentDatatype),d=c%h;0!==d&&(c+=h-d);var f=new ArrayBuffer(o*c),m={};for(n=0;n<s;++n){r=a[n];var p=xn.getSizeInBytes(t[r].componentDatatype);m[r]={pointer:xn.createTypedArray(t[r].componentDatatype,f),index:l[r]/p,strideInComponentType:c/p}}for(n=0;n<o;++n)for(var _=0;_<s;++_){r=a[_];for(var g=(i=t[r]).values,v=m[r],y=v.pointer,T=i.componentsPerAttribute,E=0;E<T;++E)y[v.index+E]=g[n*T+E];v.index+=v.strideInComponentType}return{buffer:f,offsetsInBytes:l,vertexSizeInBytes:c}}}(p);if(e(_)){o=bs.createVertexBuffer({context:u,typedArray:_.buffer,usage:l});var g=_.offsetsInBytes,v=_.vertexSizeInBytes;for(n in p)p.hasOwnProperty(n)&&e(p[n])&&(e((r=p[n]).values)?m.push({index:h[n],vertexBuffer:o,componentDatatype:r.componentDatatype,componentsPerAttribute:r.componentsPerAttribute,normalize:r.normalize,offsetInBytes:g[n],strideInBytes:v}):m.push({index:h[n],value:r.value,componentDatatype:r.componentDatatype,normalize:r.normalize}))}}else for(n in p)if(p.hasOwnProperty(n)&&e(p[n])){var y=(r=p[n]).componentDatatype;y===xn.DOUBLE&&(y=xn.FLOAT),o=void 0,e(r.values)&&(o=bs.createVertexBuffer({context:u,typedArray:xn.createTypedArray(y,r.values),usage:l})),m.push({index:h[n],vertexBuffer:o,value:r.value,componentDatatype:y,componentsPerAttribute:r.componentsPerAttribute,normalize:r.normalize})}var T=c.indices;return e(T)&&(s=cc.computeNumberOfVertices(c)>=a.SIXTY_FOUR_KILOBYTES&&u.elementIndexUint?bs.createIndexBuffer({context:u,typedArray:new Uint32Array(T),usage:l,indexDatatype:Dn.UNSIGNED_INT}):bs.createIndexBuffer({context:u,typedArray:new Uint16Array(T),usage:l,indexDatatype:Dn.UNSIGNED_SHORT})),new xc({context:u,attributes:m,indexBuffer:s})},Object.defineProperties(xc.prototype,{numberOfAttributes:{get:function(){return this._attributes.length}},numberOfVertices:{get:function(){return this._numberOfVertices}},indexBuffer:{get:function(){return this._indexBuffer}}}),xc.prototype.getAttribute=function(e){return this._attributes[e]},xc.prototype._bind=function(){e(this._vao)?(this._context.glBindVertexArray(this._vao),this._context.instancedArrays&&function(e){var t=e._context,n=e._hasInstancedAttributes;if(n||t._previousDrawInstanced){t._previousDrawInstanced=n;var r,i=t._vertexAttribDivisors,o=e._attributes,a=Ds.maximumVertexAttributes;if(n){var s=o.length;for(r=0;r<s;++r){var u=o[r];if(u.enabled){var c=u.instanceDivisor,l=u.index;c!==i[l]&&(t.glVertexAttribDivisor(l,c),i[l]=c)}}}else for(r=0;r<a;++r)i[r]>0&&(t.glVertexAttribDivisor(r,0),i[r]=0)}}(this),this._hasConstantAttributes&&function(t,n){for(var r=t._attributes,i=r.length,o=0;o<i;++o){var a=r[o];a.enabled&&e(a.value)&&a.vertexAttrib(n)}}(this,this._gl)):Ec(this._gl,this._attributes,this._indexBuffer)},xc.prototype._unBind=function(){if(e(this._vao))this._context.glBindVertexArray(null);else{for(var t=this._attributes,n=this._gl,r=0;r<t.length;++r){var i=t[r];i.enabled&&i.disableVertexAttribArray(n)}this._indexBuffer&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}},xc.prototype.isDestroyed=function(){return!1},xc.prototype.destroy=function(){for(var t=this._attributes,n=0;n<t.length;++n){var r=t[n].vertexBuffer;e(r)&&!r.isDestroyed()&&r.vertexArrayDestroyable&&r.destroy()}var i=this._indexBuffer;return e(i)&&!i.isDestroyed()&&i.vertexArrayDestroyable&&i.destroy(),e(this._vao)&&this._context.glDeleteVertexArray(this._vao),hi(this)},Ac._verifyAttributes=function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n],o={index:i(r.index,n),enabled:i(r.enabled,!0),componentsPerAttribute:r.componentsPerAttribute,componentDatatype:i(r.componentDatatype,xn.FLOAT),normalize:i(r.normalize,!1),vertexBuffer:r.vertexBuffer,usage:i(r.usage,ws.STATIC_DRAW)};t.push(o)}for(var a=new Array(t.length),s=0;s<t.length;++s){a[t[s].index]=!0}return t},Ac._vertexSizeInBytes=function(e){for(var t=0,n=e.length,r=0;r<n;++r){var i=e[r];t+=i.componentsPerAttribute*xn.getSizeInBytes(i.componentDatatype)}var o=n>0?xn.getSizeInBytes(e[0].componentDatatype):0,a=o>0?t%o:0;return t+=0===a?0:o-a},Ac._createArrayViews=function(e,t){for(var n=[],r=0,i=e.length,o=0;o<i;++o){var a=e[o],s=a.componentDatatype;n.push({index:a.index,enabled:a.enabled,componentsPerAttribute:a.componentsPerAttribute,componentDatatype:s,normalize:a.normalize,offsetInBytes:r,vertexSizeInComponentType:t/xn.getSizeInBytes(s),view:void 0}),r+=a.componentsPerAttribute*xn.getSizeInBytes(s)}return n},Ac.prototype.resize=function(e){this._size=e;var t=this._allBuffers;this.writers=[];for(var n=0,r=t.length;n<r;++n){var i=t[n];Ac._resize(i,this._size),Ac._appendWriters(this.writers,i)}Ic(this)},Ac._resize=function(t,n){if(t.vertexSizeInBytes>0){var r=new ArrayBuffer(n*t.vertexSizeInBytes);if(e(t.arrayBuffer))for(var i=new Uint8Array(r),o=new Uint8Array(t.arrayBuffer),a=o.length,s=0;s<a;++s)i[s]=o[s];for(var u=t.arrayViews,c=u.length,l=0;l<c;++l){var h=u[l];h.view=xn.createArrayBufferView(h.componentDatatype,r,h.offsetInBytes)}t.arrayBuffer=r}};var wc=[function(e,t,n){return function(r,i){t[r*n]=i,e.needsCommit=!0}},function(e,t,n){return function(r,i,o){var a=r*n;t[a]=i,t[a+1]=o,e.needsCommit=!0}},function(e,t,n){return function(r,i,o,a){var s=r*n;t[s]=i,t[s+1]=o,t[s+2]=a,e.needsCommit=!0}},function(e,t,n){return function(r,i,o,a,s){var u=r*n;t[u]=i,t[u+1]=o,t[u+2]=a,t[u+3]=s,e.needsCommit=!0}}];function bc(t,n){if(n.needsCommit&&n.vertexSizeInBytes>0){n.needsCommit=!1;var r=n.vertexBuffer,i=t._size*n.vertexSizeInBytes,o=e(r);if(!o||r.sizeInBytes<i)return o&&r.destroy(),n.vertexBuffer=bs.createVertexBuffer({context:t._context,typedArray:n.arrayBuffer,usage:n.usage}),n.vertexBuffer.vertexArrayDestroyable=!1,!0;n.vertexBuffer.copyFromArrayView(n.arrayBuffer)}return!1}function Dc(e,t,n){if(e.needsCommit&&e.vertexSizeInBytes>0){var r=e.vertexSizeInBytes*t,i=e.vertexSizeInBytes*n;e.vertexBuffer.copyFromArrayView(new Uint8Array(e.arrayBuffer,r,i),r)}}function Ic(t){var n=t.va;if(e(n)){for(var r=n.length,i=0;i<r;++i)n[i].va.destroy();t.va=void 0}}Ac._appendWriters=function(e,t){for(var n=t.arrayViews,r=n.length,i=0;i<r;++i){var o=n[i];e[o.index]=wc[o.componentsPerAttribute-1](t,o.view,o.vertexSizeInComponentType)}},Ac.prototype.commit=function(t){var n,r,i,o=!1,s=this._allBuffers;for(r=0,i=s.length;r<i;++r)o=bc(this,n=s[r])||o;if(o||!e(this.va)){Ic(this);for(var u=this.va=[],c=a.SIXTY_FOUR_KILOBYTES-4,l=e(t)&&!this._instanced?Math.ceil(this._size/c):1,h=0;h<l;++h){var d=[];for(r=0,i=s.length;r<i;++r){var f=h*((n=s[r]).vertexSizeInBytes*c);Ac._appendAttributes(d,n,f,this._instanced)}d=d.concat(this._precreated),u.push({va:new xc({context:this._context,attributes:d,indexBuffer:t}),indicesCount:1.5*(h!==l-1?c:this._size%c)})}}},Ac._appendAttributes=function(e,t,n,r){for(var i=t.arrayViews,o=i.length,a=0;a<o;++a){var s=i[a];e.push({index:s.index,enabled:s.enabled,componentsPerAttribute:s.componentsPerAttribute,componentDatatype:s.componentDatatype,normalize:s.normalize,vertexBuffer:t.vertexBuffer,offsetInBytes:n+s.offsetInBytes,strideInBytes:t.vertexSizeInBytes,instanceDivisor:r?1:0})}},Ac.prototype.subCommit=function(e,t){for(var n=this._allBuffers,r=0,i=n.length;r<i;++r)Dc(n[r],e,t)},Ac.prototype.endSubCommits=function(){for(var e=this._allBuffers,t=0,n=e.length;t<n;++t)e[t].needsCommit=!1},Ac.prototype.isDestroyed=function(){return!1},Ac.prototype.destroy=function(){for(var e=this._allBuffers,t=0,n=e.length;t<n;++t){var r=e[t];r.vertexBuffer=r.vertexBuffer&&r.vertexBuffer.destroy()}return Ic(this),hi(this)};var Rc=0,Pc={};function Oc(t,n){var r,o=t;e(Pc[o])?r=Pc[o]:(r=Rc++,Pc[o]=r),n=i(n,!1),this._id=r,this._html=t,this._showOnScreen=n,this._element=void 0}function Nc(e){this._ellipsoid=i(e,H.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis}function Mc(t){if(t=i(t,i.EMPTY_OBJECT),this._ellipsoid=i(t.ellipsoid,H.WGS84),this._numberOfLevelZeroTilesX=i(t.numberOfLevelZeroTilesX,1),this._numberOfLevelZeroTilesY=i(t.numberOfLevelZeroTilesY,1),this._projection=new Nc(this._ellipsoid),e(t.rectangleSouthwestInMeters)&&e(t.rectangleNortheastInMeters))this._rectangleSouthwestInMeters=t.rectangleSouthwestInMeters,this._rectangleNortheastInMeters=t.rectangleNortheastInMeters;else{var n=this._ellipsoid.maximumRadius*Math.PI;this._rectangleSouthwestInMeters=new c(-n,-n),this._rectangleNortheastInMeters=new c(n,n)}var r=this._projection.unproject(this._rectangleSouthwestInMeters),o=this._projection.unproject(this._rectangleNortheastInMeters);this._rectangle=new Oe(r.longitude,r.latitude,o.longitude,o.latitude)}function Lc(e,t,n,r){this._format=e,this._width=t,this._height=n,this._buffer=r}function Fc(){if(!e(Gc._canTransferArrayBuffer)){var t=new Worker(Vc("Workers/transferTypedArrayTest.js"));t.postMessage=i(t.webkitPostMessage,t.postMessage);var n=new Int8Array([99]);try{t.postMessage({array:n},[n.buffer])}catch(o){return Gc._canTransferArrayBuffer=!1,Gc._canTransferArrayBuffer}var r=Et.defer();t.onmessage=function(n){var i=n.data.array,o=e(i)&&99===i[0];r.resolve(o),t.terminate(),Gc._canTransferArrayBuffer=o},Gc._canTransferArrayBuffer=r.promise}return Gc._canTransferArrayBuffer}Object.defineProperties(Oc.prototype,{html:{get:function(){return this._html}},id:{get:function(){return this._id}},showOnScreen:{get:function(){return this._showOnScreen}},element:{get:function(){if(!e(this._element)){var t=this._html,n=document.createElement("div");n._creditId=this._id,n.style.display="inline",n.innerHTML=t;for(var r=n.querySelectorAll("a"),i=0;i<r.length;i++)r[i].setAttribute("target","_blank");this._element=n}return this._element}}}),Oc.equals=function(t,n){return t===n||e(t)&&e(n)&&t._id===n._id},Oc.prototype.equals=function(e){return Oc.equals(this,e)},Oc.getIonCredit=function(t){var n=e(t.collapsible)&&!t.collapsible,r=new Oc(t.html,n);return r._isIon=-1!==r.html.indexOf("ion-credit.png"),r},Oc.clone=function(t){if(e(t))return new Oc(t.html,t.showOnScreen)},Object.defineProperties(Nc.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),Nc.mercatorAngleToGeodeticLatitude=function(e){return a.PI_OVER_TWO-2*Math.atan(Math.exp(-e))},Nc.geodeticLatitudeToMercatorAngle=function(e){e>Nc.MaximumLatitude?e=Nc.MaximumLatitude:e<-Nc.MaximumLatitude&&(e=-Nc.MaximumLatitude);var t=Math.sin(e);return.5*Math.log((1+t)/(1-t))},Nc.MaximumLatitude=Nc.mercatorAngleToGeodeticLatitude(Math.PI),Nc.prototype.project=function(t,n){var r=this._semimajorAxis,i=t.longitude*r,o=Nc.geodeticLatitudeToMercatorAngle(t.latitude)*r,a=t.height;return e(n)?(n.x=i,n.y=o,n.z=a,n):new p(i,o,a)},Nc.prototype.unproject=function(t,n){var r=this._oneOverSemimajorAxis,i=t.x*r,o=Nc.mercatorAngleToGeodeticLatitude(t.y*r),a=t.z;return e(n)?(n.longitude=i,n.latitude=o,n.height=a,n):new N(i,o,a)},Object.defineProperties(Mc.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),Mc.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},Mc.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},Mc.prototype.rectangleToNativeRectangle=function(t,n){var r=this._projection,i=r.project(Oe.southwest(t)),o=r.project(Oe.northeast(t));return e(n)?(n.west=i.x,n.south=i.y,n.east=o.x,n.north=o.y,n):new Oe(i.x,i.y,o.x,o.y)},Mc.prototype.tileXYToNativeRectangle=function(t,n,r,i){var o=this.getNumberOfXTilesAtLevel(r),a=this.getNumberOfYTilesAtLevel(r),s=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/o,u=this._rectangleSouthwestInMeters.x+t*s,c=this._rectangleSouthwestInMeters.x+(t+1)*s,l=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/a,h=this._rectangleNortheastInMeters.y-n*l,d=this._rectangleNortheastInMeters.y-(n+1)*l;return e(i)?(i.west=u,i.south=d,i.east=c,i.north=h,i):new Oe(u,d,c,h)},Mc.prototype.tileXYToRectangle=function(e,t,n,r){var i=this.tileXYToNativeRectangle(e,t,n,r),o=this._projection,a=o.unproject(new c(i.west,i.south)),s=o.unproject(new c(i.east,i.north));return i.west=a.longitude,i.south=a.latitude,i.east=s.longitude,i.north=s.latitude,i},Mc.prototype.positionToTileXY=function(t,n,r){var i=this._rectangle;if(Oe.contains(i,t)){var o=this.getNumberOfXTilesAtLevel(n),a=this.getNumberOfYTilesAtLevel(n),s=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/o,u=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/a,l=this._projection.project(t),h=(l.x-this._rectangleSouthwestInMeters.x)/s|0;h>=o&&(h=o-1);var d=(this._rectangleNortheastInMeters.y-l.y)/u|0;return d>=a&&(d=a-1),e(r)?(r.x=h,r.y=d,r):new c(h,d)}},Object.defineProperties(Lc.prototype,{internalFormat:{get:function(){return this._format}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},bufferView:{get:function(){return this._buffer}}}),Lc.clone=function(t){if(e(t))return new Lc(t._format,t._width,t._height,t._buffer)},Lc.prototype.clone=function(){return Lc.clone(this)};var zc,Bc=new qo;function Uc(n,r){--n._activeTasks;var i=r.id;if(e(i)){var o=n._deferreds,a=o[i];if(e(r.error)){var s=r.error;"RuntimeError"===s.name?(s=new ve(r.error.message)).stack=r.error.stack:"DeveloperError"===s.name&&((s=new t(r.error.message)).stack=r.error.stack),Bc.raiseEvent(s),a.reject(s)}else Bc.raiseEvent(),a.resolve(r.result);delete o[i]}}function Vc(e){var t=za(e);if(Bo(t)){var n,r='importScripts("'+t+'");';try{n=new Blob([r],{type:"application/javascript"})}catch(o){var i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);i.append(r),n=i.getBlob("application/javascript")}t=(window.URL||window.webkitURL).createObjectURL(n)}return t}function Hc(t){var n=new Worker((e(zc)||(zc=Vc("Workers/cesiumWorkerBootstrapper.js")),zc));n.postMessage=i(n.webkitPostMessage,n.postMessage);var r={loaderConfig:{paths:{Workers:za("Workers")},baseUrl:za.getCesiumBaseUrl().url},workerModule:Gc._workerModulePrefix+t._workerName};return n.postMessage(r),n.onmessage=function(e){Uc(t,e.data)},n}function Gc(e,t){this._workerName=e,this._maximumActiveTasks=i(t,5),this._activeTasks=0,this._deferreds={},this._nextID=0}var kc=[];Gc.prototype.scheduleTask=function(t,n){if(e(this._worker)||(this._worker=Hc(this)),!(this._activeTasks>=this._maximumActiveTasks)){++this._activeTasks;var r=this;return Et(Fc(),(function(i){e(n)?i||(n.length=0):n=kc;var o=r._nextID++,a=Et.defer();return r._deferreds[o]=a,r._worker.postMessage({id:o,parameters:t,canTransferArrayBuffer:i},n),a.promise}))}},Gc.prototype.initWebAssemblyModule=function(t){e(this._worker)||(this._worker=Hc(this));var n=Et.defer(),r=this,i=this._worker;return function(t,n){var r={modulePath:void 0,wasmBinaryFile:void 0,wasmBinary:void 0};if(!fn.supportsWebAssembly()){if(!e(n.fallbackModulePath))throw new ve("This browser does not support Web Assembly, and no backup module was provided for "+t._workerName);return r.modulePath=za(n.fallbackModulePath),Et.resolve(r)}return r.modulePath=za(n.modulePath),r.wasmBinaryFile=za(n.wasmBinaryFile),ga.fetchArrayBuffer({url:r.wasmBinaryFile}).then((function(e){return r.wasmBinary=e,r}))}(this,t).then((function(t){return Et(Fc(),(function(o){var a,s=t.wasmBinary;e(s)&&o&&(a=[s]),i.onmessage=function(e){i.onmessage=function(e){Uc(r,e.data)},n.resolve(e.data)},i.postMessage({webAssemblyConfig:t},a)}))})),n},Gc.prototype.isDestroyed=function(){return!1},Gc.prototype.destroy=function(){return e(this._worker)&&this._worker.terminate(),hi(this)},Gc.taskCompletedEvent=Bc,Gc._defaultWorkerModulePrefix="Workers/",Gc._workerModulePrefix=Gc._defaultWorkerModulePrefix,Gc._canTransferArrayBuffer=void 0;var Wc=new Gc("transcodeCRNToDXT",Number.POSITIVE_INFINITY);var qc={UNSIGNED_BYTE:Tn.UNSIGNED_BYTE,UNSIGNED_SHORT:Tn.UNSIGNED_SHORT,UNSIGNED_INT:Tn.UNSIGNED_INT,FLOAT:Tn.FLOAT,HALF_FLOAT:Tn.HALF_FLOAT_OES,UNSIGNED_INT_24_8:Tn.UNSIGNED_INT_24_8,UNSIGNED_SHORT_4_4_4_4:Tn.UNSIGNED_SHORT_4_4_4_4,UNSIGNED_SHORT_5_5_5_1:Tn.UNSIGNED_SHORT_5_5_5_1,UNSIGNED_SHORT_5_6_5:Tn.UNSIGNED_SHORT_5_6_5,toWebGLConstant:function(e,t){switch(e){case qc.UNSIGNED_BYTE:return Tn.UNSIGNED_BYTE;case qc.UNSIGNED_SHORT:return Tn.UNSIGNED_SHORT;case qc.UNSIGNED_INT:return Tn.UNSIGNED_INT;case qc.FLOAT:return Tn.FLOAT;case qc.HALF_FLOAT:return t.webgl2?Tn.HALF_FLOAT:Tn.HALF_FLOAT_OES;case qc.UNSIGNED_INT_24_8:return Tn.UNSIGNED_INT_24_8;case qc.UNSIGNED_SHORT_4_4_4_4:return Tn.UNSIGNED_SHORT_4_4_4_4;case qc.UNSIGNED_SHORT_5_5_5_1:return Tn.UNSIGNED_SHORT_5_5_5_1;case qc.UNSIGNED_SHORT_5_6_5:return qc.UNSIGNED_SHORT_5_6_5}},isPacked:function(e){return e===qc.UNSIGNED_INT_24_8||e===qc.UNSIGNED_SHORT_4_4_4_4||e===qc.UNSIGNED_SHORT_5_5_5_1||e===qc.UNSIGNED_SHORT_5_6_5},sizeInBytes:function(e){switch(e){case qc.UNSIGNED_BYTE:return 1;case qc.UNSIGNED_SHORT:case qc.UNSIGNED_SHORT_4_4_4_4:case qc.UNSIGNED_SHORT_5_5_5_1:case qc.UNSIGNED_SHORT_5_6_5:case qc.HALF_FLOAT:return 2;case qc.UNSIGNED_INT:case qc.FLOAT:case qc.UNSIGNED_INT_24_8:return 4}},validate:function(e){return e===qc.UNSIGNED_BYTE||e===qc.UNSIGNED_SHORT||e===qc.UNSIGNED_INT||e===qc.FLOAT||e===qc.HALF_FLOAT||e===qc.UNSIGNED_INT_24_8||e===qc.UNSIGNED_SHORT_4_4_4_4||e===qc.UNSIGNED_SHORT_5_5_5_1||e===qc.UNSIGNED_SHORT_5_6_5}},Yc=Object.freeze(qc),jc={DEPTH_COMPONENT:Tn.DEPTH_COMPONENT,DEPTH_STENCIL:Tn.DEPTH_STENCIL,ALPHA:Tn.ALPHA,RGB:Tn.RGB,RGBA:Tn.RGBA,LUMINANCE:Tn.LUMINANCE,LUMINANCE_ALPHA:Tn.LUMINANCE_ALPHA,RGB_DXT1:Tn.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:Tn.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:Tn.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:Tn.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:Tn.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:Tn.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,RGBA_PVRTC_4BPPV1:Tn.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:Tn.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGB_ETC1:Tn.COMPRESSED_RGB_ETC1_WEBGL,componentsLength:function(e){switch(e){case jc.RGB:return 3;case jc.RGBA:return 4;case jc.LUMINANCE_ALPHA:return 2;case jc.ALPHA:case jc.LUMINANCE:default:return 1}},validate:function(e){return e===jc.DEPTH_COMPONENT||e===jc.DEPTH_STENCIL||e===jc.ALPHA||e===jc.RGB||e===jc.RGBA||e===jc.LUMINANCE||e===jc.LUMINANCE_ALPHA||e===jc.RGB_DXT1||e===jc.RGBA_DXT1||e===jc.RGBA_DXT3||e===jc.RGBA_DXT5||e===jc.RGB_PVRTC_4BPPV1||e===jc.RGB_PVRTC_2BPPV1||e===jc.RGBA_PVRTC_4BPPV1||e===jc.RGBA_PVRTC_2BPPV1||e===jc.RGB_ETC1},isColorFormat:function(e){return e===jc.ALPHA||e===jc.RGB||e===jc.RGBA||e===jc.LUMINANCE||e===jc.LUMINANCE_ALPHA},isDepthFormat:function(e){return e===jc.DEPTH_COMPONENT||e===jc.DEPTH_STENCIL},isCompressedFormat:function(e){return e===jc.RGB_DXT1||e===jc.RGBA_DXT1||e===jc.RGBA_DXT3||e===jc.RGBA_DXT5||e===jc.RGB_PVRTC_4BPPV1||e===jc.RGB_PVRTC_2BPPV1||e===jc.RGBA_PVRTC_4BPPV1||e===jc.RGBA_PVRTC_2BPPV1||e===jc.RGB_ETC1},isDXTFormat:function(e){return e===jc.RGB_DXT1||e===jc.RGBA_DXT1||e===jc.RGBA_DXT3||e===jc.RGBA_DXT5},isPVRTCFormat:function(e){return e===jc.RGB_PVRTC_4BPPV1||e===jc.RGB_PVRTC_2BPPV1||e===jc.RGBA_PVRTC_4BPPV1||e===jc.RGBA_PVRTC_2BPPV1},isETC1Format:function(e){return e===jc.RGB_ETC1},compressedTextureSizeInBytes:function(e,t,n){switch(e){case jc.RGB_DXT1:case jc.RGBA_DXT1:case jc.RGB_ETC1:return Math.floor((t+3)/4)*Math.floor((n+3)/4)*8;case jc.RGBA_DXT3:case jc.RGBA_DXT5:return Math.floor((t+3)/4)*Math.floor((n+3)/4)*16;case jc.RGB_PVRTC_4BPPV1:case jc.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(t,8)*Math.max(n,8)*4+7)/8);case jc.RGB_PVRTC_2BPPV1:case jc.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(t,16)*Math.max(n,8)*2+7)/8);default:return 0}},textureSizeInBytes:function(e,t,n,r){var i=jc.componentsLength(e);return Yc.isPacked(t)&&(i=1),i*Yc.sizeInBytes(t)*n*r},alignmentInBytes:function(e,t,n){var r=jc.textureSizeInBytes(e,t,n,1)%4;return 0===r?4:2===r?2:1},createTypedArray:function(e,t,n,r){var i=Yc.sizeInBytes(t);return new(i===Uint8Array.BYTES_PER_ELEMENT?Uint8Array:i===Uint16Array.BYTES_PER_ELEMENT?Uint16Array:i===Float32Array.BYTES_PER_ELEMENT&&t===Yc.FLOAT?Float32Array:Uint32Array)(jc.componentsLength(e)*n*r)},flipY:function(e,t,n,r,i){if(1===i)return e;for(var o=jc.createTypedArray(t,n,r,i),a=jc.componentsLength(t),s=r*a,u=0;u<i;++u)for(var c=u*r*a,l=(i-u-1)*r*a,h=0;h<s;++h)o[l+h]=e[c+h];return o},toInternalFormat:function(e,t,n){if(!n.webgl2)return e;if(e===jc.DEPTH_STENCIL)return Tn.DEPTH24_STENCIL8;if(e===jc.DEPTH_COMPONENT){if(t===Yc.UNSIGNED_SHORT)return Tn.DEPTH_COMPONENT16;if(t===Yc.UNSIGNED_INT)return Tn.DEPTH_COMPONENT24}if(t===Yc.FLOAT)switch(e){case jc.RGBA:return Tn.RGBA32F;case jc.RGB:return Tn.RGB32F;case jc.RG:return Tn.RG32F;case jc.R:return Tn.R32F}if(t===Yc.HALF_FLOAT)switch(e){case jc.RGBA:return Tn.RGBA16F;case jc.RGB:return Tn.RGB16F;case jc.RG:return Tn.RG16F;case jc.R:return Tn.R16F}return e}},Xc=Object.freeze(jc);function Zc(t){var n;t instanceof ArrayBuffer||ArrayBuffer.isView(t)?n=Et.resolve(t):n=ga.createIfNeeded(t).fetchArrayBuffer();if(e(n))return n.then((function(t){if(e(t))return function(t){var n,r,i,o=new Uint8Array(t),a=!0;for(n=0;n<Kc.length;++n)if(Kc[n]!==o[n]){a=!1;break}if(!a)throw new ve("Invalid KTX file.");e(t.buffer)?(r=new DataView(t.buffer),i=t.byteOffset):(r=new DataView(t),i=0);i+=12;var s=r.getUint32(i,!0);if(i+=4,67305985!==s)throw new ve("File is the wrong endianness.");var u=r.getUint32(i,!0);i+=4;var c=r.getUint32(i,!0);i+=4;var l=r.getUint32(i,!0);i+=4;var h=r.getUint32(i,!0);i+=4;var d=r.getUint32(i,!0);i+=4;var f=r.getUint32(i,!0);i+=4;var m=r.getUint32(i,!0);i+=4;var p=r.getUint32(i,!0);i+=4;var _=r.getUint32(i,!0);i+=4;var g=r.getUint32(i,!0);i+=4;var v=r.getUint32(i,!0);i+=4;var y=r.getUint32(i,!0);i+=4,i+=y;var T,E=r.getUint32(i,!0);i+=4,T=e(t.buffer)?new Uint8Array(t.buffer,i,E):new Uint8Array(t,i,E);h===Tn.RGB8?h=Xc.RGB:h===Tn.RGBA8&&(h=Xc.RGBA);if(!Xc.validate(h))throw new ve("glInternalFormat is not a valid format.");if(Xc.isCompressedFormat(h)){if(0!==u)throw new ve("glType must be zero when the texture is compressed.");if(1!==c)throw new ve("The type size for compressed textures must be 1.");if(0!==l)throw new ve("glFormat must be zero when the texture is compressed.")}else{if(u!==Tn.UNSIGNED_BYTE)throw new ve("Only unsigned byte buffers are supported.");if(d!==l)throw new ve("The base internal format must be the same as the format for uncompressed textures.")}if(0!==p)throw new ve("3D textures are unsupported.");if(0!==_)throw new ve("Texture arrays are unsupported.");var x=T.byteOffset,C=new Array(v);for(n=0;n<v;++n){for(var S=C[n]={},A=0;A<g;++A){var w=f>>n,b=m>>n,D=Xc.isCompressedFormat(h)?Xc.compressedTextureSizeInBytes(h,w,b):Xc.textureSizeInBytes(h,u,w,b),I=new Uint8Array(T.buffer,x,D);S[Qc[A]]=new Lc(h,w,b,I),x+=D}x+=3-(x+3)%4+4}var R=C;if(1===g)for(n=0;n<v;++n)R[n]=R[n][Qc[0]];1===v&&(R=R[0]);return R}(t)}))}var Kc=[171,75,84,88,32,49,49,187,13,10,26,10],Qc=["positiveX","negativeX","positiveY","negativeY","positiveZ","negativeZ"];function Jc(){this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0,t.throwInstantiationError()}Object.defineProperties(Jc.prototype,{ready:{get:t.throwInstantiationError},readyPromise:{get:t.throwInstantiationError},rectangle:{get:t.throwInstantiationError},tileWidth:{get:t.throwInstantiationError},tileHeight:{get:t.throwInstantiationError},maximumLevel:{get:t.throwInstantiationError},minimumLevel:{get:t.throwInstantiationError},tilingScheme:{get:t.throwInstantiationError},tileDiscardPolicy:{get:t.throwInstantiationError},errorEvent:{get:t.throwInstantiationError},credit:{get:t.throwInstantiationError},proxy:{get:t.throwInstantiationError},hasAlphaChannel:{get:t.throwInstantiationError}}),Jc.prototype.getTileCredits=function(e,n,r){t.throwInstantiationError()},Jc.prototype.requestImage=function(e,n,r,i){t.throwInstantiationError()},Jc.prototype.pickFeatures=function(e,n,r,i,o){t.throwInstantiationError()};var $c=/\.ktx$/i,el=/\.crn$/i;Jc.loadImage=function(t,n){var r=ga.createIfNeeded(n);return $c.test(r.url)?Zc(r):el.test(r.url)?function(t){var n;if(e(n=t instanceof ArrayBuffer||ArrayBuffer.isView(t)?Et.resolve(t):ga.createIfNeeded(t).fetchArrayBuffer()))return n.then((function(t){if(e(t)){var n=[];return t instanceof ArrayBuffer?n.push(t):(0===t.byteOffset&&t.byteLength===t.buffer.byteLength||(t=t.slice(0,t.length)),n.push(t.buffer)),Wc.scheduleTask(t,n)}})).then((function(e){return Lc.clone(e)}))}(r):e(t)&&e(t.tileDiscardPolicy)?r.fetchImage({preferBlob:!0,preferImageBitmap:!0,flipY:!0}):r.fetchImage({preferImageBitmap:!0,flipY:!0})};var tl=/{[^}]+}/g,nl={x:function(e,t,n,r){return dl(e,"{x}",t)},y:function(e,t,n,r){return dl(e,"{y}",n)},z:function(e,t,n,r){return dl(e,"{z}",r)},s:function(e,t,n,r){var i=(t+n+r)%e._subdomains.length;return e._subdomains[i]},reverseX:function(e,t,n,r){var i=e.tilingScheme.getNumberOfXTilesAtLevel(r)-t-1;return dl(e,"{reverseX}",i)},reverseY:function(e,t,n,r){var i=e.tilingScheme.getNumberOfYTilesAtLevel(r)-n-1;return dl(e,"{reverseY}",i)},reverseZ:function(t,n,r,i){var o=t.maximumLevel,a=e(o)&&i<o?o-i-1:i;return dl(t,"{reverseZ}",a)},westDegrees:function(e,t,n,r){return fl(e,t,n,r),al.west},southDegrees:function(e,t,n,r){return fl(e,t,n,r),al.south},eastDegrees:function(e,t,n,r){return fl(e,t,n,r),al.east},northDegrees:function(e,t,n,r){return fl(e,t,n,r),al.north},westProjected:function(e,t,n,r){return ml(e,t,n,r),ul.west},southProjected:function(e,t,n,r){return ml(e,t,n,r),ul.south},eastProjected:function(e,t,n,r){return ml(e,t,n,r),ul.east},northProjected:function(e,t,n,r){return ml(e,t,n,r),ul.north},width:function(e,t,n,r){return e.tileWidth},height:function(e,t,n,r){return e.tileHeight}},rl=No(nl,{i:function(e,t,n,r,i,o,a){return gl(e,t,n,r,i,o),ll.x},j:function(e,t,n,r,i,o,a){return gl(e,t,n,r,i,o),ll.y},reverseI:function(e,t,n,r,i,o,a){return gl(e,t,n,r,i,o),e.tileWidth-ll.x-1},reverseJ:function(e,t,n,r,i,o,a){return gl(e,t,n,r,i,o),e.tileHeight-ll.y-1},longitudeDegrees:function(e,t,n,r,i,o,s){return a.toDegrees(i)},latitudeDegrees:function(e,t,n,r,i,o,s){return a.toDegrees(o)},longitudeProjected:function(e,t,n,r,i,o,a){return yl(e,t,n,r,i,o),_l.x},latitudeProjected:function(e,t,n,r,i,o,a){return yl(e,t,n,r,i,o),_l.y},format:function(e,t,n,r,i,o,a){return a}});function il(e){this._errorEvent=new qo,this._resource=void 0,this._urlSchemeZeroPadding=void 0,this._pickFeaturesResource=void 0,this._tileWidth=void 0,this._tileHeight=void 0,this._maximumLevel=void 0,this._minimumLevel=void 0,this._tilingScheme=void 0,this._rectangle=void 0,this._tileDiscardPolicy=void 0,this._credit=void 0,this._hasAlphaChannel=void 0,this._readyPromise=void 0,this._tags=void 0,this._pickFeaturesTags=void 0,this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0,this.enablePickFeatures=!0,this.reinitialize(e)}Object.defineProperties(il.prototype,{url:{get:function(){return this._resource.url}},urlSchemeZeroPadding:{get:function(){return this._urlSchemeZeroPadding}},pickFeaturesUrl:{get:function(){return this._pickFeaturesResource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return this._minimumLevel}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._rectangle}},tileDiscardPolicy:{get:function(){return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return e(this._resource)}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return this._hasAlphaChannel}}}),il.prototype.reinitialize=function(t){var n=this;n._readyPromise=Et(t).then((function(t){var r=t.customTags,o=No(nl,r),a=No(rl,r),s=ga.createIfNeeded(t.url),u=ga.createIfNeeded(t.pickFeaturesUrl);n.enablePickFeatures=i(t.enablePickFeatures,n.enablePickFeatures),n._urlSchemeZeroPadding=i(t.urlSchemeZeroPadding,n.urlSchemeZeroPadding),n._tileDiscardPolicy=t.tileDiscardPolicy,n._getFeatureInfoFormats=t.getFeatureInfoFormats,n._subdomains=t.subdomains,Array.isArray(n._subdomains)?n._subdomains=n._subdomains.slice():e(n._subdomains)&&n._subdomains.length>0?n._subdomains=n._subdomains.split(""):n._subdomains=["a","b","c"],n._tileWidth=i(t.tileWidth,256),n._tileHeight=i(t.tileHeight,256),n._minimumLevel=i(t.minimumLevel,0),n._maximumLevel=t.maximumLevel,n._tilingScheme=i(t.tilingScheme,new Mc({ellipsoid:t.ellipsoid})),n._rectangle=i(t.rectangle,n._tilingScheme.rectangle),n._rectangle=Oe.intersection(n._rectangle,n._tilingScheme.rectangle),n._hasAlphaChannel=i(t.hasAlphaChannel,!0);var c=t.credit;return"string"==typeof c&&(c=new Oc(c)),n._credit=c,n._resource=s,n._tags=o,n._pickFeaturesResource=u,n._pickFeaturesTags=a,!0}))},il.prototype.getTileCredits=function(e,t,n){},il.prototype.requestImage=function(t,n,r,i){return Jc.loadImage(this,function(t,n,r,i,o){ol=!1,sl=!1;var a=t._resource,s=a.getUrlComponent(!0),u=t._tags,c={},l=s.match(tl);e(l)&&l.forEach((function(o){var a=o.substring(1,o.length-1);e(u[a])&&(c[a]=u[a](t,n,r,i))}));return a.getDerivedResource({request:o,templateValues:c})}(this,t,n,r,i))},il.prototype.pickFeatures=function(t,n,r,i,o){if(this.enablePickFeatures&&e(this._pickFeaturesResource)&&0!==this._getFeatureInfoFormats.length){var a=0,s=this;return function c(){if(a>=s._getFeatureInfoFormats.length)return Et([]);var l=s._getFeatureInfoFormats[a],h=function(t,n,r,i,o,a,s){ol=!1,sl=!1,cl=!1,hl=!1;var u=t._pickFeaturesResource,c=u.getUrlComponent(!0),l=t._pickFeaturesTags,h={},d=c.match(tl);e(d)&&d.forEach((function(u){var c=u.substring(1,u.length-1);e(l[c])&&(h[c]=l[c](t,n,r,i,o,a,s))}));return u.getDerivedResource({templateValues:h})}(s,t,n,r,i,o,l.format);return++a,"json"===l.type?h.fetchJson().then(l.callback).otherwise(c):"xml"===l.type?h.fetchXML().then(l.callback).otherwise(c):"text"===l.type||"html"===l.type?h.fetchText().then(l.callback).otherwise(c):h.fetch({responseType:l.format}).then(u.bind(void 0,l)).otherwise(c)}()}function u(e,t){return e.callback(t)}};var ol=!1,al=new Oe,sl=!1,ul=new Oe;var cl=!1,ll=new c,hl=!1;function dl(e,t,n){if(e&&e.urlSchemeZeroPadding&&e.urlSchemeZeroPadding.hasOwnProperty(t)){var r=e.urlSchemeZeroPadding[t];if("string"==typeof r){var i=r.length;i>1&&(n=n.length>=i?n:new Array(i-n.toString().length+1).join("0")+n)}}return n}function fl(e,t,n,r){ol||(e.tilingScheme.tileXYToRectangle(t,n,r,al),al.west=a.toDegrees(al.west),al.south=a.toDegrees(al.south),al.east=a.toDegrees(al.east),al.north=a.toDegrees(al.north),ol=!0)}function ml(e,t,n,r){sl||(e.tilingScheme.tileXYToNativeRectangle(t,n,r,ul),sl=!0)}var pl=new Oe,_l=new p;function gl(e,t,n,r,i,o,a){if(!cl){yl(e,t,n,r,i,o);var s=_l,u=e.tilingScheme.tileXYToNativeRectangle(t,n,r,pl);ll.x=e.tileWidth*(s.x-u.west)/u.width|0,ll.y=e.tileHeight*(u.north-s.y)/u.height|0,cl=!0}}var vl=new N;function yl(e,t,n,r,i,o,s){if(!hl){if(e.tilingScheme.projection instanceof K)_l.x=a.toDegrees(i),_l.y=a.toDegrees(o);else{var u=vl;u.longitude=i,u.latitude=o,e.tilingScheme.projection.project(u,_l)}hl=!0}}function Tl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function El(e,t){e=i(e,0),this._near=e,t=i(t,Number.MAX_VALUE),this._far=t}Object.defineProperties(El.prototype,{near:{get:function(){return this._near},set:function(e){this._near=e}},far:{get:function(){return this._far},set:function(e){this._far=e}}}),El.packedLength=2,El.pack=function(e,t,n){return n=i(n,0),t[n++]=e.near,t[n]=e.far,t},El.unpack=function(t,n,r){return n=i(n,0),e(r)||(r=new El),r.near=t[n++],r.far=t[n],r},El.equals=function(t,n){return t===n||e(t)&&e(n)&&t.near===n.near&&t.far===n.far},El.clone=function(t,n){if(e(t))return e(n)||(n=new El),n.near=t.near,n.far=t.far,n},El.prototype.clone=function(e){return El.clone(this,e)},El.prototype.equals=function(e){return El.equals(this,e)};var xl=Object.freeze({NONE:0,CLAMP_TO_GROUND:1,RELATIVE_TO_GROUND:2}),Cl=Object.freeze({CENTER:0,LEFT:1,RIGHT:-1}),Sl={MORPHING:0,COLUMBUS_VIEW:1,SCENE2D:2,SCENE3D:3,getMorphTime:function(e){return e===Sl.SCENE3D?1:e!==Sl.MORPHING?0:void 0}},Al=Object.freeze(Sl),wl={},bl=new le(0,0,0,1),Dl=new le,Il=new Ns,Rl=new c,Pl=new c;wl.wgs84ToWindowCoordinates=function(e,t,n){return wl.wgs84WithEyeOffsetToWindowCoordinates(e,t,p.ZERO,n)};var Ol=new le,Nl=new p;function Ml(e,t,n,r){var i=n.viewMatrix,o=ye.multiplyByVector(i,le.fromElements(e.x,e.y,e.z,1,Ol),Ol),a=p.multiplyComponents(t,p.normalize(o,Nl),Nl);return o.x+=t.x+a.x,o.y+=t.y+a.y,o.z+=a.z,ye.multiplyByVector(n.frustum.projectionMatrix,o,r)}var Ll=new N(Math.PI,a.PI_OVER_TWO),Fl=new p,zl=new p;wl.wgs84WithEyeOffsetToWindowCoordinates=function(t,n,r,i){var o=t.frameState,s=wl.computeActualWgs84Position(o,n,bl);if(e(s)){var u=t.canvas,l=Il;l.x=0,l.y=0,l.width=u.clientWidth,l.height=u.clientHeight;var h=t.camera,d=!1;if(o.mode===Al.SCENE2D){var f=t.mapProjection,m=Ll,_=f.project(m,Fl),g=p.clone(h.position,zl),v=h.frustum.clone(),y=ye.computeViewportTransformation(l,0,1,new ye),T=h.frustum.projectionMatrix,E=h.positionWC.y,x=p.fromElements(a.sign(E)*_.x-E,0,-h.positionWC.x),C=ka.pointToGLWindowCoordinates(T,y,x);if(0===E||C.x<=0||C.x>=u.clientWidth)d=!0;else{if(C.x>.5*u.clientWidth){l.width=C.x,h.frustum.right=_.x-E,Dl=Ml(s,r,h,Dl),wl.clipToGLWindowCoordinates(l,Dl,Rl),l.x+=C.x,h.position.x=-h.position.x;var S=h.frustum.right;h.frustum.right=-h.frustum.left,h.frustum.left=-S,Dl=Ml(s,r,h,Dl),wl.clipToGLWindowCoordinates(l,Dl,Pl)}else{l.x+=C.x,l.width-=C.x,h.frustum.left=-_.x-E,Dl=Ml(s,r,h,Dl),wl.clipToGLWindowCoordinates(l,Dl,Rl),l.x=l.x-l.width,h.position.x=-h.position.x;var A=h.frustum.left;h.frustum.left=-h.frustum.right,h.frustum.right=-A,Dl=Ml(s,r,h,Dl),wl.clipToGLWindowCoordinates(l,Dl,Pl)}p.clone(g,h.position),h.frustum=v.clone(),((i=c.clone(Rl,i)).x<0||i.x>u.clientWidth)&&(i.x=Pl.x)}}if(o.mode!==Al.SCENE2D||d){if((Dl=Ml(s,r,h,Dl)).z<0&&!(h.frustum instanceof Pr)&&!(h.frustum instanceof Ar))return;i=wl.clipToGLWindowCoordinates(l,Dl,i)}return i.y=u.clientHeight-i.y,i}},wl.wgs84ToDrawingBufferCoordinates=function(t,n,r){if(e(r=wl.wgs84ToWindowCoordinates(t,n,r)))return wl.transformWindowToDrawingBuffer(t,r,r)};var Bl=new p,Ul=new N;wl.computeActualWgs84Position=function(t,n,r){var i=t.mode;if(i===Al.SCENE3D)return p.clone(n,r);var o=t.mapProjection,s=o.ellipsoid.cartesianToCartographic(n,Ul);if(e(s)){if(o.project(s,Bl),i===Al.COLUMBUS_VIEW)return p.fromElements(Bl.z,Bl.x,Bl.y,r);if(i===Al.SCENE2D)return p.fromElements(0,Bl.x,Bl.y,r);var u=t.morphTime;return p.fromElements(a.lerp(Bl.z,n.x,u),a.lerp(Bl.x,n.y,u),a.lerp(Bl.y,n.z,u),r)}};var Vl=new p,Hl=new p,Gl=new ye;wl.clipToGLWindowCoordinates=function(e,t,n){return p.divideByScalar(t,t.w,Vl),ye.computeViewportTransformation(e,0,1,Gl),ye.multiplyByPoint(Gl,Vl,Hl),c.fromCartesian3(Hl,n)},wl.transformWindowToDrawingBuffer=function(e,t,n){var r=e.canvas,i=e.drawingBufferWidth/r.clientWidth,o=e.drawingBufferHeight/r.clientHeight;return c.fromElements(t.x*i,t.y*o,n)};var kl=new le,Wl=new le;wl.drawingBufferToWgs84Coordinates=function(t,n,r,i){var o=t.context.uniformState,a=o.currentFrustum,s=a.x,u=a.y;if(t.frameState.useLogDepth){var c=r*o.log2FarDepthFromNearPlusOne;r=u*(1-s/(Math.pow(2,c)-1+s))/(u-s)}var l,h=t.view.passState.viewport,d=le.clone(le.UNIT_W,kl);d.x=(n.x-h.x)/h.width*2-1,d.y=(n.y-h.y)/h.height*2-1,d.z=2*r-1,d.w=1;var f=t.camera.frustum;if(e(f.fovy)){var m=1/(l=ye.multiplyByVector(o.inverseViewProjection,d,Wl)).w;p.multiplyByScalar(l,m,l)}else e(f._offCenterFrustum)&&(f=f._offCenterFrustum),(l=Wl).x=.5*(d.x*(f.right-f.left)+f.left+f.right),l.y=.5*(d.y*(f.top-f.bottom)+f.bottom+f.top),l.z=.5*(d.z*(s-u)-s-u),l.w=1,l=ye.multiplyByVector(o.inverseView,l,l);return p.fromCartesian4(l,i)};var ql=Object.freeze({CENTER:0,BOTTOM:1,BASELINE:2,TOP:-1});function Yl(t,n){var r=(t=i(t,i.EMPTY_OBJECT)).translucencyByDistance,o=t.pixelOffsetScaleByDistance,a=t.scaleByDistance,s=t.distanceDisplayCondition;e(r)&&(r=fr.clone(r)),e(o)&&(o=fr.clone(o)),e(a)&&(a=fr.clone(a)),e(s)&&(s=El.clone(s)),this._show=i(t.show,!0),this._position=p.clone(i(t.position,p.ZERO)),this._actualPosition=p.clone(this._position),this._pixelOffset=c.clone(i(t.pixelOffset,c.ZERO)),this._translate=new c(0,0),this._eyeOffset=p.clone(i(t.eyeOffset,p.ZERO)),this._heightReference=i(t.heightReference,xl.NONE),this._verticalOrigin=i(t.verticalOrigin,ql.CENTER),this._horizontalOrigin=i(t.horizontalOrigin,Cl.CENTER),this._scale=i(t.scale,1),this._color=pn.clone(i(t.color,pn.WHITE)),this._rotation=i(t.rotation,0),this._alignedAxis=p.clone(i(t.alignedAxis,p.ZERO)),this._width=t.width,this._height=t.height,this._scaleByDistance=a,this._translucencyByDistance=r,this._pixelOffsetScaleByDistance=o,this._sizeInMeters=i(t.sizeInMeters,!1),this._distanceDisplayCondition=s,this._disableDepthTestDistance=t.disableDepthTestDistance,this._id=t.id,this._collection=i(t.collection,n),this._pickId=void 0,this._pickPrimitive=i(t._pickPrimitive,this),this._billboardCollection=n,this._dirty=!1,this._index=-1,this._batchIndex=void 0,this._imageIndex=-1,this._imageIndexPromise=void 0,this._imageId=void 0,this._image=void 0,this._imageSubRegion=void 0,this._imageWidth=void 0,this._imageHeight=void 0,this._labelDimensions=void 0,this._labelHorizontalOrigin=void 0,this._labelTranslate=void 0;var u=t.image,l=t.imageId;e(u)&&(e(l)||(l="string"==typeof u?u:e(u.src)?u.src:Tl()),this._imageId=l,this._image=u),e(t.imageSubRegion)&&(this._imageId=l,this._imageSubRegion=t.imageSubRegion),e(this._billboardCollection._textureAtlas)&&this._loadImage(),this._actualClampedPosition=void 0,this._removeCallbackFunc=void 0,this._mode=Al.SCENE3D,this._clusterShow=!0,this._outlineColor=pn.clone(i(t.outlineColor,pn.BLACK)),this._outlineWidth=i(t.outlineWidth,0),this._updateClamping()}var jl=Yl.SHOW_INDEX=0,Xl=Yl.POSITION_INDEX=1,Zl=Yl.PIXEL_OFFSET_INDEX=2,Kl=Yl.EYE_OFFSET_INDEX=3,Ql=Yl.HORIZONTAL_ORIGIN_INDEX=4,Jl=Yl.VERTICAL_ORIGIN_INDEX=5,$l=Yl.SCALE_INDEX=6,eh=Yl.IMAGE_INDEX_INDEX=7,th=Yl.COLOR_INDEX=8,nh=Yl.ROTATION_INDEX=9,rh=Yl.ALIGNED_AXIS_INDEX=10,ih=Yl.SCALE_BY_DISTANCE_INDEX=11,oh=Yl.TRANSLUCENCY_BY_DISTANCE_INDEX=12,ah=Yl.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX=13,sh=Yl.DISTANCE_DISPLAY_CONDITION=14,uh=Yl.DISABLE_DEPTH_DISTANCE=15;Yl.TEXTURE_COORDINATE_BOUNDS=16;var ch=Yl.SDF_INDEX=17;function lh(t,n){var r=t._billboardCollection;e(r)&&(r._updateBillboard(t,n),t._dirty=!0)}Yl.NUMBER_OF_PROPERTIES=18,Object.defineProperties(Yl.prototype,{show:{get:function(){return this._show},set:function(e){this._show!==e&&(this._show=e,lh(this,jl))}},position:{get:function(){return this._position},set:function(e){var t=this._position;p.equals(t,e)||(p.clone(e,t),p.clone(e,this._actualPosition),this._updateClamping(),lh(this,Xl))}},heightReference:{get:function(){return this._heightReference},set:function(e){e!==this._heightReference&&(this._heightReference=e,this._updateClamping(),lh(this,Xl))}},pixelOffset:{get:function(){return this._pixelOffset},set:function(e){var t=this._pixelOffset;c.equals(t,e)||(c.clone(e,t),lh(this,Zl))}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){var t=this._scaleByDistance;fr.equals(t,e)||(this._scaleByDistance=fr.clone(e,t),lh(this,ih))}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){var t=this._translucencyByDistance;fr.equals(t,e)||(this._translucencyByDistance=fr.clone(e,t),lh(this,oh))}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(e){var t=this._pixelOffsetScaleByDistance;fr.equals(t,e)||(this._pixelOffsetScaleByDistance=fr.clone(e,t),lh(this,ah))}},eyeOffset:{get:function(){return this._eyeOffset},set:function(e){var t=this._eyeOffset;p.equals(t,e)||(p.clone(e,t),lh(this,Kl))}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(e){this._horizontalOrigin!==e&&(this._horizontalOrigin=e,lh(this,Ql))}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(e){this._verticalOrigin!==e&&(this._verticalOrigin=e,lh(this,Jl))}},scale:{get:function(){return this._scale},set:function(e){this._scale!==e&&(this._scale=e,lh(this,$l))}},color:{get:function(){return this._color},set:function(e){var t=this._color;pn.equals(t,e)||(pn.clone(e,t),lh(this,th))}},rotation:{get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,lh(this,nh))}},alignedAxis:{get:function(){return this._alignedAxis},set:function(e){var t=this._alignedAxis;p.equals(t,e)||(p.clone(e,t),lh(this,rh))}},width:{get:function(){return i(this._width,this._imageWidth)},set:function(e){this._width!==e&&(this._width=e,lh(this,eh))}},height:{get:function(){return i(this._height,this._imageHeight)},set:function(e){this._height!==e&&(this._height=e,lh(this,eh))}},sizeInMeters:{get:function(){return this._sizeInMeters},set:function(e){this._sizeInMeters!==e&&(this._sizeInMeters=e,lh(this,th))}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){El.equals(e,this._distanceDisplayCondition)||(this._distanceDisplayCondition=El.clone(e,this._distanceDisplayCondition),lh(this,sh))}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){this._disableDepthTestDistance!==e&&(this._disableDepthTestDistance=e,lh(this,uh))}},id:{get:function(){return this._id},set:function(t){this._id=t,e(this._pickId)&&(this._pickId.object.id=t)}},pickPrimitive:{get:function(){return this._pickPrimitive},set:function(t){this._pickPrimitive=t,e(this._pickId)&&(this._pickId.object.primitive=t)}},pickId:{get:function(){return this._pickId}},image:{get:function(){return this._imageId},set:function(t){e(t)?"string"==typeof t?this.setImage(t,t):t instanceof ga?this.setImage(t.url,t):e(t.src)?this.setImage(t.src,t):this.setImage(Tl(),t):(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=void 0,this._image=void 0,this._imageIndexPromise=void 0,lh(this,eh))}},ready:{get:function(){return-1!==this._imageIndex}},_clampedPosition:{get:function(){return this._actualClampedPosition},set:function(e){this._actualClampedPosition=p.clone(e,this._actualClampedPosition),lh(this,Xl)}},clusterShow:{get:function(){return this._clusterShow},set:function(e){this._clusterShow!==e&&(this._clusterShow=e,lh(this,jl))}},outlineColor:{get:function(){return this._outlineColor},set:function(e){var t=this._outlineColor;pn.equals(t,e)||(pn.clone(e,t),lh(this,ch))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth!==e&&(this._outlineWidth=e,lh(this,ch))}}}),Yl.prototype.getPickId=function(t){return e(this._pickId)||(this._pickId=t.createPickId({primitive:this._pickPrimitive,collection:this._collection,id:this._id})),this._pickId},Yl.prototype._updateClamping=function(){Yl._updateClamping(this._billboardCollection,this)};var hh=new N,dh=new p;Yl._updateClamping=function(t,n){var r=t._scene;if(e(r)&&e(r.globe)){var i=r.globe,o=i.ellipsoid,a=i._surface,s=r.frameState.mode,u=s!==n._mode;if(n._mode=s,(n._heightReference===xl.NONE||u)&&e(n._removeCallbackFunc)&&(n._removeCallbackFunc(),n._removeCallbackFunc=void 0,n._clampedPosition=void 0),n._heightReference!==xl.NONE&&e(n._position)){var c=o.cartesianToCartographic(n._position);if(e(c)){e(n._removeCallbackFunc)&&n._removeCallbackFunc(),n._removeCallbackFunc=a.updateHeight(c,h),N.clone(c,hh);var l=i.getHeight(c);e(l)&&(hh.height=l),o.cartographicToCartesian(hh,dh),h(dh)}else n._actualClampedPosition=void 0}}function h(e){if(n._heightReference===xl.RELATIVE_TO_GROUND)if(n._mode===Al.SCENE3D){var t=o.cartesianToCartographic(e,hh);t.height+=c.height,o.cartographicToCartesian(t,e)}else e.x+=c.height;n._clampedPosition=p.clone(e,n._clampedPosition)}},Yl.prototype._loadImage=function(){var t,n=this._billboardCollection._textureAtlas,r=this._imageId,i=this._image,o=this._imageSubRegion;if(e(i)&&(t=n.addImage(r,i)),e(o)&&(t=n.addSubRegion(r,o)),this._imageIndexPromise=t,e(t)){var a=this;t.then((function(e){if(a._imageId===r&&a._image===i&&Ns.equals(a._imageSubRegion,o)){var t=n.textureCoordinates[e];a._imageWidth=n.texture.width*t.width,a._imageHeight=n.texture.height*t.height,a._imageIndex=e,a._ready=!0,a._image=void 0,a._imageIndexPromise=void 0,lh(a,eh)}})).otherwise((function(e){console.error("Error loading image for billboard: "+e),a._imageIndexPromise=void 0}))}},Yl.prototype.setImage=function(t,n){this._imageId!==t&&(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=t,this._image=n,e(this._billboardCollection._textureAtlas)&&this._loadImage())},Yl.prototype.setImageSubRegion=function(t,n){this._imageId===t&&Ns.equals(this._imageSubRegion,n)||(this._imageIndex=-1,this._imageId=t,this._imageSubRegion=Ns.clone(n),e(this._billboardCollection._textureAtlas)&&this._loadImage())},Yl.prototype._setTranslate=function(e){var t=this._translate;c.equals(t,e)||(c.clone(e,t),lh(this,Zl))},Yl.prototype._getActualPosition=function(){return e(this._clampedPosition)?this._clampedPosition:this._actualPosition},Yl.prototype._setActualPosition=function(t){e(this._clampedPosition)||p.clone(t,this._actualPosition),lh(this,Xl)};var fh=new le;Yl._computeActualPosition=function(t,n,r,i){return e(t._clampedPosition)?(r.mode!==t._mode&&t._updateClamping(),t._clampedPosition):r.mode===Al.SCENE3D?n:(ye.multiplyByPoint(i,n,fh),wl.computeActualWgs84Position(r,fh))};var mh=new p;Yl._computeScreenSpacePosition=function(t,n,r,i,o,a){var s=ye.multiplyByPoint(t,n,mh),u=wl.wgs84WithEyeOffsetToWindowCoordinates(o,s,r,a);if(e(u))return c.add(u,i,u),u};var ph=new c(0,0);Yl.prototype.computeScreenSpacePosition=function(t,n){var r=this._billboardCollection;e(n)||(n=new c),c.clone(this._pixelOffset,ph),c.add(ph,this._translate,ph);var i=r.modelMatrix,o=this._position;if(e(this._clampedPosition)&&(o=this._clampedPosition,t.mode!==Al.SCENE3D)){var a=t.mapProjection,s=a.ellipsoid,u=a.unproject(o,hh);o=s.cartographicToCartesian(u,mh),i=ye.IDENTITY}return Yl._computeScreenSpacePosition(i,o,this._eyeOffset,ph,t,n)},Yl.getScreenSpaceBoundingBox=function(t,n,r){var i=t.width,o=t.height,a=t.scale;i*=a,o*=a;var s=n.x;t.horizontalOrigin===Cl.RIGHT?s-=i:t.horizontalOrigin===Cl.CENTER&&(s-=.5*i);var u=n.y;return t.verticalOrigin===ql.BOTTOM||t.verticalOrigin===ql.BASELINE?u-=o:t.verticalOrigin===ql.CENTER&&(u-=.5*o),e(r)||(r=new Ns),r.x=s,r.y=u,r.width=i,r.height=o,r},Yl.prototype.equals=function(t){return this===t||e(t)&&this._id===t._id&&p.equals(this._position,t._position)&&this._imageId===t._imageId&&this._show===t._show&&this._scale===t._scale&&this._verticalOrigin===t._verticalOrigin&&this._horizontalOrigin===t._horizontalOrigin&&this._heightReference===t._heightReference&&Ns.equals(this._imageSubRegion,t._imageSubRegion)&&pn.equals(this._color,t._color)&&c.equals(this._pixelOffset,t._pixelOffset)&&c.equals(this._translate,t._translate)&&p.equals(this._eyeOffset,t._eyeOffset)&&fr.equals(this._scaleByDistance,t._scaleByDistance)&&fr.equals(this._translucencyByDistance,t._translucencyByDistance)&&fr.equals(this._pixelOffsetScaleByDistance,t._pixelOffsetScaleByDistance)&&El.equals(this._distanceDisplayCondition,t._distanceDisplayCondition)&&this._disableDepthTestDistance===t._disableDepthTestDistance},Yl.prototype._destroy=function(){e(this._customData)&&(this._billboardCollection._scene.globe._surface.removeTileCustomData(this._customData),this._customData=void 0),e(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this.image=void 0,this._pickId=this._pickId&&this._pickId.destroy(),this._billboardCollection=void 0};var _h={ADD:Tn.FUNC_ADD,SUBTRACT:Tn.FUNC_SUBTRACT,REVERSE_SUBTRACT:Tn.FUNC_REVERSE_SUBTRACT,MIN:Tn.MIN,MAX:Tn.MAX},gh=Object.freeze(_h),vh={ZERO:Tn.ZERO,ONE:Tn.ONE,SOURCE_COLOR:Tn.SRC_COLOR,ONE_MINUS_SOURCE_COLOR:Tn.ONE_MINUS_SRC_COLOR,DESTINATION_COLOR:Tn.DST_COLOR,ONE_MINUS_DESTINATION_COLOR:Tn.ONE_MINUS_DST_COLOR,SOURCE_ALPHA:Tn.SRC_ALPHA,ONE_MINUS_SOURCE_ALPHA:Tn.ONE_MINUS_SRC_ALPHA,DESTINATION_ALPHA:Tn.DST_ALPHA,ONE_MINUS_DESTINATION_ALPHA:Tn.ONE_MINUS_DST_ALPHA,CONSTANT_COLOR:Tn.CONSTANT_COLOR,ONE_MINUS_CONSTANT_COLOR:Tn.ONE_MINUS_CONSTANT_COLOR,CONSTANT_ALPHA:Tn.CONSTANT_ALPHA,ONE_MINUS_CONSTANT_ALPHA:Tn.ONE_MINUS_CONSTANT_ALPHA,SOURCE_ALPHA_SATURATE:Tn.SRC_ALPHA_SATURATE},yh=Object.freeze(vh),Th={DISABLED:Object.freeze({enabled:!1}),ALPHA_BLEND:Object.freeze({enabled:!0,equationRgb:gh.ADD,equationAlpha:gh.ADD,functionSourceRgb:yh.SOURCE_ALPHA,functionSourceAlpha:yh.ONE,functionDestinationRgb:yh.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:yh.ONE_MINUS_SOURCE_ALPHA}),PRE_MULTIPLIED_ALPHA_BLEND:Object.freeze({enabled:!0,equationRgb:gh.ADD,equationAlpha:gh.ADD,functionSourceRgb:yh.ONE,functionSourceAlpha:yh.ONE,functionDestinationRgb:yh.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:yh.ONE_MINUS_SOURCE_ALPHA}),ADDITIVE_BLEND:Object.freeze({enabled:!0,equationRgb:gh.ADD,equationAlpha:gh.ADD,functionSourceRgb:yh.SOURCE_ALPHA,functionSourceAlpha:yh.ONE,functionDestinationRgb:yh.ONE,functionDestinationAlpha:yh.ONE})},Eh=Object.freeze(Th),xh=Object.freeze({OPAQUE:0,TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2}),Ch=Object.freeze({FONT_SIZE:48,PADDING:10,RADIUS:8,CUTOFF:.25});function Sh(e,t,n){var r=e._gl;r.framebufferTexture2D(r.FRAMEBUFFER,t,n._target,n._texture,0)}function Ah(e,t,n){var r=e._gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,t,r.RENDERBUFFER,n._getRenderbuffer())}function wh(t){var n,r,o,a,s,u=(t=i(t,i.EMPTY_OBJECT)).context._gl;if(Ds.maximumColorAttachments,this._gl=u,this._framebuffer=u.createFramebuffer(),this._colorTextures=[],this._colorRenderbuffers=[],this._activeColorAttachments=[],this._depthTexture=void 0,this._depthRenderbuffer=void 0,this._stencilRenderbuffer=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this.destroyAttachments=i(t.destroyAttachments,!0),e(t.depthTexture)||e(t.depthRenderbuffer),e(t.depthStencilTexture)||e(t.depthStencilRenderbuffer),this._bind(),e(t.colorTextures)){var c=t.colorTextures;for(a=this._colorTextures.length=this._activeColorAttachments.length=c.length,o=0;o<a;++o)n=c[o],Sh(this,s=this._gl.COLOR_ATTACHMENT0+o,n),this._activeColorAttachments[o]=s,this._colorTextures[o]=n}if(e(t.colorRenderbuffers)){var l=t.colorRenderbuffers;for(a=this._colorRenderbuffers.length=this._activeColorAttachments.length=l.length,o=0;o<a;++o)r=l[o],Ah(this,s=this._gl.COLOR_ATTACHMENT0+o,r),this._activeColorAttachments[o]=s,this._colorRenderbuffers[o]=r}e(t.depthTexture)&&(n=t.depthTexture,Sh(this,this._gl.DEPTH_ATTACHMENT,n),this._depthTexture=n),e(t.depthRenderbuffer)&&(r=t.depthRenderbuffer,Ah(this,this._gl.DEPTH_ATTACHMENT,r),this._depthRenderbuffer=r),e(t.stencilRenderbuffer)&&(r=t.stencilRenderbuffer,Ah(this,this._gl.STENCIL_ATTACHMENT,r),this._stencilRenderbuffer=r),e(t.depthStencilTexture)&&(n=t.depthStencilTexture,Sh(this,this._gl.DEPTH_STENCIL_ATTACHMENT,n),this._depthStencilTexture=n),e(t.depthStencilRenderbuffer)&&(r=t.depthStencilRenderbuffer,Ah(this,this._gl.DEPTH_STENCIL_ATTACHMENT,r),this._depthStencilRenderbuffer=r),this._unBind()}Object.defineProperties(wh.prototype,{status:{get:function(){this._bind();var e=this._gl.checkFramebufferStatus(this._gl.FRAMEBUFFER);return this._unBind(),e}},numberOfColorAttachments:{get:function(){return this._activeColorAttachments.length}},depthTexture:{get:function(){return this._depthTexture}},depthRenderbuffer:{get:function(){return this._depthRenderbuffer}},stencilRenderbuffer:{get:function(){return this._stencilRenderbuffer}},depthStencilTexture:{get:function(){return this._depthStencilTexture}},depthStencilRenderbuffer:{get:function(){return this._depthStencilRenderbuffer}},hasDepthAttachment:{get:function(){return!!(this.depthTexture||this.depthRenderbuffer||this.depthStencilTexture||this.depthStencilRenderbuffer)}}}),wh.prototype._bind=function(){var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer)},wh.prototype._unBind=function(){var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,null)},wh.prototype._getActiveColorAttachments=function(){return this._activeColorAttachments},wh.prototype.getColorTexture=function(e){return this._colorTextures[e]},wh.prototype.getColorRenderbuffer=function(e){return this._colorRenderbuffers[e]},wh.prototype.isDestroyed=function(){return!1},wh.prototype.destroy=function(){if(this.destroyAttachments){for(var t=0,n=this._colorTextures,r=n.length;t<r;++t){var i=n[t];e(i)&&i.destroy()}var o=this._colorRenderbuffers;for(r=o.length,t=0;t<r;++t){var a=o[t];e(a)&&a.destroy()}this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy(),this._stencilRenderbuffer=this._stencilRenderbuffer&&this._stencilRenderbuffer.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy()}return this._gl.deleteFramebuffer(this._framebuffer),hi(this)};var bh={DONT_CARE:Tn.DONT_CARE,FASTEST:Tn.FASTEST,NICEST:Tn.NICEST,validate:function(e){return e===bh.DONT_CARE||e===bh.FASTEST||e===bh.NICEST}},Dh=Object.freeze(bh),Ih={NEAREST:Tn.NEAREST,LINEAR:Tn.LINEAR,validate:function(e){return e===Ih.NEAREST||e===Ih.LINEAR}},Rh=Object.freeze(Ih),Ph={NEAREST:Tn.NEAREST,LINEAR:Tn.LINEAR,NEAREST_MIPMAP_NEAREST:Tn.NEAREST_MIPMAP_NEAREST,LINEAR_MIPMAP_NEAREST:Tn.LINEAR_MIPMAP_NEAREST,NEAREST_MIPMAP_LINEAR:Tn.NEAREST_MIPMAP_LINEAR,LINEAR_MIPMAP_LINEAR:Tn.LINEAR_MIPMAP_LINEAR,validate:function(e){return e===Ph.NEAREST||e===Ph.LINEAR||e===Ph.NEAREST_MIPMAP_NEAREST||e===Ph.LINEAR_MIPMAP_NEAREST||e===Ph.NEAREST_MIPMAP_LINEAR||e===Ph.LINEAR_MIPMAP_LINEAR}},Oh=Object.freeze(Ph),Nh={CLAMP_TO_EDGE:Tn.CLAMP_TO_EDGE,REPEAT:Tn.REPEAT,MIRRORED_REPEAT:Tn.MIRRORED_REPEAT,validate:function(e){return e===Nh.CLAMP_TO_EDGE||e===Nh.REPEAT||e===Nh.MIRRORED_REPEAT}},Mh=Object.freeze(Nh);function Lh(t){t=i(t,i.EMPTY_OBJECT);var n=i(t.wrapS,Mh.CLAMP_TO_EDGE),r=i(t.wrapT,Mh.CLAMP_TO_EDGE),o=i(t.minificationFilter,Oh.LINEAR),a=i(t.magnificationFilter,Rh.LINEAR),s=e(t.maximumAnisotropy)?t.maximumAnisotropy:1;this._wrapS=n,this._wrapT=r,this._minificationFilter=o,this._magnificationFilter=a,this._maximumAnisotropy=s}function Fh(t){var n=(t=i(t,i.EMPTY_OBJECT)).context,r=t.width,o=t.height,a=t.source;e(a)&&(e(r)||(r=i(a.videoWidth,a.width)),e(o)||(o=i(a.videoHeight,a.height)));var s=i(t.pixelFormat,Xc.RGBA),u=i(t.pixelDatatype,Yc.UNSIGNED_BYTE),l=Xc.toInternalFormat(s,u,n),h=Xc.isCompressedFormat(l),d=t.preMultiplyAlpha||s===Xc.RGB||s===Xc.LUMINANCE,f=i(t.flipY,!0),m=!0,p=n._gl,_=p.TEXTURE_2D,g=p.createTexture();p.activeTexture(p.TEXTURE0),p.bindTexture(_,g);var v,y=4;if(e(a)&&e(a.arrayBufferView)&&!h&&(y=Xc.alignmentInBytes(s,u,r)),p.pixelStorei(p.UNPACK_ALIGNMENT,y),e(a))if(e(a.arrayBufferView)){p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,!1);var T=a.arrayBufferView;if(h)p.compressedTexImage2D(_,0,l,r,o,0,T);else if(f&&(T=Xc.flipY(T,s,u,r,o)),p.texImage2D(_,0,l,r,o,0,s,Yc.toWebGLConstant(u,n),T),e(a.mipLevels))for(var E=r,x=o,C=0;C<a.mipLevels.length;++C)(E=0|Math.floor(E/2))<1&&(E=1),(x=0|Math.floor(x/2))<1&&(x=1),p.texImage2D(_,C+1,l,E,x,0,s,Yc.toWebGLConstant(u,n),a.mipLevels[C])}else e(a.framebuffer)?(p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,!1),a.framebuffer!==n.defaultFramebuffer&&a.framebuffer._bind(),p.copyTexImage2D(_,0,l,a.xOffset,a.yOffset,r,o,0),a.framebuffer!==n.defaultFramebuffer&&a.framebuffer._unBind()):(p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d),p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,f),p.texImage2D(_,0,l,s,Yc.toWebGLConstant(u,n),a));else p.texImage2D(_,0,l,r,o,0,s,Yc.toWebGLConstant(u,n),null),m=!1;p.bindTexture(_,null),v=h?Xc.compressedTextureSizeInBytes(s,r,o):Xc.textureSizeInBytes(s,u,r,o),this._id=Tl(),this._context=n,this._textureFilterAnisotropic=n._textureFilterAnisotropic,this._textureTarget=_,this._texture=g,this._internalFormat=l,this._pixelFormat=s,this._pixelDatatype=u,this._width=r,this._height=o,this._dimensions=new c(r,o),this._hasMipmap=!1,this._sizeInBytes=v,this._preMultiplyAlpha=d,this._flipY=f,this._initialized=m,this._sampler=void 0,this.sampler=e(t.sampler)?t.sampler:new Lh}function zh(e,t,n,r,o){this.bottomLeft=i(e,c.ZERO),this.topRight=i(t,c.ZERO),this.childNode1=n,this.childNode2=r,this.imageIndex=o}Object.defineProperties(Lh.prototype,{wrapS:{get:function(){return this._wrapS}},wrapT:{get:function(){return this._wrapT}},minificationFilter:{get:function(){return this._minificationFilter}},magnificationFilter:{get:function(){return this._magnificationFilter}},maximumAnisotropy:{get:function(){return this._maximumAnisotropy}}}),Lh.equals=function(t,n){return t===n||e(t)&&e(n)&&t._wrapS===n._wrapS&&t._wrapT===n._wrapT&&t._minificationFilter===n._minificationFilter&&t._magnificationFilter===n._magnificationFilter&&t._maximumAnisotropy===n._maximumAnisotropy},Lh.NEAREST=Object.freeze(new Lh({wrapS:Mh.CLAMP_TO_EDGE,wrapT:Mh.CLAMP_TO_EDGE,minificationFilter:Oh.NEAREST,magnificationFilter:Rh.NEAREST})),Fh.create=function(e){return new Fh(e)},Fh.fromFramebuffer=function(t){var n=(t=i(t,i.EMPTY_OBJECT)).context,r=n._gl,o=i(t.pixelFormat,Xc.RGB),a=i(t.framebufferXOffset,0),s=i(t.framebufferYOffset,0),u=i(t.width,r.drawingBufferWidth),c=i(t.height,r.drawingBufferHeight),l=t.framebuffer;return new Fh({context:n,width:u,height:c,pixelFormat:o,source:{framebuffer:e(l)?l:n.defaultFramebuffer,xOffset:a,yOffset:s,width:u,height:c}})},Object.defineProperties(Fh.prototype,{id:{get:function(){return this._id}},sampler:{get:function(){return this._sampler},set:function(t){var n=t.minificationFilter,r=t.magnificationFilter,i=this._context,o=this._pixelFormat,a=this._pixelDatatype,s=n===Oh.NEAREST_MIPMAP_NEAREST||n===Oh.NEAREST_MIPMAP_LINEAR||n===Oh.LINEAR_MIPMAP_NEAREST||n===Oh.LINEAR_MIPMAP_LINEAR;(a===Yc.FLOAT&&!i.textureFloatLinear||a===Yc.HALF_FLOAT&&!i.textureHalfFloatLinear)&&(n=s?Oh.NEAREST_MIPMAP_NEAREST:Oh.NEAREST,r=Rh.NEAREST),i.webgl2&&Xc.isDepthFormat(o)&&(n=Oh.NEAREST,r=Rh.NEAREST);var u=i._gl,c=this._textureTarget;u.activeTexture(u.TEXTURE0),u.bindTexture(c,this._texture),u.texParameteri(c,u.TEXTURE_MIN_FILTER,n),u.texParameteri(c,u.TEXTURE_MAG_FILTER,r),u.texParameteri(c,u.TEXTURE_WRAP_S,t.wrapS),u.texParameteri(c,u.TEXTURE_WRAP_T,t.wrapT),e(this._textureFilterAnisotropic)&&u.texParameteri(c,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.maximumAnisotropy),u.bindTexture(c,null),this._sampler=t}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},dimensions:{get:function(){return this._dimensions}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(4*this._sizeInBytes/3):this._sizeInBytes}},_target:{get:function(){return this._textureTarget}}}),Fh.prototype.copyFrom=function(t,n,r){n=i(n,0),r=i(r,0);var o=this._context,a=o._gl,s=this._textureTarget;a.activeTexture(a.TEXTURE0),a.bindTexture(s,this._texture);var u=t.width,c=t.height,l=t.arrayBufferView,h=this._width,d=this._height,f=this._internalFormat,m=this._pixelFormat,p=this._pixelDatatype,_=this._preMultiplyAlpha,g=this._flipY,v=4;e(l)&&(v=Xc.alignmentInBytes(m,p,u)),a.pixelStorei(a.UNPACK_ALIGNMENT,v);var y=!1;if(!this._initialized){if(0===n&&0===r&&u===h&&c===d)e(l)?(a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),g&&(l=Xc.flipY(l,m,p,h,d)),a.texImage2D(s,0,f,h,d,0,m,Yc.toWebGLConstant(p,o),l)):(a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,_),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,g),a.texImage2D(s,0,f,m,Yc.toWebGLConstant(p,o),t)),y=!0;else{a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);var T=Xc.createTypedArray(m,p,h,d);a.texImage2D(s,0,f,h,d,0,m,Yc.toWebGLConstant(p,o),T)}this._initialized=!0}y||(e(l)?(a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),g&&(l=Xc.flipY(l,m,p,u,c)),a.texSubImage2D(s,0,n,r,u,c,m,Yc.toWebGLConstant(p,o),l)):(a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,_),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,g),a.texSubImage2D(s,0,n,r,m,Yc.toWebGLConstant(p,o),t))),a.bindTexture(s,null)},Fh.prototype.copyFromFramebuffer=function(e,t,n,r,o,a){e=i(e,0),t=i(t,0),n=i(n,0),r=i(r,0),o=i(o,this._width),a=i(a,this._height);var s=this._context._gl,u=this._textureTarget;s.activeTexture(s.TEXTURE0),s.bindTexture(u,this._texture),s.copyTexSubImage2D(u,0,e,t,n,r,o,a),s.bindTexture(u,null),this._initialized=!0},Fh.prototype.generateMipmap=function(e){e=i(e,Dh.DONT_CARE),this._hasMipmap=!0;var t=this._context._gl,n=this._textureTarget;t.hint(t.GENERATE_MIPMAP_HINT,e),t.activeTexture(t.TEXTURE0),t.bindTexture(n,this._texture),t.generateMipmap(n),t.bindTexture(n,null)},Fh.prototype.isDestroyed=function(){return!1},Fh.prototype.destroy=function(){return this._context._gl.deleteTexture(this._texture),hi(this)};var Bh=new c(16,16);function Uh(e){e=i(e,i.EMPTY_OBJECT);var t=i(e.borderWidthInPixels,1),n=i(e.initialSize,Bh);this._context=e.context,this._pixelFormat=i(e.pixelFormat,Xc.RGBA),this._borderWidthInPixels=t,this._textureCoordinates=[],this._guid=Tl(),this._idHash={},this._initialSize=n,this._root=void 0}function Vh(t,n,r){if(e(n)){if(!e(n.childNode1)&&!e(n.childNode2)){if(e(n.imageIndex))return;var i=n.topRight.x-n.bottomLeft.x,o=n.topRight.y-n.bottomLeft.y,a=i-r.width,s=o-r.height;if(a<0||s<0)return;if(0===a&&0===s)return n;if(a>s){n.childNode1=new zh(new c(n.bottomLeft.x,n.bottomLeft.y),new c(n.bottomLeft.x+r.width,n.topRight.y));var u=n.bottomLeft.x+r.width+t._borderWidthInPixels;u<n.topRight.x&&(n.childNode2=new zh(new c(u,n.bottomLeft.y),new c(n.topRight.x,n.topRight.y)))}else{n.childNode1=new zh(new c(n.bottomLeft.x,n.bottomLeft.y),new c(n.topRight.x,n.bottomLeft.y+r.height));var l=n.bottomLeft.y+r.height+t._borderWidthInPixels;l<n.topRight.y&&(n.childNode2=new zh(new c(n.bottomLeft.x,l),new c(n.topRight.x,n.topRight.y)))}return Vh(t,n.childNode1,r)}return Vh(t,n.childNode1,r)||Vh(t,n.childNode2,r)}}function Hh(t,n,r){var i=Vh(t,t._root,n);if(e(i)){i.imageIndex=r;var o=t._texture.width,a=t._texture.height,s=i.topRight.x-i.bottomLeft.x,u=i.topRight.y-i.bottomLeft.y,l=i.bottomLeft.x/o,h=i.bottomLeft.y/a,d=s/o,f=u/a;t._textureCoordinates[r]=new Ns(l,h,d,f),t._texture.copyFrom(n,i.bottomLeft.x,i.bottomLeft.y)}else!function(t,n){var r=t._context,i=t.numberOfImages,o=t._borderWidthInPixels;if(i>0){for(var a=t._texture.width,s=t._texture.height,u=2*(a+n.width+o),l=2*(s+n.height+o),h=a/u,d=s/l,f=new zh(new c(a+o,o),new c(u,s)),m=new zh(new c,new c(u,s),t._root,f),p=new zh(new c(o,s+o),new c(u,l)),_=new zh(new c,new c(u,l),m,p),g=0;g<t._textureCoordinates.length;g++){var v=t._textureCoordinates[g];e(v)&&(v.x*=h,v.y*=d,v.width*=h,v.height*=d)}var y=new Fh({context:t._context,width:u,height:l,pixelFormat:t._pixelFormat}),T=new wh({context:r,colorTextures:[t._texture],destroyAttachments:!1});T._bind(),y.copyFromFramebuffer(0,0,0,0,u,l),T._unBind(),T.destroy(),t._texture=t._texture&&t._texture.destroy(),t._texture=y,t._root=_}else{var E=2*(n.width+2*o),x=2*(n.height+2*o);E<t._initialSize.x&&(E=t._initialSize.x),x<t._initialSize.y&&(x=t._initialSize.y),t._texture=t._texture&&t._texture.destroy(),t._texture=new Fh({context:t._context,width:E,height:x,pixelFormat:t._pixelFormat}),t._root=new zh(new c(o,o),new c(E,x))}}(t,n),Hh(t,n,r);t._guid=Tl()}Object.defineProperties(Uh.prototype,{borderWidthInPixels:{get:function(){return this._borderWidthInPixels}},textureCoordinates:{get:function(){return this._textureCoordinates}},texture:{get:function(){return e(this._texture)||(this._texture=new Fh({context:this._context,width:this._initialSize.x,height:this._initialSize.y,pixelFormat:this._pixelFormat})),this._texture}},numberOfImages:{get:function(){return this._textureCoordinates.length}},guid:{get:function(){return this._guid}}}),Uh.prototype.addImage=function(t,n){var r=this._idHash[t];if(e(r))return r;if("function"==typeof n)n=n(t);else if("string"==typeof n||n instanceof ga){n=ga.createIfNeeded(n).fetchImage()}var i=this;return r=Et(n,(function(e){if(i.isDestroyed())return-1;var t=i.numberOfImages;return Hh(i,e,t),t})),this._idHash[t]=r,r},Uh.prototype.addSubRegion=function(t,n){var r=this._idHash[t];if(!e(r))throw new ve('image with id "'+t+'" not found in the atlas.');var i=this;return Et(r,(function(e){if(-1===e)return-1;var t=i._texture.width,r=i._texture.height,o=i.numberOfImages,a=i._textureCoordinates[e],s=a.x+n.x/t,u=a.y+n.y/r,c=n.width/t,l=n.height/r;return i._textureCoordinates.push(new Ns(s,u,c,l)),i._guid=Tl(),o}))},Uh.prototype.isDestroyed=function(){return!1},Uh.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),hi(this)};var Gh,kh,Wh=Yl.SHOW_INDEX,qh=Yl.POSITION_INDEX,Yh=Yl.PIXEL_OFFSET_INDEX,jh=Yl.EYE_OFFSET_INDEX,Xh=Yl.HORIZONTAL_ORIGIN_INDEX,Zh=Yl.VERTICAL_ORIGIN_INDEX,Kh=Yl.SCALE_INDEX,Qh=Yl.IMAGE_INDEX_INDEX,Jh=Yl.COLOR_INDEX,$h=Yl.ROTATION_INDEX,ed=Yl.ALIGNED_AXIS_INDEX,td=Yl.SCALE_BY_DISTANCE_INDEX,nd=Yl.TRANSLUCENCY_BY_DISTANCE_INDEX,rd=Yl.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX,id=Yl.DISTANCE_DISPLAY_CONDITION,od=Yl.DISABLE_DEPTH_DISTANCE,ad=Yl.TEXTURE_COORDINATE_BOUNDS,sd=Yl.SDF_INDEX,ud=Yl.NUMBER_OF_PROPERTIES,cd={positionHighAndScale:0,positionLowAndRotation:1,compressedAttribute0:2,compressedAttribute1:3,compressedAttribute2:4,eyeOffset:5,scaleByDistance:6,pixelOffsetScaleByDistance:7,compressedAttribute3:8,textureCoordinateBoundsOrLabelTranslate:9,a_batchId:10,sdf:11},ld={direction:0,positionHighAndScale:1,positionLowAndRotation:2,compressedAttribute0:3,compressedAttribute1:4,compressedAttribute2:5,eyeOffset:6,scaleByDistance:7,pixelOffsetScaleByDistance:8,compressedAttribute3:9,textureCoordinateBoundsOrLabelTranslate:10,a_batchId:11,sdf:12};function hd(t){t=i(t,i.EMPTY_OBJECT),this._scene=t.scene,this._batchTable=t.batchTable,this._textureAtlas=void 0,this._textureAtlasGUID=void 0,this._destroyTextureAtlas=!0,this._sp=void 0,this._spTranslucent=void 0,this._rsOpaque=void 0,this._rsTranslucent=void 0,this._vaf=void 0,this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!1,this._shaderRotation=!1,this._compiledShaderRotation=!1,this._shaderAlignedAxis=!1,this._compiledShaderAlignedAxis=!1,this._shaderScaleByDistance=!1,this._compiledShaderScaleByDistance=!1,this._shaderTranslucencyByDistance=!1,this._compiledShaderTranslucencyByDistance=!1,this._shaderPixelOffsetScaleByDistance=!1,this._compiledShaderPixelOffsetScaleByDistance=!1,this._shaderDistanceDisplayCondition=!1,this._compiledShaderDistanceDisplayCondition=!1,this._shaderDisableDepthDistance=!1,this._compiledShaderDisableDepthDistance=!1,this._shaderClampToGround=!1,this._compiledShaderClampToGround=!1,this._propertiesChanged=new Uint32Array(ud),this._maxSize=0,this._maxEyeOffset=0,this._maxScale=1,this._maxPixelOffset=0,this._allHorizontalCenter=!0,this._allVerticalCenter=!0,this._allSizedInMeters=!0,this._baseVolume=new Me,this._baseVolumeWC=new Me,this._baseVolume2D=new Me,this._boundingVolume=new Me,this._boundingVolumeDirty=!1,this._colorCommands=[],this.modelMatrix=ye.clone(i(t.modelMatrix,ye.IDENTITY)),this._modelMatrix=ye.clone(ye.IDENTITY),this.debugShowBoundingVolume=i(t.debugShowBoundingVolume,!1),this.debugShowTextureAtlas=i(t.debugShowTextureAtlas,!1),this.blendOption=i(t.blendOption,xh.OPAQUE_AND_TRANSLUCENT),this._blendOption=void 0,this._mode=Al.SCENE3D,this._buffersUsage=[ws.STATIC_DRAW,ws.STATIC_DRAW,ws.STATIC_DRAW,ws.STATIC_DRAW,ws.STATIC_DRAW,ws.STATIC_DRAW,ws.STATIC_DRAW,ws.STATIC_DRAW,ws.STATIC_DRAW,ws.STATIC_DRAW,ws.STATIC_DRAW,ws.STATIC_DRAW,ws.STATIC_DRAW,ws.STATIC_DRAW,ws.STATIC_DRAW,ws.STATIC_DRAW],this._highlightColor=pn.clone(pn.WHITE);var n=this;this._uniforms={u_atlas:function(){return n._textureAtlas.texture},u_highlightColor:function(){return n._highlightColor}};var r=this._scene;e(r)&&e(r.terrainProviderChanged)&&(this._removeCallbackFunc=r.terrainProviderChanged.addEventListener((function(){for(var t=this._billboards,n=t.length,r=0;r<n;++r)e(t[r])&&t[r]._updateClamping()}),this))}function dd(e){for(var t=e.length,n=0;n<t;++n)e[n]&&e[n]._destroy()}function fd(e){if(e._billboardsRemoved){e._billboardsRemoved=!1;for(var t=[],n=e._billboards,r=n.length,i=0,o=0;i<r;++i){var a=n[i];a&&(a._index=o++,t.push(a))}e._billboards=t}}function md(t){var n=t.cache.billboardCollection_indexBufferBatched;if(e(n))return n;for(var r=new Uint16Array(98298),i=0,o=0;i<98298;i+=6,o+=4)r[i]=o,r[i+1]=o+1,r[i+2]=o+2,r[i+3]=o+0,r[i+4]=o+2,r[i+5]=o+3;return(n=bs.createIndexBuffer({context:t,typedArray:r,usage:ws.STATIC_DRAW,indexDatatype:Dn.UNSIGNED_SHORT})).vertexArrayDestroyable=!1,t.cache.billboardCollection_indexBufferBatched=n,n}function pd(t){var n=t.cache.billboardCollection_indexBufferInstanced;return e(n)||((n=bs.createIndexBuffer({context:t,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:ws.STATIC_DRAW,indexDatatype:Dn.UNSIGNED_SHORT})).vertexArrayDestroyable=!1,t.cache.billboardCollection_indexBufferInstanced=n),n}function _d(t){var n=t.cache.billboardCollection_vertexBufferInstanced;return e(n)||((n=bs.createVertexBuffer({context:t,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:ws.STATIC_DRAW})).vertexArrayDestroyable=!1,t.cache.billboardCollection_vertexBufferInstanced=n),n}Object.defineProperties(hd.prototype,{length:{get:function(){return fd(this),this._billboards.length}},textureAtlas:{get:function(){return this._textureAtlas},set:function(e){this._textureAtlas!==e&&(this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._textureAtlas=e,this._createVertexArray=!0)}},destroyTextureAtlas:{get:function(){return this._destroyTextureAtlas},set:function(e){this._destroyTextureAtlas=e}}}),hd.prototype.add=function(e){var t=new Yl(e,this);return t._index=this._billboards.length,this._billboards.push(t),this._createVertexArray=!0,t},hd.prototype.remove=function(e){return!!this.contains(e)&&(this._billboards[e._index]=null,this._billboardsRemoved=!0,this._createVertexArray=!0,e._destroy(),!0)},hd.prototype.removeAll=function(){dd(this._billboards),this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!0},hd.prototype._updateBillboard=function(e,t){e._dirty||(this._billboardsToUpdate[this._billboardsToUpdateIndex++]=e),++this._propertiesChanged[t]},hd.prototype.contains=function(t){return e(t)&&t._billboardCollection===this},hd.prototype.get=function(e){return fd(this),this._billboards[e]},hd.prototype.computeNewBuffersUsage=function(){for(var e=this._buffersUsage,t=!1,n=this._propertiesChanged,r=0;r<ud;++r){var i=0===n[r]?ws.STATIC_DRAW:ws.STREAM_DRAW;t=t||e[r]!==i,e[r]=i}return t};var gd=new Cn;function vd(e,t,n,r,i){var o,a=r[Gh.positionHighAndScale],s=r[Gh.positionLowAndRotation],u=i._getActualPosition();e._mode===Al.SCENE3D&&(Me.expand(e._baseVolume,u,e._baseVolume),e._boundingVolumeDirty=!0),Cn.fromCartesian(u,gd);var c=i.scale,l=i.rotation;0!==l&&(e._shaderRotation=!0),e._maxScale=Math.max(e._maxScale,c);var h=gd.high,d=gd.low;e._instanced?(a(o=i._index,h.x,h.y,h.z,c),s(o,d.x,d.y,d.z,l)):(a((o=4*i._index)+0,h.x,h.y,h.z,c),a(o+1,h.x,h.y,h.z,c),a(o+2,h.x,h.y,h.z,c),a(o+3,h.x,h.y,h.z,c),s(o+0,d.x,d.y,d.z,l),s(o+1,d.x,d.y,d.z,l),s(o+2,d.x,d.y,d.z,l),s(o+3,d.x,d.y,d.z,l))}var yd=new c;function Td(e,t,n,r,i){var o,s=r[Gh.compressedAttribute0],u=i.pixelOffset,c=u.x,l=u.y,h=i._translate,d=h.x,f=h.y;e._maxPixelOffset=Math.max(e._maxPixelOffset,Math.abs(c+d),Math.abs(-l+f));var m=i.horizontalOrigin,p=i._verticalOrigin,_=i.show&&i.clusterShow;0===i.color.alpha&&(_=!1),p===ql.BASELINE&&(p=ql.BOTTOM),e._allHorizontalCenter=e._allHorizontalCenter&&m===Cl.CENTER,e._allVerticalCenter=e._allVerticalCenter&&p===ql.CENTER;var g=0,v=0,y=0,T=0,E=i._imageIndex;if(-1!==E){var x=n[E];g=x.x,v=x.y,y=x.width,T=x.height}var C=g+y,A=v+T,w=128*Math.floor(a.clamp(c,-32768,32768)+32768);w+=32*(m+1),w+=8*(p+1),w+=4*(_?1:0);var b=256*Math.floor(a.clamp(l,-32768,32768)+32768),D=256*Math.floor(a.clamp(d,-32768,32768)+32768),I=.00390625*(a.clamp(f,-32768,32768)+32768),R=Math.floor(I);b+=R,D+=Math.floor(256*(I-R)),yd.x=g,yd.y=v;var P=S.compressTextureCoordinates(yd);yd.x=C;var O=S.compressTextureCoordinates(yd);yd.y=A;var N=S.compressTextureCoordinates(yd);yd.x=g;var M=S.compressTextureCoordinates(yd);e._instanced?s(o=i._index,w,b,D,P):(s((o=4*i._index)+0,w+0,b,D,P),s(o+1,w+2,b,D,O),s(o+2,w+3,b,D,N),s(o+3,w+1,b,D,M))}function Ed(t,n,r,o,s){var u,c=o[Gh.compressedAttribute1],l=s.alignedAxis;p.equals(l,p.ZERO)||(t._shaderAlignedAxis=!0);var h=0,d=1,f=1,m=1,_=s.translucencyByDistance;e(_)&&(h=_.near,d=_.nearValue,f=_.far,m=_.farValue,1===d&&1===m||(t._shaderTranslucencyByDistance=!0));var g=0,v=s._imageIndex;-1!==v&&(g=r[v].width);var y=t._textureAtlas.texture.width,T=Math.round(i(s.width,y*g));t._maxSize=Math.max(t._maxSize,T);var E=a.clamp(T,0,65536),x=0;Math.abs(p.magnitudeSquared(l)-1)<a.EPSILON6&&(x=S.octEncodeFloat(l)),E=256*E+(d=1===(d=a.clamp(d,0,1))?255:255*d|0),x=256*x+(m=1===(m=a.clamp(m,0,1))?255:255*m|0),t._instanced?c(u=s._index,E,x,h,f):(c((u=4*s._index)+0,E,x,h,f),c(u+1,E,x,h,f),c(u+2,E,x,h,f),c(u+3,E,x,h,f))}function xd(t,n,r,o,s){var u,c=o[Gh.compressedAttribute2],l=s.color,h=e(t._batchTable)?pn.WHITE:s.getPickId(n.context).color,d=s.sizeInMeters?1:0,f=Math.abs(p.magnitudeSquared(s.alignedAxis)-1)<a.EPSILON6?1:0;t._allSizedInMeters=t._allSizedInMeters&&1===d;var m=0,_=s._imageIndex;-1!==_&&(m=r[_].height);var g=t._textureAtlas.texture.dimensions,v=Math.round(i(s.height,g.y*m));t._maxSize=Math.max(t._maxSize,v);var y=i(s._labelHorizontalOrigin,-2),T=4*v+(y+=2),E=pn.floatToByte(l.red),x=pn.floatToByte(l.green),C=pn.floatToByte(l.blue),S=65536*E+256*x+C,A=65536*(E=pn.floatToByte(h.red))+256*(x=pn.floatToByte(h.green))+(C=pn.floatToByte(h.blue)),w=65536*pn.floatToByte(l.alpha)+256*pn.floatToByte(h.alpha);w+=2*d+f,t._instanced?c(u=s._index,S,A,w,T):(c((u=4*s._index)+0,S,A,w,T),c(u+1,S,A,w,T),c(u+2,S,A,w,T),c(u+3,S,A,w,T))}function Cd(e,t,n,r,i){var o,a=r[Gh.eyeOffset],s=i.eyeOffset,u=s.z;if(i._heightReference!==xl.NONE&&(u*=1.005),e._maxEyeOffset=Math.max(e._maxEyeOffset,Math.abs(s.x),Math.abs(s.y),Math.abs(u)),e._instanced){var c=0,l=0,h=i._imageIndex;if(-1!==h){var d=n[h];c=d.width,l=d.height}yd.x=c,yd.y=l;var f=S.compressTextureCoordinates(yd);a(o=i._index,s.x,s.y,u,f)}else a((o=4*i._index)+0,s.x,s.y,u,0),a(o+1,s.x,s.y,u,0),a(o+2,s.x,s.y,u,0),a(o+3,s.x,s.y,u,0)}function Sd(t,n,r,i,o){var a,s=i[Gh.scaleByDistance],u=0,c=1,l=1,h=1,d=o.scaleByDistance;e(d)&&(u=d.near,c=d.nearValue,l=d.far,h=d.farValue,1===c&&1===h||(t._shaderScaleByDistance=!0)),t._instanced?s(a=o._index,u,c,l,h):(s((a=4*o._index)+0,u,c,l,h),s(a+1,u,c,l,h),s(a+2,u,c,l,h),s(a+3,u,c,l,h))}function Ad(t,n,r,i,o){var a,s=i[Gh.pixelOffsetScaleByDistance],u=0,c=1,l=1,h=1,d=o.pixelOffsetScaleByDistance;e(d)&&(u=d.near,c=d.nearValue,l=d.far,h=d.farValue,1===c&&1===h||(t._shaderPixelOffsetScaleByDistance=!0)),t._instanced?s(a=o._index,u,c,l,h):(s((a=4*o._index)+0,u,c,l,h),s(a+1,u,c,l,h),s(a+2,u,c,l,h),s(a+3,u,c,l,h))}function wd(t,n,r,o,s){var u,c=o[Gh.compressedAttribute3],l=0,h=Number.MAX_VALUE,d=s.distanceDisplayCondition;e(d)&&(l=d.near,h=d.far,l*=l,h*=h,t._shaderDistanceDisplayCondition=!0);var f,m,p=s.disableDepthTestDistance,_=s.heightReference===xl.CLAMP_TO_GROUND&&n.context.depthTexture;if(e(p)||(p=_?5e3:0),p*=p,(_||p>0)&&(t._shaderDisableDepthDistance=!0,p===Number.POSITIVE_INFINITY&&(p=-1)),e(s._labelDimensions))m=s._labelDimensions.x,f=s._labelDimensions.y;else{var g=0,v=0,y=s._imageIndex;if(-1!==y){var T=r[y];g=T.height,v=T.width}f=Math.round(i(s.height,t._textureAtlas.texture.dimensions.y*g));var E=t._textureAtlas.texture.width;m=Math.round(i(s.width,E*v))}var x=4096*Math.floor(a.clamp(m,0,4096))+Math.floor(a.clamp(f,0,4096));t._instanced?c(u=s._index,l,h,p,x):(c((u=4*s._index)+0,l,h,p,x),c(u+1,l,h,p,x),c(u+2,l,h,p,x),c(u+3,l,h,p,x))}function bd(t,n,r,i,o){if(o.heightReference===xl.CLAMP_TO_GROUND){var a=t._scene,s=n.context,u=n.globeTranslucencyState.translucent,c=e(a.globe)&&a.globe.depthTestAgainstTerrain;t._shaderClampToGround=s.depthTexture&&!u&&c}var l,h=i[Gh.textureCoordinateBoundsOrLabelTranslate];if(Ds.maximumVertexTextureImageUnits>0){var d=0,f=0;return e(o._labelTranslate)&&(d=o._labelTranslate.x,f=o._labelTranslate.y),void(t._instanced?h(l=o._index,d,f,0,0):(h((l=4*o._index)+0,d,f,0,0),h(l+1,d,f,0,0),h(l+2,d,f,0,0),h(l+3,d,f,0,0)))}var m=0,p=0,_=0,g=0,v=o._imageIndex;if(-1!==v){var y=r[v];m=y.x,p=y.y,_=y.width,g=y.height}var T=m+_,E=p+g;t._instanced?h(l=o._index,m,p,T,E):(h((l=4*o._index)+0,m,p,T,E),h(l+1,m,p,T,E),h(l+2,m,p,T,E),h(l+3,m,p,T,E))}function Dd(e,t,n,r,i){if(e._sdf){var o,a=r[Gh.sdf],s=i.outlineColor,u=i.outlineWidth,c=65536*pn.floatToByte(s.red)+256*pn.floatToByte(s.green)+pn.floatToByte(s.blue),l=u/Ch.RADIUS,h=65536*pn.floatToByte(s.alpha)+256*pn.floatToByte(l);e._instanced?a(o=i._index,c,h):(a((o=4*i._index)+0,c+0,h),a(o+1,c+2,h),a(o+2,c+3,h),a(o+3,c+1,h))}}function Id(t,n,r,i,o){vd(t,0,0,i,o),Td(t,0,r,i,o),Ed(t,0,r,i,o),xd(t,n,r,i,o),Cd(t,0,r,i,o),Sd(t,0,0,i,o),Ad(t,0,0,i,o),wd(t,n,r,i,o),bd(t,n,r,i,o),function(t,n,r,i,o){if(e(t._batchTable)){var a,s=i[Gh.a_batchId],u=o._batchIndex;t._instanced?s(a=o._index,u):(s(0+(a=4*o._index),u),s(a+1,u),s(a+2,u),s(a+3,u))}}(t,0,0,i,o),Dd(t,0,0,i,o)}function Rd(t,n,r,i,o,a){var s;i.mode===Al.SCENE3D?(s=t._baseVolume,t._boundingVolumeDirty=!0):s=t._baseVolume2D;for(var u=[],c=0;c<r;++c){var l=n[c],h=l.position,d=Yl._computeActualPosition(l,h,i,o);e(d)&&(l._setActualPosition(d),a?u.push(d):Me.expand(s,d,s))}a&&Me.fromPoints(u,s)}var Pd=[];hd.prototype.update=function(t){fd(this);var n=this._billboards,r=n.length,i=t.context;this._instanced=i.instancedArrays,Gh=this._instanced?ld:cd,kh=this._instanced?pd:md;var o=this._textureAtlas;if(!e(o)){o=this._textureAtlas=new Uh({context:i});for(var a=0;a<r;++a)n[a]._loadImage()}var s=o.textureCoordinates;if(0!==s.length){!function(e,t){var n=t.mode,r=e._billboards,i=e._billboardsToUpdate,o=e._modelMatrix;e._createVertexArray||e._mode!==n||n!==Al.SCENE3D&&!ye.equals(o,e.modelMatrix)?(e._mode=n,ye.clone(e.modelMatrix,o),e._createVertexArray=!0,n!==Al.SCENE3D&&n!==Al.SCENE2D&&n!==Al.COLUMBUS_VIEW||Rd(e,r,r.length,t,o,!0)):n===Al.MORPHING?Rd(e,r,r.length,t,o,!0):n!==Al.SCENE2D&&n!==Al.COLUMBUS_VIEW||Rd(e,i,e._billboardsToUpdateIndex,t,o,!1)}(this,t),r=(n=this._billboards).length;var u,c=this._billboardsToUpdate,l=this._billboardsToUpdateIndex,h=this._propertiesChanged,d=o.guid,f=this._createVertexArray||this._textureAtlasGUID!==d;this._textureAtlasGUID=d;var m=t.passes,p=m.pick;if(f||!p&&this.computeNewBuffersUsage()){this._createVertexArray=!1;for(var _=0;_<ud;++_)h[_]=0;if(this._vaf=this._vaf&&this._vaf.destroy(),r>0){this._vaf=function(t,n,r,i,o,a){var s=[{index:Gh.positionHighAndScale,componentsPerAttribute:4,componentDatatype:xn.FLOAT,usage:r[qh]},{index:Gh.positionLowAndRotation,componentsPerAttribute:4,componentDatatype:xn.FLOAT,usage:r[qh]},{index:Gh.compressedAttribute0,componentsPerAttribute:4,componentDatatype:xn.FLOAT,usage:r[Yh]},{index:Gh.compressedAttribute1,componentsPerAttribute:4,componentDatatype:xn.FLOAT,usage:r[nd]},{index:Gh.compressedAttribute2,componentsPerAttribute:4,componentDatatype:xn.FLOAT,usage:r[Jh]},{index:Gh.eyeOffset,componentsPerAttribute:4,componentDatatype:xn.FLOAT,usage:r[jh]},{index:Gh.scaleByDistance,componentsPerAttribute:4,componentDatatype:xn.FLOAT,usage:r[td]},{index:Gh.pixelOffsetScaleByDistance,componentsPerAttribute:4,componentDatatype:xn.FLOAT,usage:r[rd]},{index:Gh.compressedAttribute3,componentsPerAttribute:4,componentDatatype:xn.FLOAT,usage:r[id]},{index:Gh.textureCoordinateBoundsOrLabelTranslate,componentsPerAttribute:4,componentDatatype:xn.FLOAT,usage:r[ad]}];return i&&s.push({index:Gh.direction,componentsPerAttribute:2,componentDatatype:xn.FLOAT,vertexBuffer:_d(t)}),e(o)&&s.push({index:Gh.a_batchId,componentsPerAttribute:1,componentDatatype:xn.FLOAT,bufferUsage:ws.STATIC_DRAW}),a&&s.push({index:Gh.sdf,componentsPerAttribute:2,componentDatatype:xn.FLOAT,usage:r[sd]}),new Ac(t,s,i?n:4*n,i)}(i,r,this._buffersUsage,this._instanced,this._batchTable,this._sdf),u=this._vaf.writers;for(var g=0;g<r;++g){var v=this._billboards[g];v._dirty=!1,Id(this,t,s,u,v)}this._vaf.commit(kh(i))}this._billboardsToUpdateIndex=0}else if(l>0){var y=Pd;y.length=0,(h[qh]||h[$h]||h[Kh])&&y.push(vd),(h[Qh]||h[Yh]||h[Xh]||h[Zh]||h[Wh])&&(y.push(Td),this._instanced&&y.push(Cd)),(h[Qh]||h[ed]||h[nd])&&(y.push(Ed),y.push(xd)),(h[Qh]||h[Jh])&&y.push(xd),h[jh]&&y.push(Cd),h[td]&&y.push(Sd),h[rd]&&y.push(Ad),(h[id]||h[od]||h[Qh]||h[qh])&&y.push(wd),(h[Qh]||h[qh])&&y.push(bd),h[sd]&&y.push(Dd);var T=y.length;if(u=this._vaf.writers,l/r>.1){for(var E=0;E<l;++E){var x=c[E];x._dirty=!1;for(var C=0;C<T;++C)y[C](this,t,s,u,x)}this._vaf.commit(kh(i))}else{for(var S=0;S<l;++S){var A=c[S];A._dirty=!1;for(var w=0;w<T;++w)y[w](this,t,s,u,A);this._instanced?this._vaf.subCommit(A._index,1):this._vaf.subCommit(4*A._index,4)}this._vaf.endSubCommits()}this._billboardsToUpdateIndex=0}if(l>1.5*r&&(c.length=r),e(this._vaf)&&e(this._vaf.va)){var b;this._boundingVolumeDirty&&(this._boundingVolumeDirty=!1,Me.transform(this._baseVolume,this.modelMatrix,this._baseVolumeWC));var D=ye.IDENTITY;t.mode===Al.SCENE3D?(D=this.modelMatrix,b=Me.clone(this._baseVolumeWC,this._boundingVolume)):b=Me.clone(this._baseVolume2D,this._boundingVolume),function(e,t,n){var r=1;e._allSizedInMeters&&0===e._maxPixelOffset||(r=t.camera.getPixelSize(n,t.context.drawingBufferWidth,t.context.drawingBufferHeight));var i=r*e._maxScale*e._maxSize*2;e._allHorizontalCenter&&e._allVerticalCenter&&(i*=.5);var o=r*e._maxPixelOffset+e._maxEyeOffset;n.radius+=i+o}(this,t,b);var I,R,P,O,N,M=this._blendOption!==this.blendOption;if(this._blendOption=this.blendOption,M){this._blendOption===xh.OPAQUE||this._blendOption===xh.OPAQUE_AND_TRANSLUCENT?this._rsOpaque=Us.fromCache({depthTest:{enabled:!0,func:Tn.LESS},depthMask:!0}):this._rsOpaque=void 0;var L=this._blendOption===xh.TRANSLUCENT;this._blendOption===xh.TRANSLUCENT||this._blendOption===xh.OPAQUE_AND_TRANSLUCENT?this._rsTranslucent=Us.fromCache({depthTest:{enabled:!0,func:L?Tn.LEQUAL:Tn.LESS},depthMask:L,blending:Eh.ALPHA_BLEND}):this._rsTranslucent=void 0}this._shaderDisableDepthDistance=this._shaderDisableDepthDistance||0!==t.minimumDisableDepthTestDistance;var F=Ds.maximumVertexTextureImageUnits>0;if(M||this._shaderRotation!==this._compiledShaderRotation||this._shaderAlignedAxis!==this._compiledShaderAlignedAxis||this._shaderScaleByDistance!==this._compiledShaderScaleByDistance||this._shaderTranslucencyByDistance!==this._compiledShaderTranslucencyByDistance||this._shaderPixelOffsetScaleByDistance!==this._compiledShaderPixelOffsetScaleByDistance||this._shaderDistanceDisplayCondition!==this._compiledShaderDistanceDisplayCondition||this._shaderDisableDepthDistance!==this._compiledShaderDisableDepthDistance||this._shaderClampToGround!==this._compiledShaderClampToGround||this._sdf!==this._compiledSDF){I="#ifdef INSTANCED\nattribute vec2 direction;\n#endif\nattribute vec4 positionHighAndScale;\nattribute vec4 positionLowAndRotation;\nattribute vec4 compressedAttribute0;\nattribute vec4 compressedAttribute1;\nattribute vec4 compressedAttribute2;\nattribute vec4 eyeOffset;\nattribute vec4 scaleByDistance;\nattribute vec4 pixelOffsetScaleByDistance;\nattribute vec4 compressedAttribute3;\nattribute vec2 sdf;\n#if defined(VERTEX_DEPTH_CHECK) || defined(FRAGMENT_DEPTH_CHECK)\nattribute vec4 textureCoordinateBoundsOrLabelTranslate;\n#endif\n#ifdef VECTOR_TILE\nattribute float a_batchId;\n#endif\nvarying vec2 v_textureCoordinates;\n#ifdef FRAGMENT_DEPTH_CHECK\nvarying vec4 v_textureCoordinateBounds;\nvarying vec4 v_originTextureCoordinateAndTranslate;\nvarying vec4 v_compressed;\nvarying mat2 v_rotationMatrix;\n#endif\nvarying vec4 v_pickColor;\nvarying vec4 v_color;\n#ifdef SDF\nvarying vec4 v_outlineColor;\nvarying float v_outlineWidth;\n#endif\nconst float UPPER_BOUND = 32768.0;\nconst float SHIFT_LEFT16 = 65536.0;\nconst float SHIFT_LEFT12 = 4096.0;\nconst float SHIFT_LEFT8 = 256.0;\nconst float SHIFT_LEFT7 = 128.0;\nconst float SHIFT_LEFT5 = 32.0;\nconst float SHIFT_LEFT3 = 8.0;\nconst float SHIFT_LEFT2 = 4.0;\nconst float SHIFT_LEFT1 = 2.0;\nconst float SHIFT_RIGHT12 = 1.0 / 4096.0;\nconst float SHIFT_RIGHT8 = 1.0 / 256.0;\nconst float SHIFT_RIGHT7 = 1.0 / 128.0;\nconst float SHIFT_RIGHT5 = 1.0 / 32.0;\nconst float SHIFT_RIGHT3 = 1.0 / 8.0;\nconst float SHIFT_RIGHT2 = 1.0 / 4.0;\nconst float SHIFT_RIGHT1 = 1.0 / 2.0;\nvec4 addScreenSpaceOffset(vec4 positionEC, vec2 imageSize, float scale, vec2 direction, vec2 origin, vec2 translate, vec2 pixelOffset, vec3 alignedAxis, bool validAlignedAxis, float rotation, bool sizeInMeters, out mat2 rotationMatrix, out float mpp)\n{\nvec2 halfSize = imageSize * scale * 0.5;\nhalfSize *= ((direction * 2.0) - 1.0);\nvec2 originTranslate = origin * abs(halfSize);\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nif (validAlignedAxis || rotation != 0.0)\n{\nfloat angle = rotation;\nif (validAlignedAxis)\n{\nvec4 projectedAlignedAxis = czm_modelViewProjection * vec4(alignedAxis, 0.0);\nangle += sign(-projectedAlignedAxis.x) * acos(sign(projectedAlignedAxis.y) * (projectedAlignedAxis.y * projectedAlignedAxis.y) /\n(projectedAlignedAxis.x * projectedAlignedAxis.x + projectedAlignedAxis.y * projectedAlignedAxis.y));\n}\nfloat cosTheta = cos(angle);\nfloat sinTheta = sin(angle);\nrotationMatrix = mat2(cosTheta, sinTheta, -sinTheta, cosTheta);\nhalfSize = rotationMatrix * halfSize;\n}\nelse\n{\nrotationMatrix = mat2(1.0, 0.0, 0.0, 1.0);\n}\n#endif\nmpp = czm_metersPerPixel(positionEC);\npositionEC.xy += (originTranslate + halfSize) * czm_branchFreeTernary(sizeInMeters, 1.0, mpp);\npositionEC.xy += (translate + pixelOffset) * mpp;\nreturn positionEC;\n}\n#ifdef VERTEX_DEPTH_CHECK\nfloat getGlobeDepth(vec4 positionEC)\n{\nvec4 posWC = czm_eyeToWindowCoordinates(positionEC);\nfloat globeDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, posWC.xy / czm_viewport.zw));\nif (globeDepth == 0.0)\n{\nreturn 0.0;\n}\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(posWC.xy, globeDepth);\nreturn eyeCoordinate.z / eyeCoordinate.w;\n}\n#endif\nvoid main()\n{\nvec3 positionHigh = positionHighAndScale.xyz;\nvec3 positionLow = positionLowAndRotation.xyz;\nfloat scale = positionHighAndScale.w;\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nfloat rotation = positionLowAndRotation.w;\n#else\nfloat rotation = 0.0;\n#endif\nfloat compressed = compressedAttribute0.x;\nvec2 pixelOffset;\npixelOffset.x = floor(compressed * SHIFT_RIGHT7);\ncompressed -= pixelOffset.x * SHIFT_LEFT7;\npixelOffset.x -= UPPER_BOUND;\nvec2 origin;\norigin.x = floor(compressed * SHIFT_RIGHT5);\ncompressed -= origin.x * SHIFT_LEFT5;\norigin.y = floor(compressed * SHIFT_RIGHT3);\ncompressed -= origin.y * SHIFT_LEFT3;\n#ifdef FRAGMENT_DEPTH_CHECK\nvec2 depthOrigin = origin.xy;\n#endif\norigin -= vec2(1.0);\nfloat show = floor(compressed * SHIFT_RIGHT2);\ncompressed -= show * SHIFT_LEFT2;\n#ifdef INSTANCED\nvec2 textureCoordinatesBottomLeft = czm_decompressTextureCoordinates(compressedAttribute0.w);\nvec2 textureCoordinatesRange = czm_decompressTextureCoordinates(eyeOffset.w);\nvec2 textureCoordinates = textureCoordinatesBottomLeft + direction * textureCoordinatesRange;\n#else\nvec2 direction;\ndirection.x = floor(compressed * SHIFT_RIGHT1);\ndirection.y = compressed - direction.x * SHIFT_LEFT1;\nvec2 textureCoordinates = czm_decompressTextureCoordinates(compressedAttribute0.w);\n#endif\nfloat temp = compressedAttribute0.y  * SHIFT_RIGHT8;\npixelOffset.y = -(floor(temp) - UPPER_BOUND);\nvec2 translate;\ntranslate.y = (temp - floor(temp)) * SHIFT_LEFT16;\ntemp = compressedAttribute0.z * SHIFT_RIGHT8;\ntranslate.x = floor(temp) - UPPER_BOUND;\ntranslate.y += (temp - floor(temp)) * SHIFT_LEFT8;\ntranslate.y -= UPPER_BOUND;\ntemp = compressedAttribute1.x * SHIFT_RIGHT8;\nfloat temp2 = floor(compressedAttribute2.w * SHIFT_RIGHT2);\nvec2 imageSize = vec2(floor(temp), temp2);\n#ifdef FRAGMENT_DEPTH_CHECK\nfloat labelHorizontalOrigin = floor(compressedAttribute2.w - (temp2 * SHIFT_LEFT2));\nfloat applyTranslate = 0.0;\nif (labelHorizontalOrigin != 0.0)\n{\napplyTranslate = 1.0;\nlabelHorizontalOrigin -= 2.0;\ndepthOrigin.x = labelHorizontalOrigin + 1.0;\n}\ndepthOrigin = vec2(1.0) - (depthOrigin * 0.5);\n#endif\n#ifdef EYE_DISTANCE_TRANSLUCENCY\nvec4 translucencyByDistance;\ntranslucencyByDistance.x = compressedAttribute1.z;\ntranslucencyByDistance.z = compressedAttribute1.w;\ntranslucencyByDistance.y = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;\ntemp = compressedAttribute1.y * SHIFT_RIGHT8;\ntranslucencyByDistance.w = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;\n#endif\n#if defined(VERTEX_DEPTH_CHECK) || defined(FRAGMENT_DEPTH_CHECK)\ntemp = compressedAttribute3.w;\ntemp = temp * SHIFT_RIGHT12;\nvec2 dimensions;\ndimensions.y = (temp - floor(temp)) * SHIFT_LEFT12;\ndimensions.x = floor(temp);\n#endif\n#ifdef ALIGNED_AXIS\nvec3 alignedAxis = czm_octDecode(floor(compressedAttribute1.y * SHIFT_RIGHT8));\ntemp = compressedAttribute2.z * SHIFT_RIGHT5;\nbool validAlignedAxis = (temp - floor(temp)) * SHIFT_LEFT1 > 0.0;\n#else\nvec3 alignedAxis = vec3(0.0);\nbool validAlignedAxis = false;\n#endif\nvec4 pickColor;\nvec4 color;\ntemp = compressedAttribute2.y;\ntemp = temp * SHIFT_RIGHT8;\npickColor.b = (temp - floor(temp)) * SHIFT_LEFT8;\ntemp = floor(temp) * SHIFT_RIGHT8;\npickColor.g = (temp - floor(temp)) * SHIFT_LEFT8;\npickColor.r = floor(temp);\ntemp = compressedAttribute2.x;\ntemp = temp * SHIFT_RIGHT8;\ncolor.b = (temp - floor(temp)) * SHIFT_LEFT8;\ntemp = floor(temp) * SHIFT_RIGHT8;\ncolor.g = (temp - floor(temp)) * SHIFT_LEFT8;\ncolor.r = floor(temp);\ntemp = compressedAttribute2.z * SHIFT_RIGHT8;\nbool sizeInMeters = floor((temp - floor(temp)) * SHIFT_LEFT7) > 0.0;\ntemp = floor(temp) * SHIFT_RIGHT8;\npickColor.a = (temp - floor(temp)) * SHIFT_LEFT8;\npickColor /= 255.0;\ncolor.a = floor(temp);\ncolor /= 255.0;\nvec4 p = czm_translateRelativeToEye(positionHigh, positionLow);\nvec4 positionEC = czm_modelViewRelativeToEye * p;\n#if defined(FRAGMENT_DEPTH_CHECK) || defined(VERTEX_DEPTH_CHECK)\nfloat eyeDepth = positionEC.z;\n#endif\npositionEC = czm_eyeOffset(positionEC, eyeOffset.xyz);\npositionEC.xyz *= show;\n#if defined(EYE_DISTANCE_SCALING) || defined(EYE_DISTANCE_TRANSLUCENCY) || defined(EYE_DISTANCE_PIXEL_OFFSET) || defined(DISTANCE_DISPLAY_CONDITION) || defined(DISABLE_DEPTH_DISTANCE)\nfloat lengthSq;\nif (czm_sceneMode == czm_sceneMode2D)\n{\nlengthSq = czm_eyeHeight2D.y;\n}\nelse\n{\nlengthSq = dot(positionEC.xyz, positionEC.xyz);\n}\n#endif\n#ifdef EYE_DISTANCE_SCALING\nfloat distanceScale = czm_nearFarScalar(scaleByDistance, lengthSq);\nscale *= distanceScale;\ntranslate *= distanceScale;\nif (scale == 0.0)\n{\npositionEC.xyz = vec3(0.0);\n}\n#endif\nfloat translucency = 1.0;\n#ifdef EYE_DISTANCE_TRANSLUCENCY\ntranslucency = czm_nearFarScalar(translucencyByDistance, lengthSq);\nif (translucency == 0.0)\n{\npositionEC.xyz = vec3(0.0);\n}\n#endif\n#ifdef EYE_DISTANCE_PIXEL_OFFSET\nfloat pixelOffsetScale = czm_nearFarScalar(pixelOffsetScaleByDistance, lengthSq);\npixelOffset *= pixelOffsetScale;\n#endif\n#ifdef DISTANCE_DISPLAY_CONDITION\nfloat nearSq = compressedAttribute3.x;\nfloat farSq = compressedAttribute3.y;\nif (lengthSq < nearSq || lengthSq > farSq)\n{\npositionEC.xyz = vec3(0.0);\n}\n#endif\nmat2 rotationMatrix;\nfloat mpp;\n#ifdef DISABLE_DEPTH_DISTANCE\nfloat disableDepthTestDistance = compressedAttribute3.z;\n#endif\n#ifdef VERTEX_DEPTH_CHECK\nif (lengthSq < disableDepthTestDistance) {\nfloat depthsilon = 10.0;\nvec2 labelTranslate = textureCoordinateBoundsOrLabelTranslate.xy;\nvec4 pEC1 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(0.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\nfloat globeDepth1 = getGlobeDepth(pEC1);\nif (globeDepth1 != 0.0 && pEC1.z + depthsilon < globeDepth1)\n{\nvec4 pEC2 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(0.0, 1.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\nfloat globeDepth2 = getGlobeDepth(pEC2);\nif (globeDepth2 != 0.0 && pEC2.z + depthsilon < globeDepth2)\n{\nvec4 pEC3 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(1.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\nfloat globeDepth3 = getGlobeDepth(pEC3);\nif (globeDepth3 != 0.0 && pEC3.z + depthsilon < globeDepth3)\n{\npositionEC.xyz = vec3(0.0);\n}\n}\n}\n}\n#endif\npositionEC = addScreenSpaceOffset(positionEC, imageSize, scale, direction, origin, translate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\ngl_Position = czm_projection * positionEC;\nv_textureCoordinates = textureCoordinates;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth();\n#endif\n#ifdef DISABLE_DEPTH_DISTANCE\nif (disableDepthTestDistance == 0.0 && czm_minimumDisableDepthTestDistance != 0.0)\n{\ndisableDepthTestDistance = czm_minimumDisableDepthTestDistance;\n}\nif (disableDepthTestDistance != 0.0)\n{\nfloat zclip = gl_Position.z / gl_Position.w;\nbool clipped = (zclip < -1.0 || zclip > 1.0);\nif (!clipped && (disableDepthTestDistance < 0.0 || (lengthSq > 0.0 && lengthSq < disableDepthTestDistance)))\n{\ngl_Position.z = -gl_Position.w;\n#ifdef LOG_DEPTH\nv_depthFromNearPlusOne = 1.0;\n#endif\n}\n}\n#endif\n#ifdef FRAGMENT_DEPTH_CHECK\nif (sizeInMeters) {\ntranslate /= mpp;\ndimensions /= mpp;\nimageSize /= mpp;\n}\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nv_rotationMatrix = rotationMatrix;\n#else\nv_rotationMatrix = mat2(1.0, 0.0, 0.0, 1.0);\n#endif\nfloat enableDepthCheck = 0.0;\nif (lengthSq < disableDepthTestDistance)\n{\nenableDepthCheck = 1.0;\n}\nfloat dw = floor(clamp(dimensions.x, 0.0, SHIFT_LEFT12));\nfloat dh = floor(clamp(dimensions.y, 0.0, SHIFT_LEFT12));\nfloat iw = floor(clamp(imageSize.x, 0.0, SHIFT_LEFT12));\nfloat ih = floor(clamp(imageSize.y, 0.0, SHIFT_LEFT12));\nv_compressed.x = eyeDepth;\nv_compressed.y = applyTranslate * SHIFT_LEFT1 + enableDepthCheck;\nv_compressed.z = dw * SHIFT_LEFT12 + dh;\nv_compressed.w = iw * SHIFT_LEFT12 + ih;\nv_originTextureCoordinateAndTranslate.xy = depthOrigin;\nv_originTextureCoordinateAndTranslate.zw = translate;\nv_textureCoordinateBounds = textureCoordinateBoundsOrLabelTranslate;\n#endif\n#ifdef SDF\nvec4 outlineColor;\nfloat outlineWidth;\ntemp = sdf.x;\ntemp = temp * SHIFT_RIGHT8;\noutlineColor.b = (temp - floor(temp)) * SHIFT_LEFT8;\ntemp = floor(temp) * SHIFT_RIGHT8;\noutlineColor.g = (temp - floor(temp)) * SHIFT_LEFT8;\noutlineColor.r = floor(temp);\ntemp = sdf.y;\ntemp = temp * SHIFT_RIGHT8;\nfloat temp3 = (temp - floor(temp)) * SHIFT_LEFT8;\ntemp = floor(temp) * SHIFT_RIGHT8;\noutlineWidth = (temp - floor(temp)) * SHIFT_LEFT8;\noutlineColor.a = floor(temp);\noutlineColor /= 255.0;\nv_outlineWidth = outlineWidth / 255.0;\nv_outlineColor = outlineColor;\nv_outlineColor.a *= translucency;\n#endif\nv_pickColor = pickColor;\nv_color = color;\nv_color.a *= translucency;\n}\n",R="#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform sampler2D u_atlas;\n#ifdef VECTOR_TILE\nuniform vec4 u_highlightColor;\n#endif\nvarying vec2 v_textureCoordinates;\nvarying vec4 v_pickColor;\nvarying vec4 v_color;\n#ifdef SDF\nvarying vec4 v_outlineColor;\nvarying float v_outlineWidth;\n#endif\n#ifdef FRAGMENT_DEPTH_CHECK\nvarying vec4 v_textureCoordinateBounds;\nvarying vec4 v_originTextureCoordinateAndTranslate;\nvarying vec4 v_compressed;\nvarying mat2 v_rotationMatrix;\nconst float SHIFT_LEFT12 = 4096.0;\nconst float SHIFT_LEFT1 = 2.0;\nconst float SHIFT_RIGHT12 = 1.0 / 4096.0;\nconst float SHIFT_RIGHT1 = 1.0 / 2.0;\nfloat getGlobeDepth(vec2 adjustedST, vec2 depthLookupST, bool applyTranslate, vec2 dimensions, vec2 imageSize)\n{\nvec2 lookupVector = imageSize * (depthLookupST - adjustedST);\nlookupVector = v_rotationMatrix * lookupVector;\nvec2 labelOffset = (dimensions - imageSize) * (depthLookupST - vec2(0.0, v_originTextureCoordinateAndTranslate.y));\nvec2 translation = v_originTextureCoordinateAndTranslate.zw;\nif (applyTranslate)\n{\ntranslation += (dimensions * v_originTextureCoordinateAndTranslate.xy * vec2(1.0, 0.0));\n}\nvec2 st = ((lookupVector - translation + labelOffset) + gl_FragCoord.xy) / czm_viewport.zw;\nfloat logDepthOrDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, st));\nif (logDepthOrDepth == 0.0)\n{\nreturn 0.0;\n}\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);\nreturn eyeCoordinate.z / eyeCoordinate.w;\n}\n#endif\n#ifdef SDF\nfloat getDistance(vec2 position)\n{\nreturn texture2D(u_atlas, position).r;\n}\nvec4 getSDFColor(vec2 position, float outlineWidth, vec4 outlineColor, float smoothing)\n{\nfloat distance = getDistance(position);\nif (outlineWidth > 0.0)\n{\nfloat outlineEdge = clamp(SDF_EDGE - outlineWidth, 0.0, SDF_EDGE);\nfloat outlineFactor = smoothstep(SDF_EDGE - smoothing, SDF_EDGE + smoothing, distance);\nvec4 sdfColor = mix(outlineColor, v_color, outlineFactor);\nfloat alpha = smoothstep(outlineEdge - smoothing, outlineEdge + smoothing, distance);\nreturn vec4(sdfColor.rgb, sdfColor.a * alpha);\n}\nelse\n{\nfloat alpha = smoothstep(SDF_EDGE - smoothing, SDF_EDGE + smoothing, distance);\nreturn vec4(v_color.rgb, v_color.a * alpha);\n}\n}\n#endif\nvoid main()\n{\nvec4 color = texture2D(u_atlas, v_textureCoordinates);\n#ifdef SDF\nfloat outlineWidth = v_outlineWidth;\nvec4 outlineColor = v_outlineColor;\nfloat distance = getDistance(v_textureCoordinates);\n#ifdef GL_OES_standard_derivatives\nfloat smoothing = fwidth(distance);\nvec2 sampleOffset = 0.354 * vec2(dFdx(v_textureCoordinates) + dFdy(v_textureCoordinates));\nvec4 center = getSDFColor(v_textureCoordinates, outlineWidth, outlineColor, smoothing);\nvec4 color1 = getSDFColor(v_textureCoordinates + vec2(sampleOffset.x, sampleOffset.y), outlineWidth, outlineColor, smoothing);\nvec4 color2 = getSDFColor(v_textureCoordinates + vec2(-sampleOffset.x, sampleOffset.y), outlineWidth, outlineColor, smoothing);\nvec4 color3 = getSDFColor(v_textureCoordinates + vec2(-sampleOffset.x, -sampleOffset.y), outlineWidth, outlineColor, smoothing);\nvec4 color4 = getSDFColor(v_textureCoordinates + vec2(sampleOffset.x, -sampleOffset.y), outlineWidth, outlineColor, smoothing);\ncolor = (center + color1 + color2 + color3 + color4)/5.0;\n#else\nfloat smoothing = 1.0/32.0;\ncolor = getSDFColor(v_textureCoordinates, outlineWidth, outlineColor, smoothing);\n#endif\ncolor = czm_gammaCorrect(color);\n#else\ncolor = czm_gammaCorrect(color);\ncolor *= czm_gammaCorrect(v_color);\n#endif\n#if !defined(OPAQUE) && !defined(TRANSLUCENT)\nif (color.a < 0.005)\n{\ndiscard;\n}\n#else\n#ifdef OPAQUE\nif (color.a < 0.995)\n{\ndiscard;\n}\n#else\nif (color.a >= 0.995)\n{\ndiscard;\n}\n#endif\n#endif\n#ifdef VECTOR_TILE\ncolor *= u_highlightColor;\n#endif\ngl_FragColor = color;\n#ifdef LOG_DEPTH\nczm_writeLogDepth();\n#endif\n#ifdef FRAGMENT_DEPTH_CHECK\nfloat temp = v_compressed.y;\ntemp = temp * SHIFT_RIGHT1;\nfloat temp2 = (temp - floor(temp)) * SHIFT_LEFT1;\nbool enableDepthTest = temp2 != 0.0;\nbool applyTranslate = floor(temp) != 0.0;\nif (enableDepthTest) {\ntemp = v_compressed.z;\ntemp = temp * SHIFT_RIGHT12;\nvec2 dimensions;\ndimensions.y = (temp - floor(temp)) * SHIFT_LEFT12;\ndimensions.x = floor(temp);\ntemp = v_compressed.w;\ntemp = temp * SHIFT_RIGHT12;\nvec2 imageSize;\nimageSize.y = (temp - floor(temp)) * SHIFT_LEFT12;\nimageSize.x = floor(temp);\nvec2 adjustedST = v_textureCoordinates - v_textureCoordinateBounds.xy;\nadjustedST = adjustedST / vec2(v_textureCoordinateBounds.z - v_textureCoordinateBounds.x, v_textureCoordinateBounds.w - v_textureCoordinateBounds.y);\nfloat epsilonEyeDepth = v_compressed.x + czm_epsilon1;\nfloat globeDepth1 = getGlobeDepth(adjustedST, v_originTextureCoordinateAndTranslate.xy, applyTranslate, dimensions, imageSize);\nif (globeDepth1 != 0.0 && globeDepth1 > epsilonEyeDepth)\n{\nfloat globeDepth2 = getGlobeDepth(adjustedST, vec2(0.0, 1.0), applyTranslate, dimensions, imageSize);\nif (globeDepth2 != 0.0 && globeDepth2 > epsilonEyeDepth)\n{\nfloat globeDepth3 = getGlobeDepth(adjustedST, vec2(1.0, 1.0), applyTranslate, dimensions, imageSize);\nif (globeDepth3 != 0.0 && globeDepth3 > epsilonEyeDepth)\n{\ndiscard;\n}\n}\n}\n}\n#endif\n}\n",N=[],e(this._batchTable)&&(N.push("VECTOR_TILE"),I=this._batchTable.getVertexShaderCallback(!1,"a_batchId",void 0)(I),R=this._batchTable.getFragmentShaderCallback(!1,void 0)(R)),P=new nc({defines:N,sources:[I]}),this._instanced&&P.defines.push("INSTANCED"),this._shaderRotation&&P.defines.push("ROTATION"),this._shaderAlignedAxis&&P.defines.push("ALIGNED_AXIS"),this._shaderScaleByDistance&&P.defines.push("EYE_DISTANCE_SCALING"),this._shaderTranslucencyByDistance&&P.defines.push("EYE_DISTANCE_TRANSLUCENCY"),this._shaderPixelOffsetScaleByDistance&&P.defines.push("EYE_DISTANCE_PIXEL_OFFSET"),this._shaderDistanceDisplayCondition&&P.defines.push("DISTANCE_DISPLAY_CONDITION"),this._shaderDisableDepthDistance&&P.defines.push("DISABLE_DEPTH_DISTANCE"),this._shaderClampToGround&&(F?P.defines.push("VERTEX_DEPTH_CHECK"):P.defines.push("FRAGMENT_DEPTH_CHECK"));var z=1-Ch.CUTOFF;this._sdf&&P.defines.push("SDF");var B=e(this._batchTable)?"VECTOR_TILE":"";this._blendOption===xh.OPAQUE_AND_TRANSLUCENT&&(O=new nc({defines:["OPAQUE",B],sources:[R]}),this._shaderClampToGround&&(F?O.defines.push("VERTEX_DEPTH_CHECK"):O.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(O.defines.push("SDF"),O.defines.push("SDF_EDGE "+z)),this._sp=Hu.replaceCache({context:i,shaderProgram:this._sp,vertexShaderSource:P,fragmentShaderSource:O,attributeLocations:Gh}),O=new nc({defines:["TRANSLUCENT",B],sources:[R]}),this._shaderClampToGround&&(F?O.defines.push("VERTEX_DEPTH_CHECK"):O.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(O.defines.push("SDF"),O.defines.push("SDF_EDGE "+z)),this._spTranslucent=Hu.replaceCache({context:i,shaderProgram:this._spTranslucent,vertexShaderSource:P,fragmentShaderSource:O,attributeLocations:Gh})),this._blendOption===xh.OPAQUE&&(O=new nc({defines:[B],sources:[R]}),this._shaderClampToGround&&(F?O.defines.push("VERTEX_DEPTH_CHECK"):O.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(O.defines.push("SDF"),O.defines.push("SDF_EDGE "+z)),this._sp=Hu.replaceCache({context:i,shaderProgram:this._sp,vertexShaderSource:P,fragmentShaderSource:O,attributeLocations:Gh})),this._blendOption===xh.TRANSLUCENT&&(O=new nc({defines:[B],sources:[R]}),this._shaderClampToGround&&(F?O.defines.push("VERTEX_DEPTH_CHECK"):O.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(O.defines.push("SDF"),O.defines.push("SDF_EDGE "+z)),this._spTranslucent=Hu.replaceCache({context:i,shaderProgram:this._spTranslucent,vertexShaderSource:P,fragmentShaderSource:O,attributeLocations:Gh})),this._compiledShaderRotation=this._shaderRotation,this._compiledShaderAlignedAxis=this._shaderAlignedAxis,this._compiledShaderScaleByDistance=this._shaderScaleByDistance,this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance,this._compiledShaderPixelOffsetScaleByDistance=this._shaderPixelOffsetScaleByDistance,this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition,this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance,this._compiledShaderClampToGround=this._shaderClampToGround,this._compiledSDF=this._sdf}var U=t.commandList;if(m.render||m.pick){var V,H=this._colorCommands,G=this._blendOption===xh.OPAQUE,k=this._blendOption===xh.OPAQUE_AND_TRANSLUCENT,W=this._vaf.va,q=W.length,Y=this._uniforms;e(this._batchTable)?(Y=this._batchTable.getUniformMapCallback()(Y),V=this._batchTable.getPickId()):V="v_pickColor",H.length=q;for(var j=k?2*q:q,X=0;X<j;++X){var Z=H[X];e(Z)||(Z=H[X]=new Ps);var K=G||k&&X%2==0;Z.pass=K||!k?Os.OPAQUE:Os.TRANSLUCENT,Z.owner=this;var Q=k?Math.floor(X/2):X;Z.boundingVolume=b,Z.modelMatrix=D,Z.count=W[Q].indicesCount,Z.shaderProgram=K?this._sp:this._spTranslucent,Z.uniformMap=Y,Z.vertexArray=W[Q].va,Z.renderState=K?this._rsOpaque:this._rsTranslucent,Z.debugShowBoundingVolume=this.debugShowBoundingVolume,Z.pickId=V,this._instanced&&(Z.count=6,Z.instanceCount=r),U.push(Z)}this.debugShowTextureAtlas&&(e(this.debugCommand)||(this.debugCommand=function(e,t){var n=t.createViewportQuadCommand("uniform sampler2D billboard_texture; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    gl_FragColor = texture2D(billboard_texture, v_textureCoordinates); \n} \n",{uniformMap:{billboard_texture:function(){return e._textureAtlas.texture}}});return n.pass=Os.OVERLAY,n}(this,t.context)),U.push(this.debugCommand))}}}},hd.prototype.isDestroyed=function(){return!1},hd.prototype.destroy=function(){return e(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spTranslucent=this._spTranslucent&&this._spTranslucent.destroy(),this._vaf=this._vaf&&this._vaf.destroy(),dd(this._billboards),hi(this)};var Od=Object.freeze({LEFT_DRAG:0,RIGHT_DRAG:1,MIDDLE_DRAG:2,WHEEL:3,PINCH:4});function Nd(t,n){var r=t;return e(n)&&(r+="+"+n),r}function Md(t,n,r){var i=Nd(Od.PINCH,n),o=t._update,a=t._isDown,s=t._eventStartPosition,u=t._pressTime,l=t._releaseTime;o[i]=!0,a[i]=!1,s[i]=new c;var h=t._movement[i];e(h)||(h=t._movement[i]={}),h.distance={startPosition:new c,endPosition:new c},h.angleAndHeight={startPosition:new c,endPosition:new c},h.prevAngle=0,t._eventHandler.setInputAction((function(e){t._buttonsDown++,a[i]=!0,u[i]=new Date,c.lerp(e.position1,e.position2,.5,s[i])}),fi.PINCH_START,n),t._eventHandler.setInputAction((function(){t._buttonsDown=Math.max(t._buttonsDown-1,0),a[i]=!1,l[i]=new Date}),fi.PINCH_END,n),t._eventHandler.setInputAction((function(e){if(a[i]){o[i]?(u=e,l=h,c.clone(u.distance.startPosition,l.distance.startPosition),c.clone(u.distance.endPosition,l.distance.endPosition),c.clone(u.angleAndHeight.startPosition,l.angleAndHeight.startPosition),c.clone(u.angleAndHeight.endPosition,l.angleAndHeight.endPosition),o[i]=!1,h.prevAngle=h.angleAndHeight.startPosition.x):(c.clone(e.distance.endPosition,h.distance.endPosition),c.clone(e.angleAndHeight.endPosition,h.angleAndHeight.endPosition));for(var t=h.angleAndHeight.endPosition.x,n=h.prevAngle,s=2*Math.PI;t>=n+Math.PI;)t-=s;for(;t<n-Math.PI;)t+=s;h.angleAndHeight.endPosition.x=-t*r.clientWidth/12,h.angleAndHeight.startPosition.x=-n*r.clientWidth/12}var u,l}),fi.PINCH_MOVE,n)}function Ld(t,n){var r=Nd(Od.WHEEL,n),i=t._update;i[r]=!0;var o=t._movement[r];e(o)||(o=t._movement[r]={}),o.startPosition=new c,o.endPosition=new c,t._eventHandler.setInputAction((function(e){var t=15*a.toRadians(e);i[r]?(c.clone(c.ZERO,o.startPosition),o.endPosition.x=0,o.endPosition.y=t,i[r]=!1):o.endPosition.y=o.endPosition.y+t}),fi.WHEEL,n)}function Fd(t,n,r){var i=Nd(r,n),o=t._isDown,a=t._eventStartPosition,s=t._pressTime,u=t._releaseTime;o[i]=!1,a[i]=new c;var l,h,d=t._lastMovement[i];e(d)||(d=t._lastMovement[i]={startPosition:new c,endPosition:new c,valid:!1}),r===Od.LEFT_DRAG?(l=fi.LEFT_DOWN,h=fi.LEFT_UP):r===Od.RIGHT_DRAG?(l=fi.RIGHT_DOWN,h=fi.RIGHT_UP):r===Od.MIDDLE_DRAG&&(l=fi.MIDDLE_DOWN,h=fi.MIDDLE_UP),t._eventHandler.setInputAction((function(e){t._buttonsDown++,d.valid=!1,o[i]=!0,s[i]=new Date,c.clone(e.position,a[i])}),l,n),t._eventHandler.setInputAction((function(){t._buttonsDown=Math.max(t._buttonsDown-1,0),o[i]=!1,u[i]=new Date}),h,n)}function zd(e,t){c.clone(e.startPosition,t.startPosition),c.clone(e.endPosition,t.endPosition)}function Bd(t,n){var r=t._update,i=t._movement,o=t._lastMovement,a=t._isDown;for(var s in Od)if(Od.hasOwnProperty(s)){var u=Od[s];if(e(u)){var l=Nd(u,n);r[l]=!0,e(t._lastMovement[l])||(t._lastMovement[l]={startPosition:new c,endPosition:new c,valid:!1}),e(t._movement[l])||(t._movement[l]={startPosition:new c,endPosition:new c})}}t._eventHandler.setInputAction((function(s){for(var u in Od)if(Od.hasOwnProperty(u)){var l=Od[u];if(e(l)){var h=Nd(l,n);a[h]&&(r[h]?(zd(i[h],o[h]),o[h].valid=!0,zd(s,i[h]),r[h]=!1):c.clone(s.endPosition,i[h].endPosition))}}c.clone(s.endPosition,t._currentMousePosition)}),fi.MOUSE_MOVE,n)}function Ud(t){for(var n in this._eventHandler=new Ki(t),this._update={},this._movement={},this._lastMovement={},this._isDown={},this._eventStartPosition={},this._pressTime={},this._releaseTime={},this._buttonsDown=0,this._currentMousePosition=new c,Ld(this,void 0),Md(this,void 0,t),Fd(this,void 0,Od.LEFT_DRAG),Fd(this,void 0,Od.RIGHT_DRAG),Fd(this,void 0,Od.MIDDLE_DRAG),Bd(this,void 0),dr)if(dr.hasOwnProperty(n)){var r=dr[n];e(r)&&(Ld(this,r),Md(this,r,t),Fd(this,r,Od.LEFT_DRAG),Fd(this,r,Od.RIGHT_DRAG),Fd(this,r,Od.MIDDLE_DRAG),Bd(this,r))}}function Vd(e){e=i(e,i.EMPTY_OBJECT),this._ellipsoid=i(e.ellipsoid,H.WGS84),this._rectangle=i(e.rectangle,Oe.MAX_VALUE),this._projection=new K(this._ellipsoid),this._numberOfLevelZeroTilesX=i(e.numberOfLevelZeroTilesX,2),this._numberOfLevelZeroTilesY=i(e.numberOfLevelZeroTilesY,1)}Object.defineProperties(Ud.prototype,{currentMousePosition:{get:function(){return this._currentMousePosition}},anyButtonDown:{get:function(){var e=!(this._update[Nd(Od.WHEEL)]&&this._update[Nd(Od.WHEEL,dr.SHIFT)]&&this._update[Nd(Od.WHEEL,dr.CTRL)]&&this._update[Nd(Od.WHEEL,dr.ALT)]);return this._buttonsDown>0||e}}}),Ud.prototype.isMoving=function(e,t){var n=Nd(e,t);return!this._update[n]},Ud.prototype.getMovement=function(e,t){var n=Nd(e,t);return this._movement[n]},Ud.prototype.getLastMovement=function(e,t){var n=Nd(e,t),r=this._lastMovement[n];if(r.valid)return r},Ud.prototype.isButtonDown=function(e,t){var n=Nd(e,t);return this._isDown[n]},Ud.prototype.getStartMousePosition=function(e,t){if(e===Od.WHEEL)return this._currentMousePosition;var n=Nd(e,t);return this._eventStartPosition[n]},Ud.prototype.getButtonPressTime=function(e,t){var n=Nd(e,t);return this._pressTime[n]},Ud.prototype.getButtonReleaseTime=function(e,t){var n=Nd(e,t);return this._releaseTime[n]},Ud.prototype.reset=function(){for(var e in this._update)this._update.hasOwnProperty(e)&&(this._update[e]=!0)},Ud.prototype.isDestroyed=function(){return!1},Ud.prototype.destroy=function(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),hi(this)},Object.defineProperties(Vd.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),Vd.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},Vd.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},Vd.prototype.rectangleToNativeRectangle=function(t,n){var r=a.toDegrees(t.west),i=a.toDegrees(t.south),o=a.toDegrees(t.east),s=a.toDegrees(t.north);return e(n)?(n.west=r,n.south=i,n.east=o,n.north=s,n):new Oe(r,i,o,s)},Vd.prototype.tileXYToNativeRectangle=function(e,t,n,r){var i=this.tileXYToRectangle(e,t,n,r);return i.west=a.toDegrees(i.west),i.south=a.toDegrees(i.south),i.east=a.toDegrees(i.east),i.north=a.toDegrees(i.north),i},Vd.prototype.tileXYToRectangle=function(t,n,r,i){var o=this._rectangle,a=this.getNumberOfXTilesAtLevel(r),s=this.getNumberOfYTilesAtLevel(r),u=o.width/a,c=t*u+o.west,l=(t+1)*u+o.west,h=o.height/s,d=o.north-n*h,f=o.north-(n+1)*h;return e(i)||(i=new Oe(c,f,l,d)),i.west=c,i.south=f,i.east=l,i.north=d,i},Vd.prototype.positionToTileXY=function(t,n,r){var i=this._rectangle;if(Oe.contains(i,t)){var o=this.getNumberOfXTilesAtLevel(n),s=this.getNumberOfYTilesAtLevel(n),u=i.width/o,l=i.height/s,h=t.longitude;i.east<i.west&&(h+=a.TWO_PI);var d=(h-i.west)/u|0;d>=o&&(d=o-1);var f=(i.north-t.latitude)/l|0;return f>=s&&(f=s-1),e(r)?(r.x=d,r.y=f,r):new c(d,f)}};var Hd=Object.freeze({NONE:0,LERC:1});function Gd(t,n,r){this.minimum=p.clone(i(t,p.ZERO)),this.maximum=p.clone(i(n,p.ZERO)),r=e(r)?p.clone(r):p.midpoint(this.minimum,this.maximum,new p),this.center=r}Gd.fromPoints=function(t,n){if(e(n)||(n=new Gd),!e(t)||0===t.length)return n.minimum=p.clone(p.ZERO,n.minimum),n.maximum=p.clone(p.ZERO,n.maximum),n.center=p.clone(p.ZERO,n.center),n;for(var r=t[0].x,i=t[0].y,o=t[0].z,a=t[0].x,s=t[0].y,u=t[0].z,c=t.length,l=1;l<c;l++){var h=t[l],d=h.x,f=h.y,m=h.z;r=Math.min(d,r),a=Math.max(d,a),i=Math.min(f,i),s=Math.max(f,s),o=Math.min(m,o),u=Math.max(m,u)}var _=n.minimum;_.x=r,_.y=i,_.z=o;var g=n.maximum;return g.x=a,g.y=s,g.z=u,n.center=p.midpoint(_,g,n.center),n},Gd.clone=function(t,n){if(e(t))return e(n)?(n.minimum=p.clone(t.minimum,n.minimum),n.maximum=p.clone(t.maximum,n.maximum),n.center=p.clone(t.center,n.center),n):new Gd(t.minimum,t.maximum,t.center)},Gd.equals=function(t,n){return t===n||e(t)&&e(n)&&p.equals(t.center,n.center)&&p.equals(t.minimum,n.minimum)&&p.equals(t.maximum,n.maximum)};var kd=new p;function Wd(t,n){this._ellipsoid=t,this._cameraPosition=new p,this._cameraPositionInScaledSpace=new p,this._distanceToLimbInScaledSpaceSquared=0,e(n)&&(this.cameraPosition=n)}Gd.intersectPlane=function(e,t){kd=p.subtract(e.maximum,e.minimum,kd);var n=p.multiplyByScalar(kd,.5,kd),r=t.normal,i=n.x*Math.abs(r.x)+n.y*Math.abs(r.y)+n.z*Math.abs(r.z),o=p.dot(e.center,r)+t.distance;return o-i>0?Q.INSIDE:o+i<0?Q.OUTSIDE:Q.INTERSECTING},Gd.prototype.clone=function(e){return Gd.clone(this,e)},Gd.prototype.intersectPlane=function(e){return Gd.intersectPlane(this,e)},Gd.prototype.equals=function(e){return Gd.equals(this,e)},Object.defineProperties(Wd.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},cameraPosition:{get:function(){return this._cameraPosition},set:function(e){var t=this._ellipsoid.transformPositionToScaledSpace(e,this._cameraPositionInScaledSpace),n=p.magnitudeSquared(t)-1;p.clone(e,this._cameraPosition),this._cameraPositionInScaledSpace=t,this._distanceToLimbInScaledSpaceSquared=n}}});var qd=new p;Wd.prototype.isPointVisible=function(e){return ef(this._ellipsoid.transformPositionToScaledSpace(e,qd),this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)},Wd.prototype.isScaledSpacePointVisible=function(e){return ef(e,this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)};var Yd=new p;Wd.prototype.isScaledSpacePointVisiblePossiblyUnderEllipsoid=function(t,n){var r,i,o=this._ellipsoid;return e(n)&&n<0&&o.minimumRadius>-n?((i=Yd).x=this._cameraPosition.x/(o.radii.x+n),i.y=this._cameraPosition.y/(o.radii.y+n),i.z=this._cameraPosition.z/(o.radii.z+n),r=i.x*i.x+i.y*i.y+i.z*i.z-1):(i=this._cameraPositionInScaledSpace,r=this._distanceToLimbInScaledSpaceSquared),ef(t,i,r)},Wd.prototype.computeHorizonCullingPoint=function(e,t,n){return Qd(this._ellipsoid,e,t,n)};var jd=H.clone(H.UNIT_SPHERE);Wd.prototype.computeHorizonCullingPointPossiblyUnderEllipsoid=function(e,t,n,r){return Qd(Kd(this._ellipsoid,n,jd),e,t,r)},Wd.prototype.computeHorizonCullingPointFromVertices=function(e,t,n,r,i){return $d(this._ellipsoid,e,t,n,r,i)},Wd.prototype.computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid=function(e,t,n,r,i,o){return $d(Kd(this._ellipsoid,i,jd),e,t,n,r,o)};var Xd=[];Wd.prototype.computeHorizonCullingPointFromRectangle=function(e,t,n){var r=Oe.subsample(e,t,0,Xd),i=Me.fromPoints(r);if(!(p.magnitude(i.center)<.1*t.minimumRadius))return this.computeHorizonCullingPoint(i.center,r,n)};var Zd=new p;function Kd(t,n,r){if(e(n)&&n<0&&t.minimumRadius>-n){var i=p.fromElements(t.radii.x+n,t.radii.y+n,t.radii.z+n,Zd);t=H.fromCartesian3(i,r)}return t}function Qd(t,n,r,i){e(i)||(i=new p);for(var o=sf(t,n),a=0,s=0,u=r.length;s<u;++s){var c=rf(t,r[s],o);if(c<0)return;a=Math.max(a,c)}return of(o,a,i)}var Jd=new p;function $d(t,n,r,o,a,s){e(s)||(s=new p),o=i(o,3),a=i(a,p.ZERO);for(var u=sf(t,n),c=0,l=0,h=r.length;l<h;l+=o){Jd.x=r[l]+a.x,Jd.y=r[l+1]+a.y,Jd.z=r[l+2]+a.z;var d=rf(t,Jd,u);if(d<0)return;c=Math.max(c,d)}return of(u,c,s)}function ef(e,t,n){var r=t,i=n,o=p.subtract(e,r,qd),a=-p.dot(o,r);return!(i<0?a>0:a>i&&a*a/p.magnitudeSquared(o)>i)}var tf=new p,nf=new p;function rf(e,t,n){var r=e.transformPositionToScaledSpace(t,tf),i=p.magnitudeSquared(r),o=Math.sqrt(i),a=p.divideByScalar(r,o,nf);i=Math.max(1,i);var s=1/(o=Math.max(1,o));return 1/(p.dot(a,n)*s-p.magnitude(p.cross(a,n,a))*(Math.sqrt(i-1)*s))}function of(e,t,n){if(!(t<=0||t===1/0||t!=t))return p.multiplyByScalar(e,t,n)}var af=new p;function sf(e,t){return p.equals(t,p.ZERO)?t:(e.transformPositionToScaledSpace(t,af),p.normalize(af,af))}var uf=new le;function cf(e,t){e=(t=i(t,H.WGS84)).scaleToGeodeticSurface(e);var n=ka.eastNorthUpToFixedFrame(e,t);this._ellipsoid=t,this._origin=e,this._xAxis=p.fromCartesian4(ye.getColumn(n,0,uf)),this._yAxis=p.fromCartesian4(ye.getColumn(n,1,uf));var r=p.fromCartesian4(ye.getColumn(n,2,uf));this._plane=mr.fromPointNormal(e,r)}Object.defineProperties(cf.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},origin:{get:function(){return this._origin}},plane:{get:function(){return this._plane}},xAxis:{get:function(){return this._xAxis}},yAxis:{get:function(){return this._yAxis}},zAxis:{get:function(){return this._plane.normal}}});var lf=new Gd;cf.fromPoints=function(e,t){return new cf(Gd.fromPoints(e,lf).center,t)};var hf=new Fn,df=new p;cf.prototype.projectPointOntoPlane=function(t,n){var r=hf;r.origin=t,p.normalize(t,r.direction);var i=zn.rayPlane(r,this._plane,df);if(e(i)||(p.negate(r.direction,r.direction),i=zn.rayPlane(r,this._plane,df)),e(i)){var o=p.subtract(i,this._origin,i),a=p.dot(this._xAxis,o),s=p.dot(this._yAxis,o);return e(n)?(n.x=a,n.y=s,n):new c(a,s)}},cf.prototype.projectPointsOntoPlane=function(t,n){e(n)||(n=[]);for(var r=0,i=t.length,o=0;o<i;o++){var a=this.projectPointOntoPlane(t[o],n[r]);e(a)&&(n[r]=a,r++)}return n.length=r,n},cf.prototype.projectPointToNearestOnPlane=function(t,n){e(n)||(n=new c);var r=hf;r.origin=t,p.clone(this._plane.normal,r.direction);var i=zn.rayPlane(r,this._plane,df);e(i)||(p.negate(r.direction,r.direction),i=zn.rayPlane(r,this._plane,df));var o=p.subtract(i,this._origin,i),a=p.dot(this._xAxis,o),s=p.dot(this._yAxis,o);return n.x=a,n.y=s,n},cf.prototype.projectPointsToNearestOnPlane=function(t,n){e(n)||(n=[]);var r=t.length;n.length=r;for(var i=0;i<r;i++)n[i]=this.projectPointToNearestOnPlane(t[i],n[i]);return n};var ff=new p;function mf(e,t){this.center=p.clone(i(e,p.ZERO)),this.halfAxes=$.clone(i(t,$.ZERO))}cf.prototype.projectPointOntoEllipsoid=function(t,n){e(n)||(n=new p);var r=this._ellipsoid,i=this._origin,o=this._xAxis,a=this._yAxis,s=ff;return p.multiplyByScalar(o,t.x,s),n=p.add(i,s,n),p.multiplyByScalar(a,t.y,s),p.add(n,s,n),r.scaleToGeocentricSurface(n,n),n},cf.prototype.projectPointsOntoEllipsoid=function(t,n){var r=t.length;e(n)?n.length=r:n=new Array(r);for(var i=0;i<r;++i)n[i]=this.projectPointOntoEllipsoid(t[i],n[i]);return n},mf.packedLength=p.packedLength+$.packedLength,mf.pack=function(e,t,n){return n=i(n,0),p.pack(e.center,t,n),$.pack(e.halfAxes,t,n+p.packedLength),t},mf.unpack=function(t,n,r){return n=i(n,0),e(r)||(r=new mf),p.unpack(t,n,r.center),$.unpack(t,n+p.packedLength,r.halfAxes),r};var pf=new p,_f=new p,gf=new p,vf=new p,yf=new p,Tf=new p,Ef=new $,xf={unitary:new $,diagonal:new $};mf.fromPoints=function(t,n){if(e(n)||(n=new mf),!e(t)||0===t.length)return n.halfAxes=$.ZERO,n.center=p.ZERO,n;var r,i=t.length,o=p.clone(t[0],pf);for(r=1;r<i;r++)p.add(o,t[r],o);var a=1/i;p.multiplyByScalar(o,a,o);var s,u=0,c=0,l=0,h=0,d=0,f=0;for(r=0;r<i;r++)u+=(s=p.subtract(t[r],o,_f)).x*s.x,c+=s.x*s.y,l+=s.x*s.z,h+=s.y*s.y,d+=s.y*s.z,f+=s.z*s.z;u*=a,c*=a,l*=a,h*=a,d*=a,f*=a;var m=Ef;m[0]=u,m[1]=c,m[2]=l,m[3]=c,m[4]=h,m[5]=d,m[6]=l,m[7]=d,m[8]=f;var _=$.computeEigenDecomposition(m,xf),g=$.clone(_.unitary,n.halfAxes),v=$.getColumn(g,0,vf),y=$.getColumn(g,1,yf),T=$.getColumn(g,2,Tf),E=-Number.MAX_VALUE,x=-Number.MAX_VALUE,C=-Number.MAX_VALUE,S=Number.MAX_VALUE,A=Number.MAX_VALUE,w=Number.MAX_VALUE;for(r=0;r<i;r++)s=t[r],E=Math.max(p.dot(v,s),E),x=Math.max(p.dot(y,s),x),C=Math.max(p.dot(T,s),C),S=Math.min(p.dot(v,s),S),A=Math.min(p.dot(y,s),A),w=Math.min(p.dot(T,s),w);v=p.multiplyByScalar(v,.5*(S+E),v),y=p.multiplyByScalar(y,.5*(A+x),y),T=p.multiplyByScalar(T,.5*(w+C),T);var b=p.add(v,y,n.center);p.add(b,T,b);var D=gf;return D.x=E-S,D.y=x-A,D.z=C-w,p.multiplyByScalar(D,.5,D),$.multiplyByScale(n.halfAxes,D,n.halfAxes),n};var Cf=new p,Sf=new p;function Af(t,n,r,i,o,a,s,u,c,l,h){e(h)||(h=new mf);var d=h.halfAxes;$.setColumn(d,0,n,d),$.setColumn(d,1,r,d),$.setColumn(d,2,i,d);var f=Cf;f.x=(o+a)/2,f.y=(s+u)/2,f.z=(c+l)/2;var m=Sf;m.x=(a-o)/2,m.y=(u-s)/2,m.z=(l-c)/2;var _=h.center;return f=$.multiplyByVector(d,f,f),p.add(t,f,_),$.multiplyByScale(d,m,d),h}var wf=new N,bf=new p,Df=new N,If=new N,Rf=new N,Pf=new N,Of=new N,Nf=new p,Mf=new p,Lf=new p,Ff=new p,zf=new p,Bf=new c,Uf=new c,Vf=new c,Hf=new c,Gf=new c,kf=new p,Wf=new p,qf=new p,Yf=new p,jf=new c,Xf=new p,Zf=new p,Kf=new p,Qf=new mr(p.UNIT_X,0);mf.fromRectangle=function(e,t,n,r,o){var s,u,c,l,h,d,f;if(t=i(t,0),n=i(n,0),r=i(r,H.WGS84),e.width<=a.PI){var m=Oe.center(e,wf),_=new cf(r.cartographicToCartesian(m,bf),r);f=_.plane;var g=m.longitude,v=e.south<0&&e.north>0?0:m.latitude,y=N.fromRadians(g,e.north,n,Df),T=N.fromRadians(e.west,e.north,n,If),E=N.fromRadians(e.west,v,n,Rf),x=N.fromRadians(e.west,e.south,n,Pf),C=N.fromRadians(g,e.south,n,Of),S=r.cartographicToCartesian(y,Nf),A=r.cartographicToCartesian(T,Mf),w=r.cartographicToCartesian(E,Lf),b=r.cartographicToCartesian(x,Ff),D=r.cartographicToCartesian(C,zf),I=_.projectPointToNearestOnPlane(S,Bf),R=_.projectPointToNearestOnPlane(A,Uf),P=_.projectPointToNearestOnPlane(w,Vf),O=_.projectPointToNearestOnPlane(b,Hf),M=_.projectPointToNearestOnPlane(D,Gf);return u=-(s=Math.min(R.x,P.x,O.x)),l=Math.max(R.y,I.y),c=Math.min(O.y,M.y),T.height=x.height=t,A=r.cartographicToCartesian(T,Mf),b=r.cartographicToCartesian(x,Ff),h=Math.min(mr.getPointDistance(f,A),mr.getPointDistance(f,b)),d=n,Af(_.origin,_.xAxis,_.yAxis,_.zAxis,s,u,c,l,h,d,o)}var L=e.south>0,F=e.north<0,z=L?e.south:F?e.north:0,B=Oe.center(e,wf).longitude,U=p.fromRadians(B,z,n,r,kf);U.z=0;var V=Math.abs(U.x)<a.EPSILON10&&Math.abs(U.y)<a.EPSILON10?p.UNIT_X:p.normalize(U,Wf),G=p.UNIT_Z,k=p.cross(V,G,qf);f=mr.fromPointNormal(U,V,Qf);var W=p.fromRadians(B+a.PI_OVER_TWO,z,n,r,Yf);s=-(u=p.dot(mr.projectPointOntoPlane(f,W,jf),k)),l=p.fromRadians(0,e.north,F?t:n,r,Xf).z,c=p.fromRadians(0,e.south,L?t:n,r,Zf).z;var q=p.fromRadians(e.east,z,n,r,Kf);return Af(U,k,G,V,s,u,c,l,h=mr.getPointDistance(f,q),d=0,o)},mf.clone=function(t,n){if(e(t))return e(n)?(p.clone(t.center,n.center),$.clone(t.halfAxes,n.halfAxes),n):new mf(t.center,t.halfAxes)},mf.intersectPlane=function(e,t){var n=e.center,r=t.normal,i=e.halfAxes,o=r.x,a=r.y,s=r.z,u=Math.abs(o*i[$.COLUMN0ROW0]+a*i[$.COLUMN0ROW1]+s*i[$.COLUMN0ROW2])+Math.abs(o*i[$.COLUMN1ROW0]+a*i[$.COLUMN1ROW1]+s*i[$.COLUMN1ROW2])+Math.abs(o*i[$.COLUMN2ROW0]+a*i[$.COLUMN2ROW1]+s*i[$.COLUMN2ROW2]),c=p.dot(r,n)+t.distance;return c<=-u?Q.OUTSIDE:c>=u?Q.INSIDE:Q.INTERSECTING};var Jf=new p,$f=new p,em=new p,tm=new p;mf.distanceSquaredTo=function(e,t){var n=p.subtract(t,e.center,Cf),r=e.halfAxes,i=$.getColumn(r,0,Jf),o=$.getColumn(r,1,$f),a=$.getColumn(r,2,em),s=p.magnitude(i),u=p.magnitude(o),c=p.magnitude(a);p.normalize(i,i),p.normalize(o,o),p.normalize(a,a);var l=tm;l.x=p.dot(n,i),l.y=p.dot(n,o),l.z=p.dot(n,a);var h,d=0;return l.x<-s?d+=(h=l.x+s)*h:l.x>s&&(d+=(h=l.x-s)*h),l.y<-u?d+=(h=l.y+u)*h:l.y>u&&(d+=(h=l.y-u)*h),l.z<-c?d+=(h=l.z+c)*h:l.z>c&&(d+=(h=l.z-c)*h),d};var nm=new p,rm=new p;mf.computePlaneDistances=function(t,n,r,i){e(i)||(i=new J);var o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,s=t.center,u=t.halfAxes,c=$.getColumn(u,0,Jf),l=$.getColumn(u,1,$f),h=$.getColumn(u,2,em),d=p.add(c,l,nm);p.add(d,h,d),p.add(d,s,d);var f=p.subtract(d,n,rm),m=p.dot(r,f);return o=Math.min(m,o),a=Math.max(m,a),p.add(s,c,d),p.add(d,l,d),p.subtract(d,h,d),p.subtract(d,n,f),m=p.dot(r,f),o=Math.min(m,o),a=Math.max(m,a),p.add(s,c,d),p.subtract(d,l,d),p.add(d,h,d),p.subtract(d,n,f),m=p.dot(r,f),o=Math.min(m,o),a=Math.max(m,a),p.add(s,c,d),p.subtract(d,l,d),p.subtract(d,h,d),p.subtract(d,n,f),m=p.dot(r,f),o=Math.min(m,o),a=Math.max(m,a),p.subtract(s,c,d),p.add(d,l,d),p.add(d,h,d),p.subtract(d,n,f),m=p.dot(r,f),o=Math.min(m,o),a=Math.max(m,a),p.subtract(s,c,d),p.add(d,l,d),p.subtract(d,h,d),p.subtract(d,n,f),m=p.dot(r,f),o=Math.min(m,o),a=Math.max(m,a),p.subtract(s,c,d),p.subtract(d,l,d),p.add(d,h,d),p.subtract(d,n,f),m=p.dot(r,f),o=Math.min(m,o),a=Math.max(m,a),p.subtract(s,c,d),p.subtract(d,l,d),p.subtract(d,h,d),p.subtract(d,n,f),m=p.dot(r,f),o=Math.min(m,o),a=Math.max(m,a),i.start=o,i.stop=a,i};var im=new Me;mf.isOccluded=function(e,t){var n=Me.fromOrientedBoundingBox(e,im);return!t.isBoundingSphereVisible(n)},mf.prototype.intersectPlane=function(e){return mf.intersectPlane(this,e)},mf.prototype.distanceSquaredTo=function(e){return mf.distanceSquaredTo(this,e)},mf.prototype.computePlaneDistances=function(e,t,n){return mf.computePlaneDistances(this,e,t,n)},mf.prototype.isOccluded=function(e){return mf.isOccluded(this,e)},mf.equals=function(t,n){return t===n||e(t)&&e(n)&&p.equals(t.center,n.center)&&$.equals(t.halfAxes,n.halfAxes)},mf.prototype.clone=function(e){return mf.clone(this,e)},mf.prototype.equals=function(e){return mf.equals(this,e)};var om=Object.freeze({NONE:0,BITS12:1}),am=new p,sm=new p,um=new c,cm=new ye,lm=new ye,hm=Math.pow(2,12);function dm(t,n,r,o,a,s){var u,c,l,h=om.NONE;if(e(t)&&e(n)&&e(r)&&e(o)){var d=t.minimum,f=t.maximum,m=p.subtract(f,d,sm),_=r-n;h=Math.max(p.maximumComponent(m),_)<hm-1?om.BITS12:om.NONE,u=t.center,c=ye.inverseTransformation(o,new ye);var g=p.negate(d,am);ye.multiply(ye.fromTranslation(g,cm),c,c);var v=am;v.x=1/m.x,v.y=1/m.y,v.z=1/m.z,ye.multiply(ye.fromScale(v,cm),c,c),l=ye.clone(o),ye.setTranslation(l,p.ZERO,l),o=ye.clone(o,new ye);var y=ye.fromTranslation(d,cm),T=ye.fromScale(m,lm),E=ye.multiply(y,T,cm);ye.multiply(o,E,o),ye.multiply(l,E,l)}this.quantization=h,this.minimumHeight=n,this.maximumHeight=r,this.center=u,this.toScaledENU=c,this.fromScaledENU=o,this.matrix=l,this.hasVertexNormals=a,this.hasWebMercatorT=i(s,!1)}dm.prototype.encode=function(e,t,n,r,i,o,s){var u=r.x,l=r.y;if(this.quantization===om.BITS12){(n=ye.multiplyByPoint(this.toScaledENU,n,am)).x=a.clamp(n.x,0,1),n.y=a.clamp(n.y,0,1),n.z=a.clamp(n.z,0,1);var h=this.maximumHeight-this.minimumHeight,d=a.clamp((i-this.minimumHeight)/h,0,1);c.fromElements(n.x,n.y,um);var f=S.compressTextureCoordinates(um);c.fromElements(n.z,d,um);var m=S.compressTextureCoordinates(um);c.fromElements(u,l,um);var _=S.compressTextureCoordinates(um);if(e[t++]=f,e[t++]=m,e[t++]=_,this.hasWebMercatorT){c.fromElements(s,0,um);var g=S.compressTextureCoordinates(um);e[t++]=g}}else p.subtract(n,this.center,am),e[t++]=am.x,e[t++]=am.y,e[t++]=am.z,e[t++]=i,e[t++]=u,e[t++]=l,this.hasWebMercatorT&&(e[t++]=s);return this.hasVertexNormals&&(e[t++]=S.octPackFloat(o)),t},dm.prototype.decodePosition=function(t,n,r){if(e(r)||(r=new p),n*=this.getStride(),this.quantization===om.BITS12){var i=S.decompressTextureCoordinates(t[n],um);r.x=i.x,r.y=i.y;var o=S.decompressTextureCoordinates(t[n+1],um);return r.z=o.x,ye.multiplyByPoint(this.fromScaledENU,r,r)}return r.x=t[n],r.y=t[n+1],r.z=t[n+2],p.add(r,this.center,r)},dm.prototype.decodeTextureCoordinates=function(t,n,r){return e(r)||(r=new c),n*=this.getStride(),this.quantization===om.BITS12?S.decompressTextureCoordinates(t[n+2],r):c.fromElements(t[n+4],t[n+5],r)},dm.prototype.decodeHeight=function(e,t){return t*=this.getStride(),this.quantization===om.BITS12?S.decompressTextureCoordinates(e[t+1],um).y*(this.maximumHeight-this.minimumHeight)+this.minimumHeight:e[t+3]},dm.prototype.decodeWebMercatorT=function(e,t){return t*=this.getStride(),this.quantization===om.BITS12?S.decompressTextureCoordinates(e[t+3],um).x:e[t+6]},dm.prototype.getOctEncodedNormal=function(e,t,n){var r=e[t=(t+1)*this.getStride()-1]/256,i=Math.floor(r),o=256*(r-i);return c.fromElements(i,o,n)},dm.prototype.getStride=function(){var e;if(this.quantization===om.BITS12)e=3;else e=6;return this.hasWebMercatorT&&++e,this.hasVertexNormals&&++e,e};var fm={position3DAndHeight:0,textureCoordAndEncodedNormals:1},mm={compressed0:0,compressed1:1};dm.prototype.getAttributes=function(e){var t,n=xn.FLOAT,r=xn.getSizeInBytes(n);if(this.quantization===om.NONE){var i=2;return this.hasWebMercatorT&&++i,this.hasVertexNormals&&++i,[{index:fm.position3DAndHeight,vertexBuffer:e,componentDatatype:n,componentsPerAttribute:4,offsetInBytes:0,strideInBytes:t=(4+i)*r},{index:fm.textureCoordAndEncodedNormals,vertexBuffer:e,componentDatatype:n,componentsPerAttribute:i,offsetInBytes:4*r,strideInBytes:t}]}var o=3,a=0;return(this.hasWebMercatorT||this.hasVertexNormals)&&++o,this.hasWebMercatorT&&this.hasVertexNormals?(++a,[{index:mm.compressed0,vertexBuffer:e,componentDatatype:n,componentsPerAttribute:o,offsetInBytes:0,strideInBytes:t=(o+a)*r},{index:mm.compressed1,vertexBuffer:e,componentDatatype:n,componentsPerAttribute:a,offsetInBytes:o*r,strideInBytes:t}]):[{index:mm.compressed0,vertexBuffer:e,componentDatatype:n,componentsPerAttribute:o}]},dm.prototype.getAttributeLocations=function(){return this.quantization===om.NONE?fm:mm},dm.clone=function(t,n){return e(n)||(n=new dm),n.quantization=t.quantization,n.minimumHeight=t.minimumHeight,n.maximumHeight=t.maximumHeight,n.center=p.clone(t.center),n.toScaledENU=ye.clone(t.toScaledENU),n.fromScaledENU=ye.clone(t.fromScaledENU),n.matrix=ye.clone(t.matrix),n.hasVertexNormals=t.hasVertexNormals,n.hasWebMercatorT=t.hasWebMercatorT,n};var pm={};pm.DEFAULT_STRUCTURE=Object.freeze({heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1});var _m=new p,gm=new ye,vm=new p,ym=new p;function Tm(e,t,n,r,o,a,s,u,c,l,h,d,f,m,p,_,g){this.center=e,this.vertices=t,this.stride=i(l,6),this.indices=n,this.indexCountWithoutSkirts=r,this.vertexCountWithoutSkirts=o,this.minimumHeight=a,this.maximumHeight=s,this.boundingSphere3D=u,this.occludeePointInScaledSpace=c,this.orientedBoundingBox=h,this.encoding=d,this.exaggeration=f,this.westIndicesSouthToNorth=m,this.southIndicesEastToWest=p,this.eastIndicesNorthToSouth=_,this.northIndicesWestToEast=g}function Em(){t.throwInstantiationError()}pm.computeVertices=function(t){var n,r,o,s,u=Math.cos,l=Math.sin,h=Math.sqrt,d=Math.atan,f=Math.exp,m=a.PI_OVER_TWO,_=a.toRadians,g=t.heightmap,v=t.width,y=t.height,T=t.skirtHeight,E=i(t.isGeographic,!0),x=i(t.ellipsoid,H.WGS84),C=1/x.maximumRadius,S=t.nativeRectangle,A=t.rectangle;e(A)?(n=A.west,r=A.south,o=A.east,s=A.north):E?(n=_(S.west),r=_(S.south),o=_(S.east),s=_(S.north)):(n=S.west*C,r=m-2*d(f(-S.south*C)),o=S.east*C,s=m-2*d(f(-S.north*C)));var w=t.relativeToCenter,b=e(w);w=b?w:p.ZERO;var D=i(t.exaggeration,1),I=i(t.includeWebMercatorT,!1),R=i(t.structure,pm.DEFAULT_STRUCTURE),P=i(R.heightScale,pm.DEFAULT_STRUCTURE.heightScale),O=i(R.heightOffset,pm.DEFAULT_STRUCTURE.heightOffset),N=i(R.elementsPerHeight,pm.DEFAULT_STRUCTURE.elementsPerHeight),M=i(R.stride,pm.DEFAULT_STRUCTURE.stride),L=i(R.elementMultiplier,pm.DEFAULT_STRUCTURE.elementMultiplier),F=i(R.isBigEndian,pm.DEFAULT_STRUCTURE.isBigEndian),z=Oe.computeWidth(S),B=Oe.computeHeight(S),U=z/(v-1),V=B/(y-1);E||(z*=C,B*=C);var G,k,W=x.radiiSquared,q=W.x,Y=W.y,j=W.z,X=65536,Z=-65536,K=ka.eastNorthUpToFixedFrame(w,x),Q=ye.inverseTransformation(K,gm);I&&(G=Nc.geodeticLatitudeToMercatorAngle(r),k=1/(Nc.geodeticLatitudeToMercatorAngle(s)-G));var J=vm;J.x=Number.POSITIVE_INFINITY,J.y=Number.POSITIVE_INFINITY,J.z=Number.POSITIVE_INFINITY;var $=ym;$.x=Number.NEGATIVE_INFINITY,$.y=Number.NEGATIVE_INFINITY,$.z=Number.NEGATIVE_INFINITY;var ee=Number.POSITIVE_INFINITY,te=v*y,ne=te+(T>0?2*v+2*y:0),re=new Array(ne),ie=new Array(ne),oe=new Array(ne),ae=I?new Array(ne):[],se=0,ue=y,ce=0,le=v;T>0&&(--se,++ue,--ce,++le);for(var he=1e-5,de=se;de<ue;++de){var fe=de;fe<0&&(fe=0),fe>=y&&(fe=y-1);var me=S.north-V*fe,pe=((me=E?_(me):m-2*d(f(-me*C)))-r)/(s-r);pe=a.clamp(pe,0,1);var _e=de===se,ge=de===ue-1;T>0&&(_e?me+=he*B:ge&&(me-=he*B));var ve,Te=u(me),Ee=l(me),xe=j*Ee;I&&(ve=(Nc.geodeticLatitudeToMercatorAngle(me)-G)*k);for(var Ce=ce;Ce<le;++Ce){var Se=Ce;Se<0&&(Se=0),Se>=v&&(Se=v-1);var Ae,we,be=fe*(v*M)+Se*M;if(1===N)Ae=g[be];else if(Ae=0,F)for(we=0;we<N;++we)Ae=Ae*L+g[be+we];else for(we=N-1;we>=0;--we)Ae=Ae*L+g[be+we];Ae=(Ae*P+O)*D,Z=Math.max(Z,Ae),X=Math.min(X,Ae);var De=S.west+U*Se;E?De=_(De):De*=C;var Ie=(De-n)/(o-n);Ie=a.clamp(Ie,0,1);var Re=fe*v+Se;if(T>0){var Pe=Ce===ce,Ne=Ce===le-1,Le=_e||ge||Pe||Ne;if((_e||ge)&&(Pe||Ne))continue;Le&&(Ae-=T,Pe?(Re=te+(y-fe-1),De-=he*z):ge?Re=te+y+(v-Se-1):Ne?(Re=te+y+v+fe,De+=he*z):_e&&(Re=te+y+v+y+Se))}var Fe=Te*u(De),ze=Te*l(De),Be=q*Fe,Ue=Y*ze,Ve=1/h(Be*Fe+Ue*ze+xe*Ee),He=Be*Ve,Ge=Ue*Ve,ke=xe*Ve,We=new p;We.x=He+Fe*Ae,We.y=Ge+ze*Ae,We.z=ke+Ee*Ae,re[Re]=We,ie[Re]=Ae,oe[Re]=new c(Ie,pe),I&&(ae[Re]=ve),ye.multiplyByPoint(Q,We,_m),p.minimumByComponent(_m,J,J),p.maximumByComponent(_m,$,$),ee=Math.min(ee,Ae)}}var qe,Ye,je=Me.fromPoints(re);(e(A)&&(qe=mf.fromRectangle(A,X,Z,x)),b)&&(Ye=new Wd(x).computeHorizonCullingPointPossiblyUnderEllipsoid(w,re,X));for(var Xe=new dm(new Gd(J,$,w),ee,Z,K,!1,I),Ze=new Float32Array(ne*Xe.getStride()),Ke=0,Qe=0;Qe<ne;++Qe)Ke=Xe.encode(Ze,Ke,re[Qe],oe[Qe],ie[Qe],void 0,ae[Qe]);return{vertices:Ze,maximumHeight:Z,minimumHeight:X,encoding:Xe,boundingSphere3D:je,orientedBoundingBox:qe,occludeePointInScaledSpace:Ye}},Object.defineProperties(Em.prototype,{errorEvent:{get:t.throwInstantiationError},credit:{get:t.throwInstantiationError},tilingScheme:{get:t.throwInstantiationError},ready:{get:t.throwInstantiationError},readyPromise:{get:t.throwInstantiationError},hasWaterMask:{get:t.throwInstantiationError},hasVertexNormals:{get:t.throwInstantiationError},availability:{get:t.throwInstantiationError}});var xm=[];Em.getRegularGridIndices=function(t,n){var r=xm[t];e(r)||(xm[t]=r=[]);var i=r[n];return e(i)||wm(t,n,i=t*n<a.SIXTY_FOUR_KILOBYTES?r[n]=new Uint16Array((t-1)*(n-1)*6):r[n]=new Uint32Array((t-1)*(n-1)*6),0),i};var Cm=[];Em.getRegularGridIndicesAndEdgeIndices=function(t,n){var r=Cm[t];e(r)||(Cm[t]=r=[]);var i=r[n];if(!e(i)){var o=Em.getRegularGridIndices(t,n),a=Am(t,n),s=a.westIndicesSouthToNorth,u=a.southIndicesEastToWest,c=a.eastIndicesNorthToSouth,l=a.northIndicesWestToEast;i=r[n]={indices:o,westIndicesSouthToNorth:s,southIndicesEastToWest:u,eastIndicesNorthToSouth:c,northIndicesWestToEast:l}}return i};var Sm=[];function Am(e,t){var n,r=new Array(t),i=new Array(e),o=new Array(t),a=new Array(e);for(n=0;n<e;++n)a[n]=n,i[n]=e*t-1-n;for(n=0;n<t;++n)o[n]=(n+1)*e-1,r[n]=(t-n-1)*e;return{westIndicesSouthToNorth:r,southIndicesEastToWest:i,eastIndicesNorthToSouth:o,northIndicesWestToEast:a}}function wm(e,t,n,r){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i,u=s+e,c=u+1,l=s+1;n[r++]=s,n[r++]=u,n[r++]=l,n[r++]=l,n[r++]=u,n[r++]=c,++i}++i}}function bm(e,t,n,r){for(var i=e[0],o=e.length,a=1;a<o;++a){var s=e[a];n[r++]=i,n[r++]=s,n[r++]=t,n[r++]=t,n[r++]=s,n[r++]=t+1,i=s,++t}return r}function Dm(t){this._buffer=t.buffer,this._width=t.width,this._height=t.height,this._childTileMask=i(t.childTileMask,15),this._encoding=i(t.encoding,Hd.NONE);var n=pm.DEFAULT_STRUCTURE,r=t.structure;e(r)?r!==n&&(r.heightScale=i(r.heightScale,n.heightScale),r.heightOffset=i(r.heightOffset,n.heightOffset),r.elementsPerHeight=i(r.elementsPerHeight,n.elementsPerHeight),r.stride=i(r.stride,n.stride),r.elementMultiplier=i(r.elementMultiplier,n.elementMultiplier),r.isBigEndian=i(r.isBigEndian,n.isBigEndian)):r=n,this._structure=r,this._createdByUpsampling=i(t.createdByUpsampling,!1),this._waterMask=t.waterMask,this._skirtHeight=void 0,this._bufferType=this._encoding===Hd.LERC?Float32Array:this._buffer.constructor,this._mesh=void 0}Em.getRegularGridAndSkirtIndicesAndEdgeIndices=function(t,n){var r=Sm[t];e(r)||(Sm[t]=r=[]);var i=r[n];if(!e(i)){var o=t*n,a=(t-1)*(n-1)*6,s=2*t+2*n,u=o+s,c=a+6*Math.max(0,s-4),l=Am(t,n),h=l.westIndicesSouthToNorth,d=l.southIndicesEastToWest,f=l.eastIndicesNorthToSouth,m=l.northIndicesWestToEast,p=Dn.createTypedArray(u,c);wm(t,n,p,0),Em.addSkirtIndices(h,d,f,m,o,p,a),i=r[n]={indices:p,westIndicesSouthToNorth:h,southIndicesEastToWest:d,eastIndicesNorthToSouth:f,northIndicesWestToEast:m,indexCountWithoutSkirts:a}}return i},Em.addSkirtIndices=function(e,t,n,r,i,o,a){var s=i;a=bm(e,s,o,a),a=bm(t,s+=e.length,o,a),a=bm(n,s+=t.length,o,a),bm(r,s+=n.length,o,a)},Em.heightmapTerrainQuality=.25,Em.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,n){return 2*e.maximumRadius*Math.PI*Em.heightmapTerrainQuality/(t*n)},Em.prototype.requestTileGeometry=t.throwInstantiationError,Em.prototype.getLevelMaximumGeometricError=t.throwInstantiationError,Em.prototype.getTileDataAvailable=t.throwInstantiationError,Em.prototype.loadTileDataAvailability=t.throwInstantiationError,Object.defineProperties(Dm.prototype,{credits:{get:function(){}},waterMask:{get:function(){return this._waterMask}},childTileMask:{get:function(){return this._childTileMask}}});var Im=new Gc("createVerticesFromHeightmap");function Rm(e,t,n,r,i,o,a,s,u,c){var l=(s-i.west)*(o-1)/(i.east-i.west),h=(u-i.south)*(a-1)/(i.north-i.south),d=0|l,f=d+1;f>=o&&(f=o-1,d=o-2);var m=0|h,p=m+1;p>=a&&(p=a-1,m=a-2);var _=h-m;return m=a-1-m,p=a-1-p,Pm(l-d,_,(t.decodeHeight(e,m*o+d)/c-n)/r,(t.decodeHeight(e,m*o+f)/c-n)/r,(t.decodeHeight(e,p*o+d)/c-n)/r,(t.decodeHeight(e,p*o+f)/c-n)/r)}function Pm(e,t,n,r,i,o){return t<e?n+e*(r-n)+t*(o-r):n+e*(o-i)+t*(i-n)}function Om(e,t,n,r,i,o){o*=r;var a,s=0;if(i)for(a=0;a<t;++a)s=s*n+e[o+a];else for(a=t-1;a>=0;--a)s=s*n+e[o+a];return s}function Nm(e,t,n,r,i,o,a,s){var u;if(a*=i,o)for(u=0;u<t-1;++u)e[a+u]=s/r|0,s-=e[a+u]*r,r/=n;else for(u=t-1;u>0;--u)e[a+u]=s/r|0,s-=e[a+u]*r,r/=n;e[a+u]=s}function Mm(t){t=i(t,i.EMPTY_OBJECT),this._tilingScheme=t.tilingScheme,e(this._tilingScheme)||(this._tilingScheme=new Vd({ellipsoid:i(t.ellipsoid,H.WGS84)})),this._levelZeroMaximumGeometricError=Em.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.ellipsoid,64,this._tilingScheme.getNumberOfXTilesAtLevel(0)),this._errorEvent=new qo,this._readyPromise=Et.resolve(!0)}Dm.prototype.createMesh=function(t,n,r,o,a){var s=t.ellipsoid,u=t.tileXYToNativeRectangle(n,r,o),c=t.tileXYToRectangle(n,r,o);a=i(a,1);var l=s.cartographicToCartesian(Oe.center(c)),h=this._structure,d=Em.getEstimatedLevelZeroGeometricErrorForAHeightmap(s,this._width,t.getNumberOfXTilesAtLevel(0))/(1<<o);this._skirtHeight=Math.min(4*d,1e3);var f=Im.scheduleTask({heightmap:this._buffer,structure:h,includeWebMercatorT:!0,width:this._width,height:this._height,nativeRectangle:u,rectangle:c,relativeToCenter:l,ellipsoid:s,skirtHeight:this._skirtHeight,isGeographic:t.projection instanceof K,exaggeration:a,encoding:this._encoding});if(e(f)){var m=this;return Et(f,(function(e){var t;t=m._skirtHeight>0?Em.getRegularGridAndSkirtIndicesAndEdgeIndices(e.gridWidth,e.gridHeight):Em.getRegularGridIndicesAndEdgeIndices(e.gridWidth,e.gridHeight);var n=e.gridWidth*e.gridHeight;return m._mesh=new Tm(l,new Float32Array(e.vertices),t.indices,t.indexCountWithoutSkirts,n,e.minimumHeight,e.maximumHeight,Me.clone(e.boundingSphere3D),p.clone(e.occludeePointInScaledSpace),e.numberOfAttributes,mf.clone(e.orientedBoundingBox),dm.clone(e.encoding),a,t.westIndicesSouthToNorth,t.southIndicesEastToWest,t.eastIndicesNorthToSouth,t.northIndicesWestToEast),m._buffer=void 0,m._mesh}))}},Dm.prototype._createMeshSync=function(e,t,n,r,o){var a=e.ellipsoid,s=e.tileXYToNativeRectangle(t,n,r),u=e.tileXYToRectangle(t,n,r);o=i(o,1);var c=a.cartographicToCartesian(Oe.center(u)),l=this._structure,h=Em.getEstimatedLevelZeroGeometricErrorForAHeightmap(a,this._width,e.getNumberOfXTilesAtLevel(0))/(1<<r);this._skirtHeight=Math.min(4*h,1e3);var d,f=pm.computeVertices({heightmap:this._buffer,structure:l,includeWebMercatorT:!0,width:this._width,height:this._height,nativeRectangle:s,rectangle:u,relativeToCenter:c,ellipsoid:a,skirtHeight:this._skirtHeight,isGeographic:e.projection instanceof K,exaggeration:o});this._buffer=void 0,d=this._skirtHeight>0?Em.getRegularGridAndSkirtIndicesAndEdgeIndices(this._width,this._height):Em.getRegularGridIndicesAndEdgeIndices(this._width,this._height);var m=f.gridWidth*f.gridHeight;return new Tm(c,f.vertices,d.indices,d.indexCountWithoutSkirts,m,f.minimumHeight,f.maximumHeight,f.boundingSphere3D,f.occludeePointInScaledSpace,f.encoding.getStride(),f.orientedBoundingBox,f.encoding,o,d.westIndicesSouthToNorth,d.southIndicesEastToWest,d.eastIndicesNorthToSouth,d.northIndicesWestToEast)},Dm.prototype.interpolateHeight=function(t,n,r){var i,o=this._width,a=this._height,s=this._structure,u=s.stride,c=s.elementsPerHeight,l=s.elementMultiplier,h=s.isBigEndian,d=s.heightOffset,f=s.heightScale;e(this._mesh)?i=Rm(this._mesh.vertices,this._mesh.encoding,d,f,t,o,a,n,r,this._mesh.exaggeration):(i=function(e,t,n,r,i,o,a,s,u,c){var l=(u-o.west)*(a-1)/(o.east-o.west),h=(c-o.south)*(s-1)/(o.north-o.south),d=0|l,f=d+1;f>=a&&(f=a-1,d=a-2);var m=0|h,p=m+1;p>=s&&(p=s-1,m=s-2);var _=l-d,g=h-m;p=s-1-p;var v=Om(e,t,n,r,i,(m=s-1-m)*a+d),y=Om(e,t,n,r,i,m*a+f),T=Om(e,t,n,r,i,p*a+d),E=Om(e,t,n,r,i,p*a+f);return Pm(_,g,v,y,T,E)}(this._buffer,c,l,u,h,t,o,a,n,r),i=i*f+d);return i},Dm.prototype.upsample=function(t,n,r,i,o,s,u){var c=this._mesh;if(e(c)){for(var l=this._width,h=this._height,d=this._structure,f=d.stride,m=new this._bufferType(l*h*f),p=c.vertices,_=c.encoding,g=t.tileXYToRectangle(n,r,i),v=t.tileXYToRectangle(o,s,u),y=d.heightOffset,T=d.heightScale,E=c.exaggeration,x=d.elementsPerHeight,C=d.elementMultiplier,S=d.isBigEndian,A=Math.pow(C,x-1),w=0;w<h;++w)for(var b=a.lerp(v.north,v.south,w/(h-1)),D=0;D<l;++D){var I=Rm(p,_,y,T,g,l,h,a.lerp(v.west,v.east,D/(l-1)),b,E);Nm(m,x,C,A,f,S,w*l+D,I=(I=I<d.lowestEncodedHeight?d.lowestEncodedHeight:I)>d.highestEncodedHeight?d.highestEncodedHeight:I)}return new Dm({buffer:m,width:l,height:h,childTileMask:0,structure:this._structure,createdByUpsampling:!0})}},Dm.prototype.isChildAvailable=function(e,t,n,r){var i=2;return n!==2*e&&++i,r!==2*t&&(i-=2),0!=(this._childTileMask&1<<i)},Dm.prototype.wasCreatedByUpsampling=function(){return this._createdByUpsampling},Object.defineProperties(Mm.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){}},tilingScheme:{get:function(){return this._tilingScheme}},ready:{get:function(){return!0}},readyPromise:{get:function(){return this._readyPromise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},availability:{get:function(){}}}),Mm.prototype.requestTileGeometry=function(e,t,n,r){return Et.resolve(new Dm({buffer:new Uint8Array(256),width:16,height:16}))},Mm.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)},Mm.prototype.getTileDataAvailable=function(e,t,n){},Mm.prototype.loadTileDataAvailability=function(e,t,n){};var Lm="const float Kr = 0.0025;\nconst float Km = 0.0015;\nconst float ESun = 15.0;\nconst float fKrESun = Kr * ESun;\nconst float fKmESun = Km * ESun;\nconst float fKr4PI = Kr * 4.0 * czm_pi;\nconst float fKm4PI = Km * 4.0 * czm_pi;\nconst vec3 v3InvWavelength = vec3(5.60204474633241, 9.473284437923038, 19.64380261047721);\nconst float fScaleDepth = 0.25;\nstruct AtmosphereColor\n{\nvec3 mie;\nvec3 rayleigh;\n};\nconst int nSamples = 2;\nconst float fSamples = 2.0;\nfloat scale(float fCos)\n{\nfloat x = 1.0 - fCos;\nreturn fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\nAtmosphereColor computeGroundAtmosphereFromSpace(vec3 v3Pos, bool dynamicLighting, vec3 lightDirectionWC)\n{\nfloat fInnerRadius = czm_ellipsoidRadii.x;\nfloat fOuterRadius = czm_ellipsoidRadii.x * 1.025;\nfloat fOuterRadius2 = fOuterRadius * fOuterRadius;\nfloat fScale = 1.0 / (fOuterRadius - fInnerRadius);\nfloat fScaleOverScaleDepth = fScale / fScaleDepth;\nvec3 v3Ray = v3Pos - czm_viewerPositionWC;\nfloat fFar = length(v3Ray);\nv3Ray /= fFar;\nfloat fCameraHeight = length(czm_viewerPositionWC);\nfloat fCameraHeight2 = fCameraHeight * fCameraHeight;\nfloat B = 2.0 * length(czm_viewerPositionWC) * dot(normalize(czm_viewerPositionWC), v3Ray);\nfloat C = fCameraHeight2 - fOuterRadius2;\nfloat fDet = max(0.0, B*B - 4.0 * C);\nfloat fNear = 0.5 * (-B - sqrt(fDet));\nvec3 v3Start = czm_viewerPositionWC + v3Ray * fNear;\nfFar -= fNear;\nfloat fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);\nfloat fLightAngle = czm_branchFreeTernary(dynamicLighting, dot(lightDirectionWC, v3Pos) / length(v3Pos), 1.0);\nfloat fCameraAngle = dot(-v3Ray, v3Pos) / length(v3Pos);\nfloat fCameraScale = scale(fCameraAngle);\nfloat fLightScale = scale(fLightAngle);\nfloat fCameraOffset = fDepth*fCameraScale;\nfloat fTemp = (fLightScale + fCameraScale);\nfloat fSampleLength = fFar / fSamples;\nfloat fScaledLength = fSampleLength * fScale;\nvec3 v3SampleRay = v3Ray * fSampleLength;\nvec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\nvec3 v3FrontColor = vec3(0.0);\nvec3 v3Attenuate = vec3(0.0);\nfor(int i=0; i<nSamples; i++)\n{\nfloat fHeight = length(v3SamplePoint);\nfloat fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\nfloat fScatter = fDepth*fTemp - fCameraOffset;\nv3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\nv3FrontColor += v3Attenuate * (fDepth * fScaledLength);\nv3SamplePoint += v3SampleRay;\n}\nAtmosphereColor color;\ncolor.mie = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);\ncolor.rayleigh = v3Attenuate;\nreturn color;\n}\n";function Fm(e,t){this._distance=t,this._normal=new zm(e,this),this.onChangeCallback=void 0,this.index=-1}function zm(e,t){this._clippingPlane=t,this._cartesian3=p.clone(e)}function Bm(t){t=i(t,i.EMPTY_OBJECT),this._planes=[],this._dirtyIndex=-1,this._multipleDirtyPlanes=!1,this._enabled=i(t.enabled,!0),this.modelMatrix=ye.clone(i(t.modelMatrix,ye.IDENTITY)),this.edgeColor=pn.clone(i(t.edgeColor,pn.WHITE)),this.edgeWidth=i(t.edgeWidth,0),this.planeAdded=new qo,this.planeRemoved=new qo,this._owner=void 0;var n=i(t.unionClippingRegions,!1);this._unionClippingRegions=n,this._testIntersection=n?Um:Vm,this._uint8View=void 0,this._float32View=void 0,this._clippingPlanesTexture=void 0;var r=t.planes;if(e(r))for(var o=r.length,a=0;a<o;++a)this.add(r[a])}function Um(e){return e===Q.OUTSIDE}function Vm(e){return e===Q.INSIDE}function Hm(e,t){e._multipleDirtyPlanes=e._multipleDirtyPlanes||-1!==e._dirtyIndex&&e._dirtyIndex!==t,e._dirtyIndex=t}function Gm(e,t){for(var n=e.length,r=0;r<n;++r)if(mr.equals(e[r],t))return r;return-1}Object.defineProperties(Fm.prototype,{distance:{get:function(){return this._distance},set:function(t){e(this.onChangeCallback)&&t!==this._distance&&this.onChangeCallback(this.index),this._distance=t}},normal:{get:function(){return this._normal},set:function(t){e(this.onChangeCallback)&&!p.equals(this._normal._cartesian3,t)&&this.onChangeCallback(this.index),p.clone(t,this._normal._cartesian3)}}}),Fm.fromPlane=function(t,n){return e(n)?(n.normal=t.normal,n.distance=t.distance):n=new Fm(t.normal,t.distance),n},Fm.clone=function(t,n){return e(n)?(n.normal=t.normal,n.distance=t.distance,n):new Fm(t.normal,t.distance)},Object.defineProperties(zm.prototype,{x:{get:function(){return this._cartesian3.x},set:function(t){e(this._clippingPlane.onChangeCallback)&&t!==this._cartesian3.x&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.x=t}},y:{get:function(){return this._cartesian3.y},set:function(t){e(this._clippingPlane.onChangeCallback)&&t!==this._cartesian3.y&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.y=t}},z:{get:function(){return this._cartesian3.z},set:function(t){e(this._clippingPlane.onChangeCallback)&&t!==this._cartesian3.z&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.z=t}}}),Object.defineProperties(Bm.prototype,{length:{get:function(){return this._planes.length}},unionClippingRegions:{get:function(){return this._unionClippingRegions},set:function(e){this._unionClippingRegions!==e&&(this._unionClippingRegions=e,this._testIntersection=e?Um:Vm)}},enabled:{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e)}},texture:{get:function(){return this._clippingPlanesTexture}},owner:{get:function(){return this._owner}},clippingPlanesState:{get:function(){return this._unionClippingRegions?this._planes.length:-this._planes.length}}}),Bm.prototype.add=function(e){var t=this._planes.length,n=this;e.onChangeCallback=function(e){Hm(n,e)},e.index=t,Hm(this,t),this._planes.push(e),this.planeAdded.raiseEvent(e,t)},Bm.prototype.get=function(e){return this._planes[e]},Bm.prototype.contains=function(e){return-1!==Gm(this._planes,e)},Bm.prototype.remove=function(e){var t=this._planes,n=Gm(t,e);if(-1===n)return!1;e instanceof Fm&&(e.onChangeCallback=void 0,e.index=-1);for(var r=t.length-1,i=n;i<r;++i){var o=t[i+1];t[i]=o,o instanceof Fm&&(o.index=i)}return this._multipleDirtyPlanes=!0,t.length=r,this.planeRemoved.raiseEvent(e,n),!0},Bm.prototype.removeAll=function(){for(var e=this._planes,t=e.length,n=0;n<t;++n){var r=e[n];r instanceof Fm&&(r.onChangeCallback=void 0,r.index=-1),this.planeRemoved.raiseEvent(r,n)}this._multipleDirtyPlanes=!0,this._planes=[]};var km=new le,Wm=new le;function qm(e,t,n){for(var r=e._uint8View,i=e._planes,o=0,a=t;a<n;++a){var s=i[a],u=S.octEncodeToCartesian4(s.normal,Wm);r[o]=u.x,r[o+1]=u.y,r[o+2]=u.z,r[o+3]=u.w;var c=le.packFloat(s.distance,km);r[o+4]=c.x,r[o+5]=c.y,r[o+6]=c.z,r[o+7]=c.w,o+=8}}function Ym(e,t,n){for(var r=e._float32View,i=e._planes,o=0,a=t;a<n;++a){var s=i[a],u=s.normal;r[o]=u.x,r[o+1]=u.y,r[o+2]=u.z,r[o+3]=s.distance,o+=4}}function jm(e,t){var n=Ds.maximumTextureSize;return t.x=Math.min(e,n),t.y=Math.ceil(e/t.x),t}var Xm=new c;Bm.prototype.update=function(t){var n=this._clippingPlanesTexture,r=t.context,i=Bm.useFloatTexture(r),o=i?this.length:2*this.length;if(e(n)){var a=n.width*n.height;(a<o||o<.25*a)&&(n.destroy(),n=void 0,this._clippingPlanesTexture=void 0)}if(0!==this.length){if(!e(n)){var s=jm(o,Xm);s.y*=2,i?(n=new Fh({context:r,width:s.x,height:s.y,pixelFormat:Xc.RGBA,pixelDatatype:Yc.FLOAT,sampler:Lh.NEAREST,flipY:!1}),this._float32View=new Float32Array(s.x*s.y*4)):(n=new Fh({context:r,width:s.x,height:s.y,pixelFormat:Xc.RGBA,pixelDatatype:Yc.UNSIGNED_BYTE,sampler:Lh.NEAREST,flipY:!1}),this._uint8View=new Uint8Array(s.x*s.y*4)),this._clippingPlanesTexture=n,this._multipleDirtyPlanes=!0}var u=this._dirtyIndex;if(this._multipleDirtyPlanes||-1!==u){if(this._multipleDirtyPlanes)i?(Ym(this,0,this._planes.length),n.copyFrom({width:n.width,height:n.height,arrayBufferView:this._float32View})):(qm(this,0,this._planes.length),n.copyFrom({width:n.width,height:n.height,arrayBufferView:this._uint8View}));else{var c=0,l=0;i?(l=Math.floor(u/n.width),c=Math.floor(u-l*n.width),Ym(this,u,u+1),n.copyFrom({width:1,height:1,arrayBufferView:this._float32View},c,l)):(l=Math.floor(2*u/n.width),c=Math.floor(2*u-l*n.width),qm(this,u,u+1),n.copyFrom({width:2,height:1,arrayBufferView:this._uint8View},c,l))}this._multipleDirtyPlanes=!1,this._dirtyIndex=-1}}};var Zm=new ye,Km=new mr(p.UNIT_X,0);Bm.prototype.computeIntersectionWithBoundingVolume=function(t,n){var r=this._planes,i=r.length,o=this.modelMatrix;e(n)&&(o=ye.multiply(n,o,Zm));var a=Q.INSIDE;!this.unionClippingRegions&&i>0&&(a=Q.OUTSIDE);for(var s=0;s<i;++s){var u=r[s];mr.transform(u,o,Km);var c=t.intersectPlane(Km);if(c===Q.INTERSECTING)a=c;else if(this._testIntersection(c))return c}return a},Bm.setOwner=function(t,n,r){t!==n[r]&&(n[r]=n[r]&&n[r].destroy(),e(t)&&(t._owner=n,n[r]=t))},Bm.useFloatTexture=function(e){return e.floatingPointTexture},Bm.getTextureResolution=function(t,n,r){var i=t.texture;if(e(i))return r.x=i.width,r.y=i.height,r;var o=jm(Bm.useFloatTexture(n)?t.length:2*t.length,r);return o.y*=2,o},Bm.prototype.isDestroyed=function(){return!1},Bm.prototype.destroy=function(){return this._clippingPlanesTexture=this._clippingPlanesTexture&&this._clippingPlanesTexture.destroy(),hi(this)};var Qm=new c;function Jm(e,t,n,r,i){this.numberOfDayTextures=e,this.flags=t,this.material=n,this.shaderProgram=r,this.clippingShaderState=i}function $m(){this.baseVertexShaderSource=void 0,this.baseFragmentShaderSource=void 0,this._shadersByTexturesFlags=[],this.material=void 0}function ep(e,t,n,r){if("function"==typeof e.fill)return e.fill(t,n,r);for(var o=e.length>>>0,a=i(n,0),s=a<0?Math.max(o+a,0):Math.min(a,o),u=i(r,o),c=u<0?Math.max(o+u,0):Math.min(u,o);s<c;)e[s]=t,s++;return e}function tp(e){e=i(e,i.EMPTY_OBJECT),this.componentDatatype=e.componentDatatype,this.componentsPerAttribute=e.componentsPerAttribute,this.normalize=i(e.normalize,!1),this.values=e.values}function np(e){e=i(e,i.EMPTY_OBJECT),this.position=e.position,this.normal=e.normal,this.st=e.st,this.bitangent=e.bitangent,this.tangent=e.tangent,this.color=e.color}$m.prototype.getShaderProgram=function(t){var n=t.frameState,r=t.surfaceTile,i=t.numberOfDayTextures,o=t.applyBrightness,a=t.applyContrast,s=t.applyHue,u=t.applySaturation,c=t.applyGamma,l=t.applyAlpha,h=t.applyDayNightAlpha,d=t.applySplit,f=t.showReflectiveOcean,m=t.showOceanWaves,p=t.enableLighting,_=t.dynamicAtmosphereLighting,g=t.dynamicAtmosphereLightingFromSun,v=t.showGroundAtmosphere,y=t.perFragmentGroundAtmosphere,T=t.hasVertexNormals,E=t.useWebMercatorProjection,x=t.enableFog,C=t.enableClippingPlanes,S=t.clippingPlanes,A=t.clippedByBoundaries,w=t.hasImageryLayerCutout,b=t.colorCorrect,D=t.highlightFillTile,I=t.colorToAlpha,R=t.showUndergroundColor,P=t.translucent,O=0,N="",M=r.renderedMesh.encoding;M.quantization===om.BITS12&&(O=1,N="QUANTIZATION_BITS12");var L=0,F="";A&&(L=1,F="TILE_LIMIT_RECTANGLE");var z=0,B="";w&&(z=1,B="APPLY_IMAGERY_CUTOUT");var U=n.mode,V=U|o<<2|a<<3|s<<4|u<<5|c<<6|l<<7|f<<8|m<<9|p<<10|_<<11|g<<12|v<<13|y<<14|T<<15|E<<16|x<<17|O<<18|d<<19|C<<20|L<<21|z<<22|b<<23|D<<24|I<<25|R<<26|P<<27|h<<28,H=0;e(S)&&S.length>0&&(H=C?S.clippingPlanesState:0);var G=r.surfaceShader;if(e(G)&&G.numberOfDayTextures===i&&G.flags===V&&G.material===this.material&&G.clippingShaderState===H)return G.shaderProgram;var k,W,q,Y,j,X,Z,K,Q,J=this._shadersByTexturesFlags[i];if(e(J)||(J=this._shadersByTexturesFlags[i]=[]),!e(G=J[V])||G.material!==this.material||G.clippingShaderState!==H){var $=this.baseVertexShaderSource.clone(),ee=this.baseFragmentShaderSource.clone();0!==H&&ee.sources.unshift((k=S,W=n.context,q=k.unionClippingRegions,Y=k.length,j=Bm.useFloatTexture(W),X=Bm.getTextureResolution(k,W,Qm),Z=X.x,K=X.y,Q=j?function(e,t){var n=1/t,r=1/e+"";-1===r.indexOf(".")&&(r+=".0");var i=n+"";return-1===i.indexOf(".")&&(i+=".0"),"vec4 getClippingPlane(highp sampler2D packedClippingPlanes, int clippingPlaneNumber, mat4 transform)\n{\n    int pixY = clippingPlaneNumber / "+e+";\n    int pixX = clippingPlaneNumber - (pixY * "+e+");\n    float u = (float(pixX) + 0.5) * "+r+";\n    float v = (float(pixY) + 0.5) * "+i+";\n    vec4 plane = texture2D(packedClippingPlanes, vec2(u, v));\n    return czm_transformPlane(plane, transform);\n}\n"}(Z,K):function(e,t){var n=1/t,r=1/e+"";-1===r.indexOf(".")&&(r+=".0");var i=n+"";return-1===i.indexOf(".")&&(i+=".0"),"vec4 getClippingPlane(highp sampler2D packedClippingPlanes, int clippingPlaneNumber, mat4 transform)\n{\n    int clippingPlaneStartIndex = clippingPlaneNumber * 2;\n    int pixY = clippingPlaneStartIndex / "+e+";\n    int pixX = clippingPlaneStartIndex - (pixY * "+e+");\n    float u = (float(pixX) + 0.5) * "+r+";\n    float v = (float(pixY) + 0.5) * "+i+";\n    vec4 oct32 = texture2D(packedClippingPlanes, vec2(u, v)) * 255.0;\n    vec2 oct = vec2(oct32.x * 256.0 + oct32.y, oct32.z * 256.0 + oct32.w);\n    vec4 plane;\n    plane.xyz = czm_octDecode(oct, 65535.0);\n    plane.w = czm_unpackFloat(texture2D(packedClippingPlanes, vec2(u + "+r+", v)));\n    return czm_transformPlane(plane, transform);\n}\n"}(Z,K),Q+="\n",Q+=q?function(e){return"float clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix)\n{\n    vec4 position = czm_windowToEyeCoordinates(fragCoord);\n    vec3 clipNormal = vec3(0.0);\n    vec3 clipPosition = vec3(0.0);\n    float clipAmount;\n    float pixelWidth = czm_metersPerPixel(position);\n    bool breakAndDiscard = false;\n    for (int i = 0; i < "+e+"; ++i)\n    {\n        vec4 clippingPlane = getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);\n        clipNormal = clippingPlane.xyz;\n        clipPosition = -clippingPlane.w * clipNormal;\n        float amount = dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;\n        clipAmount = czm_branchFreeTernary(i == 0, amount, min(amount, clipAmount));\n        if (amount <= 0.0)\n        {\n           breakAndDiscard = true;\n           break;\n        }\n    }\n    if (breakAndDiscard) {\n        discard;\n    }\n    return clipAmount;\n}\n"}(Y):function(e){return"float clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix)\n{\n    bool clipped = true;\n    vec4 position = czm_windowToEyeCoordinates(fragCoord);\n    vec3 clipNormal = vec3(0.0);\n    vec3 clipPosition = vec3(0.0);\n    float clipAmount = 0.0;\n    float pixelWidth = czm_metersPerPixel(position);\n    for (int i = 0; i < "+e+"; ++i)\n    {\n        vec4 clippingPlane = getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);\n        clipNormal = clippingPlane.xyz;\n        clipPosition = -clippingPlane.w * clipNormal;\n        float amount = dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;\n        clipAmount = max(amount, clipAmount);\n        clipped = clipped && (amount <= 0.0);\n    }\n    if (clipped)\n    {\n        discard;\n    }\n    return clipAmount;\n}\n"}(Y),Q)),$.defines.push(N),ee.defines.push("TEXTURE_UNITS "+i,F,B),o&&ee.defines.push("APPLY_BRIGHTNESS"),a&&ee.defines.push("APPLY_CONTRAST"),s&&ee.defines.push("APPLY_HUE"),u&&ee.defines.push("APPLY_SATURATION"),c&&ee.defines.push("APPLY_GAMMA"),l&&ee.defines.push("APPLY_ALPHA"),h&&ee.defines.push("APPLY_DAY_NIGHT_ALPHA"),f&&(ee.defines.push("SHOW_REFLECTIVE_OCEAN"),$.defines.push("SHOW_REFLECTIVE_OCEAN")),m&&ee.defines.push("SHOW_OCEAN_WAVES"),I&&ee.defines.push("APPLY_COLOR_TO_ALPHA"),R&&($.defines.push("UNDERGROUND_COLOR"),ee.defines.push("UNDERGROUND_COLOR")),P&&($.defines.push("TRANSLUCENT"),ee.defines.push("TRANSLUCENT")),p&&(T?($.defines.push("ENABLE_VERTEX_LIGHTING"),ee.defines.push("ENABLE_VERTEX_LIGHTING")):($.defines.push("ENABLE_DAYNIGHT_SHADING"),ee.defines.push("ENABLE_DAYNIGHT_SHADING"))),_&&(ee.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING"),g&&ee.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN")),v&&($.defines.push("GROUND_ATMOSPHERE"),ee.defines.push("GROUND_ATMOSPHERE"),y&&ee.defines.push("PER_FRAGMENT_GROUND_ATMOSPHERE")),$.defines.push("INCLUDE_WEB_MERCATOR_Y"),ee.defines.push("INCLUDE_WEB_MERCATOR_Y"),x&&($.defines.push("FOG"),ee.defines.push("FOG")),d&&ee.defines.push("APPLY_SPLIT"),C&&ee.defines.push("ENABLE_CLIPPING_PLANES"),b&&ee.defines.push("COLOR_CORRECT"),D&&ee.defines.push("HIGHLIGHT_FILL_TILE");var te="    vec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates, float nightBlend)\n    {\n        vec4 color = initialColor;\n";w&&(te+="        vec4 cutoutAndColorResult;\n        bool texelUnclipped;\n");for(var ne=0;ne<i;++ne)te+=w?"        cutoutAndColorResult = u_dayTextureCutoutRectangles["+ne+"];\n        texelUnclipped = v_textureCoordinates.x < cutoutAndColorResult.x || cutoutAndColorResult.z < v_textureCoordinates.x || v_textureCoordinates.y < cutoutAndColorResult.y || cutoutAndColorResult.w < v_textureCoordinates.y;\n        cutoutAndColorResult = sampleAndBlend(\n":"        color = sampleAndBlend(\n",te+="            color,\n            u_dayTextures["+ne+"],\n            u_dayTextureUseWebMercatorT["+ne+"] ? textureCoordinates.xz : textureCoordinates.xy,\n            u_dayTextureTexCoordsRectangle["+ne+"],\n            u_dayTextureTranslationAndScale["+ne+"],\n            "+(l?"u_dayTextureAlpha["+ne+"]":"1.0")+",\n            "+(h?"u_dayTextureNightAlpha["+ne+"]":"1.0")+",\n"+(h?"u_dayTextureDayAlpha["+ne+"]":"1.0")+",\n"+(o?"u_dayTextureBrightness["+ne+"]":"0.0")+",\n            "+(a?"u_dayTextureContrast["+ne+"]":"0.0")+",\n            "+(s?"u_dayTextureHue["+ne+"]":"0.0")+",\n            "+(u?"u_dayTextureSaturation["+ne+"]":"0.0")+",\n            "+(c?"u_dayTextureOneOverGamma["+ne+"]":"0.0")+",\n            "+(d?"u_dayTextureSplit["+ne+"]":"0.0")+",\n            "+(I?"u_colorsToAlpha["+ne+"]":"vec4(0.0)")+",\n        nightBlend        );\n",w&&(te+="        color = czm_branchFreeTernary(texelUnclipped, cutoutAndColorResult, color);\n");te+="        return color;\n    }",ee.sources.push(te),$.sources.push(function(e){var t;switch(e){case Al.SCENE3D:t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPosition3DMode(position, height, textureCoordinates); }";break;case Al.SCENE2D:case Al.COLUMBUS_VIEW:t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionColumbusViewMode(position, height, textureCoordinates); }";break;case Al.MORPHING:t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionMorphingMode(position, height, textureCoordinates); }"}return t}(U)),$.sources.push(function(e){return e?"float get2DYPositionFraction(vec2 textureCoordinates) { return get2DMercatorYPositionFraction(textureCoordinates); }":"float get2DYPositionFraction(vec2 textureCoordinates) { return get2DGeographicYPositionFraction(textureCoordinates); }"}(E));var re=Hu.fromCache({context:n.context,vertexShaderSource:$,fragmentShaderSource:ee,attributeLocations:M.getAttributeLocations()});G=J[V]=new Jm(i,V,this.material,re,H)}return r.surfaceShader=G,G.shaderProgram},$m.prototype.destroy=function(){var t,n,r=this._shadersByTexturesFlags;for(var i in r)if(r.hasOwnProperty(i)){var o=r[i];if(!e(o))continue;for(t in o)o.hasOwnProperty(t)&&e(n=o[t])&&n.shaderProgram.destroy()}return hi(this)};var rp=Object.freeze({NONE:0,TOP:1,ALL:2}),ip=new p;function op(e){var t=(e=i(e,i.EMPTY_OBJECT)).minimum,n=e.maximum;this._min=p.clone(t),this._max=p.clone(n),this._offsetAttribute=e.offsetAttribute,this._workerName="createBoxOutlineGeometry"}op.fromDimensions=function(e){var t=(e=i(e,i.EMPTY_OBJECT)).dimensions,n=p.multiplyByScalar(t,.5,new p);return new op({minimum:p.negate(n,new p),maximum:n,offsetAttribute:e.offsetAttribute})},op.fromAxisAlignedBoundingBox=function(e){return new op({minimum:e.minimum,maximum:e.maximum})},op.packedLength=2*p.packedLength+1,op.pack=function(e,t,n){return n=i(n,0),p.pack(e._min,t,n),p.pack(e._max,t,n+p.packedLength),t[n+2*p.packedLength]=i(e._offsetAttribute,-1),t};var ap=new p,sp=new p,up={minimum:ap,maximum:sp,offsetAttribute:void 0};function cp(e,t,n,r){e=i(e,1),t=i(t,1),n=i(n,1),r=i(r,1),this.value=new Uint8Array([pn.floatToByte(e),pn.floatToByte(t),pn.floatToByte(n),pn.floatToByte(r)])}function lp(e){e=i(e,i.EMPTY_OBJECT),this.geometry=e.geometry,this.modelMatrix=ye.clone(i(e.modelMatrix,ye.IDENTITY)),this.id=e.id,this.pickPrimitive=e.pickPrimitive,this.attributes=i(e.attributes,{}),this.westHemisphereGeometry=void 0,this.eastHemisphereGeometry=void 0}op.unpack=function(t,n,r){n=i(n,0);var o=p.unpack(t,n,ap),a=p.unpack(t,n+p.packedLength,sp),s=t[n+2*p.packedLength];return e(r)?(r._min=p.clone(o,r._min),r._max=p.clone(a,r._max),r._offsetAttribute=-1===s?void 0:s,r):(up.offsetAttribute=-1===s?void 0:s,new op(up))},op.createGeometry=function(t){var n=t._min,r=t._max;if(!p.equals(n,r)){var i=new np,o=new Uint16Array(24),a=new Float64Array(24);a[0]=n.x,a[1]=n.y,a[2]=n.z,a[3]=r.x,a[4]=n.y,a[5]=n.z,a[6]=r.x,a[7]=r.y,a[8]=n.z,a[9]=n.x,a[10]=r.y,a[11]=n.z,a[12]=n.x,a[13]=n.y,a[14]=r.z,a[15]=r.x,a[16]=n.y,a[17]=r.z,a[18]=r.x,a[19]=r.y,a[20]=r.z,a[21]=n.x,a[22]=r.y,a[23]=r.z,i.position=new tp({componentDatatype:xn.DOUBLE,componentsPerAttribute:3,values:a}),o[0]=4,o[1]=5,o[2]=5,o[3]=6,o[4]=6,o[5]=7,o[6]=7,o[7]=4,o[8]=0,o[9]=1,o[10]=1,o[11]=2,o[12]=2,o[13]=3,o[14]=3,o[15]=0,o[16]=0,o[17]=4,o[18]=1,o[19]=5,o[20]=2,o[21]=6,o[22]=3,o[23]=7;var s=p.subtract(r,n,ip),u=.5*p.magnitude(s);if(e(t._offsetAttribute)){var c=a.length,l=new Uint8Array(c/3);ep(l,t._offsetAttribute===rp.NONE?0:1),i.applyOffset=new tp({componentDatatype:xn.UNSIGNED_BYTE,componentsPerAttribute:1,values:l})}return new cc({attributes:i,indices:o,primitiveType:Rs.LINES,boundingSphere:new Me(p.ZERO,u),offsetAttribute:t._offsetAttribute})}},Object.defineProperties(cp.prototype,{componentDatatype:{get:function(){return xn.UNSIGNED_BYTE}},componentsPerAttribute:{get:function(){return 4}},normalize:{get:function(){return!0}}}),cp.fromColor=function(e){return new cp(e.red,e.green,e.blue,e.alpha)},cp.toValue=function(t,n){return e(n)?t.toBytes(n):new Uint8Array(t.toBytes())},cp.equals=function(t,n){return t===n||e(t)&&e(n)&&t.value[0]===n.value[0]&&t.value[1]===n.value[1]&&t.value[2]===n.value[2]&&t.value[3]===n.value[3]};var hp=new p,dp=new p,fp=new p;var mp={calculateACMR:function(t){var n=(t=i(t,i.EMPTY_OBJECT)).indices,r=t.maximumIndex,o=i(t.cacheSize,24),a=n.length;if(!e(r)){r=0;for(var s=0,u=n[s];s<a;)u>r&&(r=u),u=n[++s]}for(var c=[],l=0;l<r+1;l++)c[l]=0;for(var h=o+1,d=0;d<a;++d)h-c[n[d]]>o&&(c[n[d]]=h,++h);return(h-o+1)/(a/3)}};mp.tipsify=function(t){var n,r=(t=i(t,i.EMPTY_OBJECT)).indices,o=t.maximumIndex,a=i(t.cacheSize,24);function s(e,t,r,i,o,a,s){for(var u,c=-1,l=-1,h=0;h<r.length;){var d=r[h];i[d].numLiveTriangles&&(u=0,o-i[d].timeStamp+2*i[d].numLiveTriangles<=t&&(u=o-i[d].timeStamp),(u>l||-1===l)&&(l=u,c=d)),++h}return-1===c?function(e,t,r,i){for(;t.length>=1;){var o=t[t.length-1];if(t.splice(t.length-1,1),e[o].numLiveTriangles>0)return o}for(;n<i;){if(e[n].numLiveTriangles>0)return++n-1;++n}return-1}(i,a,0,s):c}var u=r.length,c=0,l=0,h=r[l],d=u;if(e(o))c=o+1;else{for(;l<d;)h>c&&(c=h),h=r[++l];if(-1===c)return 0;++c}var f,m=[];for(f=0;f<c;f++)m[f]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};l=0;for(var p=0;l<d;)m[r[l]].vertexTriangles.push(p),++m[r[l]].numLiveTriangles,m[r[l+1]].vertexTriangles.push(p),++m[r[l+1]].numLiveTriangles,m[r[l+2]].vertexTriangles.push(p),++m[r[l+2]].numLiveTriangles,++p,l+=3;var _=0,g=a+1;n=1;var v,y,T,E,x=[],C=[],S=0,A=[],w=u/3,b=[];for(f=0;f<w;f++)b[f]=!1;for(;-1!==_;){x=[],E=(y=m[_]).vertexTriangles.length;for(var D=0;D<E;++D)if(!b[p=y.vertexTriangles[D]]){b[p]=!0,l=p+p+p;for(var I=0;I<3;++I)T=r[l],x.push(T),C.push(T),A[S]=T,++S,--(v=m[T]).numLiveTriangles,g-v.timeStamp>a&&(v.timeStamp=g,++g),++l}_=s(0,a,x,m,g,C,c)}return A};var pp={};function _p(e,t,n,r,i){e[t++]=n,e[t++]=r,e[t++]=r,e[t++]=i,e[t++]=i,e[t]=n}function gp(t){var n={};for(var r in t)if(t.hasOwnProperty(r)&&e(t[r])&&e(t[r].values)){var i=t[r];n[r]=new tp({componentDatatype:i.componentDatatype,componentsPerAttribute:i.componentsPerAttribute,normalize:i.normalize,values:[]})}return n}function vp(t,n,r){for(var i in n)if(n.hasOwnProperty(i)&&e(n[i])&&e(n[i].values))for(var o=n[i],a=0;a<o.componentsPerAttribute;++a)t[i].values.push(o.values[r*o.componentsPerAttribute+a])}pp.toWireframe=function(t){var n=t.indices;if(e(n)){switch(t.primitiveType){case Rs.TRIANGLES:t.indices=function(e){for(var t=e.length,n=t/3*6,r=Dn.createTypedArray(t,n),i=0,o=0;o<t;o+=3,i+=6)_p(r,i,e[o],e[o+1],e[o+2]);return r}(n);break;case Rs.TRIANGLE_STRIP:t.indices=function(e){var t=e.length;if(t>=3){var n=6*(t-2),r=Dn.createTypedArray(t,n);_p(r,0,e[0],e[1],e[2]);for(var i=6,o=3;o<t;++o,i+=6)_p(r,i,e[o-1],e[o],e[o-2]);return r}return new Uint16Array}(n);break;case Rs.TRIANGLE_FAN:t.indices=function(e){if(e.length>0){for(var t=e.length-1,n=6*(t-1),r=Dn.createTypedArray(t,n),i=e[0],o=0,a=1;a<t;++a,o+=6)_p(r,o,i,e[a],e[a+1]);return r}return new Uint16Array}(n)}t.primitiveType=Rs.LINES}return t},pp.createLineSegmentsForVectors=function(t,n,r){n=i(n,"normal"),r=i(r,1e4);for(var o,a=t.attributes.position.values,s=t.attributes[n].values,u=a.length,c=new Float64Array(2*u),l=0,h=0;h<u;h+=3)c[l++]=a[h],c[l++]=a[h+1],c[l++]=a[h+2],c[l++]=a[h]+s[h]*r,c[l++]=a[h+1]+s[h+1]*r,c[l++]=a[h+2]+s[h+2]*r;var d=t.boundingSphere;return e(d)&&(o=new Me(d.center,d.radius+r)),new cc({attributes:{position:new tp({componentDatatype:xn.DOUBLE,componentsPerAttribute:3,values:c})},primitiveType:Rs.LINES,boundingSphere:o})},pp.createAttributeLocations=function(t){var n,r=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],i=t.attributes,o={},a=0,s=r.length;for(n=0;n<s;++n){var u=r[n];e(i[u])&&(o[u]=a++)}for(var c in i)i.hasOwnProperty(c)&&!e(o[c])&&(o[c]=a++);return o},pp.reorderForPreVertexCache=function(t){var n=cc.computeNumberOfVertices(t),r=t.indices;if(e(r)){for(var i=new Int32Array(n),o=0;o<n;o++)i[o]=-1;for(var a,s=r,u=s.length,c=Dn.createTypedArray(n,u),l=0,h=0,d=0;l<u;)-1!==(a=i[s[l]])?c[h]=a:(i[a=s[l]]=d,c[h]=d,++d),++l,++h;t.indices=c;var f=t.attributes;for(var m in f)if(f.hasOwnProperty(m)&&e(f[m])&&e(f[m].values)){for(var p=f[m],_=p.values,g=0,v=p.componentsPerAttribute,y=xn.createTypedArray(p.componentDatatype,d*v);g<n;){var T=i[g];if(-1!==T)for(var E=0;E<v;E++)y[v*T+E]=_[v*g+E];++g}p.values=y}}return t},pp.reorderForPostVertexCache=function(t,n){var r=t.indices;if(t.primitiveType===Rs.TRIANGLES&&e(r)){for(var i=r.length,o=0,a=0;a<i;a++)r[a]>o&&(o=r[a]);t.indices=mp.tipsify({indices:r,maximumIndex:o,cacheSize:n})}return t},pp.fitToUnsignedShortIndices=function(t){var n=[],r=cc.computeNumberOfVertices(t);if(e(t.indices)&&r>=a.SIXTY_FOUR_KILOBYTES){var i,o=[],s=[],u=0,c=gp(t.attributes),l=t.indices,h=l.length;t.primitiveType===Rs.TRIANGLES?i=3:t.primitiveType===Rs.LINES?i=2:t.primitiveType===Rs.POINTS&&(i=1);for(var d=0;d<h;d+=i){for(var f=0;f<i;++f){var m=l[d+f],p=o[m];e(p)||(p=u++,o[m]=p,vp(c,t.attributes,m)),s.push(p)}u+i>=a.SIXTY_FOUR_KILOBYTES&&(n.push(new cc({attributes:c,indices:s,primitiveType:t.primitiveType,boundingSphere:t.boundingSphere,boundingSphereCV:t.boundingSphereCV})),o=[],s=[],u=0,c=gp(t.attributes))}0!==s.length&&n.push(new cc({attributes:c,indices:s,primitiveType:t.primitiveType,boundingSphere:t.boundingSphere,boundingSphereCV:t.boundingSphereCV}))}else n.push(t);return n};var yp=new p,Tp=new N;pp.projectTo2D=function(t,n,r,i,o){for(var a=t.attributes[n],s=(o=e(o)?o:new K).ellipsoid,u=a.values,c=new Float64Array(u.length),l=0,h=0;h<u.length;h+=3){var d=p.fromArray(u,h,yp),f=s.cartesianToCartographic(d,Tp),m=o.project(f,yp);c[l++]=m.x,c[l++]=m.y,c[l++]=m.z}return t.attributes[r]=a,t.attributes[i]=new tp({componentDatatype:xn.DOUBLE,componentsPerAttribute:3,values:c}),delete t.attributes[n],t};var Ep={high:0,low:0};pp.encodeAttribute=function(e,t,n,r){for(var i=e.attributes[t],o=i.values,a=o.length,s=new Float32Array(a),u=new Float32Array(a),c=0;c<a;++c)Cn.encode(o[c],Ep),s[c]=Ep.high,u[c]=Ep.low;var l=i.componentsPerAttribute;return e.attributes[n]=new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:l,values:s}),e.attributes[r]=new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:l,values:u}),delete e.attributes[t],e};var xp=new p;function Cp(t,n){if(e(n))for(var r=n.values,i=r.length,o=0;o<i;o+=3)p.unpack(r,o,xp),ye.multiplyByPoint(t,xp,xp),p.pack(xp,r,o)}function Sp(t,n){if(e(n))for(var r=n.values,i=r.length,o=0;o<i;o+=3)p.unpack(r,o,xp),$.multiplyByVector(t,xp,xp),xp=p.normalize(xp,xp),p.pack(xp,r,o)}var Ap=new ye,wp=new $;pp.transformToWorldCoordinates=function(t){var n=t.modelMatrix;if(ye.equals(n,ye.IDENTITY))return t;var r=t.geometry.attributes;Cp(n,r.position),Cp(n,r.prevPosition),Cp(n,r.nextPosition),(e(r.normal)||e(r.tangent)||e(r.bitangent))&&(ye.inverse(n,Ap),ye.transpose(Ap,Ap),ye.getMatrix3(Ap,wp),Sp(wp,r.normal),Sp(wp,r.tangent),Sp(wp,r.bitangent));var i=t.geometry.boundingSphere;return e(i)&&(t.geometry.boundingSphere=Me.transform(i,n,i)),t.modelMatrix=ye.clone(ye.IDENTITY),t};var bp=new p;function Dp(t,n){var r,i,o,a,s=t.length;t[0].modelMatrix;var u,c,l,h,d=e(t[0][n].indices),f=t[0][n].primitiveType,m=function(t,n){var r,i=t.length,o={},a=t[0][n].attributes;for(r in a)if(a.hasOwnProperty(r)&&e(a[r])&&e(a[r].values)){for(var s=a[r],u=s.values.length,c=!0,l=1;l<i;++l){var h=t[l][n].attributes[r];if(!e(h)||s.componentDatatype!==h.componentDatatype||s.componentsPerAttribute!==h.componentsPerAttribute||s.normalize!==h.normalize){c=!1;break}u+=h.values.length}c&&(o[r]=new tp({componentDatatype:s.componentDatatype,componentsPerAttribute:s.componentsPerAttribute,normalize:s.normalize,values:xn.createTypedArray(s.componentDatatype,u)}))}return o}(t,n);for(r in m)if(m.hasOwnProperty(r))for(u=m[r].values,a=0,i=0;i<s;++i)for(l=(c=t[i][n].attributes[r].values).length,o=0;o<l;++o)u[a++]=c[o];if(d){var _=0;for(i=0;i<s;++i)_+=t[i][n].indices.length;var g=cc.computeNumberOfVertices(new cc({attributes:m,primitiveType:Rs.POINTS})),v=Dn.createTypedArray(g,_),y=0,T=0;for(i=0;i<s;++i){var E=t[i][n].indices,x=E.length;for(a=0;a<x;++a)v[y++]=T+E[a];T+=cc.computeNumberOfVertices(t[i][n])}h=v}var C,S=new p,A=0;for(i=0;i<s;++i){if(!e(C=t[i][n].boundingSphere)){S=void 0;break}p.add(C.center,S,S)}if(e(S))for(p.divideByScalar(S,s,S),i=0;i<s;++i){C=t[i][n].boundingSphere;var w=p.magnitude(p.subtract(C.center,S,bp))+C.radius;w>A&&(A=w)}return new cc({attributes:m,indices:h,primitiveType:f,boundingSphere:e(S)?new Me(S,A):void 0})}pp.combineInstances=function(t){for(var n=[],r=[],i=t.length,o=0;o<i;++o){var a=t[o];e(a.geometry)?n.push(a):e(a.westHemisphereGeometry)&&e(a.eastHemisphereGeometry)&&r.push(a)}var s=[];return n.length>0&&s.push(Dp(n,"geometry")),r.length>0&&(s.push(Dp(r,"westHemisphereGeometry")),s.push(Dp(r,"eastHemisphereGeometry"))),s};var Ip=new p,Rp=new p,Pp=new p,Op=new p;pp.computeNormal=function(e){var t,n=e.indices,r=e.attributes,i=r.position.values,o=r.position.values.length/3,s=n.length,u=new Array(o),c=new Array(s/3),l=new Array(s);for(t=0;t<o;t++)u[t]={indexOffset:0,count:0,currentCount:0};var h=0;for(t=0;t<s;t+=3){var d=n[t],f=n[t+1],m=n[t+2],_=3*d,g=3*f,v=3*m;Rp.x=i[_],Rp.y=i[_+1],Rp.z=i[_+2],Pp.x=i[g],Pp.y=i[g+1],Pp.z=i[g+2],Op.x=i[v],Op.y=i[v+1],Op.z=i[v+2],u[d].count++,u[f].count++,u[m].count++,p.subtract(Pp,Rp,Pp),p.subtract(Op,Rp,Op),c[h]=p.cross(Pp,Op,new p),h++}var y,T=0;for(t=0;t<o;t++)u[t].indexOffset+=T,T+=u[t].count;for(h=0,t=0;t<s;t+=3){var E=(y=u[n[t]]).indexOffset+y.currentCount;l[E]=h,y.currentCount++,l[E=(y=u[n[t+1]]).indexOffset+y.currentCount]=h,y.currentCount++,l[E=(y=u[n[t+2]]).indexOffset+y.currentCount]=h,y.currentCount++,h++}var x=new Float32Array(3*o);for(t=0;t<o;t++){var C=3*t;if(y=u[t],p.clone(p.ZERO,Ip),y.count>0){for(h=0;h<y.count;h++)p.add(Ip,c[l[y.indexOffset+h]],Ip);p.equalsEpsilon(p.ZERO,Ip,a.EPSILON10)&&p.clone(c[l[y.indexOffset]],Ip)}p.equalsEpsilon(p.ZERO,Ip,a.EPSILON10)&&(Ip.z=1),p.normalize(Ip,Ip),x[C]=Ip.x,x[C+1]=Ip.y,x[C+2]=Ip.z}return e.attributes.normal=new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:3,values:x}),e};var Np=new p,Mp=new p,Lp=new p;pp.computeTangentAndBitangent=function(e){e.attributes;var t,n,r,i,o=e.indices,a=e.attributes.position.values,s=e.attributes.normal.values,u=e.attributes.st.values,c=e.attributes.position.values.length/3,l=o.length,h=new Array(3*c);for(t=0;t<h.length;t++)h[t]=0;for(t=0;t<l;t+=3){var d=o[t],f=o[t+1],m=o[t+2];r=3*f,i=3*m;var _=2*d,g=2*f,v=2*m,y=a[n=3*d],T=a[n+1],E=a[n+2],x=u[_],C=u[_+1],S=u[g+1]-C,A=u[v+1]-C,w=1/((u[g]-x)*A-(u[v]-x)*S),b=(A*(a[r]-y)-S*(a[i]-y))*w,D=(A*(a[r+1]-T)-S*(a[i+1]-T))*w,I=(A*(a[r+2]-E)-S*(a[i+2]-E))*w;h[n]+=b,h[n+1]+=D,h[n+2]+=I,h[r]+=b,h[r+1]+=D,h[r+2]+=I,h[i]+=b,h[i+1]+=D,h[i+2]+=I}var R=new Float32Array(3*c),P=new Float32Array(3*c);for(t=0;t<c;t++){r=(n=3*t)+1,i=n+2;var O=p.fromArray(s,n,Np),N=p.fromArray(h,n,Lp),M=p.dot(O,N);p.multiplyByScalar(O,M,Mp),p.normalize(p.subtract(N,Mp,N),N),R[n]=N.x,R[r]=N.y,R[i]=N.z,p.normalize(p.cross(O,N,N),N),P[n]=N.x,P[r]=N.y,P[i]=N.z}return e.attributes.tangent=new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:3,values:R}),e.attributes.bitangent=new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:3,values:P}),e};var Fp=new c,zp=new p,Bp=new p,Up=new p,Vp=new c;function Hp(t){switch(t.primitiveType){case Rs.TRIANGLE_FAN:return function(e){var t=cc.computeNumberOfVertices(e),n=Dn.createTypedArray(t,3*(t-2));n[0]=1,n[1]=0,n[2]=2;for(var r=3,i=3;i<t;++i)n[r++]=i-1,n[r++]=0,n[r++]=i;return e.indices=n,e.primitiveType=Rs.TRIANGLES,e}(t);case Rs.TRIANGLE_STRIP:return function(e){var t=cc.computeNumberOfVertices(e),n=Dn.createTypedArray(t,3*(t-2));n[0]=0,n[1]=1,n[2]=2,t>3&&(n[3]=0,n[4]=2,n[5]=3);for(var r=6,i=3;i<t-1;i+=2)n[r++]=i,n[r++]=i-1,n[r++]=i+1,i+2<t&&(n[r++]=i,n[r++]=i+1,n[r++]=i+2);return e.indices=n,e.primitiveType=Rs.TRIANGLES,e}(t);case Rs.TRIANGLES:return function(t){if(e(t.indices))return t;for(var n=cc.computeNumberOfVertices(t),r=Dn.createTypedArray(n,n),i=0;i<n;++i)r[i]=i;return t.indices=r,t}(t);case Rs.LINE_STRIP:return function(e){var t=cc.computeNumberOfVertices(e),n=Dn.createTypedArray(t,2*(t-1));n[0]=0,n[1]=1;for(var r=2,i=2;i<t;++i)n[r++]=i-1,n[r++]=i;return e.indices=n,e.primitiveType=Rs.LINES,e}(t);case Rs.LINE_LOOP:return function(e){var t=cc.computeNumberOfVertices(e),n=Dn.createTypedArray(t,2*t);n[0]=0,n[1]=1;for(var r=2,i=2;i<t;++i)n[r++]=i-1,n[r++]=i;return n[r++]=t-1,n[r]=0,e.indices=n,e.primitiveType=Rs.LINES,e}(t);case Rs.LINES:return function(t){if(e(t.indices))return t;for(var n=cc.computeNumberOfVertices(t),r=Dn.createTypedArray(n,n),i=0;i<n;++i)r[i]=i;return t.indices=r,t}(t)}return t}function Gp(e,t){Math.abs(e.y)<a.EPSILON6&&(e.y=t?-a.EPSILON6:a.EPSILON6)}pp.compressVertices=function(t){var n,r,i=t.attributes.extrudeDirection;if(e(i)){var o=i.values;r=o.length/3;var a=new Float32Array(2*r),s=0;for(n=0;n<r;++n)p.fromArray(o,3*n,zp),p.equals(zp,p.ZERO)?s+=2:(Vp=S.octEncodeInRange(zp,65535,Vp),a[s++]=Vp.x,a[s++]=Vp.y);return t.attributes.compressedAttributes=new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:2,values:a}),delete t.attributes.extrudeDirection,t}var u=t.attributes.normal,l=t.attributes.st,h=e(u),d=e(l);if(!h&&!d)return t;var f,m,_,g,v=t.attributes.tangent,y=t.attributes.bitangent,T=e(v),E=e(y);h&&(f=u.values),d&&(m=l.values),T&&(_=v.values),E&&(g=y.values);var x=r=(h?f.length:m.length)/(h?3:2),C=d&&h?2:1;C+=T||E?1:0;var A=new Float32Array(x*=C),w=0;for(n=0;n<r;++n){d&&(c.fromArray(m,2*n,Fp),A[w++]=S.compressTextureCoordinates(Fp));var b=3*n;h&&e(_)&&e(g)?(p.fromArray(f,b,zp),p.fromArray(_,b,Bp),p.fromArray(g,b,Up),S.octPack(zp,Bp,Up,Fp),A[w++]=Fp.x,A[w++]=Fp.y):(h&&(p.fromArray(f,b,zp),A[w++]=S.octEncodeFloat(zp)),T&&(p.fromArray(_,b,zp),A[w++]=S.octEncodeFloat(zp)),E&&(p.fromArray(g,b,zp),A[w++]=S.octEncodeFloat(zp)))}return t.attributes.compressedAttributes=new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:C,values:A}),h&&delete t.attributes.normal,d&&delete t.attributes.st,E&&delete t.attributes.bitangent,T&&delete t.attributes.tangent,t};var kp=new p;function Wp(e,t,n,r){p.add(e,p.multiplyByScalar(p.subtract(t,e,kp),e.y/(e.y-t.y),kp),n),p.clone(n,r),Gp(n,!0),Gp(r,!1)}var qp=new p,Yp=new p,jp=new p,Xp=new p,Zp={positions:new Array(7),indices:new Array(9)};function Kp(e,t,n){if(!(e.x>=0||t.x>=0||n.x>=0)){!function(e,t,n){if(0!==e.y&&0!==t.y&&0!==n.y)return Gp(e,e.y<0),Gp(t,t.y<0),void Gp(n,n.y<0);var r=Math.abs(e.y),i=Math.abs(t.y),o=Math.abs(n.y),s=(r>i?r>o?a.sign(e.y):a.sign(n.y):i>o?a.sign(t.y):a.sign(n.y))<0;Gp(e,s),Gp(t,s),Gp(n,s)}(e,t,n);var r=e.y<0,i=t.y<0,o=n.y<0,s=0;s+=r?1:0,s+=i?1:0;var u=Zp.indices;1===(s+=o?1:0)?(u[1]=3,u[2]=4,u[5]=6,u[7]=6,u[8]=5,r?(Wp(e,t,qp,jp),Wp(e,n,Yp,Xp),u[0]=0,u[3]=1,u[4]=2,u[6]=1):i?(Wp(t,n,qp,jp),Wp(t,e,Yp,Xp),u[0]=1,u[3]=2,u[4]=0,u[6]=2):o&&(Wp(n,e,qp,jp),Wp(n,t,Yp,Xp),u[0]=2,u[3]=0,u[4]=1,u[6]=0)):2===s&&(u[2]=4,u[4]=4,u[5]=3,u[7]=5,u[8]=6,r?i?o||(Wp(n,e,qp,jp),Wp(n,t,Yp,Xp),u[0]=0,u[1]=1,u[3]=0,u[6]=2):(Wp(t,n,qp,jp),Wp(t,e,Yp,Xp),u[0]=2,u[1]=0,u[3]=2,u[6]=1):(Wp(e,t,qp,jp),Wp(e,n,Yp,Xp),u[0]=1,u[1]=2,u[3]=1,u[6]=0));var c=Zp.positions;return c[0]=e,c[1]=t,c[2]=n,c.length=3,1!==s&&2!==s||(c[3]=qp,c[4]=Yp,c[5]=jp,c[6]=Xp,c.length=7),Zp}}function Qp(t,n){var r=t.attributes;if(0!==r.position.values.length){for(var i in r)if(r.hasOwnProperty(i)&&e(r[i])&&e(r[i].values)){var o=r[i];o.values=xn.createTypedArray(o.componentDatatype,o.values)}var a=cc.computeNumberOfVertices(t);return t.indices=Dn.createTypedArray(a,t.indices),n&&(t.boundingSphere=Me.fromVertices(r.position.values)),t}}function Jp(t){var n=t.attributes,r={};for(var i in n)if(n.hasOwnProperty(i)&&e(n[i])&&e(n[i].values)){var o=n[i];r[i]=new tp({componentDatatype:o.componentDatatype,componentsPerAttribute:o.componentsPerAttribute,normalize:o.normalize,values:[]})}return new cc({attributes:r,indices:[],primitiveType:t.primitiveType})}function $p(t,n,r){var i=e(t.geometry.boundingSphere);n=Qp(n,i),e(r=Qp(r,i))&&!e(n)?t.geometry=r:!e(r)&&e(n)?t.geometry=n:(t.westHemisphereGeometry=n,t.eastHemisphereGeometry=r,t.geometry=void 0)}function e_(e,t){var n=new e,r=new e,i=new e;return function(o,a,s,u,c,l,h,d){var f=e.fromArray(c,o*t,n),m=e.fromArray(c,a*t,r),p=e.fromArray(c,s*t,i);e.multiplyByScalar(f,u.x,f),e.multiplyByScalar(m,u.y,m),e.multiplyByScalar(p,u.z,p);var _=e.add(f,m,f);e.add(_,p,_),d&&e.normalize(_,_),e.pack(_,l,h*t)}}var t_=e_(le,4),n_=e_(p,3),r_=e_(c,2),i_=new p,o_=new p,a_=new p,s_=new p;function u_(t,n,r,i,o,s,u,l,h,d,f,m,_,g,v,y){if(e(s)||e(u)||e(l)||e(h)||e(d)||0!==g){var T=function(t,n,r,i,o){var s,u,l,h,d,f,m,_;if(e(o)||(o=new p),e(n.z)){if(p.equalsEpsilon(t,n,a.EPSILON14))return p.clone(p.UNIT_X,o);if(p.equalsEpsilon(t,r,a.EPSILON14))return p.clone(p.UNIT_Y,o);if(p.equalsEpsilon(t,i,a.EPSILON14))return p.clone(p.UNIT_Z,o);s=p.subtract(r,n,hp),u=p.subtract(i,n,dp),l=p.subtract(t,n,fp),h=p.dot(s,s),d=p.dot(s,u),f=p.dot(s,l),m=p.dot(u,u),_=p.dot(u,l)}else{if(c.equalsEpsilon(t,n,a.EPSILON14))return p.clone(p.UNIT_X,o);if(c.equalsEpsilon(t,r,a.EPSILON14))return p.clone(p.UNIT_Y,o);if(c.equalsEpsilon(t,i,a.EPSILON14))return p.clone(p.UNIT_Z,o);s=c.subtract(r,n,hp),u=c.subtract(i,n,dp),l=c.subtract(t,n,fp),h=c.dot(s,s),d=c.dot(s,u),f=c.dot(s,l),m=c.dot(u,u),_=c.dot(u,l)}o.y=m*f-d*_,o.z=h*_-d*f;var g=h*m-d*d;return 0!==o.y&&(o.y/=g),0!==o.z&&(o.z/=g),o.x=1-o.y-o.z,o}(i,p.fromArray(o,3*t,i_),p.fromArray(o,3*n,o_),p.fromArray(o,3*r,a_),s_);if(e(s)&&n_(t,n,r,T,s,m.normal.values,y,!0),e(d)){var E,x=p.fromArray(d,3*t,i_),C=p.fromArray(d,3*n,o_),S=p.fromArray(d,3*r,a_);p.multiplyByScalar(x,T.x,x),p.multiplyByScalar(C,T.y,C),p.multiplyByScalar(S,T.z,S),p.equals(x,p.ZERO)&&p.equals(C,p.ZERO)&&p.equals(S,p.ZERO)?((E=i_).x=0,E.y=0,E.z=0):(E=p.add(x,C,x),p.add(E,S,E),p.normalize(E,E)),p.pack(E,m.extrudeDirection.values,3*y)}if(e(f)&&function(e,t,n,r,i,o,s){var u=i[e]*r.x,c=i[t]*r.y,l=i[n]*r.z;o[s]=u+c+l>a.EPSILON6?1:0}(t,n,r,T,f,m.applyOffset.values,y),e(u)&&n_(t,n,r,T,u,m.tangent.values,y,!0),e(l)&&n_(t,n,r,T,l,m.bitangent.values,y,!0),e(h)&&r_(t,n,r,T,h,m.st.values,y),g>0)for(var A=0;A<g;A++){var w=_[A];c_(t,n,r,T,y,v[w],m[w])}}}function c_(e,t,n,r,i,o,a){var s=o.componentsPerAttribute,u=o.values,c=a.values;switch(s){case 4:t_(e,t,n,r,u,c,i,!1);break;case 3:n_(e,t,n,r,u,c,i,!1);break;case 2:r_(e,t,n,r,u,c,i,!1);break;default:c[i]=u[e]*r.x+u[t]*r.y+u[n]*r.z}}function l_(e,t,n,r,i,o){var a=e.position.values.length/3;if(-1!==i){var s=r[i],u=n[s];return-1===u?(n[s]=a,e.position.values.push(o.x,o.y,o.z),t.push(a),a):(t.push(u),u)}return e.position.values.push(o.x,o.y,o.z),t.push(a),a}var h_={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function d_(t){var n=t.geometry,r=n.attributes,i=r.position.values,o=e(r.normal)?r.normal.values:void 0,a=e(r.bitangent)?r.bitangent.values:void 0,s=e(r.tangent)?r.tangent.values:void 0,u=e(r.st)?r.st.values:void 0,c=e(r.extrudeDirection)?r.extrudeDirection.values:void 0,l=e(r.applyOffset)?r.applyOffset.values:void 0,h=n.indices,d=[];for(var f in r)r.hasOwnProperty(f)&&!h_[f]&&e(r[f])&&d.push(f);var m,_,g,v,y=d.length,T=Jp(n),E=Jp(n),x=[];x.length=i.length/3;var C=[];for(C.length=i.length/3,v=0;v<x.length;++v)x[v]=-1,C[v]=-1;var S=h.length;for(v=0;v<S;v+=3){var A=h[v],w=h[v+1],b=h[v+2],D=p.fromArray(i,3*A),I=p.fromArray(i,3*w),R=p.fromArray(i,3*b),P=Kp(D,I,R);if(e(P)&&P.positions.length>3)for(var O=P.positions,N=P.indices,M=N.length,L=0;L<M;++L){var F=N[L],z=O[F];z.y<0?(m=E.attributes,_=E.indices,g=x):(m=T.attributes,_=T.indices,g=C),u_(A,w,b,z,i,o,s,a,u,c,l,m,d,y,r,l_(m,_,g,h,F<3?v+F:-1,z))}else e(P)&&(D=P.positions[0],I=P.positions[1],R=P.positions[2]),D.y<0?(m=E.attributes,_=E.indices,g=x):(m=T.attributes,_=T.indices,g=C),u_(A,w,b,D,i,o,s,a,u,c,l,m,d,y,r,l_(m,_,g,h,v,D)),u_(A,w,b,I,i,o,s,a,u,c,l,m,d,y,r,l_(m,_,g,h,v+1,I)),u_(A,w,b,R,i,o,s,a,u,c,l,m,d,y,r,l_(m,_,g,h,v+2,R))}$p(t,E,T)}var f_=mr.fromPointNormal(p.ZERO,p.UNIT_Y),m_=new p,p_=new p;function __(t,n,r,i,o,s,u){if(e(u)){var c=p.fromArray(i,3*t,i_);p.equalsEpsilon(c,r,a.EPSILON10)?s.applyOffset.values[o]=u[t]:s.applyOffset.values[o]=u[n]}}function g_(t){var n,r=t.geometry,i=r.attributes,o=i.position.values,s=e(i.applyOffset)?i.applyOffset.values:void 0,u=r.indices,c=Jp(r),l=Jp(r),h=u.length,d=[];d.length=o.length/3;var f=[];for(f.length=o.length/3,n=0;n<d.length;++n)d[n]=-1,f[n]=-1;for(n=0;n<h;n+=2){var m=u[n],_=u[n+1],g=p.fromArray(o,3*m,i_),v=p.fromArray(o,3*_,o_);Math.abs(g.y)<a.EPSILON6&&(g.y<0?g.y=-a.EPSILON6:g.y=a.EPSILON6),Math.abs(v.y)<a.EPSILON6&&(v.y<0?v.y=-a.EPSILON6:v.y=a.EPSILON6);var y=c.attributes,T=c.indices,E=f,x=l.attributes,C=l.indices,S=d,A=zn.lineSegmentPlane(g,v,f_,a_);if(e(A)){var w=p.multiplyByScalar(p.UNIT_Y,5*a.EPSILON9,m_);g.y<0&&(p.negate(w,w),y=l.attributes,T=l.indices,E=d,x=c.attributes,C=c.indices,S=f);var b=p.add(A,w,p_);__(m,_,g,o,l_(y,T,E,u,n,g),y,s),__(m,_,b,o,l_(y,T,E,u,-1,b),y,s),p.negate(w,w),p.add(A,w,b),__(m,_,b,o,l_(x,C,S,u,-1,b),x,s),__(m,_,v,o,l_(x,C,S,u,n+1,v),x,s)}else{var D,I,R;g.y<0?(D=l.attributes,I=l.indices,R=d):(D=c.attributes,I=c.indices,R=f),__(m,_,g,o,l_(D,I,R,u,n,g),D,s),__(m,_,v,o,l_(D,I,R,u,n+1,v),D,s)}}$p(t,l,c)}var v_=new c,y_=new c,T_=new p,E_=new p,x_=new p,C_=new p,S_=new p,A_=new p,w_=new le;function b_(e){for(var t=e.attributes,n=t.position.values,r=t.prevPosition.values,i=t.nextPosition.values,o=n.length,a=0;a<o;a+=3){var s=p.unpack(n,a,T_);if(!(s.x>0)){var u=p.unpack(r,a,E_);(s.y<0&&u.y>0||s.y>0&&u.y<0)&&(a-3>0?(r[a]=n[a-3],r[a+1]=n[a-2],r[a+2]=n[a-1]):p.pack(s,r,a));var c=p.unpack(i,a,x_);(s.y<0&&c.y>0||s.y>0&&c.y<0)&&(a+3<o?(i[a]=n[a+3],i[a+1]=n[a+4],i[a+2]=n[a+5]):p.pack(s,i,a))}}}var D_=5*a.EPSILON9,I_=a.EPSILON6;pp.splitLongitude=function(t){var n=t.geometry,r=n.boundingSphere;if(e(r)&&(r.center.x-r.radius>0||Me.intersectPlane(r,mr.ORIGIN_ZX_PLANE)!==Q.INTERSECTING))return t;if(n.geometryType!==uc.NONE)switch(n.geometryType){case uc.POLYLINES:!function(t){var n,r,i,o=t.geometry,s=o.attributes,u=s.position.values,l=s.prevPosition.values,h=s.nextPosition.values,d=s.expandAndWidth.values,f=e(s.st)?s.st.values:void 0,m=e(s.color)?s.color.values:void 0,_=Jp(o),g=Jp(o),v=!1,y=u.length/3;for(n=0;n<y;n+=4){var T=n,E=n+2,x=p.fromArray(u,3*T,T_),C=p.fromArray(u,3*E,E_);if(Math.abs(x.y)<I_)for(x.y=I_*(C.y<0?-1:1),u[3*n+1]=x.y,u[3*(n+1)+1]=x.y,r=3*T;r<3*T+12;r+=3)l[r]=u[3*n],l[r+1]=u[3*n+1],l[r+2]=u[3*n+2];if(Math.abs(C.y)<I_)for(C.y=I_*(x.y<0?-1:1),u[3*(n+2)+1]=C.y,u[3*(n+3)+1]=C.y,r=3*T;r<3*T+12;r+=3)h[r]=u[3*(n+2)],h[r+1]=u[3*(n+2)+1],h[r+2]=u[3*(n+2)+2];var S=_.attributes,A=_.indices,w=g.attributes,b=g.indices,D=zn.lineSegmentPlane(x,C,f_,C_);if(e(D)){v=!0;var I=p.multiplyByScalar(p.UNIT_Y,D_,S_);x.y<0&&(p.negate(I,I),S=g.attributes,A=g.indices,w=_.attributes,b=_.indices);var R=p.add(D,I,A_);S.position.values.push(x.x,x.y,x.z,x.x,x.y,x.z),S.position.values.push(R.x,R.y,R.z),S.position.values.push(R.x,R.y,R.z),S.prevPosition.values.push(l[3*T],l[3*T+1],l[3*T+2]),S.prevPosition.values.push(l[3*T+3],l[3*T+4],l[3*T+5]),S.prevPosition.values.push(x.x,x.y,x.z,x.x,x.y,x.z),S.nextPosition.values.push(R.x,R.y,R.z),S.nextPosition.values.push(R.x,R.y,R.z),S.nextPosition.values.push(R.x,R.y,R.z),S.nextPosition.values.push(R.x,R.y,R.z),p.negate(I,I),p.add(D,I,R),w.position.values.push(R.x,R.y,R.z),w.position.values.push(R.x,R.y,R.z),w.position.values.push(C.x,C.y,C.z,C.x,C.y,C.z),w.prevPosition.values.push(R.x,R.y,R.z),w.prevPosition.values.push(R.x,R.y,R.z),w.prevPosition.values.push(R.x,R.y,R.z),w.prevPosition.values.push(R.x,R.y,R.z),w.nextPosition.values.push(C.x,C.y,C.z,C.x,C.y,C.z),w.nextPosition.values.push(h[3*E],h[3*E+1],h[3*E+2]),w.nextPosition.values.push(h[3*E+3],h[3*E+4],h[3*E+5]);var P=c.fromArray(d,2*T,v_),O=Math.abs(P.y);S.expandAndWidth.values.push(-1,O,1,O),S.expandAndWidth.values.push(-1,-O,1,-O),w.expandAndWidth.values.push(-1,O,1,O),w.expandAndWidth.values.push(-1,-O,1,-O);var N=p.magnitudeSquared(p.subtract(D,x,x_));if(N/=p.magnitudeSquared(p.subtract(C,x,x_)),e(m)){var M=le.fromArray(m,4*T,w_),L=le.fromArray(m,4*E,w_),F=a.lerp(M.x,L.x,N),z=a.lerp(M.y,L.y,N),B=a.lerp(M.z,L.z,N),U=a.lerp(M.w,L.w,N);for(r=4*T;r<4*T+8;++r)S.color.values.push(m[r]);for(S.color.values.push(F,z,B,U),S.color.values.push(F,z,B,U),w.color.values.push(F,z,B,U),w.color.values.push(F,z,B,U),r=4*E;r<4*E+8;++r)w.color.values.push(m[r])}if(e(f)){var V=c.fromArray(f,2*T,v_),H=c.fromArray(f,2*(n+3),y_),G=a.lerp(V.x,H.x,N);for(r=2*T;r<2*T+4;++r)S.st.values.push(f[r]);for(S.st.values.push(G,V.y),S.st.values.push(G,H.y),w.st.values.push(G,V.y),w.st.values.push(G,H.y),r=2*E;r<2*E+4;++r)w.st.values.push(f[r])}i=S.position.values.length/3-4,A.push(i,i+2,i+1),A.push(i+1,i+2,i+3),i=w.position.values.length/3-4,b.push(i,i+2,i+1),b.push(i+1,i+2,i+3)}else{var k,W;for(x.y<0?(k=g.attributes,W=g.indices):(k=_.attributes,W=_.indices),k.position.values.push(x.x,x.y,x.z),k.position.values.push(x.x,x.y,x.z),k.position.values.push(C.x,C.y,C.z),k.position.values.push(C.x,C.y,C.z),r=3*n;r<3*n+12;++r)k.prevPosition.values.push(l[r]),k.nextPosition.values.push(h[r]);for(r=2*n;r<2*n+8;++r)k.expandAndWidth.values.push(d[r]),e(f)&&k.st.values.push(f[r]);if(e(m))for(r=4*n;r<4*n+16;++r)k.color.values.push(m[r]);i=k.position.values.length/3-4,W.push(i,i+2,i+1),W.push(i+1,i+2,i+3)}}v&&(b_(g),b_(_)),$p(t,g,_)}(t);break;case uc.TRIANGLES:d_(t);break;case uc.LINES:g_(t)}else Hp(n),n.primitiveType===Rs.TRIANGLES?d_(t):n.primitiveType===Rs.LINES&&g_(t);return t};var R_=new p(1,1,1),P_=Math.cos,O_=Math.sin;function N_(e){e=i(e,i.EMPTY_OBJECT);var t=i(e.radii,R_),n=i(e.innerRadii,t),r=i(e.minimumClock,0),o=i(e.maximumClock,a.TWO_PI),s=i(e.minimumCone,0),u=i(e.maximumCone,a.PI),c=Math.round(i(e.stackPartitions,10)),l=Math.round(i(e.slicePartitions,8)),h=Math.round(i(e.subdivisions,128));this._radii=p.clone(t),this._innerRadii=p.clone(n),this._minimumClock=r,this._maximumClock=o,this._minimumCone=s,this._maximumCone=u,this._stackPartitions=c,this._slicePartitions=l,this._subdivisions=h,this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipsoidOutlineGeometry"}N_.packedLength=2*p.packedLength+8,N_.pack=function(e,t,n){return n=i(n,0),p.pack(e._radii,t,n),n+=p.packedLength,p.pack(e._innerRadii,t,n),n+=p.packedLength,t[n++]=e._minimumClock,t[n++]=e._maximumClock,t[n++]=e._minimumCone,t[n++]=e._maximumCone,t[n++]=e._stackPartitions,t[n++]=e._slicePartitions,t[n++]=e._subdivisions,t[n]=i(e._offsetAttribute,-1),t};var M_=new p,L_=new p,F_={radii:M_,innerRadii:L_,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,subdivisions:void 0,offsetAttribute:void 0};function z_(e){var t=i(e.radius,1),n={radii:new p(t,t,t),stackPartitions:e.stackPartitions,slicePartitions:e.slicePartitions,subdivisions:e.subdivisions};this._ellipsoidGeometry=new N_(n),this._workerName="createSphereOutlineGeometry"}N_.unpack=function(t,n,r){n=i(n,0);var o=p.unpack(t,n,M_);n+=p.packedLength;var a=p.unpack(t,n,L_);n+=p.packedLength;var s=t[n++],u=t[n++],c=t[n++],l=t[n++],h=t[n++],d=t[n++],f=t[n++],m=t[n];return e(r)?(r._radii=p.clone(o,r._radii),r._innerRadii=p.clone(a,r._innerRadii),r._minimumClock=s,r._maximumClock=u,r._minimumCone=c,r._maximumCone=l,r._stackPartitions=h,r._slicePartitions=d,r._subdivisions=f,r._offsetAttribute=-1===m?void 0:m,r):(F_.minimumClock=s,F_.maximumClock=u,F_.minimumCone=c,F_.maximumCone=l,F_.stackPartitions=h,F_.slicePartitions=d,F_.subdivisions=f,F_.offsetAttribute=-1===m?void 0:m,new N_(F_))},N_.createGeometry=function(t){var n=t._radii;if(!(n.x<=0||n.y<=0||n.z<=0)){var r=t._innerRadii;if(!(r.x<=0||r.y<=0||r.z<=0)){var i=t._minimumClock,o=t._maximumClock,s=t._minimumCone,u=t._maximumCone,c=t._subdivisions,l=H.fromCartesian3(n),h=t._slicePartitions+1,d=t._stackPartitions+1;(h=Math.round(h*Math.abs(o-i)/a.TWO_PI))<2&&(h=2),(d=Math.round(d*Math.abs(u-s)/a.PI))<2&&(d=2);var f=0,m=1,p=r.x!==n.x||r.y!==n.y||r.z!==n.z,_=!1,g=!1;p&&(m=2,s>0&&(_=!0,f+=h),u<Math.PI&&(g=!0,f+=h));var v,y,T,E,x=c*m*(d+h),C=new Float64Array(3*x),S=2*(x+f-(h+d)*m),A=Dn.createTypedArray(x,S),w=0,b=new Array(d),D=new Array(d);for(v=0;v<d;v++)E=s+v*(u-s)/(d-1),b[v]=O_(E),D[v]=P_(E);var I=new Array(c),R=new Array(c);for(v=0;v<c;v++)T=i+v*(o-i)/(c-1),I[v]=O_(T),R[v]=P_(T);for(v=0;v<d;v++)for(y=0;y<c;y++)C[w++]=n.x*b[v]*R[y],C[w++]=n.y*b[v]*I[y],C[w++]=n.z*D[v];if(p)for(v=0;v<d;v++)for(y=0;y<c;y++)C[w++]=r.x*b[v]*R[y],C[w++]=r.y*b[v]*I[y],C[w++]=r.z*D[v];for(b.length=c,D.length=c,v=0;v<c;v++)E=s+v*(u-s)/(c-1),b[v]=O_(E),D[v]=P_(E);for(I.length=h,R.length=h,v=0;v<h;v++)T=i+v*(o-i)/(h-1),I[v]=O_(T),R[v]=P_(T);for(v=0;v<c;v++)for(y=0;y<h;y++)C[w++]=n.x*b[v]*R[y],C[w++]=n.y*b[v]*I[y],C[w++]=n.z*D[v];if(p)for(v=0;v<c;v++)for(y=0;y<h;y++)C[w++]=r.x*b[v]*R[y],C[w++]=r.y*b[v]*I[y],C[w++]=r.z*D[v];for(w=0,v=0;v<d*m;v++){var P=v*c;for(y=0;y<c-1;y++)A[w++]=P+y,A[w++]=P+y+1}var O=d*c*m;for(v=0;v<h;v++)for(y=0;y<c-1;y++)A[w++]=O+v+y*h,A[w++]=O+v+(y+1)*h;if(p)for(O=d*c*m+h*c,v=0;v<h;v++)for(y=0;y<c-1;y++)A[w++]=O+v+y*h,A[w++]=O+v+(y+1)*h;if(p){var N=d*c*m,M=N+c*h;if(_)for(v=0;v<h;v++)A[w++]=N+v,A[w++]=M+v;if(g)for(N+=c*h-h,M+=c*h-h,v=0;v<h;v++)A[w++]=N+v,A[w++]=M+v}var L=new np({position:new tp({componentDatatype:xn.DOUBLE,componentsPerAttribute:3,values:C})});if(e(t._offsetAttribute)){var F=C.length,z=new Uint8Array(F/3);ep(z,t._offsetAttribute===rp.NONE?0:1),L.applyOffset=new tp({componentDatatype:xn.UNSIGNED_BYTE,componentsPerAttribute:1,values:z})}return new cc({attributes:L,indices:A,primitiveType:Rs.LINES,boundingSphere:Me.fromEllipsoid(l),offsetAttribute:t._offsetAttribute})}}},z_.packedLength=N_.packedLength,z_.pack=function(e,t,n){return N_.pack(e._ellipsoidGeometry,t,n)};var B_=new N_,U_={radius:void 0,radii:new p,stackPartitions:void 0,slicePartitions:void 0,subdivisions:void 0};z_.unpack=function(t,n,r){var i=N_.unpack(t,n,B_);return U_.stackPartitions=i._stackPartitions,U_.slicePartitions=i._slicePartitions,U_.subdivisions=i._subdivisions,e(r)?(p.clone(i._radii,U_.radii),r._ellipsoidGeometry=new N_(U_),r):(U_.radius=i._radii.x,new z_(U_))},z_.createGeometry=function(e){return N_.createGeometry(e._ellipsoidGeometry)};var V_=Object.freeze({NONE:-1,PARTIAL:0,FULL:1}),H_={NEVER:Tn.NEVER,LESS:Tn.LESS,EQUAL:Tn.EQUAL,LESS_OR_EQUAL:Tn.LEQUAL,GREATER:Tn.GREATER,NOT_EQUAL:Tn.NOTEQUAL,GREATER_OR_EQUAL:Tn.GEQUAL,ALWAYS:Tn.ALWAYS},G_=Object.freeze(H_);function k_(e,t,n,r,o,a,s){this.provider=e,this.message=t,this.x=n,this.y=r,this.level=o,this.timesRetried=i(a,0),this.retry=!1,this.error=s}k_.handleError=function(t,n,r,i,o,a,s,u,c){var l=t;return e(t)?(l.provider=n,l.message=i,l.x=o,l.y=a,l.level=s,l.retry=!1,l.error=c,++l.timesRetried):l=new k_(n,i,o,a,s,0,c),r.numberOfListeners>0?r.raiseEvent(l):console.log('An error occurred in "'+n.constructor.name+'": '+function(t){var n,r=t.name,i=t.message;n=e(r)&&e(i)?r+": "+i:t.toString();var o=t.stack;return e(o)&&(n+="\n"+o),n}(i)),l.retry&&e(u)&&u(),l},k_.handleSuccess=function(t){e(t)&&(t.timesRetried=-1)};var W_=Object.freeze({UNLOADED:0,TRANSITIONING:1,RECEIVED:2,TEXTURE_LOADED:3,READY:4,FAILED:5,INVALID:6,PLACEHOLDER:7}),q_=Object.freeze({START:0,LOADING:1,DONE:2,FAILED:3}),Y_=Object.freeze({FAILED:0,UNLOADED:1,RECEIVING:2,RECEIVED:3,TRANSFORMING:4,TRANSFORMED:5,READY:6});function j_(){this.imagery=[],this.waterMaskTexture=void 0,this.waterMaskTranslationAndScale=new le(0,0,1,1),this.terrainData=void 0,this.vertexArray=void 0,this.orientedBoundingBox=void 0,this.boundingVolumeSourceTile=void 0,this.tileBoundingRegion=void 0,this.occludeePointInScaledSpace=new p,this.terrainState=Y_.UNLOADED,this.mesh=void 0,this.fill=void 0,this.pickBoundingSphere=new Me,this.surfaceShader=void 0,this.isClipped=!0,this.clippedByBoundaries=!1}function X_(t,n,r,i,o,a){if(t.decodePosition(i,o,a),e(n)&&n!==Al.SCENE3D){var s=r.ellipsoid.cartesianToCartographic(a);r.project(s,a),p.fromElements(a.z,a.x,a.y,a)}return a}Object.defineProperties(j_.prototype,{eligibleForUnloading:{get:function(){for(var t=this.terrainState,n=!(t===Y_.RECEIVING||t===Y_.TRANSFORMING),r=this.imagery,i=0,o=r.length;n&&i<o;++i){var a=r[i];n=!e(a.loadingImagery)||a.loadingImagery.state!==W_.TRANSITIONING}return n}},renderedMesh:{get:function(){return e(this.vertexArray)?this.mesh:e(this.fill)?this.fill.mesh:void 0}}});var Z_=new p,K_=new p,Q_=new p;function J_(e){e=i(e,i.EMPTY_OBJECT),this.vertexArray=e.vertexArray,this.fragmentShaderSource=e.fragmentShaderSource,this.shaderProgram=e.shaderProgram,this.uniformMap=e.uniformMap,this.outputTexture=e.outputTexture,this.preExecute=e.preExecute,this.postExecute=e.postExecute,this.canceled=e.canceled,this.persists=i(e.persists,!1),this.pass=Os.COMPUTE,this.owner=e.owner}j_.prototype.pick=function(t,n,r,i,o){var a=this.renderedMesh;if(e(a)){for(var s=a.vertices,u=a.indices,c=a.encoding,l=u.length,h=Number.MAX_VALUE,d=0;d<l;d+=3){var f=u[d],m=u[d+1],p=u[d+2],_=X_(c,n,r,s,f,Z_),g=X_(c,n,r,s,m,K_),v=X_(c,n,r,s,p,Q_),y=zn.rayTriangleParametric(t,_,g,v,i);e(y)&&y<h&&y>=0&&(h=y)}return h!==Number.MAX_VALUE?Fn.getPoint(t,h,o):void 0}},j_.prototype.freeResources=function(){e(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,0===this.waterMaskTexture.referenceCount&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0),this.terrainData=void 0,this.terrainState=Y_.UNLOADED,this.mesh=void 0,this.fill=this.fill&&this.fill.destroy();for(var t=this.imagery,n=0,r=t.length;n<r;++n)t[n].freeResources();this.imagery.length=0,this.freeVertexArray()},j_.prototype.freeVertexArray=function(){j_._freeVertexArray(this.vertexArray),this.vertexArray=void 0,j_._freeVertexArray(this.wireframeVertexArray),this.wireframeVertexArray=void 0},j_.initialize=function(t,n,r){var i=t.data;e(i)||(i=t.data=new j_),t.state===q_.START&&(!function(t,n,r){var i=n.getTileDataAvailable(t.x,t.y,t.level);if(!e(i)&&e(t.parent)){var o=t.parent,a=o.data;e(a)&&e(a.terrainData)&&(i=a.terrainData.isChildAvailable(o.x,o.y,t.x,t.y))}!1===i&&(t.data.terrainState=Y_.FAILED);for(var s=0,u=r.length;s<u;++s){var c=r.get(s);c.show&&c._createTileImagerySkeletons(t,n)}}(t,n,r),t.state=q_.LOADING)},j_.processStateMachine=function(t,n,r,i,o,a){j_.initialize(t,r,i);var s=t.data;if(t.state===q_.LOADING&&function(t,n,r,i,o){var a=t.data,s=t.parent;if(a.terrainState===Y_.FAILED&&void 0!==s){void 0!==s.data&&void 0!==s.data.terrainData&&!1!==s.data.terrainData.canUpsample||j_.processStateMachine(s,n,r,i,!0)}a.terrainState===Y_.FAILED&&function(t,n,r,i,o,a,s){var u=n.parent;if(!u)return void(n.state=q_.FAILED);var c=u.data.terrainData,l=u.x,h=u.y,d=u.level;if(!e(c))return;var f=c.upsample(i.tilingScheme,l,h,d,o,a,s);if(!e(f))return;t.terrainState=Y_.RECEIVING,Et(f,(function(e){t.terrainData=e,t.terrainState=Y_.RECEIVED}),(function(){t.terrainState=Y_.FAILED}))}(a,t,0,r,t.x,t.y,t.level);a.terrainState===Y_.UNLOADED&&function(t,n,r,i,o){function a(e){t.terrainData=e,t.terrainState=Y_.RECEIVED,t.request=void 0}function s(){if(t.request.state===Ho.CANCELLED)return t.terrainData=void 0,t.terrainState=Y_.UNLOADED,void(t.request=void 0);t.terrainState=Y_.FAILED,t.request=void 0;var e="Failed to obtain terrain tile X: "+r+" Y: "+i+" Level: "+o+".";n._requestError=k_.handleError(n._requestError,n,n.errorEvent,e,r,i,o,u)}function u(){var u=new ko({throttle:!1,throttleByServer:!0,type:Go.TERRAIN});t.request=u;var c=n.requestTileGeometry(r,i,o,u);e(c)?(t.terrainState=Y_.RECEIVING,Et(c,a,s)):(t.terrainState=Y_.UNLOADED,t.request=void 0)}u()}(a,r,t.x,t.y,t.level);a.terrainState===Y_.RECEIVED&&function(t,n,r,i,o,a){var s=r.tilingScheme,u=t.terrainData.createMesh(s,i,o,a,n.terrainExaggeration);if(!e(u))return;t.terrainState=Y_.TRANSFORMING,Et(u,(function(e){t.mesh=e,t.orientedBoundingBox=mf.clone(e.orientedBoundingBox,t.orientedBoundingBox),t.occludeePointInScaledSpace=p.clone(e.occludeePointInScaledSpace,t.occludeePointInScaledSpace),t.terrainState=Y_.TRANSFORMED}),(function(){t.terrainState=Y_.FAILED}))}(a,n,r,t.x,t.y,t.level);a.terrainState===Y_.TRANSFORMED&&function(e,t,n,r,i,o,a){e.vertexArray=j_._createVertexArrayForMesh(t,e.mesh),e.terrainState=Y_.READY,e.fill=e.fill&&e.fill.destroy(a)}(a,n.context,0,t.x,t.y,t.level,o);if(a.terrainState>=Y_.RECEIVED&&void 0===a.waterMaskTexture&&r.hasWaterMask){if(void 0!==a.terrainData.waterMask)!function(t,n){var r,i=n.terrainData.waterMask,o=function(t){var n=t.cache.tile_waterMaskData;if(!e(n)){var r=Fh.create({context:t,pixelFormat:Xc.LUMINANCE,pixelDatatype:Yc.UNSIGNED_BYTE,source:{arrayBufferView:new Uint8Array([255]),width:1,height:1}});r.referenceCount=1,n={allWaterTexture:r,sampler:new Lh({wrapS:Mh.CLAMP_TO_EDGE,wrapT:Mh.CLAMP_TO_EDGE,minificationFilter:Oh.LINEAR,magnificationFilter:Rh.LINEAR}),destroy:function(){this.allWaterTexture.destroy()}},t.cache.tile_waterMaskData=n}return n}(t),a=i.length;if(1===a){if(0===i[0])return;r=o.allWaterTexture}else{var s=Math.sqrt(a);(r=Fh.create({context:t,pixelFormat:Xc.LUMINANCE,pixelDatatype:Yc.UNSIGNED_BYTE,source:{width:s,height:s,arrayBufferView:i},sampler:o.sampler,flipY:!1})).referenceCount=0}++r.referenceCount,n.waterMaskTexture=r,le.fromElements(0,0,1,1,n.waterMaskTranslationAndScale)}(n.context,a);else{var u=a._findAncestorTileWithTerrainData(t);e(u)&&e(u.data.waterMaskTexture)&&(a.waterMaskTexture=u.data.waterMaskTexture,++a.waterMaskTexture.referenceCount,a._computeWaterMaskTranslationAndScale(t,u,a.waterMaskTranslationAndScale))}}}(t,n,r,i,o),!a){var u=t.renderable;t.renderable=e(s.vertexArray);var c=s.terrainState===Y_.READY;t.upsampledFromParent=e(s.terrainData)&&s.terrainData.wasCreatedByUpsampling();var l=s.processImagery(t,r,n);if(c&&l){var h=t._loadedCallbacks,d={};for(var f in h)h.hasOwnProperty(f)&&(h[f](t)||(d[f]=h[f]));t._loadedCallbacks=d,t.state=q_.DONE}u&&(t.renderable=!0)}},j_.prototype.processImagery=function(t,n,r,i){var o,a,s=t.data,u=t.upsampledFromParent,c=!1,l=!0,h=s.imagery;for(o=0,a=h.length;o<a;++o){var d=h[o];if(e(d.loadingImagery)){if(d.loadingImagery.state===W_.PLACEHOLDER){var f=d.loadingImagery.imageryLayer;if(f.imageryProvider.ready){d.freeResources(),h.splice(o,1),f._createTileImagerySkeletons(t,n,o),--o,a=h.length;continue}u=!1}var m=d.processStateMachine(t,r,i);l=l&&m,c=c||m||e(d.readyImagery),u=u&&e(d.loadingImagery)&&(d.loadingImagery.state===W_.FAILED||d.loadingImagery.state===W_.INVALID)}else u=!1}return t.upsampledFromParent=u,t.renderable=t.renderable&&(c||l),l},j_._createVertexArrayForMesh=function(t,n){var r=n.vertices,i=bs.createVertexBuffer({context:t,typedArray:r,usage:ws.STATIC_DRAW}),o=n.encoding.getAttributes(i),a=n.indices.indexBuffers||{},s=a[t.id];if(!e(s)||s.isDestroyed()){var u=n.indices;(s=bs.createIndexBuffer({context:t,typedArray:u,usage:ws.STATIC_DRAW,indexDatatype:Dn.fromSizeInBytes(u.BYTES_PER_ELEMENT)})).vertexArrayDestroyable=!1,s.referenceCount=1,a[t.id]=s,n.indices.indexBuffers=a}else++s.referenceCount;return new xc({context:t,attributes:o,indexBuffer:s})},j_._freeVertexArray=function(t){if(e(t)){var n=t.indexBuffer;t.destroy(),e(n)&&!n.isDestroyed()&&e(n.referenceCount)&&(--n.referenceCount,0===n.referenceCount&&n.destroy())}},j_.prototype._findAncestorTileWithTerrainData=function(t){for(var n=t.parent;e(n)&&(!e(n.data)||!e(n.data.terrainData)||n.data.terrainData.wasCreatedByUpsampling());)n=n.parent;return n},j_.prototype._computeWaterMaskTranslationAndScale=function(e,t,n){var r=t.rectangle,i=e.rectangle,o=i.width,a=i.height,s=o/r.width,u=a/r.height;return n.x=s*(i.west-r.west)/o,n.y=u*(i.south-r.south)/a,n.z=s,n.w=u,n},J_.prototype.execute=function(e){e.execute(this)};var $_="uniform sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\ngl_FragColor = texture2D(u_texture, v_textureCoordinates);\n}\n",eg="attribute vec4 position;\nattribute float webMercatorT;\nuniform vec2 u_textureDimensions;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nv_textureCoordinates = vec2(position.x, webMercatorT);\ngl_Position = czm_viewportOrthographic * (position * vec4(u_textureDimensions, 1.0, 1.0));\n}\n";function tg(t,n,r,i,o){if(this.imageryLayer=t,this.x=n,this.y=r,this.level=i,this.request=void 0,0!==i){var a=n/2|0,s=r/2|0,u=i-1;this.parent=t.getImageryFromCache(a,s,u)}(this.state=W_.UNLOADED,this.imageUrl=void 0,this.image=void 0,this.texture=void 0,this.textureWebMercator=void 0,this.credits=void 0,this.referenceCount=0,!e(o)&&t.imageryProvider.ready)&&(o=t.imageryProvider.tilingScheme.tileXYToRectangle(n,r,i));this.rectangle=o}tg.createPlaceholder=function(e){var t=new tg(e,0,0,0);return t.addReference(),t.state=W_.PLACEHOLDER,t},tg.prototype.addReference=function(){++this.referenceCount},tg.prototype.releaseReference=function(){return--this.referenceCount,0===this.referenceCount?(this.imageryLayer.removeImageryFromCache(this),e(this.parent)&&this.parent.releaseReference(),e(this.image)&&e(this.image.destroy)&&this.image.destroy(),e(this.texture)&&this.texture.destroy(),e(this.textureWebMercator)&&this.texture!==this.textureWebMercator&&this.textureWebMercator.destroy(),hi(this),0):this.referenceCount},tg.prototype.processStateMachine=function(e,t,n){this.state!==W_.UNLOADED||n||(this.state=W_.TRANSITIONING,this.imageryLayer._requestImagery(this)),this.state===W_.RECEIVED&&(this.state=W_.TRANSITIONING,this.imageryLayer._createTexture(e.context,this));var r=this.state===W_.READY&&t&&!this.texture;(this.state===W_.TEXTURE_LOADED||r)&&(this.state=W_.TRANSITIONING,this.imageryLayer._reprojectTexture(e,this,t))};var ng=Object.freeze({LEFT:-1,NONE:0,RIGHT:1});function rg(e,t,n){this.readyImagery=void 0,this.loadingImagery=e,this.textureCoordinateRectangle=t,this.textureTranslationAndScale=void 0,this.useWebMercatorT=n}function ig(e,t){this._imageryProvider=e,t=i(t,i.EMPTY_OBJECT),this.alpha=i(t.alpha,i(e.defaultAlpha,1)),this.nightAlpha=i(t.nightAlpha,i(e.defaultNightAlpha,1)),this.dayAlpha=i(t.dayAlpha,i(e.defaultDayAlpha,1)),this.brightness=i(t.brightness,i(e.defaultBrightness,ig.DEFAULT_BRIGHTNESS)),this.contrast=i(t.contrast,i(e.defaultContrast,ig.DEFAULT_CONTRAST)),this.hue=i(t.hue,i(e.defaultHue,ig.DEFAULT_HUE)),this.saturation=i(t.saturation,i(e.defaultSaturation,ig.DEFAULT_SATURATION)),this.gamma=i(t.gamma,i(e.defaultGamma,ig.DEFAULT_GAMMA)),this.splitDirection=i(t.splitDirection,i(e.defaultSplit,ig.DEFAULT_SPLIT)),this.minificationFilter=i(t.minificationFilter,i(e.defaultMinificationFilter,ig.DEFAULT_MINIFICATION_FILTER)),this.magnificationFilter=i(t.magnificationFilter,i(e.defaultMagnificationFilter,ig.DEFAULT_MAGNIFICATION_FILTER)),this.show=i(t.show,!0),this._minimumTerrainLevel=t.minimumTerrainLevel,this._maximumTerrainLevel=t.maximumTerrainLevel,this._rectangle=i(t.rectangle,Oe.MAX_VALUE),this._maximumAnisotropy=t.maximumAnisotropy,this._imageryCache={},this._skeletonPlaceholder=new rg(tg.createPlaceholder(this)),this._show=!0,this._layerIndex=-1,this._isBaseLayer=!1,this._requestImageError=void 0,this._reprojectComputeCommands=[],this.cutoutRectangle=t.cutoutRectangle,this.colorToAlpha=t.colorToAlpha,this.colorToAlphaThreshold=i(t.colorToAlphaThreshold,ig.DEFAULT_APPLY_COLOR_TO_ALPHA_THRESHOLD)}rg.prototype.freeResources=function(){e(this.readyImagery)&&this.readyImagery.releaseReference(),e(this.loadingImagery)&&this.loadingImagery.releaseReference()},rg.prototype.processStateMachine=function(t,n,r){var i=this.loadingImagery,o=i.imageryLayer;if(i.processStateMachine(n,!this.useWebMercatorT,r),i.state===W_.READY)return e(this.readyImagery)&&this.readyImagery.releaseReference(),this.readyImagery=this.loadingImagery,this.loadingImagery=void 0,this.textureTranslationAndScale=o._calculateTextureTranslationAndScale(t,this),!0;for(var a,s=i.parent;e(s)&&(s.state!==W_.READY||!this.useWebMercatorT&&!e(s.texture));)s.state!==W_.FAILED&&s.state!==W_.INVALID&&(a=a||s),s=s.parent;return this.readyImagery!==s&&(e(this.readyImagery)&&this.readyImagery.releaseReference(),this.readyImagery=s,e(s)&&(s.addReference(),this.textureTranslationAndScale=o._calculateTextureTranslationAndScale(t,this))),(i.state===W_.FAILED||i.state===W_.INVALID)&&(!e(a)||(a.processStateMachine(n,!this.useWebMercatorT,r),!1))},Object.defineProperties(ig.prototype,{imageryProvider:{get:function(){return this._imageryProvider}},rectangle:{get:function(){return this._rectangle}}}),ig.DEFAULT_BRIGHTNESS=1,ig.DEFAULT_CONTRAST=1,ig.DEFAULT_HUE=0,ig.DEFAULT_SATURATION=1,ig.DEFAULT_GAMMA=1,ig.DEFAULT_SPLIT=ng.NONE,ig.DEFAULT_MINIFICATION_FILTER=Oh.LINEAR,ig.DEFAULT_MAGNIFICATION_FILTER=Rh.LINEAR,ig.DEFAULT_APPLY_COLOR_TO_ALPHA_THRESHOLD=.004,ig.prototype.isBaseLayer=function(){return this._isBaseLayer},ig.prototype.isDestroyed=function(){return!1},ig.prototype.destroy=function(){return hi(this)};var og=new Oe,ag=new Oe,sg=new Oe,ug=new Oe;function cg(e,t,n){return e+":"+t+":"+n}function lg(e,t,n){return JSON.stringify([e,t,n])}ig.prototype.getViewableRectangle=function(){var e=this._imageryProvider,t=this._rectangle;return e.readyPromise.then((function(){return Oe.intersection(e.rectangle,t)}))},ig.prototype._createTileImagerySkeletons=function(t,n,r){var i=t.data;if(e(this._minimumTerrainLevel)&&t.level<this._minimumTerrainLevel)return!1;if(e(this._maximumTerrainLevel)&&t.level>this._maximumTerrainLevel)return!1;var o=this._imageryProvider;if(e(r)||(r=i.imagery.length),!o.ready)return this._skeletonPlaceholder.loadingImagery.addReference(),i.imagery.splice(r,0,this._skeletonPlaceholder),!0;var a=o.tilingScheme.projection instanceof Nc&&t.rectangle.north<Nc.MaximumLatitude&&t.rectangle.south>-Nc.MaximumLatitude,s=Oe.intersection(o.rectangle,this._rectangle,og),u=Oe.intersection(t.rectangle,s,ag);if(!e(u)){if(!this.isBaseLayer())return!1;var c=s,l=t.rectangle;u=ag,l.south>=c.north?u.north=u.south=c.north:l.north<=c.south?u.north=u.south=c.south:(u.south=Math.max(l.south,c.south),u.north=Math.min(l.north,c.north)),l.west>=c.east?u.west=u.east=c.east:l.east<=c.west?u.west=u.east=c.west:(u.west=Math.max(l.west,c.west),u.east=Math.min(l.east,c.east))}var h=0;u.south>0?h=u.south:u.north<0&&(h=u.north);var d=function(e,t,n){var r=e._imageryProvider,i=r.tilingScheme,o=i.ellipsoid,a=e._imageryProvider.tilingScheme.projection instanceof K?1:Math.cos(n),s=i.rectangle,u=o.maximumRadius*s.width*a/(r.tileWidth*i.getNumberOfXTilesAtLevel(0))/t,c=Math.log(u)/Math.log(2);return 0|Math.round(c)}(this,1*n.getLevelMaximumGeometricError(t.level),h);d=Math.max(0,d);var f=o.maximumLevel;if(d>f&&(d=f),e(o.minimumLevel)){var m=o.minimumLevel;d<m&&(d=m)}var p=o.tilingScheme,_=p.positionToTileXY(Oe.northwest(u),d),g=p.positionToTileXY(Oe.southeast(u),d),v=t.rectangle.width/512,y=t.rectangle.height/512,T=p.tileXYToRectangle(_.x,_.y,d);Math.abs(T.south-t.rectangle.north)<y&&_.y<g.y&&++_.y,Math.abs(T.east-t.rectangle.west)<v&&_.x<g.x&&++_.x;var E=p.tileXYToRectangle(g.x,g.y,d);Math.abs(E.north-t.rectangle.south)<y&&g.y>_.y&&--g.y,Math.abs(E.west-t.rectangle.east)<v&&g.x>_.x&&--g.x;var x,C,S=Oe.clone(t.rectangle,ug),A=p.tileXYToRectangle(_.x,_.y,d),w=Oe.intersection(A,s,sg);a?(p.rectangleToNativeRectangle(S,S),p.rectangleToNativeRectangle(A,A),p.rectangleToNativeRectangle(w,w),p.rectangleToNativeRectangle(s,s),x=p.tileXYToNativeRectangle.bind(p),v=S.width/512,y=S.height/512):x=p.tileXYToRectangle.bind(p);var b,D=0,I=1;!this.isBaseLayer()&&Math.abs(w.west-S.west)>=v&&(D=Math.min(1,(w.west-S.west)/S.width)),!this.isBaseLayer()&&Math.abs(w.north-S.north)>=y&&(I=Math.max(0,(w.north-S.south)/S.height));for(var R=I,P=_.x;P<=g.x;P++)if(C=D,A=x(P,_.y,d),e(w=Oe.simpleIntersection(A,s,sg))){D=Math.min(1,(w.east-S.west)/S.width),P===g.x&&(this.isBaseLayer()||Math.abs(w.east-S.east)<v)&&(D=1),I=R;for(var O=_.y;O<=g.y;O++)if(b=I,A=x(P,O,d),e(w=Oe.simpleIntersection(A,s,sg))){I=Math.max(0,(w.south-S.south)/S.height),O===g.y&&(this.isBaseLayer()||Math.abs(w.south-S.south)<y)&&(I=0);var N=new le(C,I,D,b),M=this.getImageryFromCache(P,O,d);i.imagery.splice(r,0,new rg(M,N,a)),++r}}return!0},ig.prototype._calculateTextureTranslationAndScale=function(e,t){var n=t.readyImagery.rectangle,r=e.rectangle;if(t.useWebMercatorT){var i=t.readyImagery.imageryLayer.imageryProvider.tilingScheme;n=i.rectangleToNativeRectangle(n,og),r=i.rectangleToNativeRectangle(r,ug)}var o=r.width,a=r.height,s=o/n.width,u=a/n.height;return new le(s*(r.west-n.west)/o,u*(r.south-n.south)/a,s,u)},ig.prototype._requestImagery=function(t){var n=this._imageryProvider,r=this;function i(n){if(!e(n))return o();t.image=n,t.state=W_.RECEIVED,t.request=void 0,k_.handleSuccess(r._requestImageError)}function o(e){if(t.request.state===Ho.CANCELLED)return t.state=W_.UNLOADED,void(t.request=void 0);t.state=W_.FAILED,t.request=void 0;var i="Failed to obtain image tile X: "+t.x+" Y: "+t.y+" Level: "+t.level+".";r._requestImageError=k_.handleError(r._requestImageError,n,n.errorEvent,i,t.x,t.y,t.level,a,e)}function a(){var r=new ko({throttle:!1,throttleByServer:!0,type:Go.IMAGERY});t.request=r,t.state=W_.TRANSITIONING;var a=n.requestImage(t.x,t.y,t.level,r);if(!e(a))return t.state=W_.UNLOADED,void(t.request=void 0);e(n.getTileCredits)&&(t.credits=n.getTileCredits(t.x,t.y,t.level)),Et(a,i,o)}a()},ig.prototype._createTextureWebGL=function(t,n){var r=new Lh({minificationFilter:this.minificationFilter,magnificationFilter:this.magnificationFilter}),i=n.image;return e(i.internalFormat)?new Fh({context:t,pixelFormat:i.internalFormat,width:i.width,height:i.height,source:{arrayBufferView:i.bufferView},sampler:r}):new Fh({context:t,source:i,pixelFormat:this._imageryProvider.hasAlphaChannel?Xc.RGBA:Xc.RGB,sampler:r})},ig.prototype._createTexture=function(t,n){var r=this._imageryProvider,i=n.image;if(e(r.tileDiscardPolicy)){var o=r.tileDiscardPolicy;if(e(o)){if(!o.isReady())return void(n.state=W_.RECEIVED);if(o.shouldDiscardImage(i))return void(n.state=W_.INVALID)}}var a=this._createTextureWebGL(t,n);r.tilingScheme.projection instanceof Nc?n.textureWebMercator=a:n.texture=a,n.image=void 0,n.state=W_.TEXTURE_LOADED},ig.prototype._finalizeReprojectTexture=function(t,n){var r=this.minificationFilter,o=this.magnificationFilter;if(r===Oh.LINEAR&&o===Rh.LINEAR&&!Xc.isCompressedFormat(n.pixelFormat)&&a.isPowerOfTwo(n.width)&&a.isPowerOfTwo(n.height)){r=Oh.LINEAR_MIPMAP_LINEAR;var s=Ds.maximumTextureFilterAnisotropy,u=Math.min(s,i(this._maximumAnisotropy,s)),c=cg(r,o,u),l=t.cache.imageryLayerMipmapSamplers;e(l)||(l={},t.cache.imageryLayerMipmapSamplers=l);var h=l[c];e(h)||(h=l[c]=new Lh({wrapS:Mh.CLAMP_TO_EDGE,wrapT:Mh.CLAMP_TO_EDGE,minificationFilter:r,magnificationFilter:o,maximumAnisotropy:u})),n.generateMipmap(Dh.NICEST),n.sampler=h}else{var d=cg(r,o,0),f=t.cache.imageryLayerNonMipmapSamplers;e(f)||(f={},t.cache.imageryLayerNonMipmapSamplers=f);var m=f[d];e(m)||(m=f[d]=new Lh({wrapS:Mh.CLAMP_TO_EDGE,wrapT:Mh.CLAMP_TO_EDGE,minificationFilter:r,magnificationFilter:o})),n.sampler=m}},ig.prototype._reprojectTexture=function(t,n,r){var o=n.textureWebMercator||n.texture,s=n.rectangle,u=t.context;if((r=i(r,!0))&&!(this._imageryProvider.tilingScheme.projection instanceof K)&&s.width/o.width>1e-5){var c=this;n.addReference();var l=new J_({persists:!0,owner:this,preExecute:function(t){!function(t,n,r,i){var o=n.cache.imageryLayer_reproject;if(!e(o)){o=n.cache.imageryLayer_reproject={vertexArray:void 0,shaderProgram:void 0,sampler:void 0,destroy:function(){e(this.framebuffer)&&this.framebuffer.destroy(),e(this.vertexArray)&&this.vertexArray.destroy(),e(this.shaderProgram)&&this.shaderProgram.destroy()}};for(var s=new Float32Array(256),u=0,c=0;c<64;++c){var l=c/63;s[u++]=0,s[u++]=l,s[u++]=1,s[u++]=l}var h={position:0,webMercatorT:1},d=Em.getRegularGridIndices(2,64),f=bs.createIndexBuffer({context:n,typedArray:d,usage:ws.STATIC_DRAW,indexDatatype:Dn.UNSIGNED_SHORT});o.vertexArray=new xc({context:n,attributes:[{index:h.position,vertexBuffer:bs.createVertexBuffer({context:n,typedArray:s,usage:ws.STATIC_DRAW}),componentsPerAttribute:2},{index:h.webMercatorT,vertexBuffer:bs.createVertexBuffer({context:n,sizeInBytes:512,usage:ws.STREAM_DRAW}),componentsPerAttribute:1}],indexBuffer:f});var m=new nc({sources:[eg]});o.shaderProgram=Hu.fromCache({context:n,vertexShaderSource:m,fragmentShaderSource:$_,attributeLocations:h}),o.sampler=new Lh({wrapS:Mh.CLAMP_TO_EDGE,wrapT:Mh.CLAMP_TO_EDGE,minificationFilter:Oh.LINEAR,magnificationFilter:Rh.LINEAR})}r.sampler=o.sampler;var p=r.width,_=r.height;hg.textureDimensions.x=p,hg.textureDimensions.y=_,hg.texture=r;var g=Math.sin(i.south),v=.5*Math.log((1+g)/(1-g));g=Math.sin(i.north);var y=1/(.5*Math.log((1+g)/(1-g))-v),T=new Fh({context:n,width:p,height:_,pixelFormat:r.pixelFormat,pixelDatatype:r.pixelDatatype,preMultiplyAlpha:r.preMultiplyAlpha});a.isPowerOfTwo(p)&&a.isPowerOfTwo(_)&&T.generateMipmap(Dh.NICEST);for(var E=i.south,x=i.north,C=dg,S=0,A=0;A<64;++A){var w=A/63,b=a.lerp(E,x,w);g=Math.sin(b);var D=(.5*Math.log((1+g)/(1-g))-v)*y;C[S++]=D,C[S++]=D}o.vertexArray.getAttribute(1).vertexBuffer.copyFromArrayView(C),t.shaderProgram=o.shaderProgram,t.outputTexture=T,t.uniformMap=hg,t.vertexArray=o.vertexArray}(t,u,o,n.rectangle)},postExecute:function(e){n.texture=e,c._finalizeReprojectTexture(u,e),n.state=W_.READY,n.releaseReference()},canceled:function(){n.state=W_.TEXTURE_LOADED,n.releaseReference()}});this._reprojectComputeCommands.push(l)}else r&&(n.texture=o),this._finalizeReprojectTexture(u,o),n.state=W_.READY},ig.prototype.queueReprojectionCommands=function(e){for(var t=this._reprojectComputeCommands,n=t.length,r=0;r<n;++r)e.commandList.push(t[r]);t.length=0},ig.prototype.cancelReprojections=function(){this._reprojectComputeCommands.forEach((function(t){e(t.canceled)&&t.canceled()})),this._reprojectComputeCommands.length=0},ig.prototype.getImageryFromCache=function(t,n,r,i){var o=lg(t,n,r),a=this._imageryCache[o];return e(a)||(a=new tg(this,t,n,r,i),this._imageryCache[o]=a),a.addReference(),a},ig.prototype.removeImageryFromCache=function(e){var t=lg(e.x,e.y,e.level);delete this._imageryCache[t]};var hg={u_textureDimensions:function(){return this.textureDimensions},u_texture:function(){return this.texture},textureDimensions:new c,texture:void 0},dg=fn.supportsTypedArrays()?new Float32Array(128):void 0;function fg(e){e=i(e,i.EMPTY_OBJECT),this.position=i(e.position,!1),this.normal=i(e.normal,!1),this.st=i(e.st,!1),this.bitangent=i(e.bitangent,!1),this.tangent=i(e.tangent,!1),this.color=i(e.color,!1)}fg.POSITION_ONLY=Object.freeze(new fg({position:!0})),fg.POSITION_AND_NORMAL=Object.freeze(new fg({position:!0,normal:!0})),fg.POSITION_NORMAL_AND_ST=Object.freeze(new fg({position:!0,normal:!0,st:!0})),fg.POSITION_AND_ST=Object.freeze(new fg({position:!0,st:!0})),fg.POSITION_AND_COLOR=Object.freeze(new fg({position:!0,color:!0})),fg.ALL=Object.freeze(new fg({position:!0,normal:!0,st:!0,tangent:!0,bitangent:!0})),fg.DEFAULT=fg.POSITION_NORMAL_AND_ST,fg.packedLength=6,fg.pack=function(e,t,n){return n=i(n,0),t[n++]=e.position?1:0,t[n++]=e.normal?1:0,t[n++]=e.st?1:0,t[n++]=e.tangent?1:0,t[n++]=e.bitangent?1:0,t[n]=e.color?1:0,t},fg.unpack=function(t,n,r){return n=i(n,0),e(r)||(r=new fg),r.position=1===t[n++],r.normal=1===t[n++],r.st=1===t[n++],r.tangent=1===t[n++],r.bitangent=1===t[n++],r.color=1===t[n],r},fg.clone=function(t,n){if(e(t))return e(n)||(n=new fg),n.position=t.position,n.normal=t.normal,n.st=t.st,n.tangent=t.tangent,n.bitangent=t.bitangent,n.color=t.color,n};var mg={FRONT:Tn.FRONT,BACK:Tn.BACK,FRONT_AND_BACK:Tn.FRONT_AND_BACK},pg=Object.freeze(mg);function _g(e){e=i(e,i.EMPTY_OBJECT),this.material=e.material,this.translucent=i(e.translucent,!0),this._vertexShaderSource=e.vertexShaderSource,this._fragmentShaderSource=e.fragmentShaderSource,this._renderState=e.renderState,this._closed=i(e.closed,!1)}function gg(e){e=i(e,i.EMPTY_OBJECT);var t=i(e.translucent,!0),n=i(e.closed,!1),r=i(e.flat,!1),o=r?"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec4 color;\nattribute float batchId;\nvarying vec4 v_color;\nvoid main()\n{\nvec4 p = czm_computePosition();\nv_color = color;\ngl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n":"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec4 color;\nattribute float batchId;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec4 v_color;\nvoid main()\n{\nvec4 p = czm_computePosition();\nv_positionEC = (czm_modelViewRelativeToEye * p).xyz;\nv_normalEC = czm_normal * normal;\nv_color = color;\ngl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",a=r?"varying vec4 v_color;\nvoid main()\n{\ngl_FragColor = czm_gammaCorrect(v_color);\n}\n":"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec4 v_color;\nvoid main()\n{\nvec3 positionToEyeEC = -v_positionEC;\nvec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\nnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\nvec4 color = czm_gammaCorrect(v_color);\nczm_materialInput materialInput;\nmaterialInput.normalEC = normalEC;\nmaterialInput.positionToEyeEC = positionToEyeEC;\nczm_material material = czm_getDefaultMaterial(materialInput);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\ngl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n}\n",s=r?gg.FLAT_VERTEX_FORMAT:gg.VERTEX_FORMAT;this.material=void 0,this.translucent=t,this._vertexShaderSource=i(e.vertexShaderSource,o),this._fragmentShaderSource=i(e.fragmentShaderSource,a),this._renderState=_g.getDefaultRenderState(t,n,e.renderState),this._closed=n,this._vertexFormat=s,this._flat=r,this._faceForward=i(e.faceForward,!n)}function vg(e,t,n){if(this._attributes=t,this._numberOfInstances=n,0!==t.length){var r=function(e){for(var t=!1,n=e.length,r=0;r<n;++r)if(e[r].componentDatatype!==xn.UNSIGNED_BYTE){t=!0;break}return t?Yc.FLOAT:Yc.UNSIGNED_BYTE}(t),i=e.floatingPointTexture,o=r===Yc.FLOAT&&!i,a=function(e,t){for(var n=new Array(e.length),r=0,i=e.length,o=0;o<i;++o){var a=e[o].componentDatatype;n[o]=r,a!==xn.UNSIGNED_BYTE&&t?r+=4:++r}return n}(t,o),s=function(e,t,n){var r=e.length,i=e[r-1];if(t[r-1].componentDatatype!==xn.UNSIGNED_BYTE&&n)return i+4;return i+1}(a,t,o),u=Math.floor(Ds.maximumTextureSize/s),l=Math.min(n,u),h=s*l,d=Math.ceil(n/l),f=1/h,m=.5*f,p=1/d,_=.5*p;this._textureDimensions=new c(h,d),this._textureStep=new le(f,m,p,_),this._pixelDatatype=o?Yc.UNSIGNED_BYTE:r,this._packFloats=o,this._offsets=a,this._stride=s,this._texture=void 0;var g=4*h*d;this._batchValues=r!==Yc.FLOAT||o?new Uint8Array(g):new Float32Array(g),this._batchValuesDirty=!1}}function yg(e,t){var n=e[t].componentsPerAttribute;return 2===n?c:3===n?p:4===n?le:Number}Object.defineProperties(_g.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}}}),_g.prototype.getFragmentShaderSource=function(){var t=[];return this.flat&&t.push("#define FLAT"),this.faceForward&&t.push("#define FACE_FORWARD"),e(this.material)&&t.push(this.material.shaderSource),t.push(this.fragmentShaderSource),t.join("\n")},_g.prototype.isTranslucent=function(){return e(this.material)&&this.material.isTranslucent()||!e(this.material)&&this.translucent},_g.prototype.getRenderState=function(){var e=this.isTranslucent(),t=Oo(this.renderState,!1);return e?(t.depthMask=!1,t.blending=Eh.ALPHA_BLEND):t.depthMask=!0,t},_g.getDefaultRenderState=function(t,n,r){var i={depthTest:{enabled:!0}};return t&&(i.depthMask=!1,i.blending=Eh.ALPHA_BLEND),n&&(i.cull={enabled:!0,face:pg.BACK}),e(r)&&(i=No(r,i,!0)),i},Object.defineProperties(gg.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}}),gg.VERTEX_FORMAT=fg.POSITION_AND_NORMAL,gg.FLAT_VERTEX_FORMAT=fg.POSITION_ONLY,gg.prototype.getFragmentShaderSource=_g.prototype.getFragmentShaderSource,gg.prototype.isTranslucent=_g.prototype.isTranslucent,gg.prototype.getRenderState=_g.prototype.getRenderState,Object.defineProperties(vg.prototype,{attributes:{get:function(){return this._attributes}},numberOfInstances:{get:function(){return this._numberOfInstances}}});var Tg=new le;var Eg=new le;vg.prototype.getBatchedAttribute=function(t,n,r){var i,o=this._attributes,a=this._offsets[n],s=4*this._stride*t+4*a;i=this._packFloats&&o[n].componentDatatype!==Yc.UNSIGNED_BYTE?function(e,t,n){var r=le.unpack(e,t,Tg),i=le.unpackFloat(r);r=le.unpack(e,t+4,Tg);var o=le.unpackFloat(r);r=le.unpack(e,t+8,Tg);var a=le.unpackFloat(r);r=le.unpack(e,t+12,Tg);var s=le.unpackFloat(r);return le.fromElements(i,o,a,s,n)}(this._batchValues,s,Eg):le.unpack(this._batchValues,s,Eg);var u=yg(o,n);return e(u.fromCartesian4)?u.fromCartesian4(i,r):e(u.clone)?u.clone(i,r):i.x};var xg=[void 0,void 0,new c,new p,new le],Cg=new le;function Sg(e,t){var n=e._attributes[t],r=n.componentsPerAttribute,i=n.functionName,o=function(e){return 1===e?"float":"vec"+e}(r),a=function(e){return 1===e?".x":2===e?".xy":3===e?".xyz":""}(r),s=o+" "+i+"(float batchId) \n{ \n    vec2 st = computeSt(batchId); \n    st.x += batchTextureStep.x * float("+e._offsets[t]+"); \n";return e._packFloats&&n.componentDatatype!==Yc.UNSIGNED_BYTE?s+="vec4 textureValue; \ntextureValue.x = czm_unpackFloat(texture2D(batchTexture, st)); \ntextureValue.y = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x, 0.0))); \ntextureValue.z = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x * 2.0, 0.0))); \ntextureValue.w = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x * 3.0, 0.0))); \n":s+="    vec4 textureValue = texture2D(batchTexture, st); \n",s+="    "+o+" value = textureValue"+a+"; \n",e._pixelDatatype!==Yc.UNSIGNED_BYTE||n.componentDatatype!==xn.UNSIGNED_BYTE||n.normalize?e._pixelDatatype===Yc.FLOAT&&n.componentDatatype===xn.UNSIGNED_BYTE&&n.normalize&&(s+="value /= 255.0; \n"):s+="value *= 255.0; \n",s+="    return value; \n} \n"}function Ag(e,t,n){e=i(e,0),t=i(t,0),n=i(n,0),this.value=new Float32Array([e,t,n])}function wg(e,t){var n=e.attributes,r=n.position,i=r.values.length/r.componentsPerAttribute;n.batchId=new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:1,values:new Float32Array(i)});for(var o=n.batchId.values,a=0;a<i;++a)o[a]=t}function bg(t){var n,r,i=t.instances,o=t.projection,a=t.elementIndexUintSupported,s=t.scene3DOnly,u=t.vertexCacheOptimize,c=t.compressVertices,l=t.modelMatrix,h=i.length;for(n=0;n<h;++n)if(e(i[n].geometry)){i[n].geometry.primitiveType;break}if(function(t,n,r){var i,o=!r,a=t.length;if(!o&&a>1){var s=t[0].modelMatrix;for(i=1;i<a;++i)if(!ye.equals(s,t[i].modelMatrix)){o=!0;break}}if(o)for(i=0;i<a;++i)e(t[i].geometry)&&pp.transformToWorldCoordinates(t[i]);else ye.multiplyTransformation(n,t[0].modelMatrix,n)}(i,l,s),!s)for(n=0;n<h;++n)e(i[n].geometry)&&pp.splitLongitude(i[n]);if(function(t){for(var n=t.length,r=0;r<n;++r){var i=t[r];e(i.geometry)?wg(i.geometry,r):e(i.westHemisphereGeometry)&&e(i.eastHemisphereGeometry)&&(wg(i.westHemisphereGeometry,r),wg(i.eastHemisphereGeometry,r))}}(i),u)for(n=0;n<h;++n){var d=i[n];e(d.geometry)?(pp.reorderForPostVertexCache(d.geometry),pp.reorderForPreVertexCache(d.geometry)):e(d.westHemisphereGeometry)&&e(d.eastHemisphereGeometry)&&(pp.reorderForPostVertexCache(d.westHemisphereGeometry),pp.reorderForPreVertexCache(d.westHemisphereGeometry),pp.reorderForPostVertexCache(d.eastHemisphereGeometry),pp.reorderForPreVertexCache(d.eastHemisphereGeometry))}var f=pp.combineInstances(i);for(h=f.length,n=0;n<h;++n){var m,p=(r=f[n]).attributes;if(s)for(m in p)p.hasOwnProperty(m)&&p[m].componentDatatype===xn.DOUBLE&&pp.encodeAttribute(r,m,m+"3DHigh",m+"3DLow");else for(m in p)if(p.hasOwnProperty(m)&&p[m].componentDatatype===xn.DOUBLE){var _=m+"3D",g=m+"2D";pp.projectTo2D(r,m,_,g,o),e(r.boundingSphere)&&"position"===m&&(r.boundingSphereCV=Me.fromVertices(r.attributes.position2D.values)),pp.encodeAttribute(r,_,_+"High",_+"Low"),pp.encodeAttribute(r,g,g+"High",g+"Low")}c&&pp.compressVertices(r)}if(!a){var v=[];for(h=f.length,n=0;n<h;++n)r=f[n],v=v.concat(pp.fitToUnsignedShortIndices(r));f=v}return f}function Dg(t,n,r,i){var o,a,s,u=i.length-1;if(u>=0){var c=i[u];o=c.offset+c.count,a=r[s=c.index].indices.length}else o=0,a=r[s=0].indices.length;for(var l=t.length,h=0;h<l;++h){var d=t[h][n];if(e(d)){var f=d.indices.length;o+f>a&&(o=0,a=r[++s].indices.length),i.push({index:s,offset:o,count:f}),o+=f}}}vg.prototype.setBatchedAttribute=function(t,n,r){var i=this._attributes,o=xg[i[n].componentsPerAttribute],a=this.getBatchedAttribute(t,n,o),s=yg(this._attributes,n);if(!(e(s.equals)?s.equals(a,r):a===r)){var u=Cg;u.x=e(r.x)?r.x:r,u.y=e(r.y)?r.y:0,u.z=e(r.z)?r.z:0,u.w=e(r.w)?r.w:0;var c=this._offsets[n],l=4*this._stride*t+4*c;this._packFloats&&i[n].componentDatatype!==Yc.UNSIGNED_BYTE?function(e,t,n){var r=le.packFloat(e.x,Tg);le.pack(r,t,n),r=le.packFloat(e.y,r),le.pack(r,t,n+4),r=le.packFloat(e.z,r),le.pack(r,t,n+8),r=le.packFloat(e.w,r),le.pack(r,t,n+12)}(u,this._batchValues,l):le.pack(u,this._batchValues,l),this._batchValuesDirty=!0}},vg.prototype.update=function(t){var n,r,i;e(this._texture)&&!this._batchValuesDirty||0===this._attributes.length||(this._batchValuesDirty=!1,e(this._texture)||(n=this,r=t.context,i=n._textureDimensions,n._texture=new Fh({context:r,pixelFormat:Xc.RGBA,pixelDatatype:n._pixelDatatype,width:i.x,height:i.y,sampler:Lh.NEAREST,flipY:!1})),function(e){var t=e._textureDimensions;e._texture.copyFrom({width:t.x,height:t.y,arrayBufferView:e._batchValues})}(this))},vg.prototype.getUniformMapCallback=function(){var e=this;return function(t){return 0===e._attributes.length?t:No(t,{batchTexture:function(){return e._texture},batchTextureDimensions:function(){return e._textureDimensions},batchTextureStep:function(){return e._textureStep}})}},vg.prototype.getVertexShaderCallback=function(){var e=this._attributes;if(0===e.length)return function(e){return e};var t,n,r="uniform highp sampler2D batchTexture; \n";r+=(n=(t=this)._stride,(1===t._textureDimensions.y?"uniform vec4 batchTextureStep; \nvec2 computeSt(float batchId) \n{ \n    float stepX = batchTextureStep.x; \n    float centerX = batchTextureStep.y; \n    float numberOfAttributes = float("+n+"); \n    return vec2(centerX + (batchId * numberOfAttributes * stepX), 0.5); \n} \n":"uniform vec4 batchTextureStep; \nuniform vec2 batchTextureDimensions; \nvec2 computeSt(float batchId) \n{ \n    float stepX = batchTextureStep.x; \n    float centerX = batchTextureStep.y; \n    float stepY = batchTextureStep.z; \n    float centerY = batchTextureStep.w; \n    float numberOfAttributes = float("+n+"); \n    float xId = mod(batchId * numberOfAttributes, batchTextureDimensions.x); \n    float yId = floor(batchId * numberOfAttributes / batchTextureDimensions.x); \n    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); \n} \n")+"\n");for(var i=e.length,o=0;o<i;++o)r+=Sg(this,o);return function(e){var t=e.indexOf("void main"),n=e.substring(0,t),i=e.substring(t);return n+"\n"+r+"\n"+i}},vg.prototype.isDestroyed=function(){return!1},vg.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),hi(this)},Object.defineProperties(Ag.prototype,{componentDatatype:{get:function(){return xn.FLOAT}},componentsPerAttribute:{get:function(){return 3}},normalize:{get:function(){return!1}}}),Ag.fromCartesian3=function(e){return new Ag(e.x,e.y,e.z)},Ag.toValue=function(t,n){return e(n)||(n=new Float32Array([t.x,t.y,t.z])),n[0]=t.x,n[1]=t.y,n[2]=t.z,n};var Ig={};function Rg(t,n){var r=t.attributes;for(var i in r)if(r.hasOwnProperty(i)){var o=r[i];e(o)&&e(o.values)&&n.push(o.values.buffer)}e(t.indices)&&n.push(t.indices.buffer)}function Pg(t,n){var r=t.length,i=new Float64Array(1+19*r),o=0;i[o++]=r;for(var a=0;a<r;a++){var s=t[a];if(ye.pack(s.modelMatrix,i,o),o+=ye.packedLength,e(s.attributes)&&e(s.attributes.offset)){var u=s.attributes.offset.value;i[o]=u[0],i[o+1]=u[1],i[o+2]=u[2]}o+=3}return n.push(i.buffer),i}function Og(t){var n=t.length,r=1+(Me.packedLength+1)*n,i=new Float32Array(r),o=0;i[o++]=n;for(var a=0;a<n;++a){e(t[a])?(i[o++]=1,Me.pack(t[a],i,o)):i[o++]=0,o+=Me.packedLength}return i}function Ng(e){for(var t=new Array(e[0]),n=0,r=1;r<e.length;)1===e[r++]&&(t[n]=Me.unpack(e,r)),++n,r+=Me.packedLength;return t}Ig.combineGeometry=function(t){var n,r,i,o,a=t.instances,s=a.length,u=!1;s>0&&((n=bg(t)).length>0&&(r=pp.createAttributeLocations(n[0]),t.createPickOffsets&&(i=function(e,t){var n=[];return Dg(e,"geometry",t,n),Dg(e,"westHemisphereGeometry",t,n),Dg(e,"eastHemisphereGeometry",t,n),n}(a,n))),e(a[0].attributes)&&e(a[0].attributes.offset)&&(o=new Array(s),u=!0));for(var c=new Array(s),l=new Array(s),h=0;h<s;++h){var d=a[h],f=d.geometry;e(f)&&(c[h]=f.boundingSphere,l[h]=f.boundingSphereCV,u&&(o[h]=d.geometry.offsetAttribute));var m=d.eastHemisphereGeometry,p=d.westHemisphereGeometry;e(m)&&e(p)&&(e(m.boundingSphere)&&e(p.boundingSphere)&&(c[h]=Me.union(m.boundingSphere,p.boundingSphere)),e(m.boundingSphereCV)&&e(p.boundingSphereCV)&&(l[h]=Me.union(m.boundingSphereCV,p.boundingSphereCV)))}return{geometries:n,modelMatrix:t.modelMatrix,attributeLocations:r,pickOffsets:i,offsetInstanceExtend:o,boundingSpheres:c,boundingSpheresCV:l}},Ig.packCreateGeometryResults=function(t,n){var r=new Float64Array(function(t){for(var n=1,r=t.length,i=0;i<r;i++){var o=t[i];if(++n,e(o)){var a=o.attributes;for(var s in n+=7+2*Me.packedLength+(e(o.indices)?o.indices.length:0),a)a.hasOwnProperty(s)&&e(a[s])&&(n+=5+a[s].values.length)}}return n}(t)),o=[],a={},s=t.length,u=0;r[u++]=s;for(var c=0;c<s;c++){var l=t[c],h=e(l);if(r[u++]=h?1:0,h){r[u++]=l.primitiveType,r[u++]=l.geometryType,r[u++]=i(l.offsetAttribute,-1);var d=e(l.boundingSphere)?1:0;r[u++]=d,d&&Me.pack(l.boundingSphere,r,u),u+=Me.packedLength;var f=e(l.boundingSphereCV)?1:0;r[u++]=f,f&&Me.pack(l.boundingSphereCV,r,u),u+=Me.packedLength;var m=l.attributes,p=[];for(var _ in m)m.hasOwnProperty(_)&&e(m[_])&&(p.push(_),e(a[_])||(a[_]=o.length,o.push(_)));r[u++]=p.length;for(var g=0;g<p.length;g++){var v=p[g],y=m[v];r[u++]=a[v],r[u++]=y.componentDatatype,r[u++]=y.componentsPerAttribute,r[u++]=y.normalize?1:0,r[u++]=y.values.length,r.set(y.values,u),u+=y.values.length}var T=e(l.indices)?l.indices.length:0;r[u++]=T,T>0&&(r.set(l.indices,u),u+=T)}}return n.push(r.buffer),{stringTable:o,packedData:r}},Ig.unpackCreateGeometryResults=function(e){for(var t,n=e.stringTable,r=e.packedData,i=new Array(r[0]),o=0,a=1;a<r.length;){if(1===r[a++]){var s,u,c,l,h,d=r[a++],f=r[a++],m=r[a++];-1===m&&(m=void 0),1===r[a++]&&(s=Me.unpack(r,a)),a+=Me.packedLength,1===r[a++]&&(u=Me.unpack(r,a)),a+=Me.packedLength;var p,_=new np,g=r[a++];for(t=0;t<g;t++){var v=n[r[a++]],y=r[a++];h=r[a++];var T=0!==r[a++];c=r[a++],l=xn.createTypedArray(y,c);for(var E=0;E<c;E++)l[E]=r[a++];_[v]=new tp({componentDatatype:y,componentsPerAttribute:h,normalize:T,values:l})}if((c=r[a++])>0){var x=l.length/h;for(p=Dn.createTypedArray(x,c),t=0;t<c;t++)p[t]=r[a++]}i[o++]=new cc({primitiveType:d,geometryType:f,boundingSphere:s,boundingSphereCV:u,indices:p,attributes:_,offsetAttribute:m})}else i[o++]=void 0}return i},Ig.packCombineGeometryParameters=function(e,t){for(var n=e.createGeometryResults,r=n.length,i=0;i<r;i++)t.push(n[i].packedData.buffer);return{createGeometryResults:e.createGeometryResults,packedInstances:Pg(e.instances,t),ellipsoid:e.ellipsoid,isGeographic:e.projection instanceof K,elementIndexUintSupported:e.elementIndexUintSupported,scene3DOnly:e.scene3DOnly,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e.createPickOffsets}},Ig.unpackCombineGeometryParameters=function(t){for(var n=function(t){for(var n=t,r=new Array(n[0]),i=0,o=1;o<n.length;){var a,s=ye.unpack(n,o);e(n[o+=ye.packedLength])&&(a={offset:new Ag(n[o],n[o+1],n[o+2])}),o+=3,r[i++]={modelMatrix:s,attributes:a}}return r}(t.packedInstances),r=t.createGeometryResults,i=r.length,o=0,a=0;a<i;a++)for(var s=Ig.unpackCreateGeometryResults(r[a]),u=s.length,c=0;c<u;c++){var l=s[c];n[o].geometry=l,++o}var h=H.clone(t.ellipsoid);return{instances:n,ellipsoid:h,projection:t.isGeographic?new K(h):new Nc(h),elementIndexUintSupported:t.elementIndexUintSupported,scene3DOnly:t.scene3DOnly,vertexCacheOptimize:t.vertexCacheOptimize,compressVertices:t.compressVertices,modelMatrix:ye.clone(t.modelMatrix),createPickOffsets:t.createPickOffsets}},Ig.packCombineGeometryResults=function(t,n){e(t.geometries)&&function(e,t){for(var n=e.length,r=0;r<n;++r)Rg(e[r],t)}(t.geometries,n);var r=Og(t.boundingSpheres),i=Og(t.boundingSpheresCV);return n.push(r.buffer,i.buffer),{geometries:t.geometries,attributeLocations:t.attributeLocations,modelMatrix:t.modelMatrix,pickOffsets:t.pickOffsets,offsetInstanceExtend:t.offsetInstanceExtend,boundingSpheres:r,boundingSpheresCV:i}},Ig.unpackCombineGeometryResults=function(e){return{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:Ng(e.boundingSpheres),boundingSpheresCV:Ng(e.boundingSpheresCV)}};var Mg=Object.freeze({READY:0,CREATING:1,CREATED:2,COMBINING:3,COMBINED:4,COMPLETE:5,FAILED:6}),Lg={DISABLED:0,ENABLED:1,CAST_ONLY:2,RECEIVE_ONLY:3,NUMBER_OF_SHADOW_MODES:4,castShadows:function(e){return e===Lg.ENABLED||e===Lg.CAST_ONLY},receiveShadows:function(e){return e===Lg.ENABLED||e===Lg.RECEIVE_ONLY},fromCastReceive:function(e,t){return e&&t?Lg.ENABLED:e?Lg.CAST_ONLY:t?Lg.RECEIVE_ONLY:Lg.DISABLED}},Fg=Object.freeze(Lg);function zg(e){e=i(e,i.EMPTY_OBJECT),this.geometryInstances=e.geometryInstances,this.appearance=e.appearance,this._appearance=void 0,this._material=void 0,this.depthFailAppearance=e.depthFailAppearance,this._depthFailAppearance=void 0,this._depthFailMaterial=void 0,this.modelMatrix=ye.clone(i(e.modelMatrix,ye.IDENTITY)),this._modelMatrix=new ye,this.show=i(e.show,!0),this._vertexCacheOptimize=i(e.vertexCacheOptimize,!1),this._interleave=i(e.interleave,!1),this._releaseGeometryInstances=i(e.releaseGeometryInstances,!0),this._allowPicking=i(e.allowPicking,!0),this._asynchronous=i(e.asynchronous,!0),this._compressVertices=i(e.compressVertices,!0),this.cull=i(e.cull,!0),this.debugShowBoundingVolume=i(e.debugShowBoundingVolume,!1),this.rtcCenter=e.rtcCenter,this.shadows=i(e.shadows,Fg.DISABLED),this._translucent=void 0,this._state=Mg.READY,this._geometries=[],this._error=void 0,this._numberOfInstances=0,this._boundingSpheres=[],this._boundingSphereWC=[],this._boundingSphereCV=[],this._boundingSphere2D=[],this._boundingSphereMorph=[],this._perInstanceAttributeCache=[],this._instanceIds=[],this._lastPerInstanceAttributeIndex=0,this._va=[],this._attributeLocations=void 0,this._primitiveType=void 0,this._frontFaceRS=void 0,this._backFaceRS=void 0,this._sp=void 0,this._depthFailAppearance=void 0,this._spDepthFail=void 0,this._frontFaceDepthFailRS=void 0,this._backFaceDepthFailRS=void 0,this._pickIds=[],this._colorCommands=[],this._pickCommands=[],this._createBoundingVolumeFunction=e._createBoundingVolumeFunction,this._createRenderStatesFunction=e._createRenderStatesFunction,this._createShaderProgramFunction=e._createShaderProgramFunction,this._createCommandsFunction=e._createCommandsFunction,this._updateAndQueueCommandsFunction=e._updateAndQueueCommandsFunction,this._createPickOffsets=e._createPickOffsets,this._pickOffsets=void 0,this._createGeometryResults=void 0,this._ready=!1,this._readyPromise=Et.defer(),this._batchTable=void 0,this._batchTableAttributeIndices=void 0,this._offsetInstanceExtend=void 0,this._batchTableOffsetAttribute2DIndex=void 0,this._batchTableOffsetsUpdated=!1,this._instanceBoundingSpheres=void 0,this._instanceBoundingSpheresCV=void 0,this._tempBoundingSpheres=void 0,this._recomputeBoundingSpheres=!1,this._batchTableBoundingSpheresUpdated=!1,this._batchTableBoundingSphereAttributeIndices=void 0}Object.defineProperties(zg.prototype,{vertexCacheOptimize:{get:function(){return this._vertexCacheOptimize}},interleave:{get:function(){return this._interleave}},releaseGeometryInstances:{get:function(){return this._releaseGeometryInstances}},allowPicking:{get:function(){return this._allowPicking}},asynchronous:{get:function(){return this._asynchronous}},compressVertices:{get:function(){return this._compressVertices}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}}});var Bg=new c,Ug=new p,Vg=new le;function Hg(e){var t=e.length;return 1===t?e[0]:2===t?c.unpack(e,0,Bg):3===t?p.unpack(e,0,Ug):4===t?le.unpack(e,0,Vg):void 0}function Gg(t,n){var r=t.geometryInstances,o=Array.isArray(r)?r:[r],a=o.length;if(0!==a){var s,u,c,l,h=function(t){var n,r=t.length,i=[],o=t[0].attributes;for(n in o)if(o.hasOwnProperty(n)&&e(o[n])){for(var a=o[n],s=!0,u=1;u<r;++u){var c=t[u].attributes[n];if(!e(c)||a.componentDatatype!==c.componentDatatype||a.componentsPerAttribute!==c.componentsPerAttribute||a.normalize!==c.normalize){s=!1;break}}s&&i.push(n)}return i}(o),d=h.length,f=[],m={},p={},_=o[0].attributes;for(u=0;u<d;++u)l=_[c=h[u]],m[c]=u,f.push({functionName:"czm_batchTable_"+c,componentDatatype:l.componentDatatype,componentsPerAttribute:l.componentsPerAttribute,normalize:l.normalize});-1!==h.indexOf("distanceDisplayCondition")&&(f.push({functionName:"czm_batchTable_boundingSphereCenter3DHigh",componentDatatype:xn.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter3DLow",componentDatatype:xn.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DHigh",componentDatatype:xn.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DLow",componentDatatype:xn.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereRadius",componentDatatype:xn.FLOAT,componentsPerAttribute:1}),p.center3DHigh=f.length-5,p.center3DLow=f.length-4,p.center2DHigh=f.length-3,p.center2DLow=f.length-2,p.radius=f.length-1),-1!==h.indexOf("offset")&&(f.push({functionName:"czm_batchTable_offset2D",componentDatatype:xn.FLOAT,componentsPerAttribute:3}),s=f.length-1),f.push({functionName:"czm_batchTable_pickColor",componentDatatype:xn.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0});var g=f.length,v=new vg(n,f,a);for(u=0;u<a;++u){var y=o[u];_=y.attributes;for(var T=0;T<d;++T){var E=Hg((l=_[c=h[T]]).value),x=m[c];v.setBatchedAttribute(u,x,E)}var C={primitive:i(y.pickPrimitive,t)};e(y.id)&&(C.id=y.id);var S=n.createPickId(C);t._pickIds.push(S);var A=S.color,w=Vg;w.x=pn.floatToByte(A.red),w.y=pn.floatToByte(A.green),w.z=pn.floatToByte(A.blue),w.w=pn.floatToByte(A.alpha),v.setBatchedAttribute(u,g-1,w)}t._batchTable=v,t._batchTableAttributeIndices=m,t._batchTableBoundingSphereAttributeIndices=p,t._batchTableOffsetAttribute2DIndex=s}}function kg(t){var n,r,i,o=t.attributes,a=new np;for(var s in o)o.hasOwnProperty(s)&&e(o[s])&&(a[s]=(n=o[s],r=void 0,r=Array.isArray(n.values)?n.values.slice(0):new n.values.constructor(n.values),new tp({componentDatatype:n.componentDatatype,componentsPerAttribute:n.componentsPerAttribute,normalize:n.normalize,values:r})));if(e(t.indices)){var u=t.indices;i=Array.isArray(u)?u.slice(0):new u.constructor(u)}return new cc({attributes:a,indices:i,primitiveType:t.primitiveType,boundingSphere:Me.clone(t.boundingSphere)})}function Wg(e,t){return{geometry:t,attributes:e.attributes,modelMatrix:ye.clone(e.modelMatrix),pickPrimitive:e.pickPrimitive,id:e.id}}var qg=/attribute\s+vec(?:3|4)\s+(.*)3DHigh;/g;function Yg(e){return nc.replaceMain(e,"czm_non_pick_main")+"\nvarying vec4 v_pickColor; \nvoid main() \n{ \n    czm_non_pick_main(); \n    v_pickColor = czm_batchTable_pickColor(batchId); \n}"}function jg(e){return"varying vec4 v_pickColor;\n"+e}function Xg(e,t){if(!e.compressVertices)return t;var n=-1!==t.search(/attribute\s+vec3\s+normal;/g),r=-1!==t.search(/attribute\s+vec2\s+st;/g);if(!n&&!r)return t;var i=-1!==t.search(/attribute\s+vec3\s+tangent;/g),o=-1!==t.search(/attribute\s+vec3\s+bitangent;/g),a=r&&n?2:1,s="compressedAttributes",u="attribute "+((a+=i||o?1:0)>1?"vec"+a:"float")+" "+s+";",c="",l="";r&&(c+="vec2 st;\n",l+="    st = czm_decompressTextureCoordinates("+(a>1?s+".x":s)+");\n");n&&i&&o?(c+="vec3 normal;\nvec3 tangent;\nvec3 bitangent;\n",l+="    czm_octDecode("+s+"."+(r?"yz":"xy")+", normal, tangent, bitangent);\n"):(n&&(c+="vec3 normal;\n",l+="    normal = czm_octDecode("+s+(a>1?"."+(r?"y":"x"):"")+");\n"),i&&(c+="vec3 tangent;\n",l+="    tangent = czm_octDecode("+s+"."+(r&&n?"z":"y")+");\n"),o&&(c+="vec3 bitangent;\n",l+="    bitangent = czm_octDecode("+s+"."+(r&&n?"z":"y")+");\n"));var h=t;return h=(h=(h=(h=h.replace(/attribute\s+vec3\s+normal;/g,"")).replace(/attribute\s+vec2\s+st;/g,"")).replace(/attribute\s+vec3\s+tangent;/g,"")).replace(/attribute\s+vec3\s+bitangent;/g,""),[u,c,h=nc.replaceMain(h,"czm_non_compressed_main"),"void main() \n{ \n"+l+"    czm_non_compressed_main(); \n}"].join("\n")}function Zg(e,t){e.vertexAttributes}function Kg(e,t){return function(){return e[t]}}zg._modifyShaderPosition=function(t,n,r){for(var i,o="",a="",s="";null!==(i=qg.exec(n));){var u=i[1],c="vec4 czm_compute"+u[0].toUpperCase()+u.substr(1)+"()";"vec4 czm_computePosition()"!==c&&(o+=c+";\n"),e(t.rtcCenter)?(o+="uniform mat4 u_modifiedModelView;\n",a+="attribute vec4 position;\n",s+=c+"\n{\n    return u_modifiedModelView * position;\n}\n\n",n=(n=(n=(n=n.replace(/attribute\s+vec(?:3|4)\s+position3DHigh;/g,"")).replace(/attribute\s+vec(?:3|4)\s+position3DLow;/g,"")).replace(/czm_modelViewRelativeToEye\s+\*\s+/g,"")).replace(/czm_modelViewProjectionRelativeToEye/g,"czm_projection")):r?s+=c+"\n{\n    return czm_translateRelativeToEye("+u+"3DHigh, "+u+"3DLow);\n}\n\n":(a+="attribute vec3 "+u+"2DHigh;\nattribute vec3 "+u+"2DLow;\n",s+=c+"\n{\n    vec4 p;\n    if (czm_morphTime == 1.0)\n    {\n        p = czm_translateRelativeToEye("+u+"3DHigh, "+u+"3DLow);\n    }\n    else if (czm_morphTime == 0.0)\n    {\n        p = czm_translateRelativeToEye("+u+"2DHigh.zxy, "+u+"2DLow.zxy);\n    }\n    else\n    {\n        p = czm_columbusViewMorph(\n                czm_translateRelativeToEye("+u+"2DHigh.zxy, "+u+"2DLow.zxy),\n                czm_translateRelativeToEye("+u+"3DHigh, "+u+"3DLow),\n                czm_morphTime);\n    }\n    return p;\n}\n\n")}return[o,a,n,s].join("\n")},zg._appendShowToShader=function(t,n){if(!e(t._batchTableAttributeIndices.show))return n;return nc.replaceMain(n,"czm_non_show_main")+"\nvoid main() \n{ \n    czm_non_show_main(); \n    gl_Position *= czm_batchTable_show(batchId); \n}"},zg._updateColorAttribute=function(t,n,r){if(!e(t._batchTableAttributeIndices.color)&&!e(t._batchTableAttributeIndices.depthFailColor))return n;if(-1===n.search(/attribute\s+vec4\s+color;/g))return n;var i=n;return i=i.replace(/attribute\s+vec4\s+color;/g,""),i=r?i.replace(/(\b)color(\b)/g,"$1czm_batchTable_depthFailColor(batchId)$2"):i.replace(/(\b)color(\b)/g,"$1czm_batchTable_color(batchId)$2")},zg._updatePickColorAttribute=function(e){var t=e.replace(/attribute\s+vec4\s+pickColor;/g,"");return t=t.replace(/(\b)pickColor(\b)/g,"$1czm_batchTable_pickColor(batchId)$2")},zg._appendOffsetToShader=function(t,n){if(!e(t._batchTableAttributeIndices.offset))return n;var r=n.replace(/attribute\s+float\s+batchId;/g,"attribute float batchId;\nattribute float applyOffset;");return"    if (czm_sceneMode == czm_sceneMode3D)\n","    {\n","        $1 = $1 + vec4(czm_batchTable_offset(batchId) * applyOffset, 0.0);","    }\n","    else\n","    {\n","        $1 = $1 + vec4(czm_batchTable_offset2D(batchId) * applyOffset, 0.0);","    }\n",r=r.replace(/vec4\s+([A-Za-z0-9_]+)\s+=\s+czm_computePosition\(\);/g,"vec4 $1 = czm_computePosition();\n    if (czm_sceneMode == czm_sceneMode3D)\n    {\n        $1 = $1 + vec4(czm_batchTable_offset(batchId) * applyOffset, 0.0);    }\n    else\n    {\n        $1 = $1 + vec4(czm_batchTable_offset2D(batchId) * applyOffset, 0.0);    }\n")},zg._appendDistanceDisplayConditionToShader=function(t,n,r){if(!e(t._batchTableAttributeIndices.distanceDisplayCondition))return n;var i="void main() \n{ \n    czm_non_distanceDisplayCondition_main(); \n    vec2 distanceDisplayCondition = czm_batchTable_distanceDisplayCondition(batchId);\n    vec3 boundingSphereCenter3DHigh = czm_batchTable_boundingSphereCenter3DHigh(batchId);\n    vec3 boundingSphereCenter3DLow = czm_batchTable_boundingSphereCenter3DLow(batchId);\n    float boundingSphereRadius = czm_batchTable_boundingSphereRadius(batchId);\n";return i+=r?"    vec4 centerRTE = czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow);\n":"    vec3 boundingSphereCenter2DHigh = czm_batchTable_boundingSphereCenter2DHigh(batchId);\n    vec3 boundingSphereCenter2DLow = czm_batchTable_boundingSphereCenter2DLow(batchId);\n    vec4 centerRTE;\n    if (czm_morphTime == 1.0)\n    {\n        centerRTE = czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow);\n    }\n    else if (czm_morphTime == 0.0)\n    {\n        centerRTE = czm_translateRelativeToEye(boundingSphereCenter2DHigh.zxy, boundingSphereCenter2DLow.zxy);\n    }\n    else\n    {\n        centerRTE = czm_columbusViewMorph(\n                czm_translateRelativeToEye(boundingSphereCenter2DHigh.zxy, boundingSphereCenter2DLow.zxy),\n                czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow),\n                czm_morphTime);\n    }\n",nc.replaceMain(n,"czm_non_distanceDisplayCondition_main")+"\n"+(i+="    float radiusSq = boundingSphereRadius * boundingSphereRadius; \n    float distanceSq; \n    if (czm_sceneMode == czm_sceneMode2D) \n    { \n        distanceSq = czm_eyeHeight2D.y - radiusSq; \n    } \n    else \n    { \n        distanceSq = dot(centerRTE.xyz, centerRTE.xyz) - radiusSq; \n    } \n    distanceSq = max(distanceSq, 0.0); \n    float nearSq = distanceDisplayCondition.x * distanceDisplayCondition.x; \n    float farSq = distanceDisplayCondition.y * distanceDisplayCondition.y; \n    float show = (distanceSq >= nearSq && distanceSq <= farSq) ? 1.0 : 0.0; \n    gl_Position *= show; \n}")};var Qg,Jg=Math.max(fn.hardwareConcurrency-1,1),$g=new Gc("combineGeometry",Number.POSITIVE_INFINITY);function ev(t,n){var r,o,a,s,u=t._instanceIds;if(t._state===Mg.READY){r=Array.isArray(t.geometryInstances)?t.geometryInstances:[t.geometryInstances];var c,l=t._numberOfInstances=r.length,h=[],d=[];for(a=0;a<l;++a)o=r[a].geometry,u.push(r[a].id),d.push({moduleName:o._workerName,geometry:o});if(!e(Qg))for(Qg=new Array(Jg),a=0;a<Jg;a++)Qg[a]=new Gc("createGeometry",Number.POSITIVE_INFINITY);for(d=function(e,t){for(var n=[],r=e.length,i=0;i<r;){var o=Math.ceil((r-i)/t--);n.push(e.slice(i,i+o)),i+=o}return n}(d,Jg),a=0;a<d.length;a++){var f,m=0,p=d[a],_=p.length;for(s=0;s<_;++s)e((o=(c=p[s]).geometry).constructor.pack)&&(c.offset=m,m+=i(o.constructor.packedLength,o.packedLength));if(m>0){var g=new Float64Array(m);for(f=[g.buffer],s=0;s<_;++s)e((o=(c=p[s]).geometry).constructor.pack)&&(o.constructor.pack(o,g,c.offset),c.geometry=g)}h.push(Qg[a].scheduleTask({subTasks:d[a]},f))}t._state=Mg.CREATING,Et.all(h,(function(e){t._createGeometryResults=e,t._state=Mg.CREATED})).otherwise((function(e){Ev(t,n,Mg.FAILED,e)}))}else if(t._state===Mg.CREATED){var v=[];r=Array.isArray(t.geometryInstances)?t.geometryInstances:[t.geometryInstances];var y=n.scene3DOnly,T=n.mapProjection,E=$g.scheduleTask(Ig.packCombineGeometryParameters({createGeometryResults:t._createGeometryResults,instances:r,ellipsoid:T.ellipsoid,projection:T,elementIndexUintSupported:n.context.elementIndexUint,scene3DOnly:y,vertexCacheOptimize:t.vertexCacheOptimize,compressVertices:t.compressVertices,modelMatrix:t.modelMatrix,createPickOffsets:t._createPickOffsets},v),v);t._createGeometryResults=void 0,t._state=Mg.COMBINING,Et(E,(function(r){var i=Ig.unpackCombineGeometryResults(r);t._geometries=i.geometries,t._attributeLocations=i.attributeLocations,t.modelMatrix=ye.clone(i.modelMatrix,t.modelMatrix),t._pickOffsets=i.pickOffsets,t._offsetInstanceExtend=i.offsetInstanceExtend,t._instanceBoundingSpheres=i.boundingSpheres,t._instanceBoundingSpheresCV=i.boundingSpheresCV,e(t._geometries)&&t._geometries.length>0?(t._recomputeBoundingSpheres=!0,t._state=Mg.COMBINED):Ev(t,n,Mg.FAILED,void 0)})).otherwise((function(e){Ev(t,n,Mg.FAILED,e)}))}}var tv=new Cn,nv=new N,rv=new p,iv=new Me;var ov=new p,av=new p;function sv(t,n){if(e(t._batchTableAttributeIndices.offset)&&!t._batchTableOffsetsUpdated&&!n.scene3DOnly){for(var r=t._batchTableOffsetAttribute2DIndex,i=n.mapProjection,o=i.ellipsoid,a=t._batchTable,s=t._instanceBoundingSpheres,u=s.length,c=0;c<u;++c){var l=s[c];if(e(l)){var h=a.getBatchedAttribute(c,t._batchTableAttributeIndices.offset);if(p.equals(h,p.ZERO))a.setBatchedAttribute(c,r,p.ZERO);else{var d=t.modelMatrix;e(d)&&(l=Me.transform(l,d,iv));var f=l.center;f=o.scaleToGeodeticSurface(f,av);var m=o.cartesianToCartographic(f,nv),_=i.project(m,rv),g=p.add(h,f,ov);m=o.cartesianToCartographic(g,m);var v=i.project(m,ov),y=p.subtract(v,_,ov),T=y.x;y.x=y.z,y.z=y.y,y.y=T,a.setBatchedAttribute(c,r,y)}}}t._batchTableOffsetsUpdated=!0}}function uv(t,n,r,i){var o,a=r.getRenderState();i?((o=Oo(a,!1)).cull={enabled:!0,face:pg.BACK},t._frontFaceRS=Us.fromCache(o),o.cull.face=pg.FRONT,t._backFaceRS=Us.fromCache(o)):(t._frontFaceRS=Us.fromCache(a),t._backFaceRS=t._frontFaceRS),o=Oo(a,!1),e(t._depthFailAppearance)&&(o.depthTest.enabled=!1),e(t._depthFailAppearance)&&((o=Oo(a=t._depthFailAppearance.getRenderState(),!1)).depthTest.func=G_.GREATER,i?(o.cull={enabled:!0,face:pg.BACK},t._frontFaceDepthFailRS=Us.fromCache(o),o.cull.face=pg.FRONT,t._backFaceDepthFailRS=Us.fromCache(o)):(t._frontFaceDepthFailRS=Us.fromCache(o),t._backFaceDepthFailRS=t._frontFaceRS))}function cv(t,n,r){var i=n.context,o=t._attributeLocations,a=t._batchTable.getVertexShaderCallback()(r.vertexShaderSource);a=zg._appendOffsetToShader(t,a),a=zg._appendShowToShader(t,a),a=Yg(a=zg._appendDistanceDisplayConditionToShader(t,a,n.scene3DOnly)),a=Xg(t,a=zg._updateColorAttribute(t,a,!1)),a=zg._modifyShaderPosition(t,a,n.scene3DOnly);var s,u,c=r.getFragmentShaderSource();c=jg(c),t._sp=Hu.replaceCache({context:i,shaderProgram:t._sp,vertexShaderSource:a,fragmentShaderSource:c,attributeLocations:o}),Zg(t._sp),e(t._depthFailAppearance)&&(a=t._batchTable.getVertexShaderCallback()(t._depthFailAppearance.vertexShaderSource),a=zg._appendShowToShader(t,a),a=Yg(a=zg._appendDistanceDisplayConditionToShader(t,a,n.scene3DOnly)),a=Xg(t,a=zg._updateColorAttribute(t,a,!0)),a=zg._modifyShaderPosition(t,a,n.scene3DOnly),u=a,a=nc.replaceMain(u,"czm_non_depth_clamp_main")+"void main() {\n    czm_non_depth_clamp_main();\n    gl_Position = czm_depthClamp(gl_Position);}\n",c=jg(c=t._depthFailAppearance.getFragmentShaderSource()),s=c,c="#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n"+nc.replaceMain(s,"czm_non_depth_clamp_main")+"void main() {\n    czm_non_depth_clamp_main();\n#if defined(GL_EXT_frag_depth)\n    #if defined(LOG_DEPTH)\n        czm_writeLogDepth();\n    #else\n        czm_writeDepthClamp();\n    #endif\n#endif\n}\n",t._spDepthFail=Hu.replaceCache({context:i,shaderProgram:t._spDepthFail,vertexShaderSource:a,fragmentShaderSource:c,attributeLocations:o}),Zg(t._spDepthFail))}var lv=new ye,hv=new p;function dv(t,n,r,i){var o=e(r)?r._uniforms:void 0,a={},s=n.uniforms;if(e(s))for(var u in s)s.hasOwnProperty(u)&&(a[u]=Kg(s,u));var c=No(a,o);return c=t._batchTable.getUniformMapCallback()(c),e(t.rtcCenter)&&(c.u_modifiedModelView=function(){var e=i.context.uniformState.view;return ye.multiply(e,t._modelMatrix,lv),ye.multiplyByPoint(lv,t.rtcCenter,hv),ye.setTranslation(lv,hv,lv),lv}),c}function fv(t,n,r,i,o,a,s,u){var c,l=dv(t,n,r,u);e(t._depthFailAppearance)&&(c=dv(t,t._depthFailAppearance,t._depthFailAppearance.material,u));var h=i?Os.TRANSLUCENT:Os.OPAQUE,d=o?2:1;d*=e(t._depthFailAppearance)?2:1,a.length=t._va.length*d;for(var f=a.length,m=0,p=0;p<f;++p){var _;o&&(e(_=a[p])||(_=a[p]=new Ps({owner:t,primitiveType:t._primitiveType})),_.vertexArray=t._va[m],_.renderState=t._backFaceRS,_.shaderProgram=t._sp,_.uniformMap=l,_.pass=h,++p),e(_=a[p])||(_=a[p]=new Ps({owner:t,primitiveType:t._primitiveType})),_.vertexArray=t._va[m],_.renderState=t._frontFaceRS,_.shaderProgram=t._sp,_.uniformMap=l,_.pass=h,e(t._depthFailAppearance)&&(o&&(e(_=a[++p])||(_=a[p]=new Ps({owner:t,primitiveType:t._primitiveType})),_.vertexArray=t._va[m],_.renderState=t._backFaceDepthFailRS,_.shaderProgram=t._spDepthFail,_.uniformMap=c,_.pass=h),e(_=a[++p])||(_=a[p]=new Ps({owner:t,primitiveType:t._primitiveType})),_.vertexArray=t._va[m],_.renderState=t._frontFaceDepthFailRS,_.shaderProgram=t._spDepthFail,_.uniformMap=c,_.pass=h),++m}}function mv(t,n,r,i,o,a,s,u){var c;zg._updateBoundingVolumes(t,n,o),n.mode===Al.SCENE3D?c=t._boundingSphereWC:n.mode===Al.COLUMBUS_VIEW?c=t._boundingSphereCV:n.mode===Al.SCENE2D&&e(t._boundingSphere2D)?c=t._boundingSphere2D:e(t._boundingSphereMorph)&&(c=t._boundingSphereMorph);var l=n.commandList,h=n.passes;if(h.render||h.pick){var d=t.allowPicking,f=Fg.castShadows(t.shadows),m=Fg.receiveShadows(t.shadows),p=r.length,_=u?2:1;_*=e(t._depthFailAppearance)?2:1;for(var g=0;g<p;++g){var v=Math.floor(g/_),y=r[g];y.modelMatrix=o,y.boundingVolume=c[v],y.cull=a,y.debugShowBoundingVolume=s,y.castShadows=f,y.receiveShadows=m,y.pickId=d?"v_pickColor":void 0,l.push(y)}}}zg._updateBoundingVolumes=function(t,n,r,i){var o,a,s;if(i||!ye.equals(r,t._modelMatrix))for(ye.clone(r,t._modelMatrix),a=t._boundingSpheres.length,o=0;o<a;++o)e(s=t._boundingSpheres[o])&&(t._boundingSphereWC[o]=Me.transform(s,r,t._boundingSphereWC[o]),n.scene3DOnly||(t._boundingSphere2D[o]=Me.clone(t._boundingSphereCV[o],t._boundingSphere2D[o]),t._boundingSphere2D[o].center.x=0,t._boundingSphereMorph[o]=Me.union(t._boundingSphereWC[o],t._boundingSphereCV[o])));var u=t.appearance.pixelSize;if(e(u))for(a=t._boundingSpheres.length,o=0;o<a;++o){s=t._boundingSpheres[o];var c=t._boundingSphereWC[o],l=n.camera.getPixelSize(s,n.context.drawingBufferWidth,n.context.drawingBufferHeight)*u;c.radius=s.radius+l}},zg.prototype.update=function(t){if(!(!e(this.geometryInstances)&&0===this._va.length||e(this.geometryInstances)&&Array.isArray(this.geometryInstances)&&0===this.geometryInstances.length||!e(this.appearance)||t.mode!==Al.SCENE3D&&t.scene3DOnly||!t.passes.render&&!t.passes.pick)){if(e(this._error))throw this._error;if(this._state!==Mg.FAILED){var n=t.context;if(e(this._batchTable)||Gg(this,n),this._batchTable.attributes.length>0){if(0===Ds.maximumVertexTextureImageUnits)throw new ve("Vertex texture fetch support is required to render primitives with per-instance attributes. The maximum number of vertex texture image units must be greater than zero.");this._batchTable.update(t)}if(this._state!==Mg.COMPLETE&&this._state!==Mg.COMBINED&&(this.asynchronous?ev(this,t):function(t,n){var r,i,o=Array.isArray(t.geometryInstances)?t.geometryInstances:[t.geometryInstances],a=t._numberOfInstances=o.length,s=new Array(a),u=t._instanceIds,c=0;for(i=0;i<a;i++){var l,h=(r=o[i]).geometry;l=e(h.attributes)&&e(h.primitiveType)?kg(h):h.constructor.createGeometry(h),s[c++]=Wg(r,l),u.push(r.id)}s.length=c;var d=n.scene3DOnly,f=n.mapProjection,m=Ig.combineGeometry({instances:s,ellipsoid:f.ellipsoid,projection:f,elementIndexUintSupported:n.context.elementIndexUint,scene3DOnly:d,vertexCacheOptimize:t.vertexCacheOptimize,compressVertices:t.compressVertices,modelMatrix:t.modelMatrix,createPickOffsets:t._createPickOffsets});t._geometries=m.geometries,t._attributeLocations=m.attributeLocations,t.modelMatrix=ye.clone(m.modelMatrix,t.modelMatrix),t._pickOffsets=m.pickOffsets,t._offsetInstanceExtend=m.offsetInstanceExtend,t._instanceBoundingSpheres=m.boundingSpheres,t._instanceBoundingSpheresCV=m.boundingSpheresCV,e(t._geometries)&&t._geometries.length>0?(t._recomputeBoundingSpheres=!0,t._state=Mg.COMBINED):Ev(t,n,Mg.FAILED,void 0)}(this,t)),this._state===Mg.COMBINED&&(function(t,n){if(e(t._batchTableAttributeIndices.distanceDisplayCondition)&&!t._batchTableBoundingSpheresUpdated){for(var r=t._batchTableBoundingSphereAttributeIndices,i=r.center3DHigh,o=r.center3DLow,a=r.center2DHigh,s=r.center2DLow,u=r.radius,c=n.mapProjection,l=c.ellipsoid,h=t._batchTable,d=t._instanceBoundingSpheres,f=d.length,m=0;m<f;++m){var p=d[m];if(e(p)){var _=t.modelMatrix;e(_)&&(p=Me.transform(p,_,iv));var g=p.center,v=p.radius,y=Cn.fromCartesian(g,tv);if(h.setBatchedAttribute(m,i,y.high),h.setBatchedAttribute(m,o,y.low),!n.scene3DOnly){var T=l.cartesianToCartographic(g,nv),E=c.project(T,rv);y=Cn.fromCartesian(E,tv),h.setBatchedAttribute(m,a,y.high),h.setBatchedAttribute(m,s,y.low)}h.setBatchedAttribute(m,u,v)}}t._batchTableBoundingSpheresUpdated=!0}}(this,t),sv(this,t),function(t,n){for(var r=t._attributeLocations,i=t._geometries,o=n.scene3DOnly,a=n.context,s=[],u=i.length,c=0;c<u;++c){var l=i[c];if(s.push(xc.fromGeometry({context:a,geometry:l,attributeLocations:r,bufferUsage:ws.STATIC_DRAW,interleave:t._interleave})),e(t._createBoundingVolumeFunction))t._createBoundingVolumeFunction(n,l);else if(t._boundingSpheres.push(Me.clone(l.boundingSphere)),t._boundingSphereWC.push(new Me),!o){var h=l.boundingSphereCV.center,d=h.x,f=h.y,m=h.z;h.x=m,h.y=d,h.z=f,t._boundingSphereCV.push(Me.clone(l.boundingSphereCV)),t._boundingSphere2D.push(new Me),t._boundingSphereMorph.push(new Me)}}t._va=s,t._primitiveType=i[0].primitiveType,t.releaseGeometryInstances&&(t.geometryInstances=void 0),t._geometries=void 0,Ev(t,n,Mg.COMPLETE,void 0)}(this,t)),this.show&&this._state===Mg.COMPLETE){this._batchTableOffsetsUpdated||sv(this,t),this._recomputeBoundingSpheres&&function(t,n){var r=t._batchTableAttributeIndices.offset;if(t._recomputeBoundingSpheres&&e(r)){var i,o=t._offsetInstanceExtend,a=t._instanceBoundingSpheres,s=a.length,u=t._tempBoundingSpheres;if(!e(u)){for(u=new Array(s),i=0;i<s;i++)u[i]=new Me;t._tempBoundingSpheres=u}for(i=0;i<s;++i){var c=u[i],l=t._batchTable.getBatchedAttribute(i,r,new p);gv(c=a[i].clone(c),l,o[i])}var h=[],d=[],f=[];for(i=0;i<s;++i){var m=u[i];m.center.x-m.radius>0||Me.intersectPlane(m,mr.ORIGIN_ZX_PLANE)!==Q.INTERSECTING?h.push(m):(d.push(m),f.push(m))}var _=h[0],g=f[0],v=d[0];for(i=1;i<h.length;i++)_=Me.union(_,h[i]);for(i=1;i<f.length;i++)g=Me.union(g,f[i]);for(i=1;i<d.length;i++)v=Me.union(v,d[i]);var y=[];for(e(_)&&y.push(_),e(g)&&y.push(g),e(v)&&y.push(v),i=0;i<y.length;i++){var T=y[i].clone(t._boundingSpheres[i]);t._boundingSpheres[i]=T,t._boundingSphereCV[i]=Me.projectTo2D(T,n.mapProjection,t._boundingSphereCV[i])}zg._updateBoundingVolumes(t,n,t.modelMatrix,!0),t._recomputeBoundingSpheres=!1}else t._recomputeBoundingSpheres=!1}(this,t);var r=this.appearance,o=r.material,a=!1,s=!1;this._appearance!==r?(this._appearance=r,this._material=o,a=!0,s=!0):this._material!==o&&(this._material=o,s=!0);var u=this.depthFailAppearance,c=e(u)?u.material:void 0;this._depthFailAppearance!==u?(this._depthFailAppearance=u,this._depthFailMaterial=c,a=!0,s=!0):this._depthFailMaterial!==c&&(this._depthFailMaterial=c,s=!0);var l=this._appearance.isTranslucent();this._translucent!==l&&(this._translucent=l,a=!0),e(this._material)&&this._material.update(n);var h=r.closed&&l;if(a)i(this._createRenderStatesFunction,uv)(this,n,r,h);if(s)i(this._createShaderProgramFunction,cv)(this,t,r);if(a||s)i(this._createCommandsFunction,fv)(this,r,o,l,h,this._colorCommands,this._pickCommands,t);i(this._updateAndQueueCommandsFunction,mv)(this,t,this._colorCommands,this._pickCommands,this.modelMatrix,this.cull,this.debugShowBoundingVolume,h)}}}};var pv=new Me,_v=new Me;function gv(e,t,n){if(n===rp.TOP){var r=Me.clone(e,pv),i=Me.clone(e,_v);i.center=p.add(i.center,t,i.center),e=Me.union(r,i,e)}else n===rp.ALL&&(e.center=p.add(e.center,t,e.center));return e}function vv(t,n,r){return function(){var i=t.getBatchedAttribute(n,r),o=t.attributes[r],a=o.componentsPerAttribute,s=xn.createTypedArray(o.componentDatatype,a);return e(i.constructor.pack)?i.constructor.pack(i,s,0):s[0]=i,s}}function yv(e,t,n,r,i){return function(o){var a=Hg(o);e.setBatchedAttribute(t,n,a),"offset"===i&&(r._recomputeBoundingSpheres=!0,r._batchTableOffsetsUpdated=!1)}}var Tv=new p;function Ev(t,n,r,i){t._error=i,t._state=r,n.afterRender.push((function(){t._ready=t._state===Mg.COMPLETE||t._state===Mg.FAILED,e(i)?t._readyPromise.reject(i):t._readyPromise.resolve(t)}))}function xv(){this._array=[],this._offset=0,this._length=0}zg.prototype.getGeometryInstanceAttributes=function(t){for(var n=-1,r=this._lastPerInstanceAttributeIndex,i=this._instanceIds,o=i.length,a=0;a<o;++a){var s=(r+a)%o;if(t===i[s]){n=s;break}}if(-1!==n){var u=this._perInstanceAttributeCache[n];if(e(u))return u;var c=this._batchTable,l=this._batchTableAttributeIndices;u={};var h={};for(var d in l)if(l.hasOwnProperty(d)){var f=l[d];h[d]={get:vv(c,n,f),set:yv(c,n,f,this,d)}}return function(t,n,r){n.boundingSphere={get:function(){var i=t._instanceBoundingSpheres[r];if(e(i)){i=i.clone();var o=t.modelMatrix,a=n.offset;e(a)&&gv(i,p.fromArray(a.get(),0,Tv),t._offsetInstanceExtend[r]),e(o)&&(i=Me.transform(i,o))}return i}},n.boundingSphereCV={get:function(){return t._instanceBoundingSpheresCV[r]}}}(this,h,n),function(e,t,n){t.pickId={get:function(){return e._pickIds[n]}}}(this,h,n),Object.defineProperties(u,h),this._lastPerInstanceAttributeIndex=n,this._perInstanceAttributeCache[n]=u,u}},zg.prototype.isDestroyed=function(){return!1},zg.prototype.destroy=function(){var e,t;this._sp=this._sp&&this._sp.destroy(),this._spDepthFail=this._spDepthFail&&this._spDepthFail.destroy();var n=this._va;for(e=n.length,t=0;t<e;++t)n[t].destroy();this._va=void 0;var r=this._pickIds;for(e=r.length,t=0;t<e;++t)r[t].destroy();return this._pickIds=void 0,this._batchTable=this._batchTable&&this._batchTable.destroy(),this._instanceIds=void 0,this._perInstanceAttributeCache=void 0,this._attributeLocations=void 0,hi(this)},Object.defineProperties(xv.prototype,{length:{get:function(){return this._length}}}),xv.prototype.enqueue=function(e){this._array.push(e),this._length++},xv.prototype.dequeue=function(){if(0!==this._length){var e=this._array,t=this._offset,n=e[t];return e[t]=void 0,++t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,n}},xv.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},xv.prototype.contains=function(e){return-1!==this._array.indexOf(e)},xv.prototype.clear=function(){this._array.length=this._offset=this._length=0},xv.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var Cv=0,Sv=1,Av=2,wv=3,bv=4,Dv=5,Iv=6,Rv=7,Pv={NONE:0,CULLED:1,RENDERED:2,REFINED:3,RENDERED_AND_KICKED:6,REFINED_AND_KICKED:7,CULLED_BUT_NEEDED:9,wasKicked:function(e){return e>=Pv.RENDERED_AND_KICKED},originalResult:function(e){return 3&e},kick:function(e){return 4|e}};function Ov(e){this.tile=e,this.frameLastUpdated=void 0,this.westMeshes=[],this.westTiles=[],this.southMeshes=[],this.southTiles=[],this.eastMeshes=[],this.eastTiles=[],this.northMeshes=[],this.northTiles=[],this.southwestMesh=void 0,this.southwestTile=void 0,this.southeastMesh=void 0,this.southeastTile=void 0,this.northwestMesh=void 0,this.northwestTile=void 0,this.northeastMesh=void 0,this.northeastTile=void 0,this.changedThisFrame=!0,this.visitedFrame=void 0,this.enqueuedFrame=void 0,this.mesh=void 0,this.vertexArray=void 0,this.waterMaskTexture=void 0,this.waterMaskTranslationAndScale=new le}Ov.prototype.update=function(e,t,n){this.changedThisFrame&&(Kv(e,t,this.tile,n),this.changedThisFrame=!1)},Ov.prototype.destroy=function(t){e(this.vertexArray)&&(e(t)?t.push(this.vertexArray):j_._freeVertexArray(this.vertexArray,t),this.vertexArray=void 0),e(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,0===this.waterMaskTexture.referenceCount&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0)};var Nv=new xv;function Mv(n,r,i,o,s,u,c,l,h){if(void 0!==o){for(var d=o;d&&(d._lastSelectionResultFrame!==s||Pv.wasKicked(d._lastSelectionResult)||Pv.originalResult(d._lastSelectionResult)===Pv.CULLED);){if(c)return;var f=d.parent;if(u>=bv&&void 0!==f)switch(u){case bv:d=d===f.northwestChild?f:void 0;break;case Dv:d=d===f.northeastChild?f:void 0;break;case Iv:d=d===f.southwestChild?f:void 0;break;case Rv:d=d===f.southeastChild?f:void 0}else d=f}if(void 0!==d)if(d._lastSelectionResult!==Pv.RENDERED){if(Pv.originalResult(o._lastSelectionResult)!==Pv.CULLED)switch(u){case Cv:Mv(n,r,i,o.northwestChild,s,u,!0,l,h),Mv(n,r,i,o.southwestChild,s,u,!0,l,h);break;case Av:Mv(n,r,i,o.southeastChild,s,u,!0,l,h),Mv(n,r,i,o.northeastChild,s,u,!0,l,h);break;case wv:Mv(n,r,i,o.southwestChild,s,u,!0,l,h),Mv(n,r,i,o.southeastChild,s,u,!0,l,h);break;case Sv:Mv(n,r,i,o.northeastChild,s,u,!0,l,h),Mv(n,r,i,o.northwestChild,s,u,!0,l,h);break;case bv:Mv(n,r,i,o.northwestChild,s,u,!0,l,h);break;case Dv:Mv(n,r,i,o.northeastChild,s,u,!0,l,h);break;case Iv:Mv(n,r,i,o.southwestChild,s,u,!0,l,h);break;case Rv:Mv(n,r,i,o.southeastChild,s,u,!0,l,h);break;default:throw new t("Invalid edge")}}else{if(e(d.data.vertexArray))return;!function(t,n,r,i,o,s,u,c){var l=i.data;if(void 0===l.fill)l.fill=new Ov(i);else if(l.fill.visitedFrame===s)return;l.fill.enqueuedFrame!==s&&(l.fill.enqueuedFrame=s,l.fill.changedThisFrame=!1,u.enqueue(i));!function(t,n,r,i,o,s){var u,c,l,h,d,f,m=i.data.fill,p=r.data.fill;e(p)?(p.visitedFrame=n.frameNumber,p.changedThisFrame&&(Kv(t,n,r,s),p.changedThisFrame=!1),u=r.data.fill.mesh):u=r.data.mesh;switch(o){case Cv:c=m.westMeshes,l=m.westTiles;break;case wv:c=m.southMeshes,l=m.southTiles;break;case Av:c=m.eastMeshes,l=m.eastTiles;break;case Sv:c=m.northMeshes,l=m.northTiles;break;case bv:return m.changedThisFrame=m.changedThisFrame||m.northwestMesh!==u,m.northwestMesh=u,void(m.northwestTile=r);case Dv:return m.changedThisFrame=m.changedThisFrame||m.northeastMesh!==u,m.northeastMesh=u,void(m.northeastTile=r);case Iv:return m.changedThisFrame=m.changedThisFrame||m.southwestMesh!==u,m.southwestMesh=u,void(m.southwestTile=r);case Rv:return m.changedThisFrame=m.changedThisFrame||m.southeastMesh!==u,m.southeastMesh=u,void(m.southeastTile=r)}if(r.level<=i.level)return m.changedThisFrame=m.changedThisFrame||c[0]!==u||1!==c.length,c[0]=u,l[0]=r,c.length=1,void(l.length=1);var _,g=r.rectangle,v=i.rectangle;switch(o){case Cv:for(_=(v.north-v.south)*a.EPSILON5,h=0;h<l.length&&(f=l[h].rectangle,!a.greaterThan(g.north,f.south,_));++h);for(d=h;d<l.length&&(f=l[d].rectangle,!a.greaterThanOrEquals(g.south,f.north,_));++d);break;case wv:for(_=(v.east-v.west)*a.EPSILON5,h=0;h<l.length&&(f=l[h].rectangle,!a.lessThan(g.west,f.east,_));++h);for(d=h;d<l.length&&(f=l[d].rectangle,!a.lessThanOrEquals(g.east,f.west,_));++d);break;case Av:for(_=(v.north-v.south)*a.EPSILON5,h=0;h<l.length&&(f=l[h].rectangle,!a.lessThan(g.south,f.north,_));++h);for(d=h;d<l.length&&(f=l[d].rectangle,!a.lessThanOrEquals(g.north,f.south,_));++d);break;case Sv:for(_=(v.east-v.west)*a.EPSILON5,h=0;h<l.length&&(f=l[h].rectangle,!a.greaterThan(g.east,f.west,_));++h);for(d=h;d<l.length&&(f=l[d].rectangle,!a.greaterThanOrEquals(g.west,f.east,_));++d);}d-h==1?(m.changedThisFrame=m.changedThisFrame||c[h]!==u,c[h]=u,l[h]=r):(m.changedThisFrame=!0,c.splice(h,d-h,u),l.splice(h,d-h,r))}(t,n,r,i,o,c)}(n,r,i,d,u,s,l,h)}}}Ov.updateFillTiles=function(t,n,r,i){var o=t._quadtree,a=o._levelZeroTiles,s=o._lastSelectionFrameNumber,u=Nv;u.clear();for(var c=0;c<n.length;++c){e(n[c].data.vertexArray)&&u.enqueue(n[c])}for(var l=u.dequeue();void 0!==l;){var h=l.findTileToWest(a),d=l.findTileToSouth(a),f=l.findTileToEast(a),m=l.findTileToNorth(a);Mv(t,r,l,h,s,Av,!1,u,i),Mv(t,r,l,d,s,Sv,!1,u,i),Mv(t,r,l,f,s,Cv,!1,u,i),Mv(t,r,l,m,s,wv,!1,u,i);var p=h.findTileToNorth(a),_=h.findTileToSouth(a),g=f.findTileToNorth(a),v=f.findTileToSouth(a);Mv(t,r,l,p,s,Rv,!1,u,i),Mv(t,r,l,g,s,Iv,!1,u,i),Mv(t,r,l,_,s,Dv,!1,u,i),Mv(t,r,l,v,s,bv,!1,u,i),l=u.dequeue()}};var Lv=new N,Fv=new N,zv=new p,Bv=new p,Uv=new c,Vv=new c,Hv=new c;function Gv(){this.height=0,this.encodedNormal=new c}function kv(t,n,r,i,o,a,s,u,c){if(e(o))return o;var l;if(e(a)&&e(s))l=.5*(a.height+s.height);else if(e(a))l=a.height;else if(e(s))l=s.height;else if(e(u))l=u.height;else{var h=t.tile.data.tileBoundingRegion,d=0,f=0;e(h)&&(d=h.minimumHeight,f=h.maximumHeight),l=.5*(d+f)}return iy(t,n,r,i,l,c),c}var Wv={minimumHeight:0,maximumHeight:0},qv=new Gv,Yv=new Gv,jv=new Gv,Xv=new Gv,Zv="undefined"!=typeof Uint8Array?new Uint8Array(81):void 0;function Kv(t,n,r,i){j_.initialize(r,t.terrainProvider,t._imageryLayers);var o=r.data,a=o.fill,s=r.rectangle,u=r.tilingScheme.ellipsoid,l=oy(a,u,0,1,a.northwestTile,a.northwestMesh,a.northTiles,a.northMeshes,a.westTiles,a.westMeshes,jv),h=oy(a,u,0,0,a.southwestTile,a.southwestMesh,a.westTiles,a.westMeshes,a.southTiles,a.southMeshes,qv),d=oy(a,u,1,0,a.southeastTile,a.southeastMesh,a.southTiles,a.southMeshes,a.eastTiles,a.eastMeshes,Yv),f=oy(a,u,1,1,a.northeastTile,a.northeastMesh,a.eastTiles,a.eastMeshes,a.northTiles,a.northMeshes,Xv);l=kv(a,u,0,1,l,h,f,d,jv),h=kv(a,u,0,0,h,l,d,f,qv),d=kv(a,u,1,1,d,h,f,l,Yv),f=kv(a,u,1,1,f,d,l,h,Xv);var m,_,g=h.height,v=d.height,y=l.height,T=f.height,E=Math.min(g,v,y,T),x=Math.max(g,v,y,T),C=.5*(E+x),A=t.getLevelMaximumGeometricError(r.level),w=u.maximumRadius-A,b=4*Math.acos(w/u.maximumRadius);if(b*=1.5,s.width>b&&x-E<=A){var D=new Dm({width:9,height:9,buffer:Zv,structure:{heightOffset:x}});a.mesh=D._createMeshSync(r.tilingScheme,r.x,r.y,r.level,1)}else{var I=new dm(void 0,void 0,void 0,void 0,!0,!0),R=Fv;R.longitude=.5*(s.east+s.west),R.latitude=.5*(s.north+s.south),R.height=C,I.center=u.cartographicToCartesian(R,I.center);var P,O=5;for(m=0,_=(P=a.westMeshes).length;m<_;++m)O+=P[m].eastIndicesNorthToSouth.length;for(m=0,_=(P=a.southMeshes).length;m<_;++m)O+=P[m].northIndicesWestToEast.length;for(m=0,_=(P=a.eastMeshes).length;m<_;++m)O+=P[m].westIndicesSouthToNorth.length;for(m=0,_=(P=a.northMeshes).length;m<_;++m)O+=P[m].southIndicesEastToWest.length;var N=Wv;N.minimumHeight=E,N.maximumHeight=x;var M=I.getStride(),L=new Float32Array(O*M),F=0,z=F,B=F=sy(a,u,I,L,F=Qv(u,s,I,L,F,0,1,l.height,l.encodedNormal,1,N),a.westTiles,a.westMeshes,Av,N),U=F=sy(a,u,I,L,F=Qv(u,s,I,L,F,0,0,h.height,h.encodedNormal,0,N),a.southTiles,a.southMeshes,Sv,N),V=F=sy(a,u,I,L,F=Qv(u,s,I,L,F,1,0,d.height,d.encodedNormal,0,N),a.eastTiles,a.eastMeshes,Cv,N);F=sy(a,u,I,L,F=Qv(u,s,I,L,F,1,1,f.height,f.encodedNormal,1,N),a.northTiles,a.northMeshes,wv,N),E=N.minimumHeight,x=N.maximumHeight;var H=mf.fromRectangle(s,E,x,r.tilingScheme.ellipsoid),G=Nc.geodeticLatitudeToMercatorAngle(s.south),k=1/(Nc.geodeticLatitudeToMercatorAngle(s.north)-G),W=(Nc.geodeticLatitudeToMercatorAngle(R.latitude)-G)*k;u.geodeticSurfaceNormalCartographic(Lv,Bv);var q=S.octEncode(Bv,Uv),Y=F;I.encode(L,F*M,H.center,c.fromElements(.5,.5,Hv),C,q,W);var j,X=++F,Z=3*(X-1),K=Z*(X<256?1:2);if((L.length-X*M)*Float32Array.BYTES_PER_ELEMENT>=K){var Q=X*M*Float32Array.BYTES_PER_ELEMENT;j=X<256?new Uint8Array(L.buffer,Q,Z):new Uint16Array(L.buffer,Q,Z)}else j=X<256?new Uint8Array(Z):new Uint16Array(Z);L=new Float32Array(L.buffer,0,X*M);var J=0;for(m=0;m<X-2;++m)j[J++]=Y,j[J++]=m,j[J++]=m+1;j[J++]=Y,j[J++]=m,j[J++]=0;var $=[];for(m=B;m>=z;--m)$.push(m);var ee=[];for(m=U;m>=B;--m)ee.push(m);var te=[];for(m=V;m>=U;--m)te.push(m);var ne=[];for(ne.push(0),m=Y-1;m>=V;--m)ne.push(m);a.mesh=new Tm(I.center,L,j,Z,X,E,x,Me.fromOrientedBoundingBox(H),function(e,t,n,r,i,o){var a=e.quadtree._occluders.ellipsoid,s=a.ellipsoid,u=dy;return p.fromRadians(n.west,n.south,i,s,u[0]),p.fromRadians(n.east,n.south,i,s,u[1]),p.fromRadians(n.west,n.north,i,s,u[2]),p.fromRadians(n.east,n.north,i,s,u[3]),a.computeHorizonCullingPointPossiblyUnderEllipsoid(t,u,r,o)}(t,H.center,s,E,x),I.getStride(),H,I,n.terrainExaggeration,$,ee,te,ne)}var re=n.context;e(a.vertexArray)&&(e(i)?i.push(a.vertexArray):j_._freeVertexArray(a.vertexArray)),a.vertexArray=j_._createVertexArrayForMesh(re,a.mesh),o.processImagery(r,t.terrainProvider,n,!0);var ie=a.waterMaskTexture;if(a.waterMaskTexture=void 0,t.terrainProvider.hasWaterMask){var oe=o._findAncestorTileWithTerrainData(r);e(oe)&&e(oe.data.waterMaskTexture)&&(a.waterMaskTexture=oe.data.waterMaskTexture,++a.waterMaskTexture.referenceCount,o._computeWaterMaskTranslationAndScale(r,oe,a.waterMaskTranslationAndScale))}e(ie)&&(--ie.referenceCount,0===ie.referenceCount&&ie.destroy())}function Qv(e,t,n,r,i,o,s,u,c,l,h){var d=Lv;d.longitude=a.lerp(t.west,t.east,o),d.latitude=a.lerp(t.south,t.north,s),d.height=u;var f=e.cartographicToCartesian(d,zv),m=Vv;return m.x=o,m.y=s,n.encode(r,i*n.getStride(),f,m,u,c,l),h.minimumHeight=Math.min(h.minimumHeight,u),h.maximumHeight=Math.max(h.maximumHeight,u),i+1}var Jv=new Oe;function $v(e,t,n,r){var i=e.rectangle,o=t.rectangle;0===t.x&&1===n.x&&e.x===e.tilingScheme.getNumberOfXTilesAtLevel(e.level)-1?((i=Oe.clone(e.rectangle,Jv)).west-=a.TWO_PI,i.east-=a.TWO_PI):0===e.x&&0===n.x&&t.x===t.tilingScheme.getNumberOfXTilesAtLevel(t.level)-1&&((i=Oe.clone(e.rectangle,Jv)).west+=a.TWO_PI,i.east+=a.TWO_PI);var s=i.east-i.west,u=(o.west-i.west)/s,c=(o.east-i.west)/s,l=i.north-i.south,h=(o.south-i.south)/l,d=(o.north-i.south)/l,f=(n.x-u)/(c-u),m=(n.y-h)/(d-h);return Math.abs(f)<Math.EPSILON5?f=0:Math.abs(f-1)<Math.EPSILON5&&(f=1),Math.abs(m)<Math.EPSILON5?m=0:Math.abs(m-1)<Math.EPSILON5&&(m=1),r.x=f,r.y=m,r}var ey=new c;function ty(e,t,n,r,i){var o=e.encoding,a=e.vertices;if(i.height=o.decodeHeight(a,t),o.hasVertexNormals)o.getOctEncodedNormal(a,t,i.encodedNormal);else{var s=i.encodedNormal;s.x=0,s.y=0}}var ny=new c,ry=new p;function iy(e,t,n,r,i,o){o.height=i;var a=t.geodeticSurfaceNormalCartographic(Lv,zv);S.octEncode(a,o.encodedNormal)}function oy(t,n,r,i,o,a,s,u,c,l,h){var d;return hy(t,n,u,s,!1,r,i,h)||hy(t,n,l,c,!0,r,i,h)?h:ly(o,a)?(ty(a,0===r?0===i?a.eastIndicesNorthToSouth[0]:a.southIndicesEastToWest[0]:0===i?a.northIndicesWestToEast[0]:a.westIndicesSouthToNorth[0],0,0,h),h):e(d=0===r?0===i?ay(t.westMeshes,t.westTiles,Av,t.southMeshes,t.southTiles,Sv):ay(t.northMeshes,t.northTiles,wv,t.westMeshes,t.westTiles,Av):0===i?ay(t.southMeshes,t.southTiles,Sv,t.eastMeshes,t.eastTiles,Cv):ay(t.eastMeshes,t.eastTiles,Cv,t.northMeshes,t.northTiles,wv))?(iy(0,n,0,0,d,h),h):void 0}function ay(t,n,r,i,o,a,s,u){var c=cy(t,n,!1,r),l=cy(i,o,!0,a);return e(c)&&e(l)?.5*(c+l):e(c)?c:l}function sy(e,t,n,r,i,o,a,s,u){for(var c=0;c<o.length;++c)i=uy(e,t,n,r,i,o[c],a[c],s,u);return i}function uy(e,t,n,r,i,o,s,u,c){var l=o.rectangle;u===Av&&0===e.tile.x?((l=Oe.clone(o.rectangle,Jv)).west-=a.TWO_PI,l.east-=a.TWO_PI):u===Cv&&0===o.x&&((l=Oe.clone(o.rectangle,Jv)).west+=a.TWO_PI,l.east+=a.TWO_PI);var h,d,f,m,p=e.tile.rectangle;switch(i>0&&(n.decodeTextureCoordinates(r,i-1,Hv),h=Hv.x,d=Hv.y),u){case Cv:f=s.westIndicesSouthToNorth,m=!1;break;case Sv:f=s.northIndicesWestToEast,m=!0;break;case Av:f=s.eastIndicesNorthToSouth,m=!1;break;case wv:f=s.southIndicesEastToWest,m=!0}var _,g,v=o,y=e.tile,T=s.encoding,E=s.vertices,x=n.getStride();T.hasWebMercatorT&&(_=Nc.geodeticLatitudeToMercatorAngle(p.south),g=1/(Nc.geodeticLatitudeToMercatorAngle(p.north)-_));for(var C=0;C<f.length;++C){var S=f[C],A=T.decodeTextureCoordinates(E,S,Hv);$v(v,y,A,A);var w=A.x,b=A.y,D=m?w:b;if(!(D<0||D>1)&&!(Math.abs(w-h)<a.EPSILON5&&Math.abs(b-d)<a.EPSILON5)){var I=Math.abs(w)<a.EPSILON5||Math.abs(w-1)<a.EPSILON5,R=Math.abs(b)<a.EPSILON5||Math.abs(b-1)<a.EPSILON5;if(!I||!R){var P,O=T.decodePosition(E,S,zv),N=T.decodeHeight(E,S);T.hasVertexNormals?P=T.getOctEncodedNormal(E,S,Uv):((P=Uv).x=0,P.y=0);var M=b;if(T.hasWebMercatorT){var L=a.lerp(p.south,p.north,b);M=(Nc.geodeticLatitudeToMercatorAngle(L)-_)*g}n.encode(r,i*x,O,A,N,P,M),c.minimumHeight=Math.min(c.minimumHeight,N),c.maximumHeight=Math.max(c.maximumHeight,N),++i}}}return i}function cy(t,n,r,i,o,a){var s,u,c;r?(s=0,u=t.length,c=1):(s=t.length-1,u=-1,c=-1);for(var l=s;l!==u;l+=c){var h=t[l];if(ly(n[l],h)){var d;switch(i){case Cv:d=h.westIndicesSouthToNorth;break;case wv:d=h.southIndicesEastToWest;break;case Av:d=h.eastIndicesNorthToSouth;break;case Sv:d=h.northIndicesWestToEast}var f=d[r?0:d.length-1];if(e(f))return h.encoding.decodeHeight(h.vertices,f)}}}function ly(t,n){return e(n)&&(!e(t.data.fill)||!t.data.fill.changedThisFrame)}function hy(e,t,n,r,i,o,s,u){var c,l,h,d,f,m=r[i?0:n.length-1],_=n[i?0:n.length-1];if(ly(m,_)&&(0===o?0===s?(c=i?_.northIndicesWestToEast:_.eastIndicesNorthToSouth,l=i,h=i):(c=i?_.eastIndicesNorthToSouth:_.southIndicesEastToWest,l=!i,h=!1):0===s?(c=i?_.westIndicesSouthToNorth:_.northIndicesWestToEast,l=!i,h=!0):(c=i?_.southIndicesEastToWest:_.westIndicesSouthToNorth,l=i,h=!i),c.length>0)){f=c[d=i?0:c.length-1],_.encoding.decodeTextureCoordinates(_.vertices,f,Hv);var g=$v(m,e.tile,Hv,Hv);if(g.x===o&&g.y===s)return ty(_,f,0,0,u),!0;if(!((d=Qi(c,l?o:s,(function(t,n){_.encoding.decodeTextureCoordinates(_.vertices,t,Hv);var r=$v(m,e.tile,Hv,Hv);return h?l?r.x-o:r.y-s:l?o-r.x:s-r.y})))<0))return ty(_,c[d],0,0,u),!0;if((d=~d)>0&&d<c.length)return function(e,t,n,r,i,o,s,u,c,l){var h,d=r.encoding,f=r.vertices,m=$v(t,n,d.decodeTextureCoordinates(f,i,Hv),Hv),_=$v(t,n,d.decodeTextureCoordinates(f,o,Vv),Vv);h=c?(s-m.x)/(_.x-m.x):(u-m.y)/(_.y-m.y);var g,v=d.decodeHeight(f,i),y=d.decodeHeight(f,o),T=n.rectangle;if(Lv.longitude=a.lerp(T.west,T.east,s),Lv.latitude=a.lerp(T.south,T.north,u),l.height=Lv.height=a.lerp(v,y,h),d.hasVertexNormals){var E=d.getOctEncodedNormal(f,i,ey),x=d.getOctEncodedNormal(f,o,ny),C=S.octDecode(E.x,E.y,zv),A=S.octDecode(x.x,x.y,ry);g=p.lerp(C,A,h,zv),p.normalize(g,g),S.octEncode(g,l.encodedNormal)}else g=e.geodeticSurfaceNormalCartographic(Lv,zv),S.octEncode(g,l.encodedNormal)}(t,m,e.tile,_,c[d-1],c[d],o,s,l,u),!0}return!1}var dy=[new p,new p,new p,new p];function fy(e,t,n){n=n||2;var r,i,o,a,s,u,c,l=t&&t.length,h=l?t[0]*n:e.length,d=my(e,0,h,n,!0),f=[];if(!d||d.next===d.prev)return f;if(l&&(d=function(e,t,n,r){var i,o,a,s=[];for(i=0,o=t.length;i<o;i++)(a=my(e,t[i]*r,i<o-1?t[i+1]*r:e.length,r,!1))===a.next&&(a.steiner=!0),s.push(Ay(a));for(s.sort(Ey),i=0;i<s.length;i++)xy(s[i],n),n=py(n,n.next);return n}(e,t,d,n)),e.length>80*n){r=o=e[0],i=a=e[1];for(var m=n;m<h;m+=n)(s=e[m])<r&&(r=s),(u=e[m+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);c=0!==(c=Math.max(o-r,a-i))?1/c:0}return _y(d,f,n,r,i,c),f}function my(e,t,n,r,i){var o,a;if(i===By(e,t,n,r)>0)for(o=t;o<n;o+=r)a=Ly(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=Ly(o,e[o],e[o+1],a);return a&&Iy(a,a.next)&&(Fy(a),a=a.next),a}function py(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!Iy(r,r.next)&&0!==Dy(r.prev,r,r.next))r=r.next;else{if(Fy(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function _y(e,t,n,r,i,o,a){if(e){!a&&o&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=Sy(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,u,c=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(u=c;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(e,r,i,o);for(var s,u,c=e;e.prev!==e.next;)if(s=e.prev,u=e.next,o?vy(e,r,i,o):gy(e))t.push(s.i/n),t.push(e.i/n),t.push(u.i/n),Fy(e),e=u.next,c=u.next;else if((e=u)===c){a?1===a?_y(e=yy(py(e),t,n),t,n,r,i,o,2):2===a&&Ty(e,t,n,r,i,o):_y(py(e),t,n,r,i,o,1);break}}}function gy(e){var t=e.prev,n=e,r=e.next;if(Dy(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(wy(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Dy(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function vy(e,t,n,r){var i=e.prev,o=e,a=e.next;if(Dy(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=Sy(s,u,t,n,r),d=Sy(c,l,t,n,r),f=e.prevZ,m=e.nextZ;f&&f.z>=h&&m&&m.z<=d;){if(f!==e.prev&&f!==e.next&&wy(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Dy(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,m!==e.prev&&m!==e.next&&wy(i.x,i.y,o.x,o.y,a.x,a.y,m.x,m.y)&&Dy(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&wy(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Dy(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;m&&m.z<=d;){if(m!==e.prev&&m!==e.next&&wy(i.x,i.y,o.x,o.y,a.x,a.y,m.x,m.y)&&Dy(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function yy(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!Iy(i,o)&&Ry(i,r,r.next,o)&&Ny(i,o)&&Ny(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),Fy(r),Fy(r.next),r=e=o),r=r.next}while(r!==e);return py(r)}function Ty(e,t,n,r,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&by(a,s)){var u=My(a,s);return a=py(a,a.next),u=py(u,u.next),_y(a,t,n,r,i,o),void _y(u,t,n,r,i,o)}s=s.next}a=a.next}while(a!==e)}function Ey(e,t){return e.x-t.x}function xy(e,t){if(t=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===a)return n;var u,c=n,l=n.x,h=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=l&&i!==r.x&&wy(o<h?i:a,o,l,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),Ny(r,e)&&(u<d||u===d&&(r.x>n.x||r.x===n.x&&Cy(n,r)))&&(n=r,d=u)),r=r.next}while(r!==c);return n}(e,t),t){var n=My(t,e);py(n,n.next)}}function Cy(e,t){return Dy(e.prev,e,t.prev)<0&&Dy(t.next,e,e.next)<0}function Sy(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ay(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function wy(e,t,n,r,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function by(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Ry(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Ny(e,t)&&Ny(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Dy(e.prev,e,t.prev)||Dy(e,t.prev,t))||Iy(e,t)&&Dy(e.prev,e,e.next)>0&&Dy(t.prev,t,t.next)>0)}function Dy(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Iy(e,t){return e.x===t.x&&e.y===t.y}function Ry(e,t,n,r){var i=Oy(Dy(e,t,n)),o=Oy(Dy(e,t,r)),a=Oy(Dy(n,r,e)),s=Oy(Dy(n,r,t));return i!==o&&a!==s||(!(0!==i||!Py(e,n,t))||(!(0!==o||!Py(e,r,t))||(!(0!==a||!Py(n,e,r))||!(0!==s||!Py(n,t,r)))))}function Py(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Oy(e){return e>0?1:e<0?-1:0}function Ny(e,t){return Dy(e.prev,e,e.next)<0?Dy(e,t,e.next)>=0&&Dy(e,e.prev,t)>=0:Dy(e,t,e.prev)<0||Dy(e,e.next,t)<0}function My(e,t){var n=new zy(e.i,e.x,e.y),r=new zy(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Ly(e,t,n,r){var i=new zy(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Fy(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function zy(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function By(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}function Uy(e,t,n){if(0===e)return t*n;var r=e*e,i=r*r,o=i*r,a=o*r,s=a*r,u=s*r,c=n;return t*((1-r/4-3*i/64-5*o/256-175*a/16384-441*s/65536-4851*u/1048576)*c-(3*r/8+3*i/32+45*o/1024+105*a/4096+2205*s/131072+6237*u/524288)*Math.sin(2*c)+(15*i/256+45*o/1024+525*a/16384+1575*s/65536+155925*u/8388608)*Math.sin(4*c)-(35*o/3072+175*a/12288+3675*s/262144+13475*u/1048576)*Math.sin(6*c)+(315*a/131072+2205*s/524288+43659*u/8388608)*Math.sin(8*c)-(693*s/1310720+6237*u/5242880)*Math.sin(10*c)+1001*u/8388608*Math.sin(12*c))}function Vy(e,t){if(0===e)return Math.log(Math.tan(.5*(a.PI_OVER_TWO+t)));var n=e*Math.sin(t);return Math.log(Math.tan(.5*(a.PI_OVER_TWO+t)))-e/2*Math.log((1+n)/(1-n))}fy.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(By(e,0,o,n));if(i)for(var s=0,u=t.length;s<u;s++){var c=t[s]*n,l=s<u-1?t[s+1]*n:e.length;a-=Math.abs(By(e,c,l,n))}var h=0;for(s=0;s<r.length;s+=3){var d=r[s]*n,f=r[s+1]*n,m=r[s+2]*n;h+=Math.abs((e[d]-e[m])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[m+1]-e[d+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},fy.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n};var Hy=new p,Gy=new p;function ky(e,t,n,r){p.normalize(r.cartographicToCartesian(t,Gy),Hy),p.normalize(r.cartographicToCartesian(n,Gy),Gy);var i=r.maximumRadius,o=r.minimumRadius,s=i*i,u=o*o;e._ellipticitySquared=(s-u)/s,e._ellipticity=Math.sqrt(e._ellipticitySquared),e._start=N.clone(t,e._start),e._start.height=0,e._end=N.clone(n,e._end),e._end.height=0,e._heading=function(e,t,n,r,i){var o=Vy(e._ellipticity,n),s=Vy(e._ellipticity,i);return Math.atan2(a.negativePiToPi(r-t),s-o)}(e,t.longitude,t.latitude,n.longitude,n.latitude),e._distance=function(e,t,n,r,i,o,s){var u=e._heading,c=o-r,l=0;if(a.equalsEpsilon(Math.abs(u),a.PI_OVER_TWO,a.EPSILON8))if(t===n)l=t*Math.cos(i)*a.negativePiToPi(c);else{var h=Math.sin(i);l=t*Math.cos(i)*a.negativePiToPi(c)/Math.sqrt(1-e._ellipticitySquared*h*h)}else{var d=Uy(e._ellipticity,t,i);l=(Uy(e._ellipticity,t,s)-d)/Math.cos(u)}return Math.abs(l)}(e,r.maximumRadius,r.minimumRadius,t.longitude,t.latitude,n.longitude,n.latitude)}function Wy(t,n,r,i,o,s){var u,c,l,h=o*o;if(Math.abs(a.PI_OVER_TWO-Math.abs(n))>a.EPSILON8){c=function(e,t,n){var r=e/n;if(0===t)return r;var i=r*r,o=i*r,a=o*r,s=t*t,u=s*s,c=u*s,l=c*s,h=l*s,d=h*s,f=Math.sin(2*r),m=Math.cos(2*r),p=Math.sin(4*r),_=Math.cos(4*r),g=Math.sin(6*r),v=Math.cos(6*r),y=Math.sin(8*r),T=Math.cos(8*r),E=Math.sin(10*r);return r+r*s/4+7*r*u/64+15*r*c/256+579*r*l/16384+1515*r*h/65536+16837*r*d/1048576+(3*r*u/16+45*r*c/256-r*(32*i-561)*l/4096-r*(232*i-1677)*h/16384+r*(399985-90560*i+512*a)*d/5242880)*m+(21*r*c/256+483*r*l/4096-r*(224*i-1969)*h/16384-r*(33152*i-112599)*d/1048576)*_+(151*r*l/4096+4681*r*h/65536+1479*r*d/16384-453*o*d/32768)*v+(1097*r*h/65536+42783*r*d/1048576)*T+8011*r*d/1048576*Math.cos(10*r)+(3*s/8+3*u/16+213*c/2048-3*i*c/64+255*l/4096-33*i*l/512+20861*h/524288-33*i*h/512+a*h/1024+28273*d/1048576-471*i*d/8192+9*a*d/4096)*f+(21*u/256+21*c/256+533*l/8192-21*i*l/512+197*h/4096-315*i*h/4096+584039*d/16777216-12517*i*d/131072+7*a*d/2048)*p+(151*c/6144+151*l/4096+5019*h/131072-453*i*h/16384+26965*d/786432-8607*i*d/131072)*g+(1097*l/131072+1097*h/65536+225797*d/10485760-1097*i*d/65536)*y+(8011*h/2621440+8011*d/1048576)*E+293393*d/251658240*Math.sin(12*r)}(Uy(o,i,t.latitude)+r*Math.cos(n),o,i);var d=Vy(o,t.latitude),f=Vy(o,c);l=Math.tan(n)*(f-d),u=a.negativePiToPi(t.longitude+l)}else{var m;if(c=t.latitude,0===o)m=i*Math.cos(t.latitude);else{var p=Math.sin(t.latitude);m=i*Math.cos(t.latitude)/Math.sqrt(1-h*p*p)}l=r/m,u=n>0?a.negativePiToPi(t.longitude+l):a.negativePiToPi(t.longitude-l)}return e(s)?(s.longitude=u,s.latitude=c,s.height=0,s):new N(u,c,0)}function qy(t,n,r){var o=i(r,H.WGS84);this._ellipsoid=o,this._start=new N,this._end=new N,this._heading=void 0,this._distance=void 0,this._ellipticity=void 0,this._ellipticitySquared=void 0,e(t)&&e(n)&&ky(this,t,n,o)}Object.defineProperties(qy.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},surfaceDistance:{get:function(){return this._distance}},start:{get:function(){return this._start}},end:{get:function(){return this._end}},heading:{get:function(){return this._heading}}}),qy.fromStartHeadingDistance=function(t,n,r,o,s){var u=i(o,H.WGS84),c=u.maximumRadius,l=u.minimumRadius,h=c*c,d=l*l,f=Math.sqrt((h-d)/h),m=Wy(t,n=a.negativePiToPi(n),r,u.maximumRadius,f);return!e(s)||e(o)&&!o.equals(s.ellipsoid)?new qy(t,m,u):(s.setEndPoints(t,m),s)},qy.prototype.setEndPoints=function(e,t){ky(this,e,t,this._ellipsoid)},qy.prototype.interpolateUsingFraction=function(e,t){return this.interpolateUsingSurfaceDistance(e*this._distance,t)},qy.prototype.interpolateUsingSurfaceDistance=function(e,t){return Wy(this._start,this._heading,e,this._ellipsoid.maximumRadius,this._ellipticity,t)},qy.prototype.findIntersectionWithLongitude=function(t,n){var r=this._ellipticity,i=this._heading,o=Math.abs(i),s=this._start;if(t=a.negativePiToPi(t),a.equalsEpsilon(Math.abs(t),Math.PI,a.EPSILON14)&&(t=a.sign(s.longitude)*Math.PI),e(n)||(n=new N),Math.abs(a.PI_OVER_TWO-o)<=a.EPSILON8)return n.longitude=t,n.latitude=s.latitude,n.height=0,n;if(a.equalsEpsilon(Math.abs(a.PI_OVER_TWO-o),a.PI_OVER_TWO,a.EPSILON8)){if(a.equalsEpsilon(t,s.longitude,a.EPSILON12))return;return n.longitude=t,n.latitude=a.PI_OVER_TWO*a.sign(a.PI_OVER_TWO-i),n.height=0,n}var u,c=s.latitude,l=r*Math.sin(c),h=Math.tan(.5*(a.PI_OVER_TWO+c))*Math.exp((t-s.longitude)/Math.tan(i)),d=(1+l)/(1-l),f=s.latitude;do{u=f;var m=r*Math.sin(u),p=(1+m)/(1-m);f=2*Math.atan(h*Math.pow(p/d,r/2))-a.PI_OVER_TWO}while(!a.equalsEpsilon(f,u,a.EPSILON12));return n.longitude=t,n.latitude=f,n.height=0,n},qy.prototype.findIntersectionWithLatitude=function(t,n){var r=this._ellipticity,i=this._heading,o=this._start;if(!a.equalsEpsilon(Math.abs(i),a.PI_OVER_TWO,a.EPSILON8)){var s=Vy(r,o.latitude),u=Vy(r,t),c=Math.tan(i)*(u-s),l=a.negativePiToPi(o.longitude+c);return e(n)?(n.longitude=l,n.latitude=t,n.height=0,n):new N(l,t,0)}};var Yy=new p,jy=new p,Xy={computeArea2D:function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++){var o=e[r],a=e[i];n+=o.x*a.y-a.x*o.y}return.5*n},computeWindingOrder2D:function(e){return Xy.computeArea2D(e)>0?Bs.COUNTER_CLOCKWISE:Bs.CLOCKWISE},triangulate:function(e,t){return fy(c.packArray(e),t,2)}},Zy=new p,Ky=new p,Qy=new p,Jy=new p,$y=new p,eT=new p,tT=new p;Xy.computeSubdivision=function(t,n,r,o){o=i(o,a.RADIANS_PER_DEGREE);var s,u=r.slice(0),c=n.length,l=new Array(3*c),h=0;for(s=0;s<c;s++){var d=n[s];l[h++]=d.x,l[h++]=d.y,l[h++]=d.z}for(var f=[],m={},_=t.maximumRadius,g=a.chordLength(o,_),v=g*g;u.length>0;){var y,T,E=u.pop(),x=u.pop(),C=u.pop(),S=p.fromArray(l,3*C,Zy),A=p.fromArray(l,3*x,Ky),w=p.fromArray(l,3*E,Qy),b=p.multiplyByScalar(p.normalize(S,Jy),_,Jy),D=p.multiplyByScalar(p.normalize(A,$y),_,$y),I=p.multiplyByScalar(p.normalize(w,eT),_,eT),R=p.magnitudeSquared(p.subtract(b,D,tT)),P=p.magnitudeSquared(p.subtract(D,I,tT)),O=p.magnitudeSquared(p.subtract(I,b,tT)),N=Math.max(R,P,O);N>v?R===N?(e(s=m[y=Math.min(C,x)+" "+Math.max(C,x)])||(T=p.add(S,A,tT),p.multiplyByScalar(T,.5,T),l.push(T.x,T.y,T.z),s=l.length/3-1,m[y]=s),u.push(C,s,E),u.push(s,x,E)):P===N?(e(s=m[y=Math.min(x,E)+" "+Math.max(x,E)])||(T=p.add(A,w,tT),p.multiplyByScalar(T,.5,T),l.push(T.x,T.y,T.z),s=l.length/3-1,m[y]=s),u.push(x,s,C),u.push(s,E,C)):O===N&&(e(s=m[y=Math.min(E,C)+" "+Math.max(E,C)])||(T=p.add(w,S,tT),p.multiplyByScalar(T,.5,T),l.push(T.x,T.y,T.z),s=l.length/3-1,m[y]=s),u.push(E,s,x),u.push(s,C,x)):(f.push(C),f.push(x),f.push(E))}return new cc({attributes:{position:new tp({componentDatatype:xn.DOUBLE,componentsPerAttribute:3,values:l})},indices:f,primitiveType:Rs.TRIANGLES})};var nT=new N,rT=new N,iT=new N,oT=new N;Xy.computeRhumbLineSubdivision=function(t,n,r,o){o=i(o,a.RADIANS_PER_DEGREE);var s,u=r.slice(0),c=n.length,l=new Array(3*c),h=0;for(s=0;s<c;s++){var d=n[s];l[h++]=d.x,l[h++]=d.y,l[h++]=d.z}for(var f=[],m={},_=t.maximumRadius,g=a.chordLength(o,_),v=new qy(void 0,void 0,t),y=new qy(void 0,void 0,t),T=new qy(void 0,void 0,t);u.length>0;){var E=u.pop(),x=u.pop(),C=u.pop(),S=p.fromArray(l,3*C,Zy),A=p.fromArray(l,3*x,Ky),w=p.fromArray(l,3*E,Qy),b=t.cartesianToCartographic(S,nT),D=t.cartesianToCartographic(A,rT),I=t.cartesianToCartographic(w,iT);v.setEndPoints(b,D);var R=v.surfaceDistance;y.setEndPoints(D,I);var P=y.surfaceDistance;T.setEndPoints(I,b);var O,N,M,L,F=T.surfaceDistance,z=Math.max(R,P,F);z>g?R===z?(e(s=m[O=Math.min(C,x)+" "+Math.max(C,x)])||(N=v.interpolateUsingFraction(.5,oT),M=.5*(b.height+D.height),L=p.fromRadians(N.longitude,N.latitude,M,t,tT),l.push(L.x,L.y,L.z),s=l.length/3-1,m[O]=s),u.push(C,s,E),u.push(s,x,E)):P===z?(e(s=m[O=Math.min(x,E)+" "+Math.max(x,E)])||(N=y.interpolateUsingFraction(.5,oT),M=.5*(D.height+I.height),L=p.fromRadians(N.longitude,N.latitude,M,t,tT),l.push(L.x,L.y,L.z),s=l.length/3-1,m[O]=s),u.push(x,s,C),u.push(s,E,C)):F===z&&(e(s=m[O=Math.min(E,C)+" "+Math.max(E,C)])||(N=T.interpolateUsingFraction(.5,oT),M=.5*(I.height+b.height),L=p.fromRadians(N.longitude,N.latitude,M,t,tT),l.push(L.x,L.y,L.z),s=l.length/3-1,m[O]=s),u.push(E,s,x),u.push(s,C,x)):(f.push(C),f.push(x),f.push(E))}return new cc({attributes:{position:new tp({componentDatatype:xn.DOUBLE,componentsPerAttribute:3,values:l})},indices:f,primitiveType:Rs.TRIANGLES})},Xy.scaleToGeodeticHeight=function(t,n,r,o){r=i(r,H.WGS84);var a=Yy,s=jy;if(n=i(n,0),o=i(o,!0),e(t))for(var u=t.length,c=0;c<u;c+=3)p.fromArray(t,c,s),o&&(s=r.scaleToGeodeticSurface(s,s)),0!==n&&(a=r.geodeticSurfaceNormal(s,a),p.multiplyByScalar(a,n,a),p.add(s,a,s)),t[c]=s.x,t[c+1]=s.y,t[c+2]=s.z;return t};var aT=Math.cos,sT=Math.sin,uT=Math.sqrt,cT={computePosition:function(t,n,r,i,o,a,s){var u=n.radiiSquared,c=t.nwCorner,l=t.boundingRectangle,h=c.latitude-t.granYCos*i+o*t.granXSin,d=aT(h),f=sT(h),m=u.z*f,p=c.longitude+i*t.granYSin+o*t.granXCos,_=d*aT(p),g=d*sT(p),v=u.x*_,y=u.y*g,T=uT(v*_+y*g+m*f);if(a.x=v/T,a.y=y/T,a.z=m/T,r){var E=t.stNwCorner;e(E)?(h=E.latitude-t.stGranYCos*i+o*t.stGranXSin,p=E.longitude+i*t.stGranYSin+o*t.stGranXCos,s.x=(p-t.stWest)*t.lonScalar,s.y=(h-t.stSouth)*t.latScalar):(s.x=(p-l.west)*t.lonScalar,s.y=(h-l.south)*t.latScalar)}}},lT=new uu,hT=new p,dT=new N,fT=new p,mT=new K;function pT(e,t,n,r,i,o,a){var s=Math.cos(t),u=r*s,c=n*s,l=Math.sin(t),h=r*l,d=n*l;hT=mT.project(e,hT),hT=p.subtract(hT,fT,hT);var f=uu.fromRotation(t,lT);hT=uu.multiplyByVector(f,hT,hT),hT=p.add(hT,fT,hT),o-=1,a-=1;var m=(e=mT.unproject(hT,e)).latitude,_=m+o*d,g=m-u*a,v=m-u*a+o*d,y=Math.max(m,_,g,v),T=Math.min(m,_,g,v),E=e.longitude,x=E+o*c,C=E+a*h,S=E+a*h+o*c;return{north:y,south:T,east:Math.max(E,x,C,S),west:Math.min(E,x,C,S),granYCos:u,granYSin:h,granXCos:c,granXSin:d,nwCorner:e}}cT.computeOptions=function(e,t,n,r,i,o,s){var u,c,l,h,d,f=e.east,m=e.west,p=e.north,_=e.south,g=!1,v=!1;p===a.PI_OVER_TWO&&(g=!0),_===-a.PI_OVER_TWO&&(v=!0);var y=p-_;l=(d=m>f?a.TWO_PI-m+f:f-m)/((u=Math.ceil(d/t)+1)-1),h=y/((c=Math.ceil(y/t)+1)-1);var T=Oe.northwest(e,o),E=Oe.center(e,dT);0===n&&0===r||(E.longitude<T.longitude&&(E.longitude+=a.TWO_PI),fT=mT.project(E,fT));var x=h,C=l,S=Oe.clone(e,i),A={granYCos:x,granYSin:0,granXCos:C,granXSin:0,nwCorner:T,boundingRectangle:S,width:u,height:c,northCap:g,southCap:v};if(0!==n){var w=pT(T,n,l,h,0,u,c);p=w.north,_=w.south,f=w.east,m=w.west,A.granYCos=w.granYCos,A.granYSin=w.granYSin,A.granXCos=w.granXCos,A.granXSin=w.granXSin,S.north=p,S.south=_,S.east=f,S.west=m}if(0!==r){n-=r;var b=Oe.northwest(S,s),D=pT(b,n,l,h,0,u,c);A.stGranYCos=D.granYCos,A.stGranXCos=D.granXCos,A.stGranYSin=D.granYSin,A.stGranXSin=D.granXSin,A.stNwCorner=b,A.stWest=D.west,A.stSouth=D.south}return A};var _T=new Me,gT=new Me,vT=new p,yT=new Oe;function TT(e,t){var n=e._ellipsoid,r=t.height,i=t.width,o=t.northCap,a=t.southCap,s=r,u=2,c=0,l=4;o&&(u-=1,s-=1,c+=1,l-=2),a&&(u-=1,s-=1,c+=1,l-=2),c+=u*i+2*s-l;var h,d=new Float64Array(3*c),f=0,m=0,p=vT;if(o)cT.computePosition(t,n,!1,m,0,p),d[f++]=p.x,d[f++]=p.y,d[f++]=p.z;else for(h=0;h<i;h++)cT.computePosition(t,n,!1,m,h,p),d[f++]=p.x,d[f++]=p.y,d[f++]=p.z;for(h=i-1,m=1;m<r;m++)cT.computePosition(t,n,!1,m,h,p),d[f++]=p.x,d[f++]=p.y,d[f++]=p.z;if(m=r-1,!a)for(h=i-2;h>=0;h--)cT.computePosition(t,n,!1,m,h,p),d[f++]=p.x,d[f++]=p.y,d[f++]=p.z;for(h=0,m=r-2;m>0;m--)cT.computePosition(t,n,!1,m,h,p),d[f++]=p.x,d[f++]=p.y,d[f++]=p.z;for(var _=d.length/3*2,g=Dn.createTypedArray(d.length/3,_),v=0,y=0;y<d.length/3-1;y++)g[v++]=y,g[v++]=y+1;g[v++]=d.length/3-1,g[v++]=0;var T=new cc({attributes:new np,primitiveType:Rs.LINES});return T.attributes.position=new tp({componentDatatype:xn.DOUBLE,componentsPerAttribute:3,values:d}),T.indices=g,T}function ET(e){var t=(e=i(e,i.EMPTY_OBJECT)).rectangle,n=i(e.granularity,a.RADIANS_PER_DEGREE),r=i(e.ellipsoid,H.WGS84),o=i(e.rotation,0),s=i(e.height,0),u=i(e.extrudedHeight,s);this._rectangle=Oe.clone(t),this._granularity=n,this._ellipsoid=r,this._surfaceHeight=Math.max(s,u),this._rotation=o,this._extrudedHeight=Math.min(s,u),this._offsetAttribute=e.offsetAttribute,this._workerName="createRectangleOutlineGeometry"}ET.packedLength=Oe.packedLength+H.packedLength+5,ET.pack=function(e,t,n){return n=i(n,0),Oe.pack(e._rectangle,t,n),n+=Oe.packedLength,H.pack(e._ellipsoid,t,n),n+=H.packedLength,t[n++]=e._granularity,t[n++]=e._surfaceHeight,t[n++]=e._rotation,t[n++]=e._extrudedHeight,t[n]=i(e._offsetAttribute,-1),t};var xT=new Oe,CT=H.clone(H.UNIT_SPHERE),ST={rectangle:xT,ellipsoid:CT,granularity:void 0,height:void 0,rotation:void 0,extrudedHeight:void 0,offsetAttribute:void 0};ET.unpack=function(t,n,r){n=i(n,0);var o=Oe.unpack(t,n,xT);n+=Oe.packedLength;var a=H.unpack(t,n,CT);n+=H.packedLength;var s=t[n++],u=t[n++],c=t[n++],l=t[n++],h=t[n];return e(r)?(r._rectangle=Oe.clone(o,r._rectangle),r._ellipsoid=H.clone(a,r._ellipsoid),r._surfaceHeight=u,r._rotation=c,r._extrudedHeight=l,r._offsetAttribute=-1===h?void 0:h,r):(ST.granularity=s,ST.height=u,ST.rotation=c,ST.extrudedHeight=l,ST.offsetAttribute=-1===h?void 0:h,new ET(ST))};var AT=new N;function wT(e){this.rectangle=Oe.clone(e.rectangle),this.minimumHeight=i(e.minimumHeight,0),this.maximumHeight=i(e.maximumHeight,0),this.southwestCornerCartesian=new p,this.northeastCornerCartesian=new p,this.westNormal=new p,this.southNormal=new p,this.eastNormal=new p,this.northNormal=new p;var t=i(e.ellipsoid,H.WGS84);!function(e,t,n){n.cartographicToCartesian(Oe.southwest(t),e.southwestCornerCartesian),n.cartographicToCartesian(Oe.northeast(t),e.northeastCornerCartesian),NT.longitude=t.west,NT.latitude=.5*(t.south+t.north),NT.height=0;var r=n.cartographicToCartesian(NT,PT),i=p.cross(r,p.UNIT_Z,bT);p.normalize(i,e.westNormal),NT.longitude=t.east;var o=n.cartographicToCartesian(NT,OT),a=p.cross(p.UNIT_Z,o,bT);p.normalize(a,e.eastNormal);var s,u=p.subtract(r,o,bT),c=p.normalize(u,RT),l=t.south;if(l>0){NT.longitude=.5*(t.west+t.east),NT.latitude=l;var h=n.cartographicToCartesian(NT,LT.origin);p.clone(c,LT.direction);var d=mr.fromPointNormal(e.southwestCornerCartesian,e.westNormal,MT);zn.rayPlane(LT,d,e.southwestCornerCartesian),s=n.geodeticSurfaceNormal(h,DT)}else s=n.geodeticSurfaceNormalCartographic(Oe.southeast(t),DT);var f=p.cross(s,u,IT);p.normalize(f,e.southNormal);var m,_=t.north;if(_<0){NT.longitude=.5*(t.west+t.east),NT.latitude=_;var g=n.cartographicToCartesian(NT,LT.origin);p.negate(c,LT.direction);var v=mr.fromPointNormal(e.northeastCornerCartesian,e.eastNormal,MT);zn.rayPlane(LT,v,e.northeastCornerCartesian),m=n.geodeticSurfaceNormal(g,DT)}else m=n.geodeticSurfaceNormalCartographic(Oe.northwest(t),DT);var y=p.cross(u,m,IT);p.normalize(y,e.northNormal)}(this,e.rectangle,t),i(e.computeBoundingVolumes,!0)&&(this._orientedBoundingBox=mf.fromRectangle(this.rectangle,this.minimumHeight,this.maximumHeight,t),this._boundingSphere=Me.fromOrientedBoundingBox(this._orientedBoundingBox))}ET.createGeometry=function(t){var n,r,i=t._rectangle,o=t._ellipsoid,s=cT.computeOptions(i,t._granularity,t._rotation,0,yT,AT);if(!a.equalsEpsilon(i.north,i.south,a.EPSILON10)&&!a.equalsEpsilon(i.east,i.west,a.EPSILON10)){var u=t._surfaceHeight,c=t._extrudedHeight;if(!a.equalsEpsilon(u,c,0,a.EPSILON2)){if(n=function(e,t){var n=e._surfaceHeight,r=e._extrudedHeight,i=e._ellipsoid,o=r,a=n,s=TT(e,t),u=t.height,c=t.width,l=Xy.scaleToGeodeticHeight(s.attributes.position.values,a,i,!1),h=l.length,d=new Float64Array(2*h);d.set(l);var f=Xy.scaleToGeodeticHeight(s.attributes.position.values,o,i);d.set(f,h),s.attributes.position.values=d;var m=t.northCap,p=t.southCap,_=4;m&&(_-=1),p&&(_-=1);var g=2*(d.length/3+_),v=Dn.createTypedArray(d.length/3,g);h=d.length/6;for(var y,T=0,E=0;E<h-1;E++)v[T++]=E,v[T++]=E+1,v[T++]=E+h,v[T++]=E+h+1;if(v[T++]=h-1,v[T++]=0,v[T++]=h+h-1,v[T++]=h,v[T++]=0,v[T++]=h,m)y=u-1;else{var x=c-1;v[T++]=x,v[T++]=x+h,y=c+u-2}if(v[T++]=y,v[T++]=y+h,!p){var C=c+y-1;v[T++]=C,v[T]=C+h}return s.indices=v,s}(t,s),e(t._offsetAttribute)){var l=n.attributes.position.values.length/3,h=new Uint8Array(l);h=t._offsetAttribute===rp.TOP?ep(h,1,0,l/2):ep(h,t._offsetAttribute===rp.NONE?0:1),n.attributes.applyOffset=new tp({componentDatatype:xn.UNSIGNED_BYTE,componentsPerAttribute:1,values:h})}var d=Me.fromRectangle3D(i,o,u,gT),f=Me.fromRectangle3D(i,o,c,_T);r=Me.union(d,f)}else{if((n=TT(t,s)).attributes.position.values=Xy.scaleToGeodeticHeight(n.attributes.position.values,u,o,!1),e(t._offsetAttribute)){var m=n.attributes.position.values.length,p=new Uint8Array(m/3);ep(p,t._offsetAttribute===rp.NONE?0:1),n.attributes.applyOffset=new tp({componentDatatype:xn.UNSIGNED_BYTE,componentsPerAttribute:1,values:p})}r=Me.fromRectangle3D(i,o,u)}return new cc({attributes:n.attributes,indices:n.indices,primitiveType:Rs.LINES,boundingSphere:r,offsetAttribute:t._offsetAttribute})}},Object.defineProperties(wT.prototype,{boundingVolume:{get:function(){return this._orientedBoundingBox}},boundingSphere:{get:function(){return this._boundingSphere}}});var bT=new p,DT=new p,IT=new p,RT=new p,PT=new p,OT=new p,NT=new N,MT=new mr(p.UNIT_X,0),LT=new Fn;var FT=new p,zT=new p,BT=new p(0,-1,0),UT=new p(0,0,-1),VT=new p;function HT(e){this.lightingFadeOutDistance=65e5,this.lightingFadeInDistance=9e6,this.hasWaterMask=!1,this.oceanNormalMap=void 0,this.zoomedOutOceanSpecularIntensity=.5,this.enableLighting=!1,this.dynamicAtmosphereLighting=!1,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!1,this.shadows=Fg.RECEIVE_ONLY,this.fillHighlightColor=void 0,this.hueShift=0,this.saturationShift=0,this.brightnessShift=0,this.showSkirts=!0,this.backFaceCulling=!0,this.undergroundColor=void 0,this.undergroundColorAlphaByDistance=void 0,this.materialUniformMap=void 0,this._materialUniformMap=void 0,this._quadtree=void 0,this._terrainProvider=e.terrainProvider,this._imageryLayers=e.imageryLayers,this._surfaceShaderSet=e.surfaceShaderSet,this._renderState=void 0,this._blendRenderState=void 0,this._disableCullingRenderState=void 0,this._disableCullingBlendRenderState=void 0,this._errorEvent=new qo,this._imageryLayers.layerAdded.addEventListener(HT.prototype._onLayerAdded,this),this._imageryLayers.layerRemoved.addEventListener(HT.prototype._onLayerRemoved,this),this._imageryLayers.layerMoved.addEventListener(HT.prototype._onLayerMoved,this),this._imageryLayers.layerShownOrHidden.addEventListener(HT.prototype._onLayerShownOrHidden,this),this._imageryLayersUpdatedEvent=new qo,this._layerOrderChanged=!1,this._tilesToRenderByTextureCount=[],this._drawCommands=[],this._uniformMaps=[],this._usedDrawCommands=0,this._vertexArraysToDestroy=[],this._debug={wireframe:!1,boundingSphereTile:void 0},this._baseColor=void 0,this._firstPassInitialColor=void 0,this.baseColor=new pn(0,0,.5,1),this._clippingPlanes=void 0,this.cartographicLimitRectangle=Oe.clone(Oe.MAX_VALUE),this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1}function GT(t,n){var r=t.loadingImagery;e(r)||(r=t.readyImagery);var i=n.loadingImagery;return e(i)||(i=n.readyImagery),r.imageryLayer._layerIndex-i.imageryLayer._layerIndex}function kT(e,t){var n=t.globeTranslucencyState;if(n.translucent){var r=e.renderState.blending.enabled;n.pushDerivedCommands(e,r,t)}else t.commandList.push(e)}wT.prototype.distanceToCamera=function(e){var t,n,r,i=e.camera,o=i.positionWC,a=i.positionCartographic,s=0;if(!Oe.contains(this.rectangle,a)){var u=this.southwestCornerCartesian,c=this.northeastCornerCartesian,l=this.westNormal,h=this.southNormal,d=this.eastNormal,f=this.northNormal;e.mode!==Al.SCENE3D&&((u=e.mapProjection.project(Oe.southwest(this.rectangle),FT)).z=u.y,u.y=u.x,u.x=0,(c=e.mapProjection.project(Oe.northeast(this.rectangle),zT)).z=c.y,c.y=c.x,c.x=0,l=BT,d=p.UNIT_Y,h=UT,f=p.UNIT_Z);var m=p.subtract(o,u,VT),_=p.dot(m,l),g=p.dot(m,h),v=p.subtract(o,c,VT),y=p.dot(v,d),T=p.dot(v,f);_>0?s+=_*_:y>0&&(s+=y*y),g>0?s+=g*g:T>0&&(s+=T*T)}if(e.mode===Al.SCENE3D?(t=a.height,n=this.minimumHeight,r=this.maximumHeight):(t=o.x,n=0,r=0),t>r){var E=t-r;s+=E*E}else if(t<n){var x=n-t;s+=x*x}return Math.sqrt(s)},wT.prototype.intersectPlane=function(e){return this._orientedBoundingBox.intersectPlane(e)},wT.prototype.createDebugVolume=function(e){var t=new ye.clone(ye.IDENTITY);return new zg({geometryInstances:new lp({geometry:new ET({rectangle:this.rectangle,height:this.minimumHeight,extrudedHeight:this.maximumHeight}),id:"outline",modelMatrix:t,attributes:{color:cp.fromColor(e)}}),appearance:new gg({translucent:!1,flat:!0}),asynchronous:!1})},Object.defineProperties(HT.prototype,{baseColor:{get:function(){return this._baseColor},set:function(e){this._baseColor=e,this._firstPassInitialColor=le.fromColor(e,this._firstPassInitialColor)}},quadtree:{get:function(){return this._quadtree},set:function(e){this._quadtree=e}},ready:{get:function(){return this._terrainProvider.ready&&(0===this._imageryLayers.length||this._imageryLayers.get(0).imageryProvider.ready)}},tilingScheme:{get:function(){return this._terrainProvider.tilingScheme}},errorEvent:{get:function(){return this._errorEvent}},imageryLayersUpdatedEvent:{get:function(){return this._imageryLayersUpdatedEvent}},terrainProvider:{get:function(){return this._terrainProvider},set:function(t){this._terrainProvider!==t&&(this._terrainProvider=t,e(this._quadtree)&&this._quadtree.invalidateAllTiles())}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){Bm.setOwner(e,this,"_clippingPlanes")}}}),HT.prototype.update=function(e){this._imageryLayers._update()},HT.prototype.initialize=function(t){this._imageryLayers.queueReprojectionCommands(t),this._layerOrderChanged&&(this._layerOrderChanged=!1,this._quadtree.forEachLoadedTile((function(e){e.data.imagery.sort(GT)}))),function(t,n){var r=n.creditDisplay;t._terrainProvider.ready&&e(t._terrainProvider.credit)&&r.addCredit(t._terrainProvider.credit);for(var i=t._imageryLayers,o=0,a=i.length;o<a;++o){var s=i.get(o).imageryProvider;s.ready&&e(s.credit)&&r.addCredit(s.credit)}}(this,t);for(var n=this._vertexArraysToDestroy,r=n.length,i=0;i<r;++i)j_._freeVertexArray(n[i]);n.length=0},HT.prototype.beginUpdate=function(t){for(var n=this._tilesToRenderByTextureCount,r=0,i=n.length;r<i;++r){var o=n[r];e(o)&&(o.length=0)}var a=this._clippingPlanes;e(a)&&a.enabled&&a.update(t),this._usedDrawCommands=0,this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1},HT.prototype.endUpdate=function(t){if(!e(this._renderState)){this._renderState=Us.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:G_.LESS}}),this._blendRenderState=Us.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:G_.LESS_OR_EQUAL},blending:Eh.ALPHA_BLEND});var n=Oo(this._renderState,!0);n.cull.enabled=!1,this._disableCullingRenderState=Us.fromCache(n),(n=Oo(this._blendRenderState,!0)).cull.enabled=!1,this._disableCullingBlendRenderState=Us.fromCache(n)}this._hasFillTilesThisFrame&&this._hasLoadedTilesThisFrame&&Ov.updateFillTiles(this,this._quadtree._tilesToRender,t,this._vertexArraysToDestroy);for(var r=this._tilesToRenderByTextureCount,i=0,o=r.length;i<o;++i){var a=r[i];if(e(a))for(var s=0,u=a.length;s<u;++s){var c=a[s],l=c.data.tileBoundingRegion;TE(this,c,t),t.minimumTerrainHeight=Math.min(t.minimumTerrainHeight,l.minimumHeight)}}},HT.prototype.updateForPick=function(e){for(var t=this._drawCommands,n=0,r=this._usedDrawCommands;n<r;++n)kT(t[n],e)},HT.prototype.cancelReprojections=function(){this._imageryLayers.cancelReprojections()},HT.prototype.getLevelMaximumGeometricError=function(e){return this._terrainProvider.getLevelMaximumGeometricError(e)},HT.prototype.loadTile=function(t,n){var r,i=n.data,o=!0;e(i)&&(o=i.boundingVolumeSourceTile!==n||n._lastSelectionResult===Pv.CULLED_BUT_NEEDED,r=i.terrainState),j_.processStateMachine(n,t,this.terrainProvider,this._imageryLayers,this._vertexArraysToDestroy,o),i=n.data,o&&r!==n.data.terrainState&&this.computeTileVisibility(n,t,this.quadtree.occluders)!==V_.NONE&&i.boundingVolumeSourceTile===n&&(o=!1,j_.processStateMachine(n,t,this.terrainProvider,this._imageryLayers,this._vertexArraysToDestroy,o))};var WT=new Me,qT=new Oe,YT=new Oe,jT=new N;function XT(e,t){if(t.west<t.east)return t;var n=Oe.clone(t,YT);return Oe.center(e,jT).longitude>0?n.east=a.PI:n.west=-a.PI,n}function ZT(t,n){if(n.cameraUnderground)return!0;if(n.globeTranslucencyState.translucent)return!0;if(t.backFaceCulling)return!1;var r=t._clippingPlanes;return!(!e(r)||!r.enabled)||!Oe.equals(t.cartographicLimitRectangle,Oe.MAX_VALUE)}HT.prototype.computeTileVisibility=function(t,n,r){var i=this.computeDistanceToTile(t,n);t._distance=i;var o=ZT(this,n);if(n.fog.enabled&&!o&&a.fog(i,n.fog.density)>=1)return V_.NONE;var s=t.data,u=s.tileBoundingRegion;if(void 0===s.boundingVolumeSourceTile)return V_.PARTIAL;var c=n.cullingVolume,l=s.orientedBoundingBox;!e(l)&&e(s.renderedMesh)&&(l=s.renderedMesh.boundingSphere3D),s.clippedByBoundaries=!1;var h=XT(t.rectangle,this.cartographicLimitRectangle),d=Oe.simpleIntersection(h,t.rectangle,qT);if(!e(d))return V_.NONE;if(Oe.equals(d,t.rectangle)||(s.clippedByBoundaries=!0),n.mode!==Al.SCENE3D&&(l=WT,Me.fromRectangleWithHeights2D(t.rectangle,n.mapProjection,u.minimumHeight,u.maximumHeight,l),p.fromElements(l.center.z,l.center.x,l.center.y,l.center),n.mode===Al.MORPHING&&e(s.renderedMesh)&&(l=Me.union(s.renderedMesh.boundingSphere3D,l,l))),!e(l))return V_.PARTIAL;var f,m=this._clippingPlanes;if(e(m)&&m.enabled){var _=m.computeIntersectionWithBoundingVolume(l);if(t.isClipped=_!==Q.INSIDE,_===Q.OUTSIDE)return V_.NONE}var g=c.computeVisibility(l);if(g===Q.OUTSIDE?f=V_.NONE:g===Q.INTERSECTING?f=V_.PARTIAL:g===Q.INSIDE&&(f=V_.FULL),f===V_.NONE)return f;var v=n.mode===Al.SCENE3D&&n.camera.frustum instanceof Pr;if(n.mode===Al.SCENE3D&&!v&&e(r)&&!o){var y=s.occludeePointInScaledSpace;return e(y)?r.ellipsoid.isScaledSpacePointVisiblePossiblyUnderEllipsoid(y,u.minimumHeight)?f:V_.NONE:f}return f},HT.prototype.canRefine=function(t){return!!e(t.data.terrainData)||void 0!==this.terrainProvider.getTileDataAvailable(2*t.x,2*t.y,t.level+1)};var KT=[],QT=[];HT.prototype.canRenderWithoutLosingDetail=function(t,n){var r=t.data,i=KT;i.length=this._imageryLayers.length;var o,a,s,u=!1,c=!1;for(e(r)&&(u=r.terrainState===Y_.READY,c=!0,o=r.imagery),a=0,s=i.length;a<s;++a)i[a]=c;if(e(o))for(a=0,s=o.length;a<s;++a){var l=o[a],h=l.loadingImagery,d=!e(h)||h.state===W_.FAILED||h.state===W_.INVALID,f=(l.loadingImagery||l.readyImagery).imageryLayer._layerIndex;i[f]=d&&i[f]}var m=this.quadtree._lastSelectionFrameNumber,p=QT;for(p.length=0,p.push(t.southwestChild,t.southeastChild,t.northwestChild,t.northeastChild);p.length>0;){var _=p.pop(),g=_._lastSelectionResultFrame===m?_._lastSelectionResult:Pv.NONE;if(g===Pv.RENDERED){if(!e(_.data))continue;if(!u&&_.data.terrainState===Y_.READY)return!1;var v=_.data.imagery;for(a=0,s=v.length;a<s;++a){var y=v[a],T=y.loadingImagery,E=!e(T)||T.state===W_.FAILED||T.state===W_.INVALID,x=(y.loadingImagery||y.readyImagery).imageryLayer._layerIndex;if(E&&!i[x])return!1}}else g===Pv.REFINED&&p.push(_.southwestChild,_.southeastChild,_.northwestChild,_.northeastChild)}return!0};var JT=new p;HT.prototype.computeTileLoadPriority=function(e,t){var n=e.data;if(void 0===n)return 0;var r=n.orientedBoundingBox;if(void 0===r)return 0;var i=t.camera.positionWC,o=t.camera.directionWC,s=p.subtract(r.center,i,JT),u=p.magnitude(s);return u<a.EPSILON5?0:(p.divideByScalar(s,u,s),(1-p.dot(s,o))*e._distance)};var $T=new ye,eE=new ye,tE=new le,nE=new le,rE=new le,iE=new p,oE=new p,aE=new p,sE=new p;HT.prototype.showTileThisFrame=function(t,n){for(var r=0,i=t.data.imagery,o=0,a=i.length;o<a;++o){var s=i[o];e(s.readyImagery)&&0!==s.readyImagery.imageryLayer.alpha&&++r}var u=this._tilesToRenderByTextureCount[r];e(u)||(u=[],this._tilesToRenderByTextureCount[r]=u),u.push(t),e(t.data.vertexArray)?this._hasLoadedTilesThisFrame=!0:this._hasFillTilesThisFrame=!0;var c=this._debug;++c.tilesRendered,c.texturesRendered+=r};var uE=[new p,new p,new p,new p];HT.prototype.computeDistanceToTile=function(t,n){var r=function(e,t,n){var r=e.data;void 0===r&&(r=e.data=new j_);void 0===r.tileBoundingRegion&&(r.tileBoundingRegion=new wT({computeBoundingVolumes:!1,rectangle:e.rectangle,ellipsoid:e.tilingScheme.ellipsoid,minimumHeight:0,maximumHeight:0}));var i=r.terrainData,o=r.mesh,a=r.tileBoundingRegion;if(void 0!==o&&void 0!==o.minimumHeight&&void 0!==o.maximumHeight)return a.minimumHeight=o.minimumHeight,a.maximumHeight=o.maximumHeight,e;if(void 0!==i&&void 0!==i._minimumHeight&&void 0!==i._maximumHeight)return a.minimumHeight=i._minimumHeight*n.terrainExaggeration,a.maximumHeight=i._maximumHeight*n.terrainExaggeration,e;a.minimumHeight=Number.NaN,a.maximumHeight=Number.NaN;var s=e.parent;for(;void 0!==s;){var u=s.data;if(void 0!==u){var c=u.mesh;if(void 0!==c&&void 0!==c.minimumHeight&&void 0!==c.maximumHeight)return a.minimumHeight=c.minimumHeight,a.maximumHeight=c.maximumHeight,s;var l=u.terrainData;if(void 0!==l&&void 0!==l._minimumHeight&&void 0!==l._maximumHeight)return a.minimumHeight=l._minimumHeight*n.terrainExaggeration,a.maximumHeight=l._maximumHeight*n.terrainExaggeration,s}s=s.parent}return}(t,this.terrainProvider,n),i=t.data,o=i.tileBoundingRegion;if(void 0===r)return 9999999999;i.boundingVolumeSourceTile!==r&&(i.boundingVolumeSourceTile=r,e(t.rectangle)&&(i.orientedBoundingBox=mf.fromRectangle(t.rectangle,o.minimumHeight,o.maximumHeight,t.tilingScheme.ellipsoid,i.orientedBoundingBox),i.occludeePointInScaledSpace=function(e,t,n,r,i,o){var a=e.quadtree._occluders.ellipsoid,s=a.ellipsoid,u=uE;return p.fromRadians(n.west,n.south,i,s,u[0]),p.fromRadians(n.east,n.south,i,s,u[1]),p.fromRadians(n.west,n.north,i,s,u[2]),p.fromRadians(n.east,n.north,i,s,u[3]),a.computeHorizonCullingPointPossiblyUnderEllipsoid(t,u,r,o)}(this,i.orientedBoundingBox.center,t.rectangle,o.minimumHeight,o.maximumHeight,i.occludeePointInScaledSpace)));var a=o.minimumHeight,s=o.maximumHeight;if(i.boundingVolumeSourceTile!==t){var u=n.camera.positionCartographic.height;Math.abs(u-a)>Math.abs(u-s)?(o.minimumHeight=a,o.maximumHeight=a):(o.minimumHeight=s,o.maximumHeight=s)}var c=o.distanceToCamera(n);return o.minimumHeight=a,o.maximumHeight=s,c},HT.prototype.isDestroyed=function(){return!1},HT.prototype.destroy=function(){return this._tileProvider=this._tileProvider&&this._tileProvider.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),hi(this)},HT.prototype._onLayerAdded=function(t,n){if(t.show){var r=this._terrainProvider,o=this,a=t.imageryProvider,s=this._imageryLayersUpdatedEvent;a._reload=function(){t._imageryCache={},o._quadtree.forEachLoadedTile((function(n){if(!e(n._loadedCallbacks[t._layerIndex])){var o,a=n.data.imagery,s=a.length,u=-1,c=0;for(o=0;o<s;++o){var l=a[o];if(i(l.readyImagery,l.loadingImagery).imageryLayer===t)-1===u&&(u=o),++c;else if(-1!==u)break}if(-1!==u){var h=u+c;t._createTileImagerySkeletons(n,r,h)&&(n._loadedCallbacks[t._layerIndex]=function(t,n,r){return function(o){var a,s,u,c=-1,l=o.data.imagery,h=l.length;for(u=0;u<h;++u)if((s=i((a=l[u]).readyImagery,a.loadingImagery)).imageryLayer===n){c=u;break}if(-1!==c){var d=c+t;if(s=e(a=l[d])?i(a.readyImagery,a.loadingImagery):void 0,!e(s)||s.imageryLayer!==n)return!n._createTileImagerySkeletons(o,r,d);for(u=c;u<d;++u)l[u].freeResources();l.splice(c,t)}return!0}}(c,t,r),n.state=q_.LOADING)}}}))},this._quadtree.forEachLoadedTile((function(e){t._createTileImagerySkeletons(e,r)&&(e.state=q_.LOADING,0===e.level||e._lastSelectionResultFrame===o.quadtree._lastSelectionFrameNumber&&e._lastSelectionResult===Pv.RENDERED||(e.renderable=!1))})),this._layerOrderChanged=!0,s.raiseEvent()}},HT.prototype._onLayerRemoved=function(t,n){this._quadtree.forEachLoadedTile((function(n){for(var r=n.data.imagery,i=-1,o=0,a=0,s=r.length;a<s;++a){var u=r[a],c=u.loadingImagery;if(e(c)||(c=u.readyImagery),c.imageryLayer===t)-1===i&&(i=a),u.freeResources(),++o;else if(-1!==i)break}-1!==i&&r.splice(i,o)})),e(t.imageryProvider)&&(t.imageryProvider._reload=void 0),this._imageryLayersUpdatedEvent.raiseEvent()},HT.prototype._onLayerMoved=function(e,t,n){this._layerOrderChanged=!0,this._imageryLayersUpdatedEvent.raiseEvent()},HT.prototype._onLayerShownOrHidden=function(e,t,n){n?this._onLayerAdded(e,t):this._onLayerRemoved(e,t)};var cE,lE,hE,dE=new ye,fE=new ye;function mE(t,n){var r={u_initialColor:function(){return this.properties.initialColor},u_fillHighlightColor:function(){return this.properties.fillHighlightColor},u_zoomedOutOceanSpecularIntensity:function(){return this.properties.zoomedOutOceanSpecularIntensity},u_oceanNormalMap:function(){return this.properties.oceanNormalMap},u_lightingFadeDistance:function(){return this.properties.lightingFadeDistance},u_nightFadeDistance:function(){return this.properties.nightFadeDistance},u_center3D:function(){return this.properties.center3D},u_tileRectangle:function(){return this.properties.tileRectangle},u_modifiedModelView:function(){var e=t.context.uniformState.view,n=ye.multiplyByPoint(e,this.properties.rtc,oE);return ye.setTranslation(e,n,$T),$T},u_modifiedModelViewProjection:function(){var e=t.context.uniformState.view,n=t.context.uniformState.projection,r=ye.multiplyByPoint(e,this.properties.rtc,oE);return ye.setTranslation(e,r,eE),ye.multiply(n,eE,eE),eE},u_dayTextures:function(){return this.properties.dayTextures},u_dayTextureTranslationAndScale:function(){return this.properties.dayTextureTranslationAndScale},u_dayTextureTexCoordsRectangle:function(){return this.properties.dayTextureTexCoordsRectangle},u_dayTextureUseWebMercatorT:function(){return this.properties.dayTextureUseWebMercatorT},u_dayTextureAlpha:function(){return this.properties.dayTextureAlpha},u_dayTextureNightAlpha:function(){return this.properties.dayTextureNightAlpha},u_dayTextureDayAlpha:function(){return this.properties.dayTextureDayAlpha},u_dayTextureBrightness:function(){return this.properties.dayTextureBrightness},u_dayTextureContrast:function(){return this.properties.dayTextureContrast},u_dayTextureHue:function(){return this.properties.dayTextureHue},u_dayTextureSaturation:function(){return this.properties.dayTextureSaturation},u_dayTextureOneOverGamma:function(){return this.properties.dayTextureOneOverGamma},u_dayIntensity:function(){return this.properties.dayIntensity},u_southAndNorthLatitude:function(){return this.properties.southAndNorthLatitude},u_southMercatorYAndOneOverHeight:function(){return this.properties.southMercatorYAndOneOverHeight},u_waterMask:function(){return this.properties.waterMask},u_waterMaskTranslationAndScale:function(){return this.properties.waterMaskTranslationAndScale},u_minMaxHeight:function(){return this.properties.minMaxHeight},u_scaleAndBias:function(){return this.properties.scaleAndBias},u_dayTextureSplit:function(){return this.properties.dayTextureSplit},u_dayTextureCutoutRectangles:function(){return this.properties.dayTextureCutoutRectangles},u_clippingPlanes:function(){var r=n._clippingPlanes;return e(r)&&e(r.texture)?r.texture:t.context.defaultTexture},u_cartographicLimitRectangle:function(){return this.properties.localizedCartographicLimitRectangle},u_clippingPlanesMatrix:function(){var r=n._clippingPlanes,i=e(r)?ye.multiply(t.context.uniformState.view,r.modelMatrix,dE):ye.IDENTITY;return ye.inverseTranspose(i,fE)},u_clippingPlanesEdgeStyle:function(){var e=this.properties.clippingPlanesEdgeColor;return e.alpha=this.properties.clippingPlanesEdgeWidth,e},u_minimumBrightness:function(){return t.fog.minimumBrightness},u_hsbShift:function(){return this.properties.hsbShift},u_colorsToAlpha:function(){return this.properties.colorsToAlpha},u_frontFaceAlphaByDistance:function(){return this.properties.frontFaceAlphaByDistance},u_backFaceAlphaByDistance:function(){return this.properties.backFaceAlphaByDistance},u_translucencyRectangle:function(){return this.properties.localizedTranslucencyRectangle},u_undergroundColor:function(){return this.properties.undergroundColor},u_undergroundColorAlphaByDistance:function(){return this.properties.undergroundColorAlphaByDistance},properties:{initialColor:new le(0,0,.5,1),fillHighlightColor:new pn(0,0,0,0),zoomedOutOceanSpecularIntensity:.5,oceanNormalMap:void 0,lightingFadeDistance:new c(65e5,9e6),nightFadeDistance:new c(1e7,4e7),hsbShift:new p,center3D:void 0,rtc:new p,modifiedModelView:new ye,tileRectangle:new le,dayTextures:[],dayTextureTranslationAndScale:[],dayTextureTexCoordsRectangle:[],dayTextureUseWebMercatorT:[],dayTextureAlpha:[],dayTextureNightAlpha:[],dayTextureDayAlpha:[],dayTextureBrightness:[],dayTextureContrast:[],dayTextureHue:[],dayTextureSaturation:[],dayTextureOneOverGamma:[],dayTextureSplit:[],dayTextureCutoutRectangles:[],dayIntensity:0,colorsToAlpha:[],southAndNorthLatitude:new c,southMercatorYAndOneOverHeight:new c,waterMask:void 0,waterMaskTranslationAndScale:new le,minMaxHeight:new c,scaleAndBias:new ye,clippingPlanesEdgeColor:pn.clone(pn.WHITE),clippingPlanesEdgeWidth:0,localizedCartographicLimitRectangle:new le,frontFaceAlphaByDistance:new le,backFaceAlphaByDistance:new le,localizedTranslucencyRectangle:new le,undergroundColor:pn.clone(pn.TRANSPARENT),undergroundColorAlphaByDistance:new le}};return e(n.materialUniformMap)?No(r,n.materialUniformMap):r}function pE(t,n,r){var i,o,a=r.data;if(e(a.vertexArray)?(i=a.mesh,o=a.vertexArray):e(a.fill)&&e(a.fill.vertexArray)&&(i=a.fill.mesh,o=a.fill.vertexArray),e(i)&&e(o)){if(e(a.wireframeVertexArray)){if(a.wireframeVertexArray.mesh===i)return;a.wireframeVertexArray.destroy(),a.wireframeVertexArray=void 0}a.wireframeVertexArray=function(e,t,n){var r={indices:n.indices,primitiveType:Rs.TRIANGLES};pp.toWireframe(r);var i=r.indices,o=bs.createIndexBuffer({context:e,typedArray:i,usage:ws.STATIC_DRAW,indexDatatype:Dn.fromSizeInBytes(i.BYTES_PER_ELEMENT)});return new xc({context:e,attributes:t._attributes,indexBuffer:o})}(t,o,i),a.wireframeVertexArray.mesh=i}}!function(){var t,n,r=new lp({geometry:op.fromDimensions({dimensions:new p(2,2,2)})}),i=new lp({geometry:new z_({radius:1})}),o=new ye;function a(e){return new zg({geometryInstances:e,appearance:new gg({translucent:!1,flat:!0}),asynchronous:!1})}cE=function(e,i){return e===t?n:(hE(),t=e,o=ye.fromRotationTranslation(e.halfAxes,e.center,o),r.modelMatrix=o,r.attributes.color=cp.fromColor(i),n=a(r))},lE=function(e,r){return e===t?n:(hE(),t=e,o=ye.fromTranslation(e.center,o),o=ye.multiplyByUniformScale(o,e.radius,o),i.modelMatrix=o,i.attributes.color=cp.fromColor(r),n=a(i))},hE=function(){e(n)&&(n.destroy(),n=void 0,t=void 0)}}();var _E=new le(0,0,0,0),gE={frameState:void 0,surfaceTile:void 0,numberOfDayTextures:void 0,applyBrightness:void 0,applyContrast:void 0,applyHue:void 0,applySaturation:void 0,applyGamma:void 0,applyAlpha:void 0,applyDayNightAlpha:void 0,applySplit:void 0,showReflectiveOcean:void 0,showOceanWaves:void 0,enableLighting:void 0,dynamicAtmosphereLighting:void 0,dynamicAtmosphereLightingFromSun:void 0,showGroundAtmosphere:void 0,perFragmentGroundAtmosphere:void 0,hasVertexNormals:void 0,useWebMercatorProjection:void 0,enableFog:void 0,enableClippingPlanes:void 0,clippingPlanes:void 0,clippedByBoundaries:void 0,hasImageryLayerCutout:void 0,colorCorrect:void 0,colorToAlpha:void 0},vE=pn.TRANSPARENT,yE=new fr;function TE(t,n,r){var o=n.data;e(o.vertexArray)||(void 0===o.fill&&(o.fill=new Ov(n)),o.fill.update(t,r));var s=r.creditDisplay,u=o.terrainData;if(e(u)&&e(u.credits))for(var c=u.credits,l=0,h=c.length;l<h;++l)s.addCredit(c[l]);var d=Ds.maximumTextureImageUnits,f=o.waterMaskTexture,m=o.waterMaskTranslationAndScale;!e(f)&&e(o.fill)&&(f=o.fill.waterMaskTexture,m=o.fill.waterMaskTranslationAndScale);var _=r.cameraUnderground,g=r.globeTranslucencyState,v=g.translucent,y=g.frontFaceAlphaByDistance,T=g.backFaceAlphaByDistance,E=g.rectangle,x=i(t.undergroundColor,vE),C=i(t.undergroundColorAlphaByDistance,yE),S=ZT(t,r)&&r.mode===Al.SCENE3D&&x.alpha>0&&(C.nearValue>0||C.farValue>0),A=t.hasWaterMask&&e(f),w=t.oceanNormalMap,b=A&&e(w),D=t.terrainProvider.ready&&t.terrainProvider.hasVertexNormals,I=r.fog.enabled&&!_,R=t.showGroundAtmosphere&&r.mode===Al.SCENE3D,P=Fg.castShadows(t.shadows)&&!v,O=Fg.receiveShadows(t.shadows)&&!v,N=t.hueShift,M=t.saturationShift,L=t.brightnessShift,F=!(a.equalsEpsilon(N,0,a.EPSILON7)&&a.equalsEpsilon(M,0,a.EPSILON7)&&a.equalsEpsilon(L,0,a.EPSILON7)),z=!1;R&&(z=p.magnitude(r.camera.positionWC)>t.nightFadeOutDistance);A&&--d,b&&--d,e(r.shadowState)&&r.shadowState.shadowsEnabled&&--d,e(t.clippingPlanes)&&t.clippingPlanes.enabled&&--d,d-=g.numberOfTextureUniforms;var B=o.renderedMesh,U=B.center,V=B.encoding,H=tE,G=0,k=0,W=0,q=0,Y=!1;if(r.mode!==Al.SCENE3D){var j=r.mapProjection,X=j.project(Oe.southwest(n.rectangle),aE),Z=j.project(Oe.northeast(n.rectangle),sE);if(H.x=X.x,H.y=X.y,H.z=Z.x,H.w=Z.y,r.mode!==Al.MORPHING&&((U=iE).x=0,U.y=.5*(H.z+H.x),U.z=.5*(H.w+H.y),H.x-=U.y,H.y-=U.z,H.z-=U.y,H.w-=U.z),r.mode===Al.SCENE2D&&V.quantization===om.BITS12){var K=1/(Math.pow(2,12)-1)*.5,Q=(H.z-H.x)*K,J=(H.w-H.y)*K;H.x-=Q,H.y-=J,H.z+=Q,H.w+=J}j instanceof Nc&&(G=n.rectangle.south,k=n.rectangle.north,W=Nc.geodeticLatitudeToMercatorAngle(G),q=1/(Nc.geodeticLatitudeToMercatorAngle(k)-W),Y=!0)}var $=gE;$.frameState=r,$.surfaceTile=o,$.showReflectiveOcean=A,$.showOceanWaves=b,$.enableLighting=t.enableLighting,$.dynamicAtmosphereLighting=t.dynamicAtmosphereLighting,$.dynamicAtmosphereLightingFromSun=t.dynamicAtmosphereLightingFromSun,$.showGroundAtmosphere=R,$.perFragmentGroundAtmosphere=z,$.hasVertexNormals=D,$.useWebMercatorProjection=Y,$.clippedByBoundaries=o.clippedByBoundaries;var ee=o.imagery,te=0,ne=ee.length,re=t.showSkirts&&!_&&!v,ie=t.backFaceCulling&&!_&&!v,oe=ie?t._renderState:t._disableCullingRenderState,ae=ie?t._blendRenderState:t._disableCullingBlendRenderState,se=oe,ue=t._firstPassInitialColor,ce=r.context;if(e(t._debug.boundingSphereTile)||hE(),t._materialUniformMap!==t.materialUniformMap){t._materialUniformMap=t.materialUniformMap;for(var he=t._drawCommands.length,de=0;de<he;++de)t._uniformMaps[de]=mE(r,t)}do{var fe,me,pe=0;if(t._drawCommands.length<=t._usedDrawCommands?((fe=new Ps).owner=n,fe.cull=!1,fe.boundingVolume=new Me,fe.orientedBoundingBox=void 0,me=mE(r,t),t._drawCommands.push(fe),t._uniformMaps.push(me)):(fe=t._drawCommands[t._usedDrawCommands],me=t._uniformMaps[t._usedDrawCommands]),fe.owner=n,++t._usedDrawCommands,n===t._debug.boundingSphereTile){var _e=o.orientedBoundingBox;e(_e)?cE(_e,pn.RED).update(r):e(B)&&e(B.boundingSphere3D)&&lE(B.boundingSphere3D,pn.RED).update(r)}var ge=me.properties;le.clone(ue,ge.initialColor),ge.oceanNormalMap=w,ge.lightingFadeDistance.x=t.lightingFadeOutDistance,ge.lightingFadeDistance.y=t.lightingFadeInDistance,ge.nightFadeDistance.x=t.nightFadeOutDistance,ge.nightFadeDistance.y=t.nightFadeInDistance,ge.zoomedOutOceanSpecularIntensity=t.zoomedOutOceanSpecularIntensity;var ve=_?T:y,Te=_?y:T;e(ve)&&(le.fromElements(ve.near,ve.nearValue,ve.far,ve.farValue,ge.frontFaceAlphaByDistance),le.fromElements(Te.near,Te.nearValue,Te.far,Te.farValue,ge.backFaceAlphaByDistance)),le.fromElements(C.near,C.nearValue,C.far,C.farValue,ge.undergroundColorAlphaByDistance),pn.clone(x,ge.undergroundColor);var Ee=!e(o.vertexArray)&&e(t.fillHighlightColor)&&t.fillHighlightColor.alpha>0;Ee&&pn.clone(t.fillHighlightColor,ge.fillHighlightColor),ge.center3D=B.center,p.clone(U,ge.rtc),le.clone(H,ge.tileRectangle),ge.southAndNorthLatitude.x=G,ge.southAndNorthLatitude.y=k,ge.southMercatorYAndOneOverHeight.x=W,ge.southMercatorYAndOneOverHeight.y=q;var xe=nE,Ce=XT(n.rectangle,t.cartographicLimitRectangle),Se=rE,Ae=XT(n.rectangle,E);p.fromElements(N,M,L,ge.hsbShift);var we=n.rectangle,be=1/we.width,De=1/we.height;xe.x=(Ce.west-we.west)*be,xe.y=(Ce.south-we.south)*De,xe.z=(Ce.east-we.west)*be,xe.w=(Ce.north-we.south)*De,le.clone(xe,ge.localizedCartographicLimitRectangle),Se.x=(Ae.west-we.west)*be,Se.y=(Ae.south-we.south)*De,Se.z=(Ae.east-we.west)*be,Se.w=(Ae.north-we.south)*De,le.clone(Se,ge.localizedTranslucencyRectangle);var Ie=I&&a.fog(n._distance,r.fog.density)>a.EPSILON3;F=F&&(Ie||R);for(var Re=!1,Pe=!1,Ne=!1,Le=!1,Fe=!1,ze=!1,Be=!1,Ue=!1,Ve=!1,He=!1;pe<d&&te<ne;){var Ge=ee[te],ke=Ge.readyImagery;if(++te,e(ke)&&0!==ke.imageryLayer.alpha){var We=Ge.useWebMercatorT?ke.textureWebMercator:ke.texture,qe=ke.imageryLayer;e(Ge.textureTranslationAndScale)||(Ge.textureTranslationAndScale=qe._calculateTextureTranslationAndScale(n,Ge)),ge.dayTextures[pe]=We,ge.dayTextureTranslationAndScale[pe]=Ge.textureTranslationAndScale,ge.dayTextureTexCoordsRectangle[pe]=Ge.textureCoordinateRectangle,ge.dayTextureUseWebMercatorT[pe]=Ge.useWebMercatorT,ge.dayTextureAlpha[pe]=qe.alpha,ze=ze||1!==ge.dayTextureAlpha[pe],ge.dayTextureNightAlpha[pe]=qe.nightAlpha,Be=Be||1!==ge.dayTextureNightAlpha[pe],ge.dayTextureDayAlpha[pe]=qe.dayAlpha,Be=Be||1!==ge.dayTextureDayAlpha[pe],ge.dayTextureBrightness[pe]=qe.brightness,Re=Re||ge.dayTextureBrightness[pe]!==ig.DEFAULT_BRIGHTNESS,ge.dayTextureContrast[pe]=qe.contrast,Pe=Pe||ge.dayTextureContrast[pe]!==ig.DEFAULT_CONTRAST,ge.dayTextureHue[pe]=qe.hue,Ne=Ne||ge.dayTextureHue[pe]!==ig.DEFAULT_HUE,ge.dayTextureSaturation[pe]=qe.saturation,Le=Le||ge.dayTextureSaturation[pe]!==ig.DEFAULT_SATURATION,ge.dayTextureOneOverGamma[pe]=1/qe.gamma,Fe=Fe||ge.dayTextureOneOverGamma[pe]!==1/ig.DEFAULT_GAMMA,ge.dayTextureSplit[pe]=qe.splitDirection,Ue=Ue||0!==ge.dayTextureSplit[pe];var Ye=ge.dayTextureCutoutRectangles[pe];if(e(Ye)||(Ye=ge.dayTextureCutoutRectangles[pe]=new le),le.clone(le.ZERO,Ye),e(qe.cutoutRectangle)){var je=XT(we,qe.cutoutRectangle);Ve=e(Oe.simpleIntersection(je,we,qT))||Ve,Ye.x=(je.west-we.west)*be,Ye.y=(je.south-we.south)*De,Ye.z=(je.east-we.west)*be,Ye.w=(je.north-we.south)*De}var Xe=ge.colorsToAlpha[pe];e(Xe)||(Xe=ge.colorsToAlpha[pe]=new le);var Ze=e(qe.colorToAlpha)&&qe.colorToAlphaThreshold>0;if(He=He||Ze,Ze){var Ke=qe.colorToAlpha;Xe.x=Ke.red,Xe.y=Ke.green,Xe.z=Ke.blue,Xe.w=qe.colorToAlphaThreshold}else Xe.w=-1;if(e(ke.credits))for(var Qe=ke.credits,Je=0,$e=Qe.length;Je<$e;++Je)s.addCredit(Qe[Je]);++pe}}ge.dayTextures.length=pe,ge.waterMask=f,le.clone(m,ge.waterMaskTranslationAndScale),ge.minMaxHeight.x=V.minimumHeight,ge.minMaxHeight.y=V.maximumHeight,ye.clone(V.matrix,ge.scaleAndBias);var et=t._clippingPlanes,tt=e(et)&&et.enabled&&n.isClipped;tt&&(ge.clippingPlanesEdgeColor=pn.clone(et.edgeColor,ge.clippingPlanesEdgeColor),ge.clippingPlanesEdgeWidth=et.edgeWidth),$.numberOfDayTextures=pe,$.applyBrightness=Re,$.applyContrast=Pe,$.applyHue=Ne,$.applySaturation=Le,$.applyGamma=Fe,$.applyAlpha=ze,$.applyDayNightAlpha=Be,$.applySplit=Ue,$.enableFog=Ie,$.enableClippingPlanes=tt,$.clippingPlanes=et,$.hasImageryLayerCutout=Ve,$.colorCorrect=F,$.highlightFillTile=Ee,$.colorToAlpha=He,$.showUndergroundColor=S,$.translucent=v;var nt=o.renderedMesh.indices.length;re||(nt=o.renderedMesh.indexCountWithoutSkirts),fe.shaderProgram=t._surfaceShaderSet.getShaderProgram($),fe.castShadows=P,fe.receiveShadows=O,fe.renderState=se,fe.primitiveType=Rs.TRIANGLES,fe.vertexArray=o.vertexArray||o.fill.vertexArray,fe.count=nt,fe.uniformMap=me,fe.pass=Os.GLOBE,t._debug.wireframe&&(pE(ce,0,n),e(o.wireframeVertexArray)&&(fe.vertexArray=o.wireframeVertexArray,fe.primitiveType=Rs.LINES,fe.count=2*nt));var rt=fe.boundingVolume,it=fe.orientedBoundingBox;if(r.mode!==Al.SCENE3D){var ot=o.tileBoundingRegion;Me.fromRectangleWithHeights2D(n.rectangle,r.mapProjection,ot.minimumHeight,ot.maximumHeight,rt),p.fromElements(rt.center.z,rt.center.x,rt.center.y,rt.center),r.mode===Al.MORPHING&&(rt=Me.union(B.boundingSphere3D,rt,rt))}else fe.boundingVolume=Me.clone(B.boundingSphere3D,rt),fe.orientedBoundingBox=mf.clone(o.orientedBoundingBox,it);fe.dirty=!0,v&&g.updateDerivedCommands(fe,r),kT(fe,r),se=ae,ue=_E}while(te<ne)}function EE(){this._enabled=!1,this._frontFaceAlpha=1,this._frontFaceAlphaByDistance=void 0,this._backFaceAlpha=1,this._backFaceAlphaByDistance=void 0,this._rectangle=Oe.clone(Oe.MAX_VALUE)}function xE(){this._layers=[],this.layerAdded=new qo,this.layerRemoved=new qo,this.layerMoved=new qo,this.layerShownOrHidden=new qo}function CE(e,t){return e.indexOf(t)}function SE(e,t,n){var r=e._layers;if((t=a.clamp(t,0,r.length-1))!==(n=a.clamp(n,0,r.length-1))){var i=r[t];r[t]=r[n],r[n]=i,e._update(),e.layerMoved.raiseEvent(i,n,t)}}Object.defineProperties(EE.prototype,{enabled:{get:function(){return this._enabled},set:function(e){this._enabled=e}},frontFaceAlpha:{get:function(){return this._frontFaceAlpha},set:function(e){this._frontFaceAlpha=e}},frontFaceAlphaByDistance:{get:function(){return this._frontFaceAlphaByDistance},set:function(e){this._frontFaceAlphaByDistance=fr.clone(e,this._frontFaceAlphaByDistance)}},backFaceAlpha:{get:function(){return this._backFaceAlpha},set:function(e){this._backFaceAlpha=e}},backFaceAlphaByDistance:{get:function(){return this._backFaceAlphaByDistance},set:function(e){this._backFaceAlphaByDistance=fr.clone(e,this._backFaceAlphaByDistance)}},rectangle:{get:function(){return this._rectangle},set:function(t){e(t)||(t=Oe.clone(Oe.MAX_VALUE)),Oe.clone(t,this._rectangle)}}}),Object.defineProperties(xE.prototype,{length:{get:function(){return this._layers.length}}}),xE.prototype.add=function(t,n){e(n)?this._layers.splice(n,0,t):(n=this._layers.length,this._layers.push(t)),this._update(),this.layerAdded.raiseEvent(t,n)},xE.prototype.addImageryProvider=function(e,t){var n=new ig(e);return this.add(n,t),n},xE.prototype.remove=function(e,t){t=i(t,!0);var n=this._layers.indexOf(e);return-1!==n&&(this._layers.splice(n,1),this._update(),this.layerRemoved.raiseEvent(e,n),t&&e.destroy(),!0)},xE.prototype.removeAll=function(e){e=i(e,!0);for(var t=this._layers,n=0,r=t.length;n<r;n++){var o=t[n];this.layerRemoved.raiseEvent(o,n),e&&o.destroy()}this._layers=[]},xE.prototype.contains=function(e){return-1!==this.indexOf(e)},xE.prototype.indexOf=function(e){return this._layers.indexOf(e)},xE.prototype.get=function(e){return this._layers[e]},xE.prototype.raise=function(e){var t=CE(this._layers,e);SE(this,t,t+1)},xE.prototype.lower=function(e){var t=CE(this._layers,e);SE(this,t,t-1)},xE.prototype.raiseToTop=function(e){var t=CE(this._layers,e);t!==this._layers.length-1&&(this._layers.splice(t,1),this._layers.push(e),this._update(),this.layerMoved.raiseEvent(e,this._layers.length-1,t))},xE.prototype.lowerToBottom=function(e){var t=CE(this._layers,e);0!==t&&(this._layers.splice(t,1),this._layers.splice(0,0,e),this._update(),this.layerMoved.raiseEvent(e,0,t))};var AE,wE=new Oe;function bE(e){this._ellipsoid=new Wd(e.ellipsoid,p.ZERO)}function DE(e){this._tilingScheme=e.tilingScheme,this._x=e.x,this._y=e.y,this._level=e.level,this._parent=e.parent,this._rectangle=this._tilingScheme.tileXYToRectangle(this._x,this._y,this._level),this._southwestChild=void 0,this._southeastChild=void 0,this._northwestChild=void 0,this._northeastChild=void 0,this.replacementPrevious=void 0,this.replacementNext=void 0,this._distance=0,this._loadPriority=0,this._customData=[],this._frameUpdated=void 0,this._lastSelectionResult=Pv.NONE,this._lastSelectionResultFrame=void 0,this._loadedCallbacks={},this.state=q_.START,this.renderable=!1,this.upsampledFromParent=!1,this.data=void 0}function IE(t){e(t)&&t.freeResources()}function RE(){this.head=void 0,this.tail=void 0,this.count=0,this._lastBeforeStartOfFrame=void 0}function PE(e,t){var n=t.replacementPrevious,r=t.replacementNext;t===e._lastBeforeStartOfFrame&&(e._lastBeforeStartOfFrame=r),t===e.head?e.head=r:n.replacementNext=r,t===e.tail?e.tail=n:r.replacementPrevious=n,t.replacementPrevious=void 0,t.replacementNext=void 0,--e.count}function OE(e){this._tileProvider=e.tileProvider,this._tileProvider.quadtree=this,this._debug={enableDebugOutput:!1,maxDepth:0,maxDepthVisited:0,tilesVisited:0,tilesCulled:0,tilesRendered:0,tilesWaitingForChildren:0,lastMaxDepth:-1,lastMaxDepthVisited:-1,lastTilesVisited:-1,lastTilesCulled:-1,lastTilesRendered:-1,lastTilesWaitingForChildren:-1,suspendLodUpdate:!1};var t=this._tileProvider.tilingScheme.ellipsoid;this._tilesToRender=[],this._tileLoadQueueHigh=[],this._tileLoadQueueMedium=[],this._tileLoadQueueLow=[],this._tileReplacementQueue=new RE,this._levelZeroTiles=void 0,this._loadQueueTimeSlice=5,this._tilesInvalidated=!1,this._addHeightCallbacks=[],this._removeHeightCallbacks=[],this._tileToUpdateHeights=[],this._lastTileIndex=0,this._updateHeightsTimeSlice=2,this._cameraPositionCartographic=void 0,this._cameraReferenceFrameOriginCartographic=void 0,this.maximumScreenSpaceError=i(e.maximumScreenSpaceError,2),this.tileCacheSize=i(e.tileCacheSize,100),this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this._occluders=new bE({ellipsoid:t}),this._tileLoadProgressEvent=new qo,this._lastTileLoadQueueLength=0,this._lastSelectionFrameNumber=void 0}function NE(e){var t=e._debug;t.maxDepth=0,t.maxDepthVisited=0,t.tilesVisited=0,t.tilesCulled=0,t.tilesRendered=0,t.tilesWaitingForChildren=0,e._tileLoadQueueHigh.length=0,e._tileLoadQueueMedium.length=0,e._tileLoadQueueLow.length=0}xE.prototype.pickImageryLayerFeatures=function(t,n){var r=n.globe.pick(t,n);if(e(r)){for(var i,o=n.globe.ellipsoid.cartesianToCartographic(r),s=n.globe._surface._tilesToRender,u=0;!e(i)&&u<s.length;++u){var c=s[u];Oe.contains(c.rectangle,o)&&(i=c)}if(e(i)){for(var l=i.data.imagery,h=[],d=[],f=l.length-1;f>=0;--f){var m=l[f],p=m.readyImagery;if(e(p)){var _=p.imageryLayer.imageryProvider;if(e(_.pickFeatures)&&Oe.contains(p.rectangle,o)){var g=wE,v=1/1024;if(g.west=a.lerp(i.rectangle.west,i.rectangle.east,m.textureCoordinateRectangle.x-v),g.east=a.lerp(i.rectangle.west,i.rectangle.east,m.textureCoordinateRectangle.z+v),g.south=a.lerp(i.rectangle.south,i.rectangle.north,m.textureCoordinateRectangle.y-v),g.north=a.lerp(i.rectangle.south,i.rectangle.north,m.textureCoordinateRectangle.w+v),Oe.contains(g,o)){var y=_.pickFeatures(p.x,p.y,p.level,o.longitude,o.latitude);e(y)&&(h.push(y),d.push(p.imageryLayer))}}}}if(0!==h.length)return Et.all(h,(function(t){for(var n=[],r=0;r<t.length;++r){var i=t[r],a=d[r];if(e(i)&&i.length>0)for(var s=0;s<i.length;++s){var u=i[s];u.imageryLayer=a,e(u.position)||(u.position=o),n.push(u)}}return n}))}}},xE.prototype.queueReprojectionCommands=function(e){for(var t=this._layers,n=0,r=t.length;n<r;++n)t[n].queueReprojectionCommands(e)},xE.prototype.cancelReprojections=function(){for(var e=this._layers,t=0,n=e.length;t<n;++t)e[t].cancelReprojections()},xE.prototype.isDestroyed=function(){return!1},xE.prototype.destroy=function(){return this.removeAll(!0),hi(this)},xE.prototype._update=function(){var t,n,r,i,o=!0,a=this._layers;for(r=0,i=a.length;r<i;++r)(n=a[r])._layerIndex=r,n.show?(n._isBaseLayer=o,o=!1):n._isBaseLayer=!1,n.show!==n._show&&(e(n._show)&&(e(t)||(t=[]),t.push(n)),n._show=n.show);if(e(t))for(r=0,i=t.length;r<i;++r)n=t[r],this.layerShownOrHidden.raiseEvent(n,n._layerIndex,n.show)},Object.defineProperties(bE.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),DE.createLevelZeroTiles=function(e){for(var t=e.getNumberOfXTilesAtLevel(0),n=e.getNumberOfYTilesAtLevel(0),r=new Array(t*n),i=0,o=0;o<n;++o)for(var a=0;a<t;++a)r[i++]=new DE({tilingScheme:e,x:a,y:o,level:0});return r},DE.prototype._updateCustomData=function(t,n,r){var i,o,a,s=this.customData;if(e(n)&&e(r)){for(s=s.filter((function(e){return-1===r.indexOf(e)})),this._customData=s,a=this._rectangle,i=0;i<n.length;++i)o=n[i],Oe.contains(a,o.positionCartographic)&&s.push(o);this._frameUpdated=t}else{var u=this._parent;if(e(u)&&this._frameUpdated!==u._frameUpdated){s.length=0,a=this._rectangle;var c=u.customData;for(i=0;i<c.length;++i)o=c[i],Oe.contains(a,o.positionCartographic)&&s.push(o);this._frameUpdated=u._frameUpdated}}},Object.defineProperties(DE.prototype,{tilingScheme:{get:function(){return this._tilingScheme}},x:{get:function(){return this._x}},y:{get:function(){return this._y}},level:{get:function(){return this._level}},parent:{get:function(){return this._parent}},rectangle:{get:function(){return this._rectangle}},children:{get:function(){return[this.northwestChild,this.northeastChild,this.southwestChild,this.southeastChild]}},southwestChild:{get:function(){return e(this._southwestChild)||(this._southwestChild=new DE({tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y+1,level:this.level+1,parent:this})),this._southwestChild}},southeastChild:{get:function(){return e(this._southeastChild)||(this._southeastChild=new DE({tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y+1,level:this.level+1,parent:this})),this._southeastChild}},northwestChild:{get:function(){return e(this._northwestChild)||(this._northwestChild=new DE({tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y,level:this.level+1,parent:this})),this._northwestChild}},northeastChild:{get:function(){return e(this._northeastChild)||(this._northeastChild=new DE({tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y,level:this.level+1,parent:this})),this._northeastChild}},customData:{get:function(){return this._customData}},needsLoading:{get:function(){return this.state<q_.DONE}},eligibleForUnloading:{get:function(){var t=!0;return e(this.data)&&(e(t=this.data.eligibleForUnloading)||(t=!0)),t}}}),DE.prototype.findLevelZeroTile=function(e,t,n){var r=this.tilingScheme.getNumberOfXTilesAtLevel(0);if(t<0?t+=r:t>=r&&(t-=r),!(n<0||n>=this.tilingScheme.getNumberOfYTilesAtLevel(0)))return e.filter((function(e){return e.x===t&&e.y===n}))[0]},DE.prototype.findTileToWest=function(e){var t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x-1,this.y);if(t.southeastChild===this)return t.southwestChild;if(t.northeastChild===this)return t.northwestChild;var n=t.findTileToWest(e);return void 0!==n?t.southwestChild===this?n.southeastChild:n.northeastChild:void 0},DE.prototype.findTileToEast=function(e){var t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x+1,this.y);if(t.southwestChild===this)return t.southeastChild;if(t.northwestChild===this)return t.northeastChild;var n=t.findTileToEast(e);return void 0!==n?t.southeastChild===this?n.southwestChild:n.northwestChild:void 0},DE.prototype.findTileToSouth=function(e){var t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x,this.y+1);if(t.northwestChild===this)return t.southwestChild;if(t.northeastChild===this)return t.southeastChild;var n=t.findTileToSouth(e);return void 0!==n?t.southwestChild===this?n.northwestChild:n.northeastChild:void 0},DE.prototype.findTileToNorth=function(e){var t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x,this.y-1);if(t.southwestChild===this)return t.northwestChild;if(t.southeastChild===this)return t.northeastChild;var n=t.findTileToNorth(e);return void 0!==n?t.northwestChild===this?n.southwestChild:n.southeastChild:void 0},DE.prototype.freeResources=function(){this.state=q_.START,this.renderable=!1,this.upsampledFromParent=!1,e(this.data)&&e(this.data.freeResources)&&this.data.freeResources(),IE(this._southwestChild),this._southwestChild=void 0,IE(this._southeastChild),this._southeastChild=void 0,IE(this._northwestChild),this._northwestChild=void 0,IE(this._northeastChild),this._northeastChild=void 0},RE.prototype.markStartOfRenderFrame=function(){this._lastBeforeStartOfFrame=this.head},RE.prototype.trimTiles=function(t){for(var n=this.tail,r=!0;r&&e(this._lastBeforeStartOfFrame)&&this.count>t&&e(n);){r=n!==this._lastBeforeStartOfFrame;var i=n.replacementPrevious;n.eligibleForUnloading&&(n.freeResources(),PE(this,n)),n=i}},RE.prototype.markTileRendered=function(t){var n=this.head;if(n!==t){if(++this.count,!e(n))return t.replacementPrevious=void 0,t.replacementNext=void 0,this.head=t,void(this.tail=t);(e(t.replacementPrevious)||e(t.replacementNext))&&PE(this,t),t.replacementPrevious=void 0,t.replacementNext=n,n.replacementPrevious=t,this.head=t}else t===this._lastBeforeStartOfFrame&&(this._lastBeforeStartOfFrame=t.replacementNext)},Object.defineProperties(OE.prototype,{tileProvider:{get:function(){return this._tileProvider}},tileLoadProgressEvent:{get:function(){return this._tileLoadProgressEvent}},occluders:{get:function(){return this._occluders}}}),OE.prototype.invalidateAllTiles=function(){this._tilesInvalidated=!0},OE.prototype.forEachLoadedTile=function(t){for(var n=this._tileReplacementQueue.head;e(n);)n.state!==q_.START&&t(n),n=n.replacementNext},OE.prototype.forEachRenderedTile=function(e){for(var t=this._tilesToRender,n=0,r=t.length;n<r;++n)e(t[n])},OE.prototype.updateHeight=function(e,t){var n=this,r={positionOnEllipsoidSurface:void 0,positionCartographic:e,level:-1,callback:t,removeFunc:function(){for(var e=n._addHeightCallbacks,t=e.length,i=0;i<t;++i)if(e[i]===r){e.splice(i,1);break}n._removeHeightCallbacks.push(r)}};return n._addHeightCallbacks.push(r),r.removeFunc},OE.prototype.update=function(t){e(this._tileProvider.update)&&this._tileProvider.update(t)},OE.prototype.beginFrame=function(t){t.passes.render&&(this._tilesInvalidated&&(!function(t){var n=t._tileReplacementQueue;n.head=void 0,n.tail=void 0,n.count=0,NE(t);var r=t._levelZeroTiles;if(e(r))for(var i=0;i<r.length;++i){for(var o=r[i].customData,a=o.length,s=0;s<a;++s){var u=o[s];u.level=0,t._addHeightCallbacks.push(u)}r[i].freeResources()}t._levelZeroTiles=void 0,t._tileProvider.cancelReprojections()}(this),this._tilesInvalidated=!1),this._tileProvider.initialize(t),NE(this),this._debug.suspendLodUpdate||this._tileReplacementQueue.markStartOfRenderFrame())},OE.prototype.render=function(t){var n=t.passes,r=this._tileProvider;n.render&&(r.beginUpdate(t),function(t,n){var r,i=t._debug;if(i.suspendLodUpdate)return;t._tilesToRender.length=0;var o,a=t._tileProvider;if(!e(t._levelZeroTiles)){if(!a.ready)return;var s=a.tilingScheme;t._levelZeroTiles=DE.createLevelZeroTiles(s);var u=t._levelZeroTiles.length;if(zE.length<u)for(zE=new Array(u),r=0;r<u;++r)void 0===zE[r]&&(zE[r]=new UE)}t._occluders.ellipsoid.cameraPosition=n.camera.positionWC;var c=t._levelZeroTiles,l=c.length>1?t._occluders:void 0;AE=n.camera.positionCartographic,c.sort(LE);var h,d=t._addHeightCallbacks,f=t._removeHeightCallbacks,m=n.frameNumber;if(d.length>0||f.length>0){for(r=0,h=c.length;r<h;++r)(o=c[r])._updateCustomData(m,d,f);d.length=0,f.length=0}var p=n.camera;t._cameraPositionCartographic=p.positionCartographic;var _=ye.getTranslation(p.transform,FE);for(t._cameraReferenceFrameOriginCartographic=t.tileProvider.tilingScheme.ellipsoid.cartesianToCartographic(_,t._cameraReferenceFrameOriginCartographic),r=0,h=c.length;r<h;++r)o=c[r],t._tileReplacementQueue.markTileRendered(o),o.renderable?WE(t,o,a,n,l,!1,zE[r]):(BE(t,t._tileLoadQueueHigh,o,n),++i.tilesWaitingForChildren);t._lastSelectionFrameNumber=m}(this,t),function(e,t){for(var n=e._tileProvider,r=e._tilesToRender,i=0,o=r.length;i<o;++i){var a=r[i];n.showTileThisFrame(a,t)}}(this,t),r.endUpdate(t)),n.pick&&this._tilesToRender.length>0&&r.updateForPick(t)},OE.prototype.endFrame=function(t){t.passes.render&&t.mode!==Al.MORPHING&&(function(e,t){var n=e._tileLoadQueueHigh,r=e._tileLoadQueueMedium,i=e._tileLoadQueueLow;if(0===n.length&&0===r.length&&0===i.length)return;e._tileReplacementQueue.trimTiles(e.tileCacheSize);var o=di()+e._loadQueueTimeSlice,a=e._tileProvider,s=jE(e,t,a,o,n,!1);s=jE(e,t,a,o,r,s),jE(e,t,a,o,i,s)}(this,t),function(t,n){if(!t.tileProvider.ready)return;var r=QE;r.length=0;var o,a=t._tileToUpdateHeights,s=t._tileProvider.terrainProvider,u=di(),c=t._updateHeightsTimeSlice,l=u+c,h=n.mode,d=n.mapProjection,f=t.tileProvider.tilingScheme.ellipsoid;for(;a.length>0;){var m=a[0];if(e(m.data)&&e(m.data.mesh)){var _=m.customData,g=_.length,v=!1;for(o=t._lastTileIndex;o<g;++o){var y=_[o];if(m.level>y.level){if(e(y.positionOnEllipsoidSurface)||(y.positionOnEllipsoidSurface=p.fromRadians(y.positionCartographic.longitude,y.positionCartographic.latitude,0,f)),h===Al.SCENE3D){var T=f.geodeticSurfaceNormal(y.positionOnEllipsoidSurface,XE.direction);if(!e(f.getSurfaceNormalIntersectionWithZAxis(y.positionOnEllipsoidSurface,11500,XE.origin))){var E;e(m.data.tileBoundingRegion)&&(E=m.data.tileBoundingRegion.minimumHeight);var x=Math.min(i(E,0),-11500),C=p.multiplyByScalar(T,Math.abs(x)+1,KE);p.subtract(y.positionOnEllipsoidSurface,C,XE.origin)}}else N.clone(y.positionCartographic,ZE),ZE.height=-11500,d.project(ZE,KE),p.fromElements(KE.z,KE.x,KE.y,KE),p.clone(KE,XE.origin),p.clone(p.UNIT_X,XE.direction);var S=m.data.pick(XE,h,d,!1,KE);e(S)&&(y.callback(S),y.level=m.level)}else if(m.level===y.level){for(var A,w=m.children,b=w.length,D=0;D<b&&(A=w[D],!Oe.contains(A.rectangle,y.positionCartographic));++D);var I=s.getTileDataAvailable(A.x,A.y,A.level),R=m.parent;(e(I)&&!I||e(R)&&e(R.data)&&e(R.data.terrainData)&&!R.data.terrainData.isChildAvailable(R.x,R.y,A.x,A.y))&&y.removeFunc()}if(di()>=l){v=!0;break}}if(v){t._lastTileIndex=o;break}t._lastTileIndex=0,a.shift()}else{var P=m._lastSelectionResultFrame===t._lastSelectionFrameNumber?m._lastSelectionResult:Pv.NONE;P!==Pv.RENDERED&&P!==Pv.CULLED_BUT_NEEDED||r.push(m),a.shift(),t._lastTileIndex=0}}for(o=0;o<r.length;o++)a.push(r[o])}(this,t),function(e,t){var n=e._tileLoadQueueHigh.length+e._tileLoadQueueMedium.length+e._tileLoadQueueLow.length;(n!==e._lastTileLoadQueueLength||e._tilesInvalidated)&&(t.afterRender.push(qo.prototype.raiseEvent.bind(e._tileLoadProgressEvent,n)),e._lastTileLoadQueueLength=n);var r=e._debug;r.enableDebugOutput&&!r.suspendLodUpdate&&(r.maxDepth=e._tilesToRender.reduce((function(e,t){return Math.max(e,t.level)}),-1),r.tilesRendered=e._tilesToRender.length,r.tilesVisited===r.lastTilesVisited&&r.tilesRendered===r.lastTilesRendered&&r.tilesCulled===r.lastTilesCulled&&r.maxDepth===r.lastMaxDepth&&r.tilesWaitingForChildren===r.lastTilesWaitingForChildren&&r.maxDepthVisited===r.lastMaxDepthVisited||(console.log("Visited "+r.tilesVisited+", Rendered: "+r.tilesRendered+", Culled: "+r.tilesCulled+", Max Depth Rendered: "+r.maxDepth+", Max Depth Visited: "+r.maxDepthVisited+", Waiting for children: "+r.tilesWaitingForChildren),r.lastTilesVisited=r.tilesVisited,r.lastTilesRendered=r.tilesRendered,r.lastTilesCulled=r.tilesCulled,r.lastMaxDepth=r.maxDepth,r.lastTilesWaitingForChildren=r.tilesWaitingForChildren,r.lastMaxDepthVisited=r.maxDepthVisited))}(this,t))},OE.prototype.isDestroyed=function(){return!1},OE.prototype.destroy=function(){this._tileProvider=this._tileProvider&&this._tileProvider.destroy()};var ME=new N;function LE(e,t){var n=Oe.center(e.rectangle,ME),r=n.longitude-AE.longitude,i=n.latitude-AE.latitude,o=(n=Oe.center(t.rectangle,ME)).longitude-AE.longitude,a=n.latitude-AE.latitude;return r*r+i*i-(o*o+a*a)}var FE=new p,zE=[];function BE(e,t,n,r){n.needsLoading&&(void 0!==e.tileProvider.computeTileLoadPriority&&(n._loadPriority=e.tileProvider.computeTileLoadPriority(n,r)),t.push(n))}function UE(){this.allAreRenderable=!0,this.anyWereRenderedLastFrame=!1,this.notYetRenderableCount=0}function VE(){this.southwest=new UE,this.southeast=new UE,this.northwest=new UE,this.northeast=new UE}VE.prototype.combine=function(e){var t=this.southwest,n=this.southeast,r=this.northwest,i=this.northeast;e.allAreRenderable=t.allAreRenderable&&n.allAreRenderable&&r.allAreRenderable&&i.allAreRenderable,e.anyWereRenderedLastFrame=t.anyWereRenderedLastFrame||n.anyWereRenderedLastFrame||r.anyWereRenderedLastFrame||i.anyWereRenderedLastFrame,e.notYetRenderableCount=t.notYetRenderableCount+n.notYetRenderableCount+r.notYetRenderableCount+i.notYetRenderableCount};for(var HE=new Array(31),GE=0;GE<HE.length;++GE)HE[GE]=new VE;function kE(t,n,r,i,o){var s=t._debug;++s.tilesVisited,t._tileReplacementQueue.markTileRendered(r),r._updateCustomData(n.frameNumber),r.level>s.maxDepthVisited&&(s.maxDepthVisited=r.level);var u=function(t,n,r){if(n.mode===Al.SCENE2D||n.camera.frustum instanceof Pr||n.camera.frustum instanceof Ar)return function(t,n,r){var i=n.camera.frustum;e(i._offCenterFrustum)&&(i=i._offCenterFrustum);var o=n.context,s=o.drawingBufferWidth,u=o.drawingBufferHeight,c=t._tileProvider.getLevelMaximumGeometricError(r.level),l=Math.max(i.top-i.bottom,i.right-i.left)/Math.max(s,u),h=c/l;n.fog.enabled&&n.mode!==Al.SCENE2D&&(h-=a.fog(r._distance,n.fog.density)*n.fog.sse);return h/=n.pixelRatio}(t,n,r);var i=t._tileProvider.getLevelMaximumGeometricError(r.level),o=r._distance,s=n.context.drawingBufferHeight,u=n.camera.frustum.sseDenominator,c=i*s/(o*u);n.fog.enabled&&(c-=a.fog(o,n.fog.density)*n.fog.sse);return c/=n.pixelRatio}(t,n,r)<t.maximumScreenSpaceError,c=r.southwestChild,l=r.southeastChild,h=r.northwestChild,d=r.northeastChild,f=t._lastSelectionFrameNumber,m=r._lastSelectionResultFrame===f?r._lastSelectionResult:Pv.NONE,p=t.tileProvider;if(u||i){var _=Pv.originalResult(m)===Pv.RENDERED,g=Pv.originalResult(m)===Pv.CULLED||m===Pv.NONE,v=r.state===q_.DONE,y=_||g||v;if(y||e(p.canRenderWithoutLosingDetail)&&(y=p.canRenderWithoutLosingDetail(r)),y)return u&&BE(t,t._tileLoadQueueMedium,r,n),qE(t,r),o.allAreRenderable=r.renderable,o.anyWereRenderedLastFrame=m===Pv.RENDERED,o.notYetRenderableCount=r.renderable?0:1,r._lastSelectionResultFrame=n.frameNumber,r._lastSelectionResult=Pv.RENDERED,void(o.anyWereRenderedLastFrame||t._tileToUpdateHeights.push(r));i=!0,u&&BE(t,t._tileLoadQueueHigh,r,n)}if(p.canRefine(r)){if(c.upsampledFromParent&&l.upsampledFromParent&&h.upsampledFromParent&&d.upsampledFromParent)return qE(t,r),BE(t,t._tileLoadQueueMedium,r,n),t._tileReplacementQueue.markTileRendered(c),t._tileReplacementQueue.markTileRendered(l),t._tileReplacementQueue.markTileRendered(h),t._tileReplacementQueue.markTileRendered(d),o.allAreRenderable=r.renderable,o.anyWereRenderedLastFrame=m===Pv.RENDERED,o.notYetRenderableCount=r.renderable?0:1,r._lastSelectionResultFrame=n.frameNumber,r._lastSelectionResult=Pv.RENDERED,void(o.anyWereRenderedLastFrame||t._tileToUpdateHeights.push(r));r._lastSelectionResultFrame=n.frameNumber,r._lastSelectionResult=Pv.REFINED;var T=t._tilesToRender.length,E=t._tileLoadQueueLow.length,x=t._tileLoadQueueMedium.length,C=t._tileLoadQueueHigh.length,S=t._tileToUpdateHeights.length;if(function(e,t,n,r,i,o,a,s){var u=o.camera.positionCartographic,c=e._tileProvider,l=e._occluders,h=HE[t.level],d=h.southwest,f=h.southeast,m=h.northwest,p=h.northeast;u.longitude<t.rectangle.east?u.latitude<t.rectangle.north?(WE(e,t,c,o,l,a,d),WE(e,n,c,o,l,a,f),WE(e,r,c,o,l,a,m),WE(e,i,c,o,l,a,p)):(WE(e,r,c,o,l,a,m),WE(e,t,c,o,l,a,d),WE(e,i,c,o,l,a,p),WE(e,n,c,o,l,a,f)):u.latitude<t.rectangle.north?(WE(e,n,c,o,l,a,f),WE(e,t,c,o,l,a,d),WE(e,i,c,o,l,a,p),WE(e,r,c,o,l,a,m)):(WE(e,i,c,o,l,a,p),WE(e,r,c,o,l,a,m),WE(e,n,c,o,l,a,f),WE(e,t,c,o,l,a,d));h.combine(s)}(t,c,l,h,d,n,i,o),T!==t._tilesToRender.length){var A=o.allAreRenderable,w=o.anyWereRenderedLastFrame,b=o.notYetRenderableCount,D=!1;if(!A&&!w){for(var I=t._tilesToRender,R=T;R<I.length;++R)for(var P=I[R];void 0!==P&&P._lastSelectionResult!==Pv.KICKED&&P!==r;)P._lastSelectionResult=Pv.kick(P._lastSelectionResult),P=P.parent;t._tilesToRender.length=T,t._tileToUpdateHeights.length=S,qE(t,r),r._lastSelectionResult=Pv.RENDERED;var O=m===Pv.RENDERED;!O&&b>t.loadingDescendantLimit&&(t._tileLoadQueueLow.length=E,t._tileLoadQueueMedium.length=x,t._tileLoadQueueHigh.length=C,BE(t,t._tileLoadQueueMedium,r,n),o.notYetRenderableCount=r.renderable?0:1,D=!0),o.allAreRenderable=r.renderable,o.anyWereRenderedLastFrame=O,O||t._tileToUpdateHeights.push(r),++s.tilesWaitingForChildren}t.preloadAncestors&&!D&&BE(t,t._tileLoadQueueLow,r,n)}}else r._lastSelectionResultFrame=n.frameNumber,r._lastSelectionResult=Pv.RENDERED,qE(t,r),BE(t,t._tileLoadQueueHigh,r,n),o.allAreRenderable=r.renderable,o.anyWereRenderedLastFrame=m===Pv.RENDERED,o.notYetRenderableCount=r.renderable?0:1}function WE(t,n,r,i,o,a,s){if(r.computeTileVisibility(n,i,o)!==V_.NONE)return kE(t,i,n,a,s);if(++t._debug.tilesCulled,t._tileReplacementQueue.markTileRendered(n),s.allAreRenderable=!0,s.anyWereRenderedLastFrame=!1,s.notYetRenderableCount=0,function(t,n){var r=n.rectangle;return e(t._cameraPositionCartographic)&&Oe.contains(r,t._cameraPositionCartographic)||e(t._cameraReferenceFrameOriginCartographic)&&Oe.contains(r,t._cameraReferenceFrameOriginCartographic)}(t,n)){e(n.data)&&e(n.data.vertexArray)||BE(t,t._tileLoadQueueMedium,n,i);var u=t._lastSelectionFrameNumber,c=n._lastSelectionResultFrame===u?n._lastSelectionResult:Pv.NONE;c!==Pv.CULLED_BUT_NEEDED&&c!==Pv.RENDERED&&t._tileToUpdateHeights.push(n),n._lastSelectionResult=Pv.CULLED_BUT_NEEDED}else t.preloadSiblings||0===n.level?(BE(t,t._tileLoadQueueLow,n,i),n._lastSelectionResult=Pv.CULLED):n._lastSelectionResult=Pv.CULLED;n._lastSelectionResultFrame=i.frameNumber}function qE(e,t){e._tilesToRender.push(t)}function YE(e,t){return e._loadPriority-t._loadPriority}function jE(e,t,n,r,i,o){void 0!==n.computeTileLoadPriority&&i.sort(YE);for(var a=0,s=i.length;a<s&&(di()<r||!o);++a){var u=i[a];e._tileReplacementQueue.markTileRendered(u),n.loadTile(t,u),o=!0}return o}var XE=new Fn,ZE=new N,KE=new p,QE=[];function JE(e){var t=new Mm({ellipsoid:e=i(e,H.WGS84)}),n=new xE;this._ellipsoid=e,this._imageryLayerCollection=n,this._surfaceShaderSet=new $m,this._material=void 0,this._surface=new OE({tileProvider:new HT({terrainProvider:t,imageryLayers:n,surfaceShaderSet:this._surfaceShaderSet})}),this._terrainProvider=t,this._terrainProviderChanged=new qo,this._undergroundColor=pn.clone(pn.BLACK),this._undergroundColorAlphaByDistance=new fr(e.maximumRadius/1e3,0,e.maximumRadius/5,1),this._translucency=new EE,$E(this),this.show=!0,this._oceanNormalMapResourceDirty=!0,this._oceanNormalMapResource=new ga({url:za("Assets/Textures/waterNormalsSmall.jpg")}),this.maximumScreenSpaceError=2,this.tileCacheSize=100,this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this.fillHighlightColor=void 0,this.enableLighting=!1,this.dynamicAtmosphereLighting=!0,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!0,this.lightingFadeOutDistance=1e7,this.lightingFadeInDistance=2e7,this.nightFadeOutDistance=1e7,this.nightFadeInDistance=5e7,this.showWaterEffect=!0,this.depthTestAgainstTerrain=!1,this.shadows=Fg.RECEIVE_ONLY,this.atmosphereHueShift=0,this.atmosphereSaturationShift=0,this.atmosphereBrightnessShift=0,this.showSkirts=!0,this.backFaceCulling=!0,this._oceanNormalMap=void 0,this._zoomedOutOceanSpecularIntensity=void 0}function $E(t){var n=[],r=e(t._material)&&(t._material.shaderSource.match(/slope/)||t._material.shaderSource.match("normalEC")),i=[Lm];!e(t._material)||r&&!t._terrainProvider.requestVertexNormals?t._surface._tileProvider.materialUniformMap=void 0:(i.push(t._material.shaderSource),n.push("APPLY_MATERIAL"),t._surface._tileProvider.materialUniformMap=t._material._uniforms),i.push("uniform vec4 u_initialColor;\n#if TEXTURE_UNITS > 0\nuniform sampler2D u_dayTextures[TEXTURE_UNITS];\nuniform vec4 u_dayTextureTranslationAndScale[TEXTURE_UNITS];\nuniform bool u_dayTextureUseWebMercatorT[TEXTURE_UNITS];\n#ifdef APPLY_ALPHA\nuniform float u_dayTextureAlpha[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_DAY_NIGHT_ALPHA\nuniform float u_dayTextureNightAlpha[TEXTURE_UNITS];\nuniform float u_dayTextureDayAlpha[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_SPLIT\nuniform float u_dayTextureSplit[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_BRIGHTNESS\nuniform float u_dayTextureBrightness[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_CONTRAST\nuniform float u_dayTextureContrast[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_HUE\nuniform float u_dayTextureHue[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_SATURATION\nuniform float u_dayTextureSaturation[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_GAMMA\nuniform float u_dayTextureOneOverGamma[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_IMAGERY_CUTOUT\nuniform vec4 u_dayTextureCutoutRectangles[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_COLOR_TO_ALPHA\nuniform vec4 u_colorsToAlpha[TEXTURE_UNITS];\n#endif\nuniform vec4 u_dayTextureTexCoordsRectangle[TEXTURE_UNITS];\n#endif\n#ifdef SHOW_REFLECTIVE_OCEAN\nuniform sampler2D u_waterMask;\nuniform vec4 u_waterMaskTranslationAndScale;\nuniform float u_zoomedOutOceanSpecularIntensity;\n#endif\n#ifdef SHOW_OCEAN_WAVES\nuniform sampler2D u_oceanNormalMap;\n#endif\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\nuniform vec2 u_lightingFadeDistance;\n#endif\n#ifdef TILE_LIMIT_RECTANGLE\nuniform vec4 u_cartographicLimitRectangle;\n#endif\n#ifdef GROUND_ATMOSPHERE\nuniform vec2 u_nightFadeDistance;\n#endif\n#ifdef ENABLE_CLIPPING_PLANES\nuniform highp sampler2D u_clippingPlanes;\nuniform mat4 u_clippingPlanesMatrix;\nuniform vec4 u_clippingPlanesEdgeStyle;\n#endif\n#if defined(FOG) && defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\nuniform float u_minimumBrightness;\n#endif\n#ifdef COLOR_CORRECT\nuniform vec3 u_hsbShift;\n#endif\n#ifdef HIGHLIGHT_FILL_TILE\nuniform vec4 u_fillHighlightColor;\n#endif\n#ifdef TRANSLUCENT\nuniform vec4 u_frontFaceAlphaByDistance;\nuniform vec4 u_backFaceAlphaByDistance;\nuniform vec4 u_translucencyRectangle;\n#endif\n#ifdef UNDERGROUND_COLOR\nuniform vec4 u_undergroundColor;\nuniform vec4 u_undergroundColorAlphaByDistance;\n#endif\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec3 v_textureCoordinates;\nvarying vec3 v_normalMC;\nvarying vec3 v_normalEC;\n#ifdef APPLY_MATERIAL\nvarying float v_height;\nvarying float v_slope;\nvarying float v_aspect;\n#endif\n#if defined(FOG) || defined(GROUND_ATMOSPHERE) || defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)\nvarying float v_distance;\n#endif\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nvarying vec3 v_fogRayleighColor;\nvarying vec3 v_fogMieColor;\n#endif\n#ifdef GROUND_ATMOSPHERE\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\n#endif\n#if defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)\nfloat interpolateByDistance(vec4 nearFarScalar, float distance)\n{\nfloat startDistance = nearFarScalar.x;\nfloat startValue = nearFarScalar.y;\nfloat endDistance = nearFarScalar.z;\nfloat endValue = nearFarScalar.w;\nfloat t = clamp((distance - startDistance) / (endDistance - startDistance), 0.0, 1.0);\nreturn mix(startValue, endValue, t);\n}\n#endif\n#if defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT) || defined(APPLY_MATERIAL)\nvec4 alphaBlend(vec4 sourceColor, vec4 destinationColor)\n{\nreturn sourceColor * vec4(sourceColor.aaa, 1.0) + destinationColor * (1.0 - sourceColor.a);\n}\n#endif\n#ifdef TRANSLUCENT\nbool inTranslucencyRectangle()\n{\nreturn\nv_textureCoordinates.x > u_translucencyRectangle.x &&\nv_textureCoordinates.x < u_translucencyRectangle.z &&\nv_textureCoordinates.y > u_translucencyRectangle.y &&\nv_textureCoordinates.y < u_translucencyRectangle.w;\n}\n#endif\nvec4 sampleAndBlend(\nvec4 previousColor,\nsampler2D textureToSample,\nvec2 tileTextureCoordinates,\nvec4 textureCoordinateRectangle,\nvec4 textureCoordinateTranslationAndScale,\nfloat textureAlpha,\nfloat textureNightAlpha,\nfloat textureDayAlpha,\nfloat textureBrightness,\nfloat textureContrast,\nfloat textureHue,\nfloat textureSaturation,\nfloat textureOneOverGamma,\nfloat split,\nvec4 colorToAlpha,\nfloat nightBlend)\n{\nvec2 alphaMultiplier = step(textureCoordinateRectangle.st, tileTextureCoordinates);\ntextureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\nalphaMultiplier = step(vec2(0.0), textureCoordinateRectangle.pq - tileTextureCoordinates);\ntextureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n#if defined(APPLY_DAY_NIGHT_ALPHA) && defined(ENABLE_DAYNIGHT_SHADING)\ntextureAlpha *= mix(textureDayAlpha, textureNightAlpha, nightBlend);\n#endif\nvec2 translation = textureCoordinateTranslationAndScale.xy;\nvec2 scale = textureCoordinateTranslationAndScale.zw;\nvec2 textureCoordinates = tileTextureCoordinates * scale + translation;\nvec4 value = texture2D(textureToSample, textureCoordinates);\nvec3 color = value.rgb;\nfloat alpha = value.a;\n#ifdef APPLY_COLOR_TO_ALPHA\nvec3 colorDiff = abs(color.rgb - colorToAlpha.rgb);\ncolorDiff.r = max(max(colorDiff.r, colorDiff.g), colorDiff.b);\nalpha = czm_branchFreeTernary(colorDiff.r < colorToAlpha.a, 0.0, alpha);\n#endif\n#if !defined(APPLY_GAMMA)\nvec4 tempColor = czm_gammaCorrect(vec4(color, alpha));\ncolor = tempColor.rgb;\nalpha = tempColor.a;\n#else\ncolor = pow(color, vec3(textureOneOverGamma));\n#endif\n#ifdef APPLY_SPLIT\nfloat splitPosition = czm_imagerySplitPosition;\nif (split < 0.0 && gl_FragCoord.x > splitPosition) {\nalpha = 0.0;\n}\nelse if (split > 0.0 && gl_FragCoord.x < splitPosition) {\nalpha = 0.0;\n}\n#endif\n#ifdef APPLY_BRIGHTNESS\ncolor = mix(vec3(0.0), color, textureBrightness);\n#endif\n#ifdef APPLY_CONTRAST\ncolor = mix(vec3(0.5), color, textureContrast);\n#endif\n#ifdef APPLY_HUE\ncolor = czm_hue(color, textureHue);\n#endif\n#ifdef APPLY_SATURATION\ncolor = czm_saturation(color, textureSaturation);\n#endif\nfloat sourceAlpha = alpha * textureAlpha;\nfloat outAlpha = mix(previousColor.a, 1.0, sourceAlpha);\noutAlpha += sign(outAlpha) - 1.0;\nvec3 outColor = mix(previousColor.rgb * previousColor.a, color, sourceAlpha) / outAlpha;\nreturn vec4(outColor, max(outAlpha, 0.0));\n}\nvec3 colorCorrect(vec3 rgb) {\n#ifdef COLOR_CORRECT\nvec3 hsb = czm_RGBToHSB(rgb);\nhsb.x += u_hsbShift.x;\nhsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0);\nhsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0;\nrgb = czm_HSBToRGB(hsb);\n#endif\nreturn rgb;\n}\nvec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates, float nightBlend);\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float specularMapValue, float fade);\n#ifdef GROUND_ATMOSPHERE\nvec3 computeGroundAtmosphereColor(vec3 fogColor, vec4 finalColor, vec3 atmosphereLightDirection, float cameraDist);\n#endif\nconst float fExposure = 2.0;\nvoid main()\n{\n#ifdef TILE_LIMIT_RECTANGLE\nif (v_textureCoordinates.x < u_cartographicLimitRectangle.x || u_cartographicLimitRectangle.z < v_textureCoordinates.x ||\nv_textureCoordinates.y < u_cartographicLimitRectangle.y || u_cartographicLimitRectangle.w < v_textureCoordinates.y)\n{\ndiscard;\n}\n#endif\n#ifdef ENABLE_CLIPPING_PLANES\nfloat clipDistance = clip(gl_FragCoord, u_clippingPlanes, u_clippingPlanesMatrix);\n#endif\n#if defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(HDR)\nvec3 normalMC = czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0));\nvec3 normalEC = czm_normal3D * normalMC;\n#endif\n#if defined(APPLY_DAY_NIGHT_ALPHA) && defined(ENABLE_DAYNIGHT_SHADING)\nfloat nightBlend = 1.0 - clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * 5.0, 0.0, 1.0);\n#else\nfloat nightBlend = 0.0;\n#endif\nvec4 color = computeDayColor(u_initialColor, clamp(v_textureCoordinates, 0.0, 1.0), nightBlend);\n#ifdef SHOW_TILE_BOUNDARIES\nif (v_textureCoordinates.x < (1.0/256.0) || v_textureCoordinates.x > (255.0/256.0) ||\nv_textureCoordinates.y < (1.0/256.0) || v_textureCoordinates.y > (255.0/256.0))\n{\ncolor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n#endif\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\nfloat cameraDist;\nif (czm_sceneMode == czm_sceneMode2D)\n{\ncameraDist = max(czm_frustumPlanes.x - czm_frustumPlanes.y, czm_frustumPlanes.w - czm_frustumPlanes.z) * 0.5;\n}\nelse if (czm_sceneMode == czm_sceneModeColumbusView)\n{\ncameraDist = -czm_view[3].z;\n}\nelse\n{\ncameraDist = length(czm_view[3]);\n}\nfloat fadeOutDist = u_lightingFadeDistance.x;\nfloat fadeInDist = u_lightingFadeDistance.y;\nif (czm_sceneMode != czm_sceneMode3D) {\nvec3 radii = czm_ellipsoidRadii;\nfloat maxRadii = max(radii.x, max(radii.y, radii.z));\nfadeOutDist -= maxRadii;\nfadeInDist -= maxRadii;\n}\nfloat fade = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\n#else\nfloat fade = 0.0;\n#endif\n#ifdef SHOW_REFLECTIVE_OCEAN\nvec2 waterMaskTranslation = u_waterMaskTranslationAndScale.xy;\nvec2 waterMaskScale = u_waterMaskTranslationAndScale.zw;\nvec2 waterMaskTextureCoordinates = v_textureCoordinates.xy * waterMaskScale + waterMaskTranslation;\nwaterMaskTextureCoordinates.y = 1.0 - waterMaskTextureCoordinates.y;\nfloat mask = texture2D(u_waterMask, waterMaskTextureCoordinates).r;\nif (mask > 0.0)\n{\nmat3 enuToEye = czm_eastNorthUpToEyeCoordinates(v_positionMC, normalEC);\nvec2 ellipsoidTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC);\nvec2 ellipsoidFlippedTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC.zyx);\nvec2 textureCoordinates = mix(ellipsoidTextureCoordinates, ellipsoidFlippedTextureCoordinates, czm_morphTime * smoothstep(0.9, 0.95, normalMC.z));\ncolor = computeWaterColor(v_positionEC, textureCoordinates, enuToEye, color, mask, fade);\n}\n#endif\n#ifdef APPLY_MATERIAL\nczm_materialInput materialInput;\nmaterialInput.st = v_textureCoordinates.st;\nmaterialInput.normalEC = normalize(v_normalEC);\nmaterialInput.slope = v_slope;\nmaterialInput.height = v_height;\nmaterialInput.aspect = v_aspect;\nczm_material material = czm_getMaterial(materialInput);\nvec4 materialColor = vec4(material.diffuse, material.alpha);\ncolor = alphaBlend(materialColor, color);\n#endif\n#ifdef ENABLE_VERTEX_LIGHTING\nfloat diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalize(v_normalEC)) * 0.9 + 0.3, 0.0, 1.0);\nvec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);\n#elif defined(ENABLE_DAYNIGHT_SHADING)\nfloat diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * 5.0 + 0.3, 0.0, 1.0);\ndiffuseIntensity = mix(1.0, diffuseIntensity, fade);\nvec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);\n#else\nvec4 finalColor = color;\n#endif\n#ifdef ENABLE_CLIPPING_PLANES\nvec4 clippingPlanesEdgeColor = vec4(1.0);\nclippingPlanesEdgeColor.rgb = u_clippingPlanesEdgeStyle.rgb;\nfloat clippingPlanesEdgeWidth = u_clippingPlanesEdgeStyle.a;\nif (clipDistance < clippingPlanesEdgeWidth)\n{\nfinalColor = clippingPlanesEdgeColor;\n}\n#endif\n#ifdef HIGHLIGHT_FILL_TILE\nfinalColor = vec4(mix(finalColor.rgb, u_fillHighlightColor.rgb, u_fillHighlightColor.a), finalColor.a);\n#endif\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nvec3 fogColor = colorCorrect(v_fogMieColor) + finalColor.rgb * colorCorrect(v_fogRayleighColor);\n#ifndef HDR\nfogColor = vec3(1.0) - exp(-fExposure * fogColor);\n#endif\n#endif\n#if defined(DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN)\nvec3 atmosphereLightDirection = czm_sunDirectionWC;\n#else\nvec3 atmosphereLightDirection = czm_lightDirectionWC;\n#endif\n#ifdef FOG\n#if defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\nfloat darken = clamp(dot(normalize(czm_viewerPositionWC), atmosphereLightDirection), u_minimumBrightness, 1.0);\nfogColor *= darken;\n#endif\n#ifdef HDR\nconst float modifier = 0.15;\nfinalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor, modifier), finalColor.a);\n#else\nfinalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor), finalColor.a);\n#endif\n#endif\n#ifdef GROUND_ATMOSPHERE\nif (!czm_backFacing())\n{\nvec3 groundAtmosphereColor = computeGroundAtmosphereColor(fogColor, finalColor, atmosphereLightDirection, cameraDist);\nfinalColor = vec4(mix(finalColor.rgb, groundAtmosphereColor, fade), finalColor.a);\n}\n#endif\n#ifdef UNDERGROUND_COLOR\nif (czm_backFacing())\n{\nfloat distanceFromEllipsoid = max(czm_eyeHeight, 0.0);\nfloat distance = max(v_distance - distanceFromEllipsoid, 0.0);\nfloat blendAmount = interpolateByDistance(u_undergroundColorAlphaByDistance, distance);\nvec4 undergroundColor = vec4(u_undergroundColor.rgb, u_undergroundColor.a * blendAmount);\nfinalColor = alphaBlend(undergroundColor, finalColor);\n}\n#endif\n#ifdef TRANSLUCENT\nif (inTranslucencyRectangle())\n{\nvec4 alphaByDistance = gl_FrontFacing ? u_frontFaceAlphaByDistance : u_backFaceAlphaByDistance;\nfinalColor.a *= interpolateByDistance(alphaByDistance, v_distance);\n}\n#endif\ngl_FragColor = finalColor;\n}\n#ifdef GROUND_ATMOSPHERE\nvec3 computeGroundAtmosphereColor(vec3 fogColor, vec4 finalColor, vec3 atmosphereLightDirection, float cameraDist)\n{\n#if defined(PER_FRAGMENT_GROUND_ATMOSPHERE) && defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_DAYNIGHT_SHADING) || defined(ENABLE_VERTEX_LIGHTING))\nfloat mpp = czm_metersPerPixel(vec4(0.0, 0.0, -czm_currentFrustum.x, 1.0), 1.0);\nvec2 xy = gl_FragCoord.xy / czm_viewport.zw * 2.0 - vec2(1.0);\nxy *= czm_viewport.zw * mpp * 0.5;\nvec3 direction = normalize(vec3(xy, -czm_currentFrustum.x));\nczm_ray ray = czm_ray(vec3(0.0), direction);\nvec3 ellipsoid_center = czm_view[3].xyz;\nczm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);\nvec3 ellipsoidPosition = czm_pointAlongRay(ray, intersection.start);\nellipsoidPosition = (czm_inverseView * vec4(ellipsoidPosition, 1.0)).xyz;\nAtmosphereColor atmosColor = computeGroundAtmosphereFromSpace(ellipsoidPosition, true, atmosphereLightDirection);\nvec3 groundAtmosphereColor = colorCorrect(atmosColor.mie) + finalColor.rgb * colorCorrect(atmosColor.rayleigh);\n#ifndef HDR\ngroundAtmosphereColor = vec3(1.0) - exp(-fExposure * groundAtmosphereColor);\n#endif\nfloat fadeInDist = u_nightFadeDistance.x;\nfloat fadeOutDist = u_nightFadeDistance.y;\nfloat sunlitAtmosphereIntensity = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\n#ifdef HDR\nsunlitAtmosphereIntensity = max(sunlitAtmosphereIntensity * sunlitAtmosphereIntensity, 0.03);\n#endif\ngroundAtmosphereColor = mix(groundAtmosphereColor, fogColor, sunlitAtmosphereIntensity);\n#else\nvec3 groundAtmosphereColor = fogColor;\n#endif\n#ifdef HDR\ngroundAtmosphereColor = czm_saturation(groundAtmosphereColor, 1.6);\n#endif\nreturn groundAtmosphereColor;\n}\n#endif\n#ifdef SHOW_REFLECTIVE_OCEAN\nfloat waveFade(float edge0, float edge1, float x)\n{\nfloat y = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\nreturn pow(1.0 - y, 5.0);\n}\nfloat linearFade(float edge0, float edge1, float x)\n{\nreturn clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n}\nconst float oceanFrequencyLowAltitude = 825000.0;\nconst float oceanAnimationSpeedLowAltitude = 0.004;\nconst float oceanOneOverAmplitudeLowAltitude = 1.0 / 2.0;\nconst float oceanSpecularIntensity = 0.5;\nconst float oceanFrequencyHighAltitude = 125000.0;\nconst float oceanAnimationSpeedHighAltitude = 0.008;\nconst float oceanOneOverAmplitudeHighAltitude = 1.0 / 2.0;\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float maskValue, float fade)\n{\nvec3 positionToEyeEC = -positionEyeCoordinates;\nfloat positionToEyeECLength = length(positionToEyeEC);\nvec3 normalizedPositionToEyeEC = normalize(normalize(positionToEyeEC));\nfloat waveIntensity = waveFade(70000.0, 1000000.0, positionToEyeECLength);\n#ifdef SHOW_OCEAN_WAVES\nfloat time = czm_frameNumber * oceanAnimationSpeedHighAltitude;\nvec4 noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyHighAltitude, time, 0.0);\nvec3 normalTangentSpaceHighAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeHighAltitude);\ntime = czm_frameNumber * oceanAnimationSpeedLowAltitude;\nnoise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyLowAltitude, time, 0.0);\nvec3 normalTangentSpaceLowAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeLowAltitude);\nfloat highAltitudeFade = linearFade(0.0, 60000.0, positionToEyeECLength);\nfloat lowAltitudeFade = 1.0 - linearFade(20000.0, 60000.0, positionToEyeECLength);\nvec3 normalTangentSpace =\n(highAltitudeFade * normalTangentSpaceHighAltitude) +\n(lowAltitudeFade * normalTangentSpaceLowAltitude);\nnormalTangentSpace = normalize(normalTangentSpace);\nnormalTangentSpace.xy *= waveIntensity;\nnormalTangentSpace = normalize(normalTangentSpace);\n#else\nvec3 normalTangentSpace = vec3(0.0, 0.0, 1.0);\n#endif\nvec3 normalEC = enuToEye * normalTangentSpace;\nconst vec3 waveHighlightColor = vec3(0.3, 0.45, 0.6);\nfloat diffuseIntensity = czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * maskValue;\nvec3 diffuseHighlight = waveHighlightColor * diffuseIntensity * (1.0 - fade);\n#ifdef SHOW_OCEAN_WAVES\nfloat tsPerturbationRatio = normalTangentSpace.z;\nvec3 nonDiffuseHighlight = mix(waveHighlightColor * 5.0 * (1.0 - tsPerturbationRatio), vec3(0.0), diffuseIntensity);\n#else\nvec3 nonDiffuseHighlight = vec3(0.0);\n#endif\nfloat specularIntensity = czm_getSpecular(czm_lightDirectionEC, normalizedPositionToEyeEC, normalEC, 10.0);\nfloat surfaceReflectance = mix(0.0, mix(u_zoomedOutOceanSpecularIntensity, oceanSpecularIntensity, waveIntensity), maskValue);\nfloat specular = specularIntensity * surfaceReflectance;\n#ifdef HDR\nspecular *= 1.4;\nfloat e = 0.2;\nfloat d = 3.3;\nfloat c = 1.7;\nvec3 color = imageryColor.rgb + (c * (vec3(e) + imageryColor.rgb * d) * (diffuseHighlight + nonDiffuseHighlight + specular));\n#else\nvec3 color = imageryColor.rgb + diffuseHighlight + nonDiffuseHighlight + specular;\n#endif\nreturn vec4(color, imageryColor.a);\n}\n#endif // #ifdef SHOW_REFLECTIVE_OCEAN\n"),t._surfaceShaderSet.baseVertexShaderSource=new nc({sources:[Lm,"#ifdef QUANTIZATION_BITS12\nattribute vec4 compressed0;\nattribute float compressed1;\n#else\nattribute vec4 position3DAndHeight;\nattribute vec4 textureCoordAndEncodedNormals;\n#endif\nuniform vec3 u_center3D;\nuniform mat4 u_modifiedModelView;\nuniform mat4 u_modifiedModelViewProjection;\nuniform vec4 u_tileRectangle;\nuniform vec2 u_southAndNorthLatitude;\nuniform vec2 u_southMercatorYAndOneOverHeight;\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec3 v_textureCoordinates;\nvarying vec3 v_normalMC;\nvarying vec3 v_normalEC;\n#ifdef APPLY_MATERIAL\nvarying float v_slope;\nvarying float v_aspect;\nvarying float v_height;\n#endif\n#if defined(FOG) || defined(GROUND_ATMOSPHERE) || defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)\nvarying float v_distance;\n#endif\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nvarying vec3 v_fogMieColor;\nvarying vec3 v_fogRayleighColor;\n#endif\nvec4 getPosition(vec3 position, float height, vec2 textureCoordinates);\nfloat get2DYPositionFraction(vec2 textureCoordinates);\nvec4 getPosition3DMode(vec3 position, float height, vec2 textureCoordinates)\n{\nreturn u_modifiedModelViewProjection * vec4(position, 1.0);\n}\nfloat get2DMercatorYPositionFraction(vec2 textureCoordinates)\n{\nconst float maxTileWidth = 0.003068;\nfloat positionFraction = textureCoordinates.y;\nfloat southLatitude = u_southAndNorthLatitude.x;\nfloat northLatitude = u_southAndNorthLatitude.y;\nif (northLatitude - southLatitude > maxTileWidth)\n{\nfloat southMercatorY = u_southMercatorYAndOneOverHeight.x;\nfloat oneOverMercatorHeight = u_southMercatorYAndOneOverHeight.y;\nfloat currentLatitude = mix(southLatitude, northLatitude, textureCoordinates.y);\ncurrentLatitude = clamp(currentLatitude, -czm_webMercatorMaxLatitude, czm_webMercatorMaxLatitude);\npositionFraction = czm_latitudeToWebMercatorFraction(currentLatitude, southMercatorY, oneOverMercatorHeight);\n}\nreturn positionFraction;\n}\nfloat get2DGeographicYPositionFraction(vec2 textureCoordinates)\n{\nreturn textureCoordinates.y;\n}\nvec4 getPositionPlanarEarth(vec3 position, float height, vec2 textureCoordinates)\n{\nfloat yPositionFraction = get2DYPositionFraction(textureCoordinates);\nvec4 rtcPosition2D = vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\nreturn u_modifiedModelViewProjection * rtcPosition2D;\n}\nvec4 getPosition2DMode(vec3 position, float height, vec2 textureCoordinates)\n{\nreturn getPositionPlanarEarth(position, 0.0, textureCoordinates);\n}\nvec4 getPositionColumbusViewMode(vec3 position, float height, vec2 textureCoordinates)\n{\nreturn getPositionPlanarEarth(position, height, textureCoordinates);\n}\nvec4 getPositionMorphingMode(vec3 position, float height, vec2 textureCoordinates)\n{\nvec3 position3DWC = position + u_center3D;\nfloat yPositionFraction = get2DYPositionFraction(textureCoordinates);\nvec4 position2DWC = vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\nvec4 morphPosition = czm_columbusViewMorph(position2DWC, vec4(position3DWC, 1.0), czm_morphTime);\nreturn czm_modelViewProjection * morphPosition;\n}\n#ifdef QUANTIZATION_BITS12\nuniform vec2 u_minMaxHeight;\nuniform mat4 u_scaleAndBias;\n#endif\nvoid main()\n{\n#ifdef QUANTIZATION_BITS12\nvec2 xy = czm_decompressTextureCoordinates(compressed0.x);\nvec2 zh = czm_decompressTextureCoordinates(compressed0.y);\nvec3 position = vec3(xy, zh.x);\nfloat height = zh.y;\nvec2 textureCoordinates = czm_decompressTextureCoordinates(compressed0.z);\nheight = height * (u_minMaxHeight.y - u_minMaxHeight.x) + u_minMaxHeight.x;\nposition = (u_scaleAndBias * vec4(position, 1.0)).xyz;\n#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)) && defined(INCLUDE_WEB_MERCATOR_Y)\nfloat webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;\nfloat encodedNormal = compressed1;\n#elif defined(INCLUDE_WEB_MERCATOR_Y)\nfloat webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;\nfloat encodedNormal = 0.0;\n#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)\nfloat webMercatorT = textureCoordinates.y;\nfloat encodedNormal = compressed0.w;\n#else\nfloat webMercatorT = textureCoordinates.y;\nfloat encodedNormal = 0.0;\n#endif\n#else\nvec3 position = position3DAndHeight.xyz;\nfloat height = position3DAndHeight.w;\nvec2 textureCoordinates = textureCoordAndEncodedNormals.xy;\n#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)) && defined(INCLUDE_WEB_MERCATOR_Y)\nfloat webMercatorT = textureCoordAndEncodedNormals.z;\nfloat encodedNormal = textureCoordAndEncodedNormals.w;\n#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\nfloat webMercatorT = textureCoordinates.y;\nfloat encodedNormal = textureCoordAndEncodedNormals.z;\n#elif defined(INCLUDE_WEB_MERCATOR_Y)\nfloat webMercatorT = textureCoordAndEncodedNormals.z;\nfloat encodedNormal = 0.0;\n#else\nfloat webMercatorT = textureCoordinates.y;\nfloat encodedNormal = 0.0;\n#endif\n#endif\nvec3 position3DWC = position + u_center3D;\ngl_Position = getPosition(position, height, textureCoordinates);\nv_textureCoordinates = vec3(textureCoordinates, webMercatorT);\n#if defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\nv_positionEC = (u_modifiedModelView * vec4(position, 1.0)).xyz;\nv_positionMC = position3DWC;\nvec3 normalMC = czm_octDecode(encodedNormal);\nv_normalMC = normalMC;\nv_normalEC = czm_normal3D * v_normalMC;\n#elif defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(GENERATE_POSITION) || defined(HDR)\nv_positionEC = (u_modifiedModelView * vec4(position, 1.0)).xyz;\nv_positionMC = position3DWC;\n#endif\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nAtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(position3DWC, false, vec3(0.0));\nv_fogMieColor = atmosFogColor.mie;\nv_fogRayleighColor = atmosFogColor.rayleigh;\n#endif\n#if defined(FOG) || defined(GROUND_ATMOSPHERE) || defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)\nv_distance = length((czm_modelView3D * vec4(position3DWC, 1.0)).xyz);\n#endif\n#ifdef APPLY_MATERIAL\nfloat northPoleZ = czm_ellipsoidRadii.z;\nvec3 northPolePositionMC = vec3(0.0, 0.0, northPoleZ);\nvec3 ellipsoidNormal = normalize(v_positionMC);\nvec3 vectorEastMC = normalize(cross(northPolePositionMC - v_positionMC, ellipsoidNormal));\nfloat dotProd = abs(dot(ellipsoidNormal, v_normalMC));\nv_slope = acos(dotProd);\nvec3 normalRejected = ellipsoidNormal * dotProd;\nvec3 normalProjected = v_normalMC - normalRejected;\nvec3 aspectVector = normalize(normalProjected);\nv_aspect = acos(dot(aspectVector, vectorEastMC));\nfloat determ = dot(cross(vectorEastMC, aspectVector), ellipsoidNormal);\nv_aspect = czm_branchFreeTernary(determ < 0.0, 2.0 * czm_pi - v_aspect, v_aspect);\nv_height = height;\n#endif\n}\n"],defines:n}),t._surfaceShaderSet.baseFragmentShaderSource=new nc({sources:i,defines:n}),t._surfaceShaderSet.material=t._material}Object.defineProperties(JE.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},imageryLayers:{get:function(){return this._imageryLayerCollection}},imageryLayersUpdatedEvent:{get:function(){return this._surface.tileProvider.imageryLayersUpdatedEvent}},tilesLoaded:{get:function(){return!e(this._surface)||this._surface.tileProvider.ready&&0===this._surface._tileLoadQueueHigh.length&&0===this._surface._tileLoadQueueMedium.length&&0===this._surface._tileLoadQueueLow.length}},baseColor:{get:function(){return this._surface.tileProvider.baseColor},set:function(e){this._surface.tileProvider.baseColor=e}},clippingPlanes:{get:function(){return this._surface.tileProvider.clippingPlanes},set:function(e){this._surface.tileProvider.clippingPlanes=e}},cartographicLimitRectangle:{get:function(){return this._surface.tileProvider.cartographicLimitRectangle},set:function(t){e(t)||(t=Oe.clone(Oe.MAX_VALUE)),this._surface.tileProvider.cartographicLimitRectangle=t}},oceanNormalMapUrl:{get:function(){return this._oceanNormalMapResource.url},set:function(e){this._oceanNormalMapResource.url=e,this._oceanNormalMapResourceDirty=!0}},terrainProvider:{get:function(){return this._terrainProvider},set:function(t){t!==this._terrainProvider&&(this._terrainProvider=t,this._terrainProviderChanged.raiseEvent(t),e(this._material)&&$E(this))}},terrainProviderChanged:{get:function(){return this._terrainProviderChanged}},tileLoadProgressEvent:{get:function(){return this._surface.tileLoadProgressEvent}},material:{get:function(){return this._material},set:function(e){this._material!==e&&(this._material=e,$E(this))}},undergroundColor:{get:function(){return this._undergroundColor},set:function(e){this._undergroundColor=pn.clone(e,this._undergroundColor)}},undergroundColorAlphaByDistance:{get:function(){return this._undergroundColorAlphaByDistance},set:function(e){this._undergroundColorAlphaByDistance=fr.clone(e,this._undergroundColorAlphaByDistance)}},translucency:{get:function(){return this._translucency}}});var ex=[],tx={start:0,stop:0};JE.prototype.pickWorldCoordinates=function(t,n,r,o){r=i(r,!0);var a=n.mode,s=n.mapProjection,u=ex;u.length=0;var c,l,h,d,f=this._surface._tilesToRender,m=f.length;for(l=0;l<m;++l){var _=(c=f[l]).data;if(e(_)){var g=_.pickBoundingSphere;if(a!==Al.SCENE3D)_.pickBoundingSphere=g=Me.fromRectangleWithHeights2D(c.rectangle,s,_.tileBoundingRegion.minimumHeight,_.tileBoundingRegion.maximumHeight,g),p.fromElements(g.center.z,g.center.x,g.center.y,g.center);else{if(!e(_.renderedMesh))continue;Me.clone(_.renderedMesh.boundingSphere3D,g)}e(zn.raySphere(t,g,tx))&&u.push(_)}}for(u.sort((h=t.origin,function(e,t){return Me.distanceSquaredTo(e.pickBoundingSphere,h)-Me.distanceSquaredTo(t.pickBoundingSphere,h)})),m=u.length,l=0;l<m&&!e(d=u[l].pick(t,n.mode,n.mapProjection,r,o));++l);return d};var nx=new N;JE.prototype.pick=function(t,n,r){if(e(r=this.pickWorldCoordinates(t,n,!0,r))&&n.mode!==Al.SCENE3D){r=p.fromElements(r.y,r.z,r.x,r);var i=n.mapProjection.unproject(r,nx);r=n.globe.ellipsoid.cartographicToCartesian(i,r)}return r};var rx=new p,ix=new p,ox=new N,ax=new Fn;function sx(t,n){return e(t)&&Oe.contains(t.rectangle,n)?t:void 0}JE.prototype.getHeight=function(t){var n=this._surface._levelZeroTiles;if(e(n)){var r,o,a=n.length;for(o=0;o<a&&(r=n[o],!Oe.contains(r.rectangle,t));++o);if(!(o>=a)){for(var s=r;e(r);)e(r=sx(r._southwestChild,t)||sx(r._southeastChild,t)||sx(r._northwestChild,t)||r._northeastChild)&&e(r.data)&&e(r.data.renderedMesh)&&(s=r);if(e(r=s)&&e(r.data)&&e(r.data.renderedMesh)){var u=this._surface._tileProvider.tilingScheme.ellipsoid,c=p.fromRadians(t.longitude,t.latitude,0,u,rx),l=ax,h=u.geodeticSurfaceNormal(c,l.direction);if(!e(u.getSurfaceNormalIntersectionWithZAxis(c,11500,l.origin))){var d;e(r.data.tileBoundingRegion)&&(d=r.data.tileBoundingRegion.minimumHeight);var f=Math.min(i(d,0),-11500),m=p.multiplyByScalar(h,Math.abs(f)+1,ix);p.subtract(c,m,l.origin)}var _=r.data.pick(l,void 0,void 0,!1,ix);if(e(_))return u.cartesianToCartographic(_,ox).height}}}},JE.prototype.update=function(e){this.show&&e.passes.render&&this._surface.update(e)},JE.prototype.beginFrame=function(t){var n=this._surface,r=n.tileProvider,i=this.terrainProvider,o=this.showWaterEffect&&i.ready&&i.hasWaterMask;if(o&&this._oceanNormalMapResourceDirty){this._oceanNormalMapResourceDirty=!1;var a=this._oceanNormalMapResource,s=a.url;if(e(s)){var u=this;Et(a.fetchImage(),(function(e){s===u._oceanNormalMapResource.url&&(u._oceanNormalMap=u._oceanNormalMap&&u._oceanNormalMap.destroy(),u._oceanNormalMap=new Fh({context:t.context,source:e}))}))}else this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy()}var c=t.passes,l=t.mode;c.render&&(this.showGroundAtmosphere?this._zoomedOutOceanSpecularIntensity=.4:this._zoomedOutOceanSpecularIntensity=.5,n.maximumScreenSpaceError=this.maximumScreenSpaceError,n.tileCacheSize=this.tileCacheSize,n.loadingDescendantLimit=this.loadingDescendantLimit,n.preloadAncestors=this.preloadAncestors,n.preloadSiblings=this.preloadSiblings,r.terrainProvider=this.terrainProvider,r.lightingFadeOutDistance=this.lightingFadeOutDistance,r.lightingFadeInDistance=this.lightingFadeInDistance,r.nightFadeOutDistance=this.nightFadeOutDistance,r.nightFadeInDistance=this.nightFadeInDistance,r.zoomedOutOceanSpecularIntensity=l===Al.SCENE3D?this._zoomedOutOceanSpecularIntensity:0,r.hasWaterMask=o,r.oceanNormalMap=this._oceanNormalMap,r.enableLighting=this.enableLighting,r.dynamicAtmosphereLighting=this.dynamicAtmosphereLighting,r.dynamicAtmosphereLightingFromSun=this.dynamicAtmosphereLightingFromSun,r.showGroundAtmosphere=this.showGroundAtmosphere,r.shadows=this.shadows,r.hueShift=this.atmosphereHueShift,r.saturationShift=this.atmosphereSaturationShift,r.brightnessShift=this.atmosphereBrightnessShift,r.fillHighlightColor=this.fillHighlightColor,r.showSkirts=this.showSkirts,r.backFaceCulling=this.backFaceCulling,r.undergroundColor=this._undergroundColor,r.undergroundColorAlphaByDistance=this._undergroundColorAlphaByDistance,n.beginFrame(t))},JE.prototype.render=function(t){this.show&&(e(this._material)&&this._material.update(t.context),this._surface.render(t))},JE.prototype.endFrame=function(e){this.show&&e.passes.render&&this._surface.endFrame(e)},JE.prototype.isDestroyed=function(){return!1},JE.prototype.destroy=function(){return this._surfaceShaderSet=this._surfaceShaderSet&&this._surfaceShaderSet.destroy(),this._surface=this._surface&&this._surface.destroy(),this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy(),hi(this)};var ux=new p;function cx(e){var t=(e=i(e,i.EMPTY_OBJECT)).minimum,n=e.maximum,r=i(e.vertexFormat,fg.DEFAULT);this._minimum=p.clone(t),this._maximum=p.clone(n),this._vertexFormat=r,this._offsetAttribute=e.offsetAttribute,this._workerName="createBoxGeometry"}cx.fromDimensions=function(e){var t=(e=i(e,i.EMPTY_OBJECT)).dimensions,n=p.multiplyByScalar(t,.5,new p);return new cx({minimum:p.negate(n,new p),maximum:n,vertexFormat:e.vertexFormat,offsetAttribute:e.offsetAttribute})},cx.fromAxisAlignedBoundingBox=function(e){return new cx({minimum:e.minimum,maximum:e.maximum})},cx.packedLength=2*p.packedLength+fg.packedLength+1,cx.pack=function(e,t,n){return n=i(n,0),p.pack(e._minimum,t,n),p.pack(e._maximum,t,n+p.packedLength),fg.pack(e._vertexFormat,t,n+2*p.packedLength),t[n+2*p.packedLength+fg.packedLength]=i(e._offsetAttribute,-1),t};var lx,hx=new p,dx=new p,fx=new fg,mx={minimum:hx,maximum:dx,vertexFormat:fx,offsetAttribute:void 0};cx.unpack=function(t,n,r){n=i(n,0);var o=p.unpack(t,n,hx),a=p.unpack(t,n+p.packedLength,dx),s=fg.unpack(t,n+2*p.packedLength,fx),u=t[n+2*p.packedLength+fg.packedLength];return e(r)?(r._minimum=p.clone(o,r._minimum),r._maximum=p.clone(a,r._maximum),r._vertexFormat=fg.clone(s,r._vertexFormat),r._offsetAttribute=-1===u?void 0:u,r):(mx.offsetAttribute=-1===u?void 0:u,new cx(mx))},cx.createGeometry=function(t){var n=t._minimum,r=t._maximum,i=t._vertexFormat;if(!p.equals(n,r)){var o,a,s=new np;if(i.position&&(i.st||i.normal||i.tangent||i.bitangent)){if(i.position&&((a=new Float64Array(72))[0]=n.x,a[1]=n.y,a[2]=r.z,a[3]=r.x,a[4]=n.y,a[5]=r.z,a[6]=r.x,a[7]=r.y,a[8]=r.z,a[9]=n.x,a[10]=r.y,a[11]=r.z,a[12]=n.x,a[13]=n.y,a[14]=n.z,a[15]=r.x,a[16]=n.y,a[17]=n.z,a[18]=r.x,a[19]=r.y,a[20]=n.z,a[21]=n.x,a[22]=r.y,a[23]=n.z,a[24]=r.x,a[25]=n.y,a[26]=n.z,a[27]=r.x,a[28]=r.y,a[29]=n.z,a[30]=r.x,a[31]=r.y,a[32]=r.z,a[33]=r.x,a[34]=n.y,a[35]=r.z,a[36]=n.x,a[37]=n.y,a[38]=n.z,a[39]=n.x,a[40]=r.y,a[41]=n.z,a[42]=n.x,a[43]=r.y,a[44]=r.z,a[45]=n.x,a[46]=n.y,a[47]=r.z,a[48]=n.x,a[49]=r.y,a[50]=n.z,a[51]=r.x,a[52]=r.y,a[53]=n.z,a[54]=r.x,a[55]=r.y,a[56]=r.z,a[57]=n.x,a[58]=r.y,a[59]=r.z,a[60]=n.x,a[61]=n.y,a[62]=n.z,a[63]=r.x,a[64]=n.y,a[65]=n.z,a[66]=r.x,a[67]=n.y,a[68]=r.z,a[69]=n.x,a[70]=n.y,a[71]=r.z,s.position=new tp({componentDatatype:xn.DOUBLE,componentsPerAttribute:3,values:a})),i.normal){var u=new Float32Array(72);u[0]=0,u[1]=0,u[2]=1,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=1,u[9]=0,u[10]=0,u[11]=1,u[12]=0,u[13]=0,u[14]=-1,u[15]=0,u[16]=0,u[17]=-1,u[18]=0,u[19]=0,u[20]=-1,u[21]=0,u[22]=0,u[23]=-1,u[24]=1,u[25]=0,u[26]=0,u[27]=1,u[28]=0,u[29]=0,u[30]=1,u[31]=0,u[32]=0,u[33]=1,u[34]=0,u[35]=0,u[36]=-1,u[37]=0,u[38]=0,u[39]=-1,u[40]=0,u[41]=0,u[42]=-1,u[43]=0,u[44]=0,u[45]=-1,u[46]=0,u[47]=0,u[48]=0,u[49]=1,u[50]=0,u[51]=0,u[52]=1,u[53]=0,u[54]=0,u[55]=1,u[56]=0,u[57]=0,u[58]=1,u[59]=0,u[60]=0,u[61]=-1,u[62]=0,u[63]=0,u[64]=-1,u[65]=0,u[66]=0,u[67]=-1,u[68]=0,u[69]=0,u[70]=-1,u[71]=0,s.normal=new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:3,values:u})}if(i.st){var c=new Float32Array(48);c[0]=0,c[1]=0,c[2]=1,c[3]=0,c[4]=1,c[5]=1,c[6]=0,c[7]=1,c[8]=1,c[9]=0,c[10]=0,c[11]=0,c[12]=0,c[13]=1,c[14]=1,c[15]=1,c[16]=0,c[17]=0,c[18]=1,c[19]=0,c[20]=1,c[21]=1,c[22]=0,c[23]=1,c[24]=1,c[25]=0,c[26]=0,c[27]=0,c[28]=0,c[29]=1,c[30]=1,c[31]=1,c[32]=1,c[33]=0,c[34]=0,c[35]=0,c[36]=0,c[37]=1,c[38]=1,c[39]=1,c[40]=0,c[41]=0,c[42]=1,c[43]=0,c[44]=1,c[45]=1,c[46]=0,c[47]=1,s.st=new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:2,values:c})}if(i.tangent){var l=new Float32Array(72);l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=0,l[5]=0,l[6]=1,l[7]=0,l[8]=0,l[9]=1,l[10]=0,l[11]=0,l[12]=-1,l[13]=0,l[14]=0,l[15]=-1,l[16]=0,l[17]=0,l[18]=-1,l[19]=0,l[20]=0,l[21]=-1,l[22]=0,l[23]=0,l[24]=0,l[25]=1,l[26]=0,l[27]=0,l[28]=1,l[29]=0,l[30]=0,l[31]=1,l[32]=0,l[33]=0,l[34]=1,l[35]=0,l[36]=0,l[37]=-1,l[38]=0,l[39]=0,l[40]=-1,l[41]=0,l[42]=0,l[43]=-1,l[44]=0,l[45]=0,l[46]=-1,l[47]=0,l[48]=-1,l[49]=0,l[50]=0,l[51]=-1,l[52]=0,l[53]=0,l[54]=-1,l[55]=0,l[56]=0,l[57]=-1,l[58]=0,l[59]=0,l[60]=1,l[61]=0,l[62]=0,l[63]=1,l[64]=0,l[65]=0,l[66]=1,l[67]=0,l[68]=0,l[69]=1,l[70]=0,l[71]=0,s.tangent=new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:3,values:l})}if(i.bitangent){var h=new Float32Array(72);h[0]=0,h[1]=1,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=0,h[7]=1,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=1,h[14]=0,h[15]=0,h[16]=1,h[17]=0,h[18]=0,h[19]=1,h[20]=0,h[21]=0,h[22]=1,h[23]=0,h[24]=0,h[25]=0,h[26]=1,h[27]=0,h[28]=0,h[29]=1,h[30]=0,h[31]=0,h[32]=1,h[33]=0,h[34]=0,h[35]=1,h[36]=0,h[37]=0,h[38]=1,h[39]=0,h[40]=0,h[41]=1,h[42]=0,h[43]=0,h[44]=1,h[45]=0,h[46]=0,h[47]=1,h[48]=0,h[49]=0,h[50]=1,h[51]=0,h[52]=0,h[53]=1,h[54]=0,h[55]=0,h[56]=1,h[57]=0,h[58]=0,h[59]=1,h[60]=0,h[61]=0,h[62]=1,h[63]=0,h[64]=0,h[65]=1,h[66]=0,h[67]=0,h[68]=1,h[69]=0,h[70]=0,h[71]=1,s.bitangent=new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:3,values:h})}(o=new Uint16Array(36))[0]=0,o[1]=1,o[2]=2,o[3]=0,o[4]=2,o[5]=3,o[6]=6,o[7]=5,o[8]=4,o[9]=7,o[10]=6,o[11]=4,o[12]=8,o[13]=9,o[14]=10,o[15]=8,o[16]=10,o[17]=11,o[18]=14,o[19]=13,o[20]=12,o[21]=15,o[22]=14,o[23]=12,o[24]=18,o[25]=17,o[26]=16,o[27]=19,o[28]=18,o[29]=16,o[30]=20,o[31]=21,o[32]=22,o[33]=20,o[34]=22,o[35]=23}else(a=new Float64Array(24))[0]=n.x,a[1]=n.y,a[2]=n.z,a[3]=r.x,a[4]=n.y,a[5]=n.z,a[6]=r.x,a[7]=r.y,a[8]=n.z,a[9]=n.x,a[10]=r.y,a[11]=n.z,a[12]=n.x,a[13]=n.y,a[14]=r.z,a[15]=r.x,a[16]=n.y,a[17]=r.z,a[18]=r.x,a[19]=r.y,a[20]=r.z,a[21]=n.x,a[22]=r.y,a[23]=r.z,s.position=new tp({componentDatatype:xn.DOUBLE,componentsPerAttribute:3,values:a}),(o=new Uint16Array(36))[0]=4,o[1]=5,o[2]=6,o[3]=4,o[4]=6,o[5]=7,o[6]=1,o[7]=0,o[8]=3,o[9]=1,o[10]=3,o[11]=2,o[12]=1,o[13]=6,o[14]=5,o[15]=1,o[16]=2,o[17]=6,o[18]=2,o[19]=3,o[20]=7,o[21]=2,o[22]=7,o[23]=6,o[24]=3,o[25]=0,o[26]=4,o[27]=3,o[28]=4,o[29]=7,o[30]=0,o[31]=1,o[32]=5,o[33]=0,o[34]=5,o[35]=4;var d=p.subtract(r,n,ux),f=.5*p.magnitude(d);if(e(t._offsetAttribute)){var m=a.length,_=new Uint8Array(m/3);ep(_,t._offsetAttribute===rp.NONE?0:1),s.applyOffset=new tp({componentDatatype:xn.UNSIGNED_BYTE,componentsPerAttribute:1,values:_})}return new cc({attributes:s,indices:o,primitiveType:Rs.TRIANGLES,boundingSphere:new Me(p.ZERO,f),offsetAttribute:t._offsetAttribute})}},cx.getUnitBox=function(){return e(lx)||(lx=cx.createGeometry(cx.fromDimensions({dimensions:new p(1,1,1),vertexFormat:fg.POSITION_ONLY}))),lx};var px=new p,_x=new p,gx=new p,vx=new p,yx=new p,Tx=new p(1,1,1),Ex=Math.cos,xx=Math.sin;function Cx(e){e=i(e,i.EMPTY_OBJECT);var t=i(e.radii,Tx),n=i(e.innerRadii,t),r=i(e.minimumClock,0),o=i(e.maximumClock,a.TWO_PI),s=i(e.minimumCone,0),u=i(e.maximumCone,a.PI),c=Math.round(i(e.stackPartitions,64)),l=Math.round(i(e.slicePartitions,64)),h=i(e.vertexFormat,fg.DEFAULT);this._radii=p.clone(t),this._innerRadii=p.clone(n),this._minimumClock=r,this._maximumClock=o,this._minimumCone=s,this._maximumCone=u,this._stackPartitions=c,this._slicePartitions=l,this._vertexFormat=fg.clone(h),this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipsoidGeometry"}Cx.packedLength=2*p.packedLength+fg.packedLength+7,Cx.pack=function(e,t,n){return n=i(n,0),p.pack(e._radii,t,n),n+=p.packedLength,p.pack(e._innerRadii,t,n),n+=p.packedLength,fg.pack(e._vertexFormat,t,n),n+=fg.packedLength,t[n++]=e._minimumClock,t[n++]=e._maximumClock,t[n++]=e._minimumCone,t[n++]=e._maximumCone,t[n++]=e._stackPartitions,t[n++]=e._slicePartitions,t[n]=i(e._offsetAttribute,-1),t};var Sx,Ax=new p,wx=new p,bx=new fg,Dx={radii:Ax,innerRadii:wx,vertexFormat:bx,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,offsetAttribute:void 0};Cx.unpack=function(t,n,r){n=i(n,0);var o=p.unpack(t,n,Ax);n+=p.packedLength;var a=p.unpack(t,n,wx);n+=p.packedLength;var s=fg.unpack(t,n,bx);n+=fg.packedLength;var u=t[n++],c=t[n++],l=t[n++],h=t[n++],d=t[n++],f=t[n++],m=t[n];return e(r)?(r._radii=p.clone(o,r._radii),r._innerRadii=p.clone(a,r._innerRadii),r._vertexFormat=fg.clone(s,r._vertexFormat),r._minimumClock=u,r._maximumClock=c,r._minimumCone=l,r._maximumCone=h,r._stackPartitions=d,r._slicePartitions=f,r._offsetAttribute=-1===m?void 0:m,r):(Dx.minimumClock=u,Dx.maximumClock=c,Dx.minimumCone=l,Dx.maximumCone=h,Dx.stackPartitions=d,Dx.slicePartitions=f,Dx.offsetAttribute=-1===m?void 0:m,new Cx(Dx))},Cx.createGeometry=function(t){var n=t._radii;if(!(n.x<=0||n.y<=0||n.z<=0)){var r=t._innerRadii;if(!(r.x<=0||r.y<=0||r.z<=0)){var i,o,s=t._minimumClock,u=t._maximumClock,l=t._minimumCone,h=t._maximumCone,d=t._vertexFormat,f=t._slicePartitions+1,m=t._stackPartitions+1;(f=Math.round(f*Math.abs(u-s)/a.TWO_PI))<2&&(f=2),(m=Math.round(m*Math.abs(h-l)/a.PI))<2&&(m=2);var _=0,g=[l],v=[s];for(i=0;i<m;i++)g.push(l+i*(h-l)/(m-1));for(g.push(h),o=0;o<f;o++)v.push(s+o*(u-s)/(f-1));v.push(u);var y=g.length,T=v.length,E=0,x=1,C=r.x!==n.x||r.y!==n.y||r.z!==n.z,S=!1,A=!1,w=!1;C&&(x=2,l>0&&(S=!0,E+=f-1),h<Math.PI&&(A=!0,E+=f-1),(u-s)%a.TWO_PI?(w=!0,E+=2*(m-1)+1):E+=1);var b=T*y*x,D=new Float64Array(3*b),I=ep(new Array(b),!1),R=ep(new Array(b),!1),P=f*m*x,O=6*(P+E+1-(f+m)*x),N=Dn.createTypedArray(P,O),M=d.normal?new Float32Array(3*b):void 0,L=d.tangent?new Float32Array(3*b):void 0,F=d.bitangent?new Float32Array(3*b):void 0,z=d.st?new Float32Array(2*b):void 0,B=new Array(y),U=new Array(y);for(i=0;i<y;i++)B[i]=xx(g[i]),U[i]=Ex(g[i]);var V=new Array(T),G=new Array(T);for(o=0;o<T;o++)G[o]=Ex(v[o]),V[o]=xx(v[o]);for(i=0;i<y;i++)for(o=0;o<T;o++)D[_++]=n.x*B[i]*G[o],D[_++]=n.y*B[i]*V[o],D[_++]=n.z*U[i];var k,W,q,Y,j=b/2;if(C)for(i=0;i<y;i++)for(o=0;o<T;o++)D[_++]=r.x*B[i]*G[o],D[_++]=r.y*B[i]*V[o],D[_++]=r.z*U[i],I[j]=!0,i>0&&i!==y-1&&0!==o&&o!==T-1&&(R[j]=!0),j++;for(_=0,i=1;i<y-2;i++)for(k=i*T,W=(i+1)*T,o=1;o<T-2;o++)N[_++]=W+o,N[_++]=W+o+1,N[_++]=k+o+1,N[_++]=W+o,N[_++]=k+o+1,N[_++]=k+o;if(C){var X=y*T;for(i=1;i<y-2;i++)for(k=X+i*T,W=X+(i+1)*T,o=1;o<T-2;o++)N[_++]=W+o,N[_++]=k+o,N[_++]=k+o+1,N[_++]=W+o,N[_++]=k+o+1,N[_++]=W+o+1}if(C){if(S)for(Y=y*T,i=1;i<T-2;i++)N[_++]=i,N[_++]=i+1,N[_++]=Y+i+1,N[_++]=i,N[_++]=Y+i+1,N[_++]=Y+i;if(A)for(q=y*T-T,Y=y*T*x-T,i=1;i<T-2;i++)N[_++]=q+i+1,N[_++]=q+i,N[_++]=Y+i,N[_++]=q+i+1,N[_++]=Y+i,N[_++]=Y+i+1}if(w){for(i=1;i<y-2;i++)Y=T*y+T*i,q=T*i,N[_++]=Y,N[_++]=q+T,N[_++]=q,N[_++]=Y,N[_++]=Y+T,N[_++]=q+T;for(i=1;i<y-2;i++)Y=T*y+T*(i+1)-1,q=T*(i+1)-1,N[_++]=q+T,N[_++]=Y,N[_++]=q,N[_++]=q+T,N[_++]=Y+T,N[_++]=Y}var Z=new np;d.position&&(Z.position=new tp({componentDatatype:xn.DOUBLE,componentsPerAttribute:3,values:D}));var K,Q=0,J=0,$=0,ee=0,te=b/2,ne=H.fromCartesian3(n),re=H.fromCartesian3(r);if(d.st||d.normal||d.tangent||d.bitangent){for(i=0;i<b;i++){K=I[i]?re:ne;var ie=p.fromArray(D,3*i,px),oe=K.geodeticSurfaceNormal(ie,_x);if(R[i]&&p.negate(oe,oe),d.st){var ae=c.negate(oe,yx);z[Q++]=Math.atan2(ae.y,ae.x)/a.TWO_PI+.5,z[Q++]=Math.asin(oe.z)/Math.PI+.5}if(d.normal&&(M[J++]=oe.x,M[J++]=oe.y,M[J++]=oe.z),d.tangent||d.bitangent){var se,ue=gx,ce=0;if(I[i]&&(ce=te),se=!S&&i>=ce&&i<ce+2*T?p.UNIT_X:p.UNIT_Z,p.cross(se,oe,ue),p.normalize(ue,ue),d.tangent&&(L[$++]=ue.x,L[$++]=ue.y,L[$++]=ue.z),d.bitangent){var le=p.cross(oe,ue,vx);p.normalize(le,le),F[ee++]=le.x,F[ee++]=le.y,F[ee++]=le.z}}}d.st&&(Z.st=new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:2,values:z})),d.normal&&(Z.normal=new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:3,values:M})),d.tangent&&(Z.tangent=new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:3,values:L})),d.bitangent&&(Z.bitangent=new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:3,values:F}))}if(e(t._offsetAttribute)){var he=D.length,de=new Uint8Array(he/3);ep(de,t._offsetAttribute===rp.NONE?0:1),Z.applyOffset=new tp({componentDatatype:xn.UNSIGNED_BYTE,componentsPerAttribute:1,values:de})}return new cc({attributes:Z,indices:N,primitiveType:Rs.TRIANGLES,boundingSphere:Me.fromEllipsoid(ne),offsetAttribute:t._offsetAttribute})}}},Cx.getUnitEllipsoid=function(){return e(Sx)||(Sx=Cx.createGeometry(new Cx({radii:new p(1,1,1),vertexFormat:fg.POSITION_ONLY}))),Sx};var Ix=[],Rx=[];function Px(e,t,n,r,i){if(!(r>=i)){var o=Math.floor(.5*(r+i));Px(e,t,n,r,o),Px(e,t,n,o+1,i),function(e,t,n,r,i,o){var a,s,u=i-r+1,c=o-i,l=Ix,h=Rx;for(a=0;a<u;++a)l[a]=e[r+a];for(s=0;s<c;++s)h[s]=e[i+s+1];a=0,s=0;for(var d=r;d<=o;++d){var f=l[a],m=h[s];a<u&&(s>=c||t(f,m,n)<=0)?(e[d]=f,++a):s<c&&(e[d]=m,++s)}}(e,t,n,r,o,i)}}function Ox(e,t,n){var r=e.length,i=Math.ceil(.5*r);Ix.length=i,Rx.length=i,Px(e,t,n,0,r-1),Ix.length=0,Rx.length=0}function Nx(e,t){this._occluderPosition=p.clone(e.center),this._occluderRadius=e.radius,this._horizonDistance=0,this._horizonPlaneNormal=void 0,this._horizonPlanePosition=void 0,this._cameraPosition=void 0,this.cameraPosition=t}var Mx=new p;Object.defineProperties(Nx.prototype,{position:{get:function(){return this._occluderPosition}},radius:{get:function(){return this._occluderRadius}},cameraPosition:{set:function(e){e=p.clone(e,this._cameraPosition);var t,n,r,i=p.subtract(this._occluderPosition,e,Mx),o=p.magnitudeSquared(i),a=this._occluderRadius*this._occluderRadius;if(o>a){t=Math.sqrt(o-a),o=1/Math.sqrt(o),n=p.multiplyByScalar(i,o,Mx);var s=t*t*o;r=p.add(e,p.multiplyByScalar(n,s,Mx),Mx)}else t=Number.MAX_VALUE;this._horizonDistance=t,this._horizonPlaneNormal=n,this._horizonPlanePosition=r,this._cameraPosition=e}}}),Nx.fromBoundingSphere=function(t,n,r){return e(r)?(p.clone(t.center,r._occluderPosition),r._occluderRadius=t.radius,r.cameraPosition=n,r):new Nx(t,n)};var Lx=new p;Nx.prototype.isPointVisible=function(e){if(this._horizonDistance!==Number.MAX_VALUE){var t=p.subtract(e,this._occluderPosition,Lx),n=this._occluderRadius;if((n=p.magnitudeSquared(t)-n*n)>0)return n=Math.sqrt(n)+this._horizonDistance,t=p.subtract(e,this._cameraPosition,t),n*n>p.magnitudeSquared(t)}return!1};var Fx=new p;Nx.prototype.isBoundingSphereVisible=function(e){var t=p.clone(e.center,Fx),n=e.radius;if(this._horizonDistance!==Number.MAX_VALUE){var r=p.subtract(t,this._occluderPosition,Lx),i=this._occluderRadius-n;if(i=p.magnitudeSquared(r)-i*i,n<this._occluderRadius)return i>0&&(i=Math.sqrt(i)+this._horizonDistance,r=p.subtract(t,this._cameraPosition,r),i*i+n*n>p.magnitudeSquared(r));if(i>0){r=p.subtract(t,this._cameraPosition,r);var o=p.magnitudeSquared(r),a=this._occluderRadius*this._occluderRadius,s=n*n;return(this._horizonDistance*this._horizonDistance+a)*s>o*a||(i=Math.sqrt(i)+this._horizonDistance)*i+s>o}return!0}return!1};var zx=new p;Nx.prototype.computeVisibility=function(e){var t=p.clone(e.center),n=e.radius;if(n>this._occluderRadius)return V_.FULL;if(this._horizonDistance!==Number.MAX_VALUE){var r=p.subtract(t,this._occluderPosition,zx),i=this._occluderRadius-n,o=p.magnitudeSquared(r);if((i=o-i*i)>0){i=Math.sqrt(i)+this._horizonDistance,r=p.subtract(t,this._cameraPosition,r);var a=p.magnitudeSquared(r);return i*i+n*n<a?V_.NONE:(i=o-(i=this._occluderRadius+n)*i)>0?a<(i=Math.sqrt(i)+this._horizonDistance)*i+n*n?V_.FULL:V_.PARTIAL:(r=p.subtract(t,this._horizonPlanePosition,r),p.dot(r,this._horizonPlaneNormal)>-n?V_.PARTIAL:V_.FULL)}}return V_.NONE};var Bx=new p;Nx.computeOccludeePoint=function(e,t,n){var r=p.clone(t),i=p.clone(e.center),o=e.radius,a=n.length,s=p.normalize(p.subtract(r,i,Bx),Bx),u=-p.dot(s,i),c=Nx._anyRotationVector(i,s,u),l=Nx._horizonToPlaneNormalDotProduct(e,s,u,c,n[0]);if(l){for(var h,d=1;d<a;++d){if(!(h=Nx._horizonToPlaneNormalDotProduct(e,s,u,c,n[d])))return;h<l&&(l=h)}if(!(l<.0017453283658983088)){var f=o/l;return p.add(i,p.multiplyByScalar(s,f,Bx),Bx)}}};var Ux=[];Nx.computeOccludeePointFromRectangle=function(e,t){t=i(t,H.WGS84);var n=Oe.subsample(e,t,0,Ux),r=Me.fromPoints(n),o=p.ZERO;if(!p.equals(o,r.center))return Nx.computeOccludeePoint(new Me(o,t.minimumRadius),r.center,n)};var Vx=new p;Nx._anyRotationVector=function(e,t,n){var r=p.abs(t,Vx),i=r.x>r.y?0:1;(0===i&&r.z>r.x||1===i&&r.z>r.y)&&(i=2);var o,a=new p;0===i?(r.x=e.x,r.y=e.y+1,r.z=e.z+1,o=p.UNIT_X):1===i?(r.x=e.x+1,r.y=e.y,r.z=e.z+1,o=p.UNIT_Y):(r.x=e.x+1,r.y=e.y+1,r.z=e.z,o=p.UNIT_Z);var s=(p.dot(t,r)+n)/-p.dot(t,o);return p.normalize(p.subtract(p.add(r,p.multiplyByScalar(o,s,a),r),e,r),r)};var Hx=new p;Nx._rotationVector=function(e,t,n,r,i){var o=p.subtract(r,e,Hx);if(o=p.normalize(o,o),p.dot(t,o)<.9999999847691291){var s=p.cross(t,o,o);if(p.magnitude(s)>a.EPSILON13)return p.normalize(s,new p)}return i};var Gx=new p,kx=new p,Wx=new p,qx=new p;function Yx(e){e=i(e,i.EMPTY_OBJECT),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=i(e.near,1),this._near=this.near,this.far=i(e.far,5e8),this._far=this.far,this._cullingVolume=new Tr,this._perspectiveMatrix=new ye,this._infinitePerspective=new ye}function jx(e){var t=e.top,n=e.bottom,r=e.right,i=e.left,o=e.near,a=e.far;t===e._top&&n===e._bottom&&i===e._left&&r===e._right&&o===e._near&&a===e._far||(e._left=i,e._right=r,e._top=t,e._bottom=n,e._near=o,e._far=a,e._perspectiveMatrix=ye.computePerspectiveOffCenter(i,r,n,t,o,a,e._perspectiveMatrix),e._infinitePerspective=ye.computeInfinitePerspectiveOffCenter(i,r,n,t,o,e._infinitePerspective))}Nx._horizonToPlaneNormalDotProduct=function(e,t,n,r,i){var o=p.clone(i,Gx),a=p.clone(e.center,kx),s=e.radius,u=p.subtract(a,o,Wx),c=p.magnitudeSquared(u),l=s*s;if(c<l)return!1;var h=c-l,d=Math.sqrt(h),f=d*(1/Math.sqrt(c))*d;u=p.normalize(u,u);var m=p.add(o,p.multiplyByScalar(u,f,qx),qx),_=Math.sqrt(h-f*f),g=this._rotationVector(a,t,n,o,r),v=p.fromElements(g.x*g.x*u.x+(g.x*g.y-g.z)*u.y+(g.x*g.z+g.y)*u.z,(g.x*g.y+g.z)*u.x+g.y*g.y*u.y+(g.y*g.z-g.x)*u.z,(g.x*g.z-g.y)*u.x+(g.y*g.z+g.x)*u.y+g.z*g.z*u.z,Gx);v=p.normalize(v,v);var y=p.multiplyByScalar(v,_,Gx);g=p.normalize(p.subtract(p.add(m,y,Wx),a,Wx),Wx);var T=p.dot(t,g);g=p.normalize(p.subtract(p.subtract(m,y,g),a,g),g);var E=p.dot(t,g);return T<E?T:E},Object.defineProperties(Yx.prototype,{projectionMatrix:{get:function(){return jx(this),this._perspectiveMatrix}},infiniteProjectionMatrix:{get:function(){return jx(this),this._infinitePerspective}}});var Xx=new p,Zx=new p,Kx=new p,Qx=new p;function Jx(e){e=i(e,i.EMPTY_OBJECT),this._offCenterFrustum=new Yx,this.fov=e.fov,this._fov=void 0,this._fovy=void 0,this._sseDenominator=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=i(e.near,1),this._near=this.near,this.far=i(e.far,5e8),this._far=this.far,this.xOffset=i(e.xOffset,0),this._xOffset=this.xOffset,this.yOffset=i(e.yOffset,0),this._yOffset=this.yOffset}function $x(e){var t=e._offCenterFrustum;e.fov===e._fov&&e.aspectRatio===e._aspectRatio&&e.near===e._near&&e.far===e._far&&e.xOffset===e._xOffset&&e.yOffset===e._yOffset||(e._aspectRatio=e.aspectRatio,e._fov=e.fov,e._fovy=e.aspectRatio<=1?e.fov:2*Math.atan(Math.tan(.5*e.fov)/e.aspectRatio),e._near=e.near,e._far=e.far,e._sseDenominator=2*Math.tan(.5*e._fovy),e._xOffset=e.xOffset,e._yOffset=e.yOffset,t.top=e.near*Math.tan(.5*e._fovy),t.bottom=-t.top,t.right=e.aspectRatio*t.top,t.left=-t.right,t.near=e.near,t.far=e.far,t.right+=e.xOffset,t.left+=e.xOffset,t.top+=e.yOffset,t.bottom+=e.yOffset)}function eC(e){e=i(e,i.EMPTY_OBJECT),this.color=e.color,this.depth=e.depth,this.stencil=e.stencil,this.renderState=e.renderState,this.framebuffer=e.framebuffer,this.owner=e.owner,this.pass=e.pass}Yx.prototype.computeCullingVolume=function(t,n,r){var i=this._cullingVolume.planes,o=this.top,a=this.bottom,s=this.right,u=this.left,c=this.near,l=this.far,h=p.cross(n,r,Xx),d=Zx;p.multiplyByScalar(n,c,d),p.add(t,d,d);var f=Kx;p.multiplyByScalar(n,l,f),p.add(t,f,f);var m=Qx;p.multiplyByScalar(h,u,m),p.add(d,m,m),p.subtract(m,t,m),p.normalize(m,m),p.cross(m,r,m),p.normalize(m,m);var _=i[0];return e(_)||(_=i[0]=new le),_.x=m.x,_.y=m.y,_.z=m.z,_.w=-p.dot(m,t),p.multiplyByScalar(h,s,m),p.add(d,m,m),p.subtract(m,t,m),p.cross(r,m,m),p.normalize(m,m),e(_=i[1])||(_=i[1]=new le),_.x=m.x,_.y=m.y,_.z=m.z,_.w=-p.dot(m,t),p.multiplyByScalar(r,a,m),p.add(d,m,m),p.subtract(m,t,m),p.cross(h,m,m),p.normalize(m,m),e(_=i[2])||(_=i[2]=new le),_.x=m.x,_.y=m.y,_.z=m.z,_.w=-p.dot(m,t),p.multiplyByScalar(r,o,m),p.add(d,m,m),p.subtract(m,t,m),p.cross(m,h,m),p.normalize(m,m),e(_=i[3])||(_=i[3]=new le),_.x=m.x,_.y=m.y,_.z=m.z,_.w=-p.dot(m,t),e(_=i[4])||(_=i[4]=new le),_.x=n.x,_.y=n.y,_.z=n.z,_.w=-p.dot(n,d),p.negate(n,m),e(_=i[5])||(_=i[5]=new le),_.x=m.x,_.y=m.y,_.z=m.z,_.w=-p.dot(m,f),this._cullingVolume},Yx.prototype.getPixelDimensions=function(e,t,n,r,i){jx(this);var o=1/this.near,a=this.top*o,s=2*r*n*a/t,u=2*r*n*(a=this.right*o)/e;return i.x=u,i.y=s,i},Yx.prototype.clone=function(t){return e(t)||(t=new Yx),t.right=this.right,t.left=this.left,t.top=this.top,t.bottom=this.bottom,t.near=this.near,t.far=this.far,t._left=void 0,t._right=void 0,t._top=void 0,t._bottom=void 0,t._near=void 0,t._far=void 0,t},Yx.prototype.equals=function(t){return e(t)&&t instanceof Yx&&this.right===t.right&&this.left===t.left&&this.top===t.top&&this.bottom===t.bottom&&this.near===t.near&&this.far===t.far},Yx.prototype.equalsEpsilon=function(t,n,r){return t===this||e(t)&&t instanceof Yx&&a.equalsEpsilon(this.right,t.right,n,r)&&a.equalsEpsilon(this.left,t.left,n,r)&&a.equalsEpsilon(this.top,t.top,n,r)&&a.equalsEpsilon(this.bottom,t.bottom,n,r)&&a.equalsEpsilon(this.near,t.near,n,r)&&a.equalsEpsilon(this.far,t.far,n,r)},Jx.packedLength=6,Jx.pack=function(e,t,n){return n=i(n,0),t[n++]=e.fov,t[n++]=e.aspectRatio,t[n++]=e.near,t[n++]=e.far,t[n++]=e.xOffset,t[n]=e.yOffset,t},Jx.unpack=function(t,n,r){return n=i(n,0),e(r)||(r=new Jx),r.fov=t[n++],r.aspectRatio=t[n++],r.near=t[n++],r.far=t[n++],r.xOffset=t[n++],r.yOffset=t[n],r},Object.defineProperties(Jx.prototype,{projectionMatrix:{get:function(){return $x(this),this._offCenterFrustum.projectionMatrix}},infiniteProjectionMatrix:{get:function(){return $x(this),this._offCenterFrustum.infiniteProjectionMatrix}},fovy:{get:function(){return $x(this),this._fovy}},sseDenominator:{get:function(){return $x(this),this._sseDenominator}}}),Jx.prototype.computeCullingVolume=function(e,t,n){return $x(this),this._offCenterFrustum.computeCullingVolume(e,t,n)},Jx.prototype.getPixelDimensions=function(e,t,n,r,i){return $x(this),this._offCenterFrustum.getPixelDimensions(e,t,n,r,i)},Jx.prototype.clone=function(t){return e(t)||(t=new Jx),t.aspectRatio=this.aspectRatio,t.fov=this.fov,t.near=this.near,t.far=this.far,t._aspectRatio=void 0,t._fov=void 0,t._near=void 0,t._far=void 0,this._offCenterFrustum.clone(t._offCenterFrustum),t},Jx.prototype.equals=function(t){return!!(e(t)&&t instanceof Jx)&&($x(this),$x(t),this.fov===t.fov&&this.aspectRatio===t.aspectRatio&&this._offCenterFrustum.equals(t._offCenterFrustum))},Jx.prototype.equalsEpsilon=function(t,n,r){return!!(e(t)&&t instanceof Jx)&&($x(this),$x(t),a.equalsEpsilon(this.fov,t.fov,n,r)&&a.equalsEpsilon(this.aspectRatio,t.aspectRatio,n,r)&&this._offCenterFrustum.equalsEpsilon(t._offCenterFrustum,n,r))},eC.ALL=Object.freeze(new eC({color:new pn(0,0,0,0),depth:1,stencil:0})),eC.prototype.execute=function(e,t){e.clear(this,t)};var tC,nC="attribute vec4 position;\nattribute vec2 textureCoordinates;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\ngl_Position = position;\nv_textureCoordinates = textureCoordinates;\n}\n";function rC(e){this._context=e}var iC=new Ps({primitiveType:Rs.TRIANGLES}),oC=new eC({color:new pn(0,0,0,0)});function aC(e,t,n,r,i,o,a,s,u,c,l){this._context=e,this._texture=t,this._textureTarget=n,this._targetFace=r,this._pixelDatatype=a,this._internalFormat=i,this._pixelFormat=o,this._size=s,this._preMultiplyAlpha=u,this._flipY=c,this._initialized=l}function sC(t){var n,r=(t=i(t,i.EMPTY_OBJECT)).context,o=t.source;if(e(o)){var a=[o.positiveX,o.negativeX,o.positiveY,o.negativeY,o.positiveZ,o.negativeZ];n=a[0].width,a[0].height}else n=t.width;var s=n,u=i(t.pixelDatatype,Yc.UNSIGNED_BYTE),c=i(t.pixelFormat,Xc.RGBA),l=Xc.toInternalFormat(c,u,r),h=6*Xc.textureSizeInBytes(c,u,s,s),d=t.preMultiplyAlpha||c===Xc.RGB||c===Xc.LUMINANCE,f=i(t.flipY,!0),m=r._gl,p=m.TEXTURE_CUBE_MAP,_=m.createTexture();function g(t,i,o,a){var h=i.arrayBufferView;e(h)||(h=i.bufferView);var d=4;e(h)&&(d=Xc.alignmentInBytes(c,u,n)),m.pixelStorei(m.UNPACK_ALIGNMENT,d),e(h)?(m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,!1),a&&(h=Xc.flipY(h,c,u,s,s)),m.texImage2D(t,0,l,s,s,0,c,Yc.toWebGLConstant(u,r),h)):(m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,a),m.texImage2D(t,0,l,c,Yc.toWebGLConstant(u,r),i))}m.activeTexture(m.TEXTURE0),m.bindTexture(p,_),e(o)?(g(m.TEXTURE_CUBE_MAP_POSITIVE_X,o.positiveX,d,f),g(m.TEXTURE_CUBE_MAP_NEGATIVE_X,o.negativeX,d,f),g(m.TEXTURE_CUBE_MAP_POSITIVE_Y,o.positiveY,d,f),g(m.TEXTURE_CUBE_MAP_NEGATIVE_Y,o.negativeY,d,f),g(m.TEXTURE_CUBE_MAP_POSITIVE_Z,o.positiveZ,d,f),g(m.TEXTURE_CUBE_MAP_NEGATIVE_Z,o.negativeZ,d,f)):(m.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X,0,l,s,s,0,c,Yc.toWebGLConstant(u,r),null),m.texImage2D(m.TEXTURE_CUBE_MAP_NEGATIVE_X,0,l,s,s,0,c,Yc.toWebGLConstant(u,r),null),m.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_Y,0,l,s,s,0,c,Yc.toWebGLConstant(u,r),null),m.texImage2D(m.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,l,s,s,0,c,Yc.toWebGLConstant(u,r),null),m.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_Z,0,l,s,s,0,c,Yc.toWebGLConstant(u,r),null),m.texImage2D(m.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,l,s,s,0,c,Yc.toWebGLConstant(u,r),null)),m.bindTexture(p,null),this._context=r,this._textureFilterAnisotropic=r._textureFilterAnisotropic,this._textureTarget=p,this._texture=_,this._pixelFormat=c,this._pixelDatatype=u,this._size=s,this._hasMipmap=!1,this._sizeInBytes=h,this._preMultiplyAlpha=d,this._flipY=f,this._sampler=void 0;var v=e(o);this._positiveX=new aC(r,_,p,m.TEXTURE_CUBE_MAP_POSITIVE_X,l,c,u,s,d,f,v),this._negativeX=new aC(r,_,p,m.TEXTURE_CUBE_MAP_NEGATIVE_X,l,c,u,s,d,f,v),this._positiveY=new aC(r,_,p,m.TEXTURE_CUBE_MAP_POSITIVE_Y,l,c,u,s,d,f,v),this._negativeY=new aC(r,_,p,m.TEXTURE_CUBE_MAP_NEGATIVE_Y,l,c,u,s,d,f,v),this._positiveZ=new aC(r,_,p,m.TEXTURE_CUBE_MAP_POSITIVE_Z,l,c,u,s,d,f,v),this._negativeZ=new aC(r,_,p,m.TEXTURE_CUBE_MAP_NEGATIVE_Z,l,c,u,s,d,f,v),this.sampler=e(t.sampler)?t.sampler:new Lh}function uC(e){this.context=e,this.framebuffer=void 0,this.blendingEnabled=void 0,this.scissorTest=void 0,this.viewport=void 0}function cC(e){this._context=e,this._shaders={},this._numberOfShaders=0,this._shadersToRelease={}}function lC(e,t){for(var n=t.derivedKeywords,r=n.length,i=0;i<r;++i){var o=n[i]+t.keyword;lC(e,e._shaders[o])}delete e._shaders[t.keyword],t.shaderProgram.finalDestroy()}function hC(){this._textures={},this._numberOfTextures=0,this._texturesToRelease={}}function dC(e){e=i(e,i.EMPTY_OBJECT),this.color=pn.clone(i(e.color,pn.WHITE)),this.intensity=i(e.intensity,2)}function fC(){this.globeDepthTexture=void 0,this.gamma=void 0,this._viewport=new Ns,this._viewportCartesian4=new le,this._viewportDirty=!1,this._viewportOrthographicMatrix=ye.clone(ye.IDENTITY),this._viewportTransformation=ye.clone(ye.IDENTITY),this._model=ye.clone(ye.IDENTITY),this._view=ye.clone(ye.IDENTITY),this._inverseView=ye.clone(ye.IDENTITY),this._projection=ye.clone(ye.IDENTITY),this._infiniteProjection=ye.clone(ye.IDENTITY),this._entireFrustum=new c,this._currentFrustum=new c,this._frustumPlanes=new le,this._farDepthFromNearPlusOne=void 0,this._log2FarDepthFromNearPlusOne=void 0,this._oneOverLog2FarDepthFromNearPlusOne=void 0,this._frameState=void 0,this._temeToPseudoFixed=$.clone(ye.IDENTITY),this._view3DDirty=!0,this._view3D=new ye,this._inverseView3DDirty=!0,this._inverseView3D=new ye,this._inverseModelDirty=!0,this._inverseModel=new ye,this._inverseTransposeModelDirty=!0,this._inverseTransposeModel=new $,this._viewRotation=new $,this._inverseViewRotation=new $,this._viewRotation3D=new $,this._inverseViewRotation3D=new $,this._inverseProjectionDirty=!0,this._inverseProjection=new ye,this._modelViewDirty=!0,this._modelView=new ye,this._modelView3DDirty=!0,this._modelView3D=new ye,this._modelViewRelativeToEyeDirty=!0,this._modelViewRelativeToEye=new ye,this._inverseModelViewDirty=!0,this._inverseModelView=new ye,this._inverseModelView3DDirty=!0,this._inverseModelView3D=new ye,this._viewProjectionDirty=!0,this._viewProjection=new ye,this._inverseViewProjectionDirty=!0,this._inverseViewProjection=new ye,this._modelViewProjectionDirty=!0,this._modelViewProjection=new ye,this._inverseModelViewProjectionDirty=!0,this._inverseModelViewProjection=new ye,this._modelViewProjectionRelativeToEyeDirty=!0,this._modelViewProjectionRelativeToEye=new ye,this._modelViewInfiniteProjectionDirty=!0,this._modelViewInfiniteProjection=new ye,this._normalDirty=!0,this._normal=new $,this._normal3DDirty=!0,this._normal3D=new $,this._inverseNormalDirty=!0,this._inverseNormal=new $,this._inverseNormal3DDirty=!0,this._inverseNormal3D=new $,this._encodedCameraPositionMCDirty=!0,this._encodedCameraPositionMC=new Cn,this._cameraPosition=new p,this._sunPositionWC=new p,this._sunPositionColumbusView=new p,this._sunDirectionWC=new p,this._sunDirectionEC=new p,this._moonDirectionEC=new p,this._lightDirectionWC=new p,this._lightDirectionEC=new p,this._lightColor=new p,this._lightColorHdr=new p,this._pass=void 0,this._mode=void 0,this._mapProjection=void 0,this._ellipsoid=void 0,this._cameraDirection=new p,this._cameraRight=new p,this._cameraUp=new p,this._frustum2DWidth=0,this._eyeHeight=0,this._eyeHeight2D=new c,this._pixelRatio=1,this._orthographicIn3D=!1,this._backgroundColor=new pn,this._brdfLut=void 0,this._environmentMap=void 0,this._sphericalHarmonicCoefficients=void 0,this._specularEnvironmentMaps=void 0,this._specularEnvironmentMapsDimensions=new c,this._specularEnvironmentMapsMaximumLOD=void 0,this._fogDensity=void 0,this._invertClassificationColor=void 0,this._imagerySplitPosition=0,this._pixelSizePerMeter=void 0,this._geometricToleranceOverMeter=void 0,this._minimumDisableDepthTestDistance=void 0}rC.prototype.execute=function(t){e(t.preExecute)&&t.preExecute(t);var n=t.outputTexture,r=n.width,i=n.height,o=this._context,a=e(t.vertexArray)?t.vertexArray:o.getViewportQuadVertexArray(),s=e(t.shaderProgram)?t.shaderProgram:function(e,t){return Hu.fromCache({context:e,vertexShaderSource:nC,fragmentShaderSource:t,attributeLocations:{position:0,textureCoordinates:1}})}(o,t.fragmentShaderSource),u=function(e,t){return new wh({context:e,colorTextures:[t],destroyAttachments:!1})}(o,n),c=function(t,n){return e(tC)&&tC.viewport.width===t&&tC.viewport.height===n||(tC=Us.fromCache({viewport:new Ns(0,0,t,n)})),tC}(r,i),l=t.uniformMap,h=oC;h.framebuffer=u,h.renderState=c,h.execute(o);var d=iC;d.vertexArray=a,d.renderState=c,d.shaderProgram=s,d.uniformMap=l,d.framebuffer=u,d.execute(o),u.destroy(),t.persists||(s.destroy(),e(t.vertexArray)&&a.destroy()),e(t.postExecute)&&t.postExecute(n)},rC.prototype.isDestroyed=function(){return!1},rC.prototype.destroy=function(){return hi(this)},Object.defineProperties(aC.prototype,{pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},_target:{get:function(){return this._targetFace}}}),aC.prototype.copyFrom=function(t,n,r){n=i(n,0),r=i(r,0);var o=this._context._gl,a=this._textureTarget,s=this._targetFace;o.activeTexture(o.TEXTURE0),o.bindTexture(a,this._texture);var u=t.width,c=t.height,l=t.arrayBufferView,h=this._size,d=this._pixelFormat,f=this._internalFormat,m=this._pixelDatatype,p=this._preMultiplyAlpha,_=this._flipY,g=4;e(l)&&(g=Xc.alignmentInBytes(d,m,u)),o.pixelStorei(o.UNPACK_ALIGNMENT,g);var v=!1;if(!this._initialized){if(0===n&&0===r&&u===h&&c===h)e(l)?(o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1),_&&(l=Xc.flipY(l,d,m,h,h)),o.texImage2D(s,0,f,h,h,0,d,Yc.toWebGLConstant(m,this._context),l)):(o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,_),o.texImage2D(s,0,f,d,Yc.toWebGLConstant(m,this._context),t)),v=!0;else{o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1);var y=Xc.createTypedArray(d,m,h,h);o.texImage2D(s,0,f,h,h,0,d,Yc.toWebGLConstant(m,this._context),y)}this._initialized=!0}v||(e(l)?(o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1),_&&(l=Xc.flipY(l,d,m,u,c)),o.texSubImage2D(s,0,n,r,u,c,d,Yc.toWebGLConstant(m,this._context),l)):(o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,_),o.texSubImage2D(s,0,n,r,d,Yc.toWebGLConstant(m,this._context),t))),o.bindTexture(a,null)},aC.prototype.copyFromFramebuffer=function(e,t,n,r,o,a){e=i(e,0),t=i(t,0),n=i(n,0),r=i(r,0),o=i(o,this._size),a=i(a,this._size);var s=this._context._gl,u=this._textureTarget;s.activeTexture(s.TEXTURE0),s.bindTexture(u,this._texture),s.copyTexSubImage2D(this._targetFace,0,e,t,n,r,o,a),s.bindTexture(u,null),this._initialized=!0},Object.defineProperties(sC.prototype,{positiveX:{get:function(){return this._positiveX}},negativeX:{get:function(){return this._negativeX}},positiveY:{get:function(){return this._positiveY}},negativeY:{get:function(){return this._negativeY}},positiveZ:{get:function(){return this._positiveZ}},negativeZ:{get:function(){return this._negativeZ}},sampler:{get:function(){return this._sampler},set:function(t){var n=t.minificationFilter,r=t.magnificationFilter,i=n===Oh.NEAREST_MIPMAP_NEAREST||n===Oh.NEAREST_MIPMAP_LINEAR||n===Oh.LINEAR_MIPMAP_NEAREST||n===Oh.LINEAR_MIPMAP_LINEAR,o=this._context,a=this._pixelDatatype;(a===Yc.FLOAT&&!o.textureFloatLinear||a===Yc.HALF_FLOAT&&!o.textureHalfFloatLinear)&&(n=i?Oh.NEAREST_MIPMAP_NEAREST:Oh.NEAREST,r=Rh.NEAREST);var s=o._gl,u=this._textureTarget;s.activeTexture(s.TEXTURE0),s.bindTexture(u,this._texture),s.texParameteri(u,s.TEXTURE_MIN_FILTER,n),s.texParameteri(u,s.TEXTURE_MAG_FILTER,r),s.texParameteri(u,s.TEXTURE_WRAP_S,t.wrapS),s.texParameteri(u,s.TEXTURE_WRAP_T,t.wrapT),e(this._textureFilterAnisotropic)&&s.texParameteri(u,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.maximumAnisotropy),s.bindTexture(u,null),this._sampler=t}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},width:{get:function(){return this._size}},height:{get:function(){return this._size}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(4*this._sizeInBytes/3):this._sizeInBytes}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},_target:{get:function(){return this._textureTarget}}}),sC.prototype.generateMipmap=function(e){e=i(e,Dh.DONT_CARE),this._hasMipmap=!0;var t=this._context._gl,n=this._textureTarget;t.hint(t.GENERATE_MIPMAP_HINT,e),t.activeTexture(t.TEXTURE0),t.bindTexture(n,this._texture),t.generateMipmap(n),t.bindTexture(n,null)},sC.prototype.isDestroyed=function(){return!1},sC.prototype.destroy=function(){return this._context._gl.deleteTexture(this._texture),this._positiveX=hi(this._positiveX),this._negativeX=hi(this._negativeX),this._positiveY=hi(this._positiveY),this._negativeY=hi(this._negativeY),this._positiveZ=hi(this._positiveZ),this._negativeZ=hi(this._negativeZ),hi(this)},Object.defineProperties(cC.prototype,{numberOfShaders:{get:function(){return this._numberOfShaders}}}),cC.prototype.replaceShaderProgram=function(t){return e(t.shaderProgram)&&t.shaderProgram.destroy(),this.getShaderProgram(t)},cC.prototype.getShaderProgram=function(t){var n=t.vertexShaderSource,r=t.fragmentShaderSource,i=t.attributeLocations;"string"==typeof n&&(n=new nc({sources:[n]})),"string"==typeof r&&(r=new nc({sources:[r]}));var o,a=n.createCombinedVertexShader(this._context),s=r.createCombinedFragmentShader(this._context),u=a+s+JSON.stringify(i);if(e(this._shaders[u]))o=this._shaders[u],delete this._shadersToRelease[u];else{var c=this._context,l=new Hu({gl:c._gl,logShaderCompilation:c.logShaderCompilation,debugShaders:c.debugShaders,vertexShaderSource:n,vertexShaderText:a,fragmentShaderSource:r,fragmentShaderText:s,attributeLocations:i});o={cache:this,shaderProgram:l,keyword:u,derivedKeywords:[],count:0},l._cachedShader=o,this._shaders[u]=o,++this._numberOfShaders}return++o.count,o.shaderProgram},cC.prototype.replaceDerivedShaderProgram=function(t,n,r){var i=t._cachedShader,o=n+i.keyword,a=this._shaders[o];if(e(a)){lC(this,a);var s=i.derivedKeywords.indexOf(n);s>-1&&i.derivedKeywords.splice(s,1)}return this.createDerivedShaderProgram(t,n,r)},cC.prototype.getDerivedShaderProgram=function(t,n){var r=n+t._cachedShader.keyword,i=this._shaders[r];if(e(i))return i.shaderProgram},cC.prototype.createDerivedShaderProgram=function(e,t,n){var r=e._cachedShader,i=t+r.keyword,o=n.vertexShaderSource,a=n.fragmentShaderSource,s=n.attributeLocations;"string"==typeof o&&(o=new nc({sources:[o]})),"string"==typeof a&&(a=new nc({sources:[a]}));var u=this._context,c=o.createCombinedVertexShader(u),l=a.createCombinedFragmentShader(u),h=new Hu({gl:u._gl,logShaderCompilation:u.logShaderCompilation,debugShaders:u.debugShaders,vertexShaderSource:o,vertexShaderText:c,fragmentShaderSource:a,fragmentShaderText:l,attributeLocations:s}),d={cache:this,shaderProgram:h,keyword:i,derivedKeywords:[],count:0};return r.derivedKeywords.push(t),h._cachedShader=d,this._shaders[i]=d,h},cC.prototype.destroyReleasedShaderPrograms=function(){var e=this._shadersToRelease;for(var t in e){if(e.hasOwnProperty(t))lC(this,e[t]),--this._numberOfShaders}this._shadersToRelease={}},cC.prototype.releaseShaderProgram=function(t){if(e(t)){var n=t._cachedShader;n&&0==--n.count&&(this._shadersToRelease[n.keyword]=n)}},cC.prototype.isDestroyed=function(){return!1},cC.prototype.destroy=function(){var e=this._shaders;for(var t in e)e.hasOwnProperty(t)&&e[t].shaderProgram.finalDestroy();return hi(this)},Object.defineProperties(hC.prototype,{numberOfTextures:{get:function(){return this._numberOfTextures}}}),hC.prototype.getTexture=function(t){var n=this._textures[t];if(e(n))return delete this._texturesToRelease[t],++n.count,n.texture},hC.prototype.addTexture=function(e,t){var n={texture:t,count:1};t.finalDestroy=t.destroy;var r=this;t.destroy=function(){0==--n.count&&(r._texturesToRelease[e]=n)},this._textures[e]=n,++this._numberOfTextures},hC.prototype.destroyReleasedTextures=function(){var e=this._texturesToRelease;for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];delete this._textures[t],n.texture.finalDestroy(),--this._numberOfTextures}this._texturesToRelease={}},hC.prototype.isDestroyed=function(){return!1},hC.prototype.destroy=function(){var e=this._textures;for(var t in e)e.hasOwnProperty(t)&&e[t].texture.finalDestroy();return hi(this)},Object.defineProperties(fC.prototype,{frameState:{get:function(){return this._frameState}},viewport:{get:function(){return this._viewport},set:function(e){if(!Ns.equals(e,this._viewport)){Ns.clone(e,this._viewport);var t=this._viewport,n=this._viewportCartesian4;n.x=t.x,n.y=t.y,n.z=t.width,n.w=t.height,this._viewportDirty=!0}}},viewportCartesian4:{get:function(){return this._viewportCartesian4}},viewportOrthographic:{get:function(){return _C(this),this._viewportOrthographicMatrix}},viewportTransformation:{get:function(){return _C(this),this._viewportTransformation}},model:{get:function(){return this._model},set:function(e){ye.clone(e,this._model),this._modelView3DDirty=!0,this._inverseModelView3DDirty=!0,this._inverseModelDirty=!0,this._inverseTransposeModelDirty=!0,this._modelViewDirty=!0,this._inverseModelViewDirty=!0,this._modelViewRelativeToEyeDirty=!0,this._inverseModelViewDirty=!0,this._modelViewProjectionDirty=!0,this._inverseModelViewProjectionDirty=!0,this._modelViewProjectionRelativeToEyeDirty=!0,this._modelViewInfiniteProjectionDirty=!0,this._normalDirty=!0,this._inverseNormalDirty=!0,this._normal3DDirty=!0,this._inverseNormal3DDirty=!0,this._encodedCameraPositionMCDirty=!0}},inverseModel:{get:function(){return this._inverseModelDirty&&(this._inverseModelDirty=!1,ye.inverse(this._model,this._inverseModel)),this._inverseModel}},inverseTransposeModel:{get:function(){var e=this._inverseTransposeModel;return this._inverseTransposeModelDirty&&(this._inverseTransposeModelDirty=!1,ye.getMatrix3(this.inverseModel,e),$.transpose(e,e)),e}},view:{get:function(){return this._view}},view3D:{get:function(){return wC(this),this._view3D}},viewRotation:{get:function(){return wC(this),this._viewRotation}},viewRotation3D:{get:function(){return wC(this),this._viewRotation3D}},inverseView:{get:function(){return this._inverseView}},inverseView3D:{get:function(){return bC(this),this._inverseView3D}},inverseViewRotation:{get:function(){return this._inverseViewRotation}},inverseViewRotation3D:{get:function(){return bC(this),this._inverseViewRotation3D}},projection:{get:function(){return this._projection}},inverseProjection:{get:function(){var e;return(e=this)._inverseProjectionDirty&&(e._inverseProjectionDirty=!1,e._mode===Al.SCENE2D||e._mode===Al.MORPHING||e._orthographicIn3D?ye.clone(ye.ZERO,e._inverseProjection):ye.inverse(e._projection,e._inverseProjection)),this._inverseProjection}},infiniteProjection:{get:function(){return this._infiniteProjection}},modelView:{get:function(){var e;return(e=this)._modelViewDirty&&(e._modelViewDirty=!1,ye.multiplyTransformation(e._view,e._model,e._modelView)),this._modelView}},modelView3D:{get:function(){var e;return(e=this)._modelView3DDirty&&(e._modelView3DDirty=!1,ye.multiplyTransformation(e.view3D,e._model,e._modelView3D)),this._modelView3D}},modelViewRelativeToEye:{get:function(){return function(e){if(e._modelViewRelativeToEyeDirty){e._modelViewRelativeToEyeDirty=!1;var t=e.modelView,n=e._modelViewRelativeToEye;n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=0,n[13]=0,n[14]=0,n[15]=t[15]}}(this),this._modelViewRelativeToEye}},inverseModelView:{get:function(){var e;return(e=this)._inverseModelViewDirty&&(e._inverseModelViewDirty=!1,ye.inverse(e.modelView,e._inverseModelView)),this._inverseModelView}},inverseModelView3D:{get:function(){var e;return(e=this)._inverseModelView3DDirty&&(e._inverseModelView3DDirty=!1,ye.inverse(e.modelView3D,e._inverseModelView3D)),this._inverseModelView3D}},viewProjection:{get:function(){var e;return(e=this)._viewProjectionDirty&&(e._viewProjectionDirty=!1,ye.multiply(e._projection,e._view,e._viewProjection)),this._viewProjection}},inverseViewProjection:{get:function(){var e;return(e=this)._inverseViewProjectionDirty&&(e._inverseViewProjectionDirty=!1,ye.inverse(e.viewProjection,e._inverseViewProjection)),this._inverseViewProjection}},modelViewProjection:{get:function(){var e;return(e=this)._modelViewProjectionDirty&&(e._modelViewProjectionDirty=!1,ye.multiply(e._projection,e.modelView,e._modelViewProjection)),this._modelViewProjection}},inverseModelViewProjection:{get:function(){var e;return(e=this)._inverseModelViewProjectionDirty&&(e._inverseModelViewProjectionDirty=!1,ye.inverse(e.modelViewProjection,e._inverseModelViewProjection)),this._inverseModelViewProjection}},modelViewProjectionRelativeToEye:{get:function(){var e;return(e=this)._modelViewProjectionRelativeToEyeDirty&&(e._modelViewProjectionRelativeToEyeDirty=!1,ye.multiply(e._projection,e.modelViewRelativeToEye,e._modelViewProjectionRelativeToEye)),this._modelViewProjectionRelativeToEye}},modelViewInfiniteProjection:{get:function(){var e;return(e=this)._modelViewInfiniteProjectionDirty&&(e._modelViewInfiniteProjectionDirty=!1,ye.multiply(e._infiniteProjection,e.modelView,e._modelViewInfiniteProjection)),this._modelViewInfiniteProjection}},normal:{get:function(){return function(e){if(e._normalDirty){e._normalDirty=!1;var t=e._normal;ye.getMatrix3(e.inverseModelView,t),$.getRotation(t,t),$.transpose(t,t)}}(this),this._normal}},normal3D:{get:function(){return function(e){if(e._normal3DDirty){e._normal3DDirty=!1;var t=e._normal3D;ye.getMatrix3(e.inverseModelView3D,t),$.getRotation(t,t),$.transpose(t,t)}}(this),this._normal3D}},inverseNormal:{get:function(){var e;return(e=this)._inverseNormalDirty&&(e._inverseNormalDirty=!1,ye.getMatrix3(e.inverseModelView,e._inverseNormal),$.getRotation(e._inverseNormal,e._inverseNormal)),this._inverseNormal}},inverseNormal3D:{get:function(){var e;return(e=this)._inverseNormal3DDirty&&(e._inverseNormal3DDirty=!1,ye.getMatrix3(e.inverseModelView3D,e._inverseNormal3D),$.getRotation(e._inverseNormal3D,e._inverseNormal3D)),this._inverseNormal3D}},entireFrustum:{get:function(){return this._entireFrustum}},currentFrustum:{get:function(){return this._currentFrustum}},frustumPlanes:{get:function(){return this._frustumPlanes}},farDepthFromNearPlusOne:{get:function(){return this._farDepthFromNearPlusOne}},log2FarDepthFromNearPlusOne:{get:function(){return this._log2FarDepthFromNearPlusOne}},oneOverLog2FarDepthFromNearPlusOne:{get:function(){return this._oneOverLog2FarDepthFromNearPlusOne}},eyeHeight:{get:function(){return this._eyeHeight}},eyeHeight2D:{get:function(){return this._eyeHeight2D}},sunPositionWC:{get:function(){return this._sunPositionWC}},sunPositionColumbusView:{get:function(){return this._sunPositionColumbusView}},sunDirectionWC:{get:function(){return this._sunDirectionWC}},sunDirectionEC:{get:function(){return this._sunDirectionEC}},moonDirectionEC:{get:function(){return this._moonDirectionEC}},lightDirectionWC:{get:function(){return this._lightDirectionWC}},lightDirectionEC:{get:function(){return this._lightDirectionEC}},lightColor:{get:function(){return this._lightColor}},lightColorHdr:{get:function(){return this._lightColorHdr}},encodedCameraPositionMCHigh:{get:function(){return vC(this),this._encodedCameraPositionMC.high}},encodedCameraPositionMCLow:{get:function(){return vC(this),this._encodedCameraPositionMC.low}},temeToPseudoFixedMatrix:{get:function(){return this._temeToPseudoFixed}},pixelRatio:{get:function(){return this._pixelRatio}},fogDensity:{get:function(){return this._fogDensity}},geometricToleranceOverMeter:{get:function(){return this._geometricToleranceOverMeter}},pass:{get:function(){return this._pass}},backgroundColor:{get:function(){return this._backgroundColor}},brdfLut:{get:function(){return this._brdfLut}},environmentMap:{get:function(){return this._environmentMap}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps}},specularEnvironmentMapsDimensions:{get:function(){return this._specularEnvironmentMapsDimensions}},specularEnvironmentMapsMaximumLOD:{get:function(){return this._specularEnvironmentMapsMaximumLOD}},imagerySplitPosition:{get:function(){return this._imagerySplitPosition}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance}},invertClassificationColor:{get:function(){return this._invertClassificationColor}},orthographicIn3D:{get:function(){return this._orthographicIn3D}},ellipsoid:{get:function(){return i(this._ellipsoid,H.WGS84)}}}),fC.prototype.updateCamera=function(t){var n,r;n=this,r=t.viewMatrix,ye.clone(r,n._view),ye.getMatrix3(r,n._viewRotation),n._view3DDirty=!0,n._inverseView3DDirty=!0,n._modelViewDirty=!0,n._modelView3DDirty=!0,n._modelViewRelativeToEyeDirty=!0,n._inverseModelViewDirty=!0,n._inverseModelView3DDirty=!0,n._viewProjectionDirty=!0,n._inverseViewProjectionDirty=!0,n._modelViewProjectionDirty=!0,n._modelViewProjectionRelativeToEyeDirty=!0,n._modelViewInfiniteProjectionDirty=!0,n._normalDirty=!0,n._inverseNormalDirty=!0,n._normal3DDirty=!0,n._inverseNormal3DDirty=!0,function(e,t){ye.clone(t,e._inverseView),ye.getMatrix3(t,e._inverseViewRotation)}(this,t.inverseViewMatrix),function(t,n){p.clone(n.positionWC,t._cameraPosition),p.clone(n.directionWC,t._cameraDirection),p.clone(n.rightWC,t._cameraRight),p.clone(n.upWC,t._cameraUp);var r=n.positionCartographic;e(r)?t._eyeHeight=r.height:t._eyeHeight=-t._ellipsoid.maximumRadius,t._encodedCameraPositionMCDirty=!0}(this,t),this._entireFrustum.x=t.frustum.near,this._entireFrustum.y=t.frustum.far,this.updateFrustum(t.frustum),this._orthographicIn3D=this._mode!==Al.SCENE2D&&t.frustum instanceof Pr},fC.prototype.updateFrustum=function(t){var n,r;n=this,r=t.projectionMatrix,ye.clone(r,n._projection),n._inverseProjectionDirty=!0,n._viewProjectionDirty=!0,n._inverseViewProjectionDirty=!0,n._modelViewProjectionDirty=!0,n._modelViewProjectionRelativeToEyeDirty=!0,e(t.infiniteProjectionMatrix)&&function(e,t){ye.clone(t,e._infiniteProjection),e._modelViewInfiniteProjectionDirty=!0}(this,t.infiniteProjectionMatrix),this._currentFrustum.x=t.near,this._currentFrustum.y=t.far,this._farDepthFromNearPlusOne=t.far-t.near+1,this._log2FarDepthFromNearPlusOne=a.log2(this._farDepthFromNearPlusOne),this._oneOverLog2FarDepthFromNearPlusOne=1/this._log2FarDepthFromNearPlusOne,e(t._offCenterFrustum)&&(t=t._offCenterFrustum),this._frustumPlanes.x=t.top,this._frustumPlanes.y=t.bottom,this._frustumPlanes.z=t.left,this._frustumPlanes.w=t.right},fC.prototype.updatePass=function(e){this._pass=e};var mC=[],pC=new dC;function _C(e){if(e._viewportDirty){var t=e._viewport;ye.computeOrthographicOffCenter(t.x,t.x+t.width,t.y,t.y+t.height,0,1,e._viewportOrthographicMatrix),ye.computeViewportTransformation(t,0,1,e._viewportTransformation),e._viewportDirty=!1}}fC.prototype.update=function(t){this._mode=t.mode,this._mapProjection=t.mapProjection,this._ellipsoid=t.mapProjection.ellipsoid,this._pixelRatio=t.pixelRatio;var n=t.camera;this.updateCamera(n),t.mode===Al.SCENE2D?(this._frustum2DWidth=n.frustum.right-n.frustum.left,this._eyeHeight2D.x=.5*this._frustum2DWidth,this._eyeHeight2D.y=this._eyeHeight2D.x*this._eyeHeight2D.x):(this._frustum2DWidth=0,this._eyeHeight2D.x=0,this._eyeHeight2D.y=0);var r=i(t.light,pC);r instanceof dC?(this._lightDirectionWC=p.clone(this._sunDirectionWC,this._lightDirectionWC),this._lightDirectionEC=p.clone(this._sunDirectionEC,this._lightDirectionEC)):(this._lightDirectionWC=p.normalize(p.negate(r.direction,this._lightDirectionWC),this._lightDirectionWC),this._lightDirectionEC=$.multiplyByVector(this.viewRotation3D,this._lightDirectionWC,this._lightDirectionEC));var o=r.color,a=p.fromElements(o.red,o.green,o.blue,this._lightColorHdr);a=p.multiplyByScalar(a,r.intensity,a);var s=p.maximumComponent(a);s>1?p.divideByScalar(a,s,this._lightColor):p.clone(a,this._lightColor);var u=t.brdfLutGenerator,l=e(u)?u.colorTexture:void 0;this._brdfLut=l,this._environmentMap=i(t.environmentMap,t.context.defaultCubeMap),this._sphericalHarmonicCoefficients=i(t.sphericalHarmonicCoefficients,mC),this._specularEnvironmentMaps=t.specularEnvironmentMaps,this._specularEnvironmentMapsMaximumLOD=t.specularEnvironmentMapsMaximumLOD,e(this._specularEnvironmentMaps)&&c.clone(this._specularEnvironmentMaps.dimensions,this._specularEnvironmentMapsDimensions),this._fogDensity=t.fog.density,this._invertClassificationColor=t.invertClassificationColor,this._frameState=t,this._temeToPseudoFixed=ka.computeTemeToPseudoFixedMatrix(t.time,this._temeToPseudoFixed),this._imagerySplitPosition=t.imagerySplitPosition*t.context.drawingBufferWidth;var h,d=n.frustum.fov,f=this._viewport;h=e(d)?f.height>f.width?2*Math.tan(.5*d)/f.height:2*Math.tan(.5*d)/f.width:1/Math.max(f.width,f.height),this._geometricToleranceOverMeter=h*t.maximumScreenSpaceError,pn.clone(t.backgroundColor,this._backgroundColor),this._minimumDisableDepthTestDistance=t.minimumDisableDepthTestDistance,this._minimumDisableDepthTestDistance*=this._minimumDisableDepthTestDistance,this._minimumDisableDepthTestDistance===Number.POSITIVE_INFINITY&&(this._minimumDisableDepthTestDistance=-1)};var gC=new p;function vC(e){e._encodedCameraPositionMCDirty&&(e._encodedCameraPositionMCDirty=!1,ye.multiplyByPoint(e.inverseModel,e._cameraPosition,gC),Cn.fromCartesian(gC,e._encodedCameraPositionMC))}var yC=new p,TC=new p,EC=new p,xC=new p,CC=new N,SC=new p,AC=new ye;function wC(t){t._view3DDirty&&(t._mode===Al.SCENE3D?ye.clone(t._view,t._view3D):function(t,n,r,i,o,s,u,c){var l=yC;l.x=t.y,l.y=t.z,l.z=t.x;var h=TC;h.x=r.y,h.y=r.z,h.z=r.x;var d=EC;d.x=i.y,d.y=i.z,d.z=i.x;var f=xC;f.x=n.y,f.y=n.z,f.z=n.x,s===Al.SCENE2D&&(l.z=.5*o);var m=u.unproject(l,CC);m.longitude=a.clamp(m.longitude,-Math.PI,Math.PI),m.latitude=a.clamp(m.latitude,-a.PI_OVER_TWO,a.PI_OVER_TWO);var _=u.ellipsoid,g=_.cartographicToCartesian(m,SC),v=ka.eastNorthUpToFixedFrame(g,_,AC);ye.multiplyByPointAsVector(v,h,h),ye.multiplyByPointAsVector(v,d,d),ye.multiplyByPointAsVector(v,f,f),e(c)||(c=new ye),c[0]=h.x,c[1]=d.x,c[2]=-f.x,c[3]=0,c[4]=h.y,c[5]=d.y,c[6]=-f.y,c[7]=0,c[8]=h.z,c[9]=d.z,c[10]=-f.z,c[11]=0,c[12]=-p.dot(h,g),c[13]=-p.dot(d,g),c[14]=p.dot(f,g),c[15]=1}(t._cameraPosition,t._cameraDirection,t._cameraRight,t._cameraUp,t._frustum2DWidth,t._mode,t._mapProjection,t._view3D),ye.getMatrix3(t._view3D,t._viewRotation3D),t._view3DDirty=!1)}function bC(e){e._inverseView3DDirty&&(ye.inverseTransformation(e.view3D,e._inverseView3D),ye.getMatrix3(e._inverseView3D,e._inverseViewRotation3D),e._inverseView3DDirty=!1)}function DC(e,t,n){var r=e.getError();if(r!==e.NO_ERROR)throw new ve(function(e,t,n,r){for(var i=function(e,t){var n="WebGL Error:  ";switch(t){case e.INVALID_ENUM:n+="INVALID_ENUM";break;case e.INVALID_VALUE:n+="INVALID_VALUE";break;case e.INVALID_OPERATION:n+="INVALID_OPERATION";break;case e.OUT_OF_MEMORY:n+="OUT_OF_MEMORY";break;case e.CONTEXT_LOST_WEBGL:n+="CONTEXT_LOST_WEBGL lost";break;default:n+="Unknown ("+t+")"}return n}(e,r)+": "+t.name+"(",o=0;o<n.length;++o)0!==o&&(i+=", "),i+=n[o];return i+");"}(e,t,n,r))}function IC(e,t,n){return{get:function(){var r=e[t];return n(e,"get: "+t,r),e[t]},set:function(r){e[t]=r,n(e,"set: "+t,r)}}}function RC(e,t){for(var n=t.length,r=0;r<n;++r){var i=e.getExtension(t[r]);if(i)return i}}function PC(t,n){if("undefined"==typeof WebGLRenderingContext)throw new ve("The browser does not support WebGL.  Visit http://get.webgl.org.");this._canvas=t,(n=i(n=Oo(n,!0),{})).allowTextureFilterAnisotropic=i(n.allowTextureFilterAnisotropic,!0);var r=i(n.webgl,{});r.alpha=i(r.alpha,!1),r.stencil=i(r.stencil,!0);var o,a=i(n.requestWebgl2,!1)&&"undefined"!=typeof WebGL2RenderingContext,s=!1,u=n.getWebGLStub;if(e(u))o=u(t,r);else if(a&&e(o=t.getContext("webgl2",r)||t.getContext("experimental-webgl2",r)||void 0)&&(s=!0),e(o)||(o=t.getContext("webgl",r)||t.getContext("experimental-webgl",r)||void 0),!e(o))throw new ve("The browser supports WebGL, but initialization failed.");this._originalGLContext=o,this._gl=o,this._webgl2=s,this._id=Tl(),this.validateFramebuffer=!1,this.validateShaderProgram=!1,this.logShaderCompilation=!1,this._throwOnWebGLError=!1,this._shaderCache=new cC(this),this._textureCache=new hC;var c=o;this._stencilBits=c.getParameter(c.STENCIL_BITS),Ds._maximumCombinedTextureImageUnits=c.getParameter(c.MAX_COMBINED_TEXTURE_IMAGE_UNITS),Ds._maximumCubeMapSize=c.getParameter(c.MAX_CUBE_MAP_TEXTURE_SIZE),Ds._maximumFragmentUniformVectors=c.getParameter(c.MAX_FRAGMENT_UNIFORM_VECTORS),Ds._maximumTextureImageUnits=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS),Ds._maximumRenderbufferSize=c.getParameter(c.MAX_RENDERBUFFER_SIZE),Ds._maximumTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE),Ds._maximumVaryingVectors=c.getParameter(c.MAX_VARYING_VECTORS),Ds._maximumVertexAttributes=c.getParameter(c.MAX_VERTEX_ATTRIBS),Ds._maximumVertexTextureImageUnits=c.getParameter(c.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Ds._maximumVertexUniformVectors=c.getParameter(c.MAX_VERTEX_UNIFORM_VECTORS);var l=c.getParameter(c.ALIASED_LINE_WIDTH_RANGE);Ds._minimumAliasedLineWidth=l[0],Ds._maximumAliasedLineWidth=l[1];var h=c.getParameter(c.ALIASED_POINT_SIZE_RANGE);Ds._minimumAliasedPointSize=h[0],Ds._maximumAliasedPointSize=h[1];var d=c.getParameter(c.MAX_VIEWPORT_DIMS);Ds._maximumViewportWidth=d[0],Ds._maximumViewportHeight=d[1];var f=c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.HIGH_FLOAT);Ds._highpFloatSupported=0!==f.precision;var m=c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.HIGH_INT);Ds._highpIntSupported=0!==m.rangeMax,this._antialias=c.getContextAttributes().antialias,this._standardDerivatives=!!RC(c,["OES_standard_derivatives"]),this._blendMinmax=!!RC(c,["EXT_blend_minmax"]),this._elementIndexUint=!!RC(c,["OES_element_index_uint"]),this._depthTexture=!!RC(c,["WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),this._fragDepth=!!RC(c,["EXT_frag_depth"]),this._debugShaders=RC(c,["WEBGL_debug_shaders"]),this._textureFloat=!!RC(c,["OES_texture_float"]),this._textureHalfFloat=!!RC(c,["OES_texture_half_float"]),this._textureFloatLinear=!!RC(c,["OES_texture_float_linear"]),this._textureHalfFloatLinear=!!RC(c,["OES_texture_half_float_linear"]),this._colorBufferFloat=!!RC(c,["EXT_color_buffer_float","WEBGL_color_buffer_float"]),this._floatBlend=!!RC(c,["EXT_float_blend"]),this._colorBufferHalfFloat=!!RC(c,["EXT_color_buffer_half_float"]),this._s3tc=!!RC(c,["WEBGL_compressed_texture_s3tc","MOZ_WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc"]),this._pvrtc=!!RC(c,["WEBGL_compressed_texture_pvrtc","WEBKIT_WEBGL_compressed_texture_pvrtc"]),this._etc1=!!RC(c,["WEBGL_compressed_texture_etc1"]);var p,_,g,v,y,T,E,x,C,S,A=n.allowTextureFilterAnisotropic?RC(c,["EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"]):void 0;if(this._textureFilterAnisotropic=A,Ds._maximumTextureFilterAnisotropy=e(A)?c.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1,s){var w=this;p=function(){return w._gl.createVertexArray()},_=function(e){w._gl.bindVertexArray(e)},g=function(e){w._gl.deleteVertexArray(e)},v=function(e,t,n,r,i){c.drawElementsInstanced(e,t,n,r,i)},y=function(e,t,n,r){c.drawArraysInstanced(e,t,n,r)},T=function(e,t){c.vertexAttribDivisor(e,t)},E=function(e){c.drawBuffers(e)}}else e(x=RC(c,["OES_vertex_array_object"]))&&(p=function(){return x.createVertexArrayOES()},_=function(e){x.bindVertexArrayOES(e)},g=function(e){x.deleteVertexArrayOES(e)}),e(C=RC(c,["ANGLE_instanced_arrays"]))&&(v=function(e,t,n,r,i){C.drawElementsInstancedANGLE(e,t,n,r,i)},y=function(e,t,n,r){C.drawArraysInstancedANGLE(e,t,n,r)},T=function(e,t){C.vertexAttribDivisorANGLE(e,t)}),e(S=RC(c,["WEBGL_draw_buffers"]))&&(E=function(e){S.drawBuffersWEBGL(e)});this.glCreateVertexArray=p,this.glBindVertexArray=_,this.glDeleteVertexArray=g,this.glDrawElementsInstanced=v,this.glDrawArraysInstanced=y,this.glVertexAttribDivisor=T,this.glDrawBuffers=E,this._vertexArrayObject=!!x,this._instancedArrays=!!C,this._drawBuffers=!!S,Ds._maximumDrawBuffers=this.drawBuffers?c.getParameter(Tn.MAX_DRAW_BUFFERS):1,Ds._maximumColorAttachments=this.drawBuffers?c.getParameter(Tn.MAX_COLOR_ATTACHMENTS):1,this._clearColor=new pn(0,0,0,0),this._clearDepth=1,this._clearStencil=0;var b=new fC,D=new uC(this),I=Us.fromCache();this._defaultPassState=D,this._defaultRenderState=I,this._defaultTexture=void 0,this._defaultCubeMap=void 0,this._us=b,this._currentRenderState=I,this._currentPassState=D,this._currentFramebuffer=void 0,this._maxFrameTextureUnitIndex=0,this._vertexAttribDivisors=[],this._previousDrawInstanced=!1;for(var R=0;R<Ds._maximumVertexAttributes;R++)this._vertexAttribDivisors.push(0);this._pickObjects={},this._nextPickColor=new Uint32Array(1),this.options=n,this.cache={},Us.apply(c,I,D)}var OC,NC={};function MC(e,t,n,r){var i=e._currentRenderState,o=e._currentPassState;e._currentRenderState=t,e._currentPassState=n,Us.partialApply(e._gl,i,t,o,n,r)}function LC(t,n){if(n!==t._currentFramebuffer){t._currentFramebuffer=n;var r=OC;if(e(n))n._bind(),r=n._getActiveColorAttachments();else{var i=t._gl;i.bindFramebuffer(i.FRAMEBUFFER,null)}t.drawBuffers&&t.glDrawBuffers(r)}}Object.defineProperties(PC.prototype,{id:{get:function(){return this._id}},webgl2:{get:function(){return this._webgl2}},canvas:{get:function(){return this._canvas}},shaderCache:{get:function(){return this._shaderCache}},textureCache:{get:function(){return this._textureCache}},uniformState:{get:function(){return this._us}},stencilBits:{get:function(){return this._stencilBits}},stencilBuffer:{get:function(){return this._stencilBits>=8}},antialias:{get:function(){return this._antialias}},standardDerivatives:{get:function(){return this._standardDerivatives||this._webgl2}},floatBlend:{get:function(){return this._floatBlend}},blendMinmax:{get:function(){return this._blendMinmax||this._webgl2}},elementIndexUint:{get:function(){return this._elementIndexUint||this._webgl2}},depthTexture:{get:function(){return this._depthTexture||this._webgl2}},floatingPointTexture:{get:function(){return this._webgl2||this._textureFloat}},halfFloatingPointTexture:{get:function(){return this._webgl2||this._textureHalfFloat}},textureFloatLinear:{get:function(){return this._textureFloatLinear}},textureHalfFloatLinear:{get:function(){return this._webgl2&&this._textureFloatLinear||!this._webgl2&&this._textureHalfFloatLinear}},textureFilterAnisotropic:{get:function(){return!!this._textureFilterAnisotropic}},s3tc:{get:function(){return this._s3tc}},pvrtc:{get:function(){return this._pvrtc}},etc1:{get:function(){return this._etc1}},vertexArrayObject:{get:function(){return this._vertexArrayObject||this._webgl2}},fragmentDepth:{get:function(){return this._fragDepth||this._webgl2}},instancedArrays:{get:function(){return this._instancedArrays||this._webgl2}},colorBufferFloat:{get:function(){return this._colorBufferFloat}},colorBufferHalfFloat:{get:function(){return this._webgl2&&this._colorBufferFloat||!this._webgl2&&this._colorBufferHalfFloat}},drawBuffers:{get:function(){return this._drawBuffers||this._webgl2}},debugShaders:{get:function(){return this._debugShaders}},throwOnWebGLError:{get:function(){return this._throwOnWebGLError},set:function(t){this._throwOnWebGLError=t,this._gl=function(t,n){if(!e(n))return t;function r(e){return function(){var r=e.apply(t,arguments);return n(t,e,arguments),r}}var i={};for(var o in t){var a=t[o];a instanceof Function?i[o]=r(a):Object.defineProperty(i,o,IC(t,o,n))}return i}(this._originalGLContext,t?DC:void 0)}},defaultTexture:{get:function(){return void 0===this._defaultTexture&&(this._defaultTexture=new Fh({context:this,source:{width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])},flipY:!1})),this._defaultTexture}},defaultCubeMap:{get:function(){if(void 0===this._defaultCubeMap){var e={width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])};this._defaultCubeMap=new sC({context:this,source:{positiveX:e,negativeX:e,positiveY:e,negativeY:e,positiveZ:e,negativeZ:e},flipY:!1})}return this._defaultCubeMap}},drawingBufferHeight:{get:function(){return this._gl.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._gl.drawingBufferWidth}},defaultFramebuffer:{get:function(){return NC}}}),"undefined"!=typeof WebGLRenderingContext&&(OC=[Tn.BACK]);var FC=new eC;PC.prototype.clear=function(t,n){t=i(t,FC),n=i(n,this._defaultPassState);var r=this._gl,o=0,a=t.color,s=t.depth,u=t.stencil;e(a)&&(pn.equals(this._clearColor,a)||(pn.clone(a,this._clearColor),r.clearColor(a.red,a.green,a.blue,a.alpha)),o|=r.COLOR_BUFFER_BIT),e(s)&&(s!==this._clearDepth&&(this._clearDepth=s,r.clearDepth(s)),o|=r.DEPTH_BUFFER_BIT),e(u)&&(u!==this._clearStencil&&(this._clearStencil=u,r.clearStencil(u)),o|=r.STENCIL_BUFFER_BIT),MC(this,i(t.renderState,this._defaultRenderState),n,!0),LC(this,i(t.framebuffer,n.framebuffer)),r.clear(o)},PC.prototype.draw=function(t,n,r,o){n=i(n,this._defaultPassState);var a=i(t._framebuffer,n.framebuffer),s=i(t._renderState,this._defaultRenderState);r=i(r,t._shaderProgram),o=i(o,t._uniformMap),function(e,t,n,r,i){LC(e,t),MC(e,i,n,!1),r._bind(),e._maxFrameTextureUnitIndex=Math.max(e._maxFrameTextureUnitIndex,r.maximumTextureUnitIndex)}(this,a,n,r,s),function(t,n,r,o){var a=n._primitiveType,s=n._vertexArray,u=n._offset,c=n._count,l=n.instanceCount;t._us.model=i(n._modelMatrix,ye.IDENTITY),r._setUniforms(o,t._us,t.validateShaderProgram),s._bind();var h=s.indexBuffer;e(h)?(u*=h.bytesPerIndex,c=i(c,h.numberOfIndices),0===l?t._gl.drawElements(a,c,h.indexDatatype,u):t.glDrawElementsInstanced(a,c,h.indexDatatype,u,l)):(c=i(c,s.numberOfVertices),0===l?t._gl.drawArrays(a,u,c):t.glDrawArraysInstanced(a,u,c,l)),s._unBind()}(this,t,r,o)},PC.prototype.endFrame=function(){var e=this._gl;e.useProgram(null),this._currentFramebuffer=void 0,e.bindFramebuffer(e.FRAMEBUFFER,null);var t=OC;this.drawBuffers&&this.glDrawBuffers(t);var n=this._maxFrameTextureUnitIndex;this._maxFrameTextureUnitIndex=0;for(var r=0;r<n;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null)},PC.prototype.readPixels=function(t){var n=this._gl;t=i(t,i.EMPTY_OBJECT);var r=Math.max(i(t.x,0),0),o=Math.max(i(t.y,0),0),a=i(t.width,n.drawingBufferWidth),s=i(t.height,n.drawingBufferHeight),u=t.framebuffer,c=Yc.UNSIGNED_BYTE;e(u)&&u.numberOfColorAttachments>0&&(c=u.getColorTexture(0).pixelDatatype);var l=Xc.createTypedArray(Xc.RGBA,c,a,s);return LC(this,u),n.readPixels(r,o,a,s,Xc.RGBA,Yc.toWebGLConstant(c,this),l),l};var zC={position:0,textureCoordinates:1};function BC(e,t,n){this._pickObjects=e,this.key=t,this.color=n}PC.prototype.getViewportQuadVertexArray=function(){var t=this.cache.viewportQuad_vertexArray;if(!e(t)){var n=new cc({attributes:{position:new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:2,values:[-1,-1,1,-1,1,1,-1,1]}),textureCoordinates:new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:2,values:[0,0,1,0,1,1,0,1]})},indices:new Uint16Array([0,1,2,0,2,3]),primitiveType:Rs.TRIANGLES});t=xc.fromGeometry({context:this,geometry:n,attributeLocations:zC,bufferUsage:ws.STATIC_DRAW,interleave:!0}),this.cache.viewportQuad_vertexArray=t}return t},PC.prototype.createViewportQuadCommand=function(e,t){return t=i(t,i.EMPTY_OBJECT),new Ps({vertexArray:this.getViewportQuadVertexArray(),primitiveType:Rs.TRIANGLES,renderState:t.renderState,shaderProgram:Hu.fromCache({context:this,vertexShaderSource:nC,fragmentShaderSource:e,attributeLocations:zC}),uniformMap:t.uniformMap,owner:t.owner,framebuffer:t.framebuffer,pass:t.pass})},PC.prototype.getObjectByPickColor=function(e){return this._pickObjects[e.toRgba()]},Object.defineProperties(BC.prototype,{object:{get:function(){return this._pickObjects[this.key]},set:function(e){this._pickObjects[this.key]=e}}}),BC.prototype.destroy=function(){delete this._pickObjects[this.key]},PC.prototype.createPickId=function(e){++this._nextPickColor[0];var t=this._nextPickColor[0];if(0===t)throw new ve("Out of unique Pick IDs.");return this._pickObjects[t]=e,new BC(this._pickObjects,t,pn.fromRgba(t))},PC.prototype.isDestroyed=function(){return!1},PC.prototype.destroy=function(){var t=this.cache;for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];e(r.destroy)&&r.destroy()}return this._shaderCache=this._shaderCache.destroy(),this._textureCache=this._textureCache.destroy(),this._defaultTexture=this._defaultTexture&&this._defaultTexture.destroy(),this._defaultCubeMap=this._defaultCubeMap&&this._defaultCubeMap.destroy(),hi(this)};function UC(){this._framebuffer=void 0,this._colorTexture=void 0,this._drawCommand=void 0}Object.defineProperties(UC.prototype,{colorTexture:{get:function(){return this._colorTexture}}}),UC.prototype.update=function(t){if(!e(this._colorTexture)){var n=t.context;!function(e,t){var n=new Fh({context:t,width:256,height:256,pixelFormat:Xc.RGBA,pixelDatatype:Yc.UNSIGNED_BYTE,sampler:Lh.NEAREST});e._colorTexture=n;var r=new wh({context:t,colorTextures:[n],destroyAttachments:!1});e._framebuffer=r}(this,n),function(e,t){var n=e._framebuffer,r=t.createViewportQuadCommand("varying vec2 v_textureCoordinates;\nconst float M_PI = 3.141592653589793;\nfloat vdcRadicalInverse(int i)\n{\nfloat r;\nfloat base = 2.0;\nfloat value = 0.0;\nfloat invBase = 1.0 / base;\nfloat invBi = invBase;\nfor (int x = 0; x < 100; x++)\n{\nif (i <= 0)\n{\nbreak;\n}\nr = mod(float(i), base);\nvalue += r * invBi;\ninvBi *= invBase;\ni = int(float(i) * invBase);\n}\nreturn value;\n}\nvec2 hammersley2D(int i, int N)\n{\nreturn vec2(float(i) / float(N), vdcRadicalInverse(i));\n}\nvec3 importanceSampleGGX(vec2 xi, float roughness, vec3 N)\n{\nfloat a = roughness * roughness;\nfloat phi = 2.0 * M_PI * xi.x;\nfloat cosTheta = sqrt((1.0 - xi.y) / (1.0 + (a * a - 1.0) * xi.y));\nfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\nvec3 H = vec3(sinTheta * cos(phi), sinTheta * sin(phi), cosTheta);\nvec3 upVector = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\nvec3 tangentX = normalize(cross(upVector, N));\nvec3 tangentY = cross(N, tangentX);\nreturn tangentX * H.x + tangentY * H.y + N * H.z;\n}\nfloat G1_Smith(float NdotV, float k)\n{\nreturn NdotV / (NdotV * (1.0 - k) + k);\n}\nfloat G_Smith(float roughness, float NdotV, float NdotL)\n{\nfloat k = roughness * roughness / 2.0;\nreturn G1_Smith(NdotV, k) * G1_Smith(NdotL, k);\n}\nvec2 integrateBrdf(float roughness, float NdotV)\n{\nvec3 V = vec3(sqrt(1.0 - NdotV * NdotV), 0.0, NdotV);\nfloat A = 0.0;\nfloat B = 0.0;\nconst int NumSamples = 1024;\nfor (int i = 0; i < NumSamples; i++)\n{\nvec2 xi = hammersley2D(i, NumSamples);\nvec3 H = importanceSampleGGX(xi, roughness, vec3(0.0, 0.0, 1.0));\nvec3 L = 2.0 * dot(V, H) * H - V;\nfloat NdotL = clamp(L.z, 0.0, 1.0);\nfloat NdotH = clamp(H.z, 0.0, 1.0);\nfloat VdotH = clamp(dot(V, H), 0.0, 1.0);\nif (NdotL > 0.0)\n{\nfloat G = G_Smith(roughness, NdotV, NdotL);\nfloat G_Vis = G * VdotH / (NdotH * NdotV);\nfloat Fc = pow(1.0 - VdotH, 5.0);\nA += (1.0 - Fc) * G_Vis;\nB += Fc * G_Vis;\n}\n}\nreturn vec2(A, B) / float(NumSamples);\n}\nvoid main()\n{\ngl_FragColor = vec4(integrateBrdf(v_textureCoordinates.y, v_textureCoordinates.x), 0.0, 1.0);\n}\n",{framebuffer:n,renderState:Us.fromCache({viewport:new Ns(0,0,256,256)})});e._drawCommand=r}(this,n),this._drawCommand.execute(n),this._framebuffer=this._framebuffer&&this._framebuffer.destroy(),this._drawCommand.shaderProgram=this._drawCommand.shaderProgram&&this._drawCommand.shaderProgram.destroy()}},UC.prototype.isDestroyed=function(){return!1},UC.prototype.destroy=function(){return this._colorTexture=this._colorTexture&&this._colorTexture.destroy(),hi(this)},void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var VC,HC,GC=GC||(VC=[],{REVISION:"13",getAll:function(){return VC},removeAll:function(){VC=[]},add:function(e){VC.push(e)},remove:function(e){var t=VC.indexOf(e);-1!==t&&VC.splice(t,1)},update:function(e){if(0===VC.length)return!1;var t=0;for(e=void 0!==e?e:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();t<VC.length;)VC[t].update(e)?t++:VC.splice(t,1);return!0}});GC.Tween=function(e){var t=e,n={},r={},i={},o=1e3,a=0,s=!1,u=!1,c=0,l=null,h=GC.Easing.Linear.None,d=GC.Interpolation.Linear,f=[],m=null,p=!1,_=null,g=null,v=null;for(var y in e)n[y]=parseFloat(e[y],10);this.to=function(e,t){return void 0!==t&&(o=t),r=e,this},this.start=function(e){for(var o in GC.add(this),u=!0,p=!1,l=void 0!==e?e:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),l+=c,r){if(r[o]instanceof Array){if(0===r[o].length)continue;r[o]=[t[o]].concat(r[o])}n[o]=t[o],n[o]instanceof Array==!1&&(n[o]*=1),i[o]=n[o]||0}return this},this.stop=function(){return u?(GC.remove(this),u=!1,null!==v&&v.call(t),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var e=0,t=f.length;e<t;e++)f[e].stop()},this.delay=function(e){return c=e,this},this.repeat=function(e){return a=e,this},this.yoyo=function(e){return s=e,this},this.easing=function(e){return h=e,this},this.interpolation=function(e){return d=e,this},this.chain=function(){return f=arguments,this},this.onStart=function(e){return m=e,this},this.onUpdate=function(e){return _=e,this},this.onComplete=function(e){return g=e,this},this.onStop=function(e){return v=e,this},this.update=function(e){var u;if(e<l)return!0;!1===p&&(null!==m&&m.call(t),p=!0);var v=(e-l)/o,y=h(v=v>1?1:v);for(u in r){var T=n[u]||0,E=r[u];E instanceof Array?t[u]=d(E,y):("string"==typeof E&&(E=T+parseFloat(E,10)),"number"==typeof E&&(t[u]=T+(E-T)*y))}if(null!==_&&_.call(t,y),1==v){if(a>0){for(u in isFinite(a)&&a--,i){if("string"==typeof r[u]&&(i[u]=i[u]+parseFloat(r[u],10)),s){var x=i[u];i[u]=r[u],r[u]=x}n[u]=i[u]}return l=e+c,!0}null!==g&&g.call(t);for(var C=0,S=f.length;C<S;C++)f[C].start(e);return!1}return!0}},GC.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4))},Out:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/.4)+1)},InOut:function(e){var t,n=.1,r=.4;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=r*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/r)*-.5:n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/r)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-GC.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*GC.Easing.Bounce.In(2*e):.5*GC.Easing.Bounce.Out(2*e-1)+.5}}},GC.Interpolation={Linear:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),o=GC.Interpolation.Utils.Linear;return t<0?o(e[0],e[1],r):t>1?o(e[n],e[n-1],n-r):o(e[i],e[i+1>n?n:i+1],r-i)},Bezier:function(e,t){var n,r=0,i=e.length-1,o=Math.pow,a=GC.Interpolation.Utils.Bernstein;for(n=0;n<=i;n++)r+=o(1-t,i-n)*o(t,n)*e[n]*a(i,n);return r},CatmullRom:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),o=GC.Interpolation.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(i=Math.floor(r=n*(1+t))),o(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):t<0?e[0]-(o(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(o(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):o(e[i?i-1:0],e[i],e[n<i+1?n:i+1],e[n<i+2?n:i+2],r-i)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=GC.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:(HC=[1],function(e){var t,n=1;if(HC[e])return HC[e];for(t=e;t>1;t--)n*=t;return HC[e]=n}),CatmullRom:function(e,t,n,r,i){var o=.5*(n-e),a=.5*(r-t),s=i*i;return(2*t-2*n+o+a)*(i*s)+(-3*t+3*n-2*o-a)*s+o*i+t}}};var kC={};function WC(t,n){e(kC[t])||(kC[t]=!0,console.warn(i(n,t)))}function qC(e,t){WC(e,t)}WC.geometryOutlines="Entity geometry outlines are unsupported on terrain. Outlines will be disabled. To enable outlines, disable geometry terrain clamping by explicitly setting height to 0.",WC.geometryZIndex="Entity geometry with zIndex are unsupported when height or extrudedHeight are defined.  zIndex will be ignored",WC.geometryHeightReference="Entity corridor, ellipse, polygon or rectangle with heightReference must also have a defined height.  heightReference will be ignored",WC.geometryExtrudedHeightReference="Entity corridor, ellipse, polygon or rectangle with extrudedHeightReference must also have a defined extrudedHeight.  extrudedHeightReference will be ignored";var YC={LINEAR_NONE:GC.Easing.Linear.None,QUADRATIC_IN:GC.Easing.Quadratic.In,QUADRATIC_OUT:GC.Easing.Quadratic.Out,QUADRATIC_IN_OUT:GC.Easing.Quadratic.InOut,CUBIC_IN:GC.Easing.Cubic.In,CUBIC_OUT:GC.Easing.Cubic.Out,CUBIC_IN_OUT:GC.Easing.Cubic.InOut,QUARTIC_IN:GC.Easing.Quartic.In,QUARTIC_OUT:GC.Easing.Quartic.Out,QUARTIC_IN_OUT:GC.Easing.Quartic.InOut,QUINTIC_IN:GC.Easing.Quintic.In,QUINTIC_OUT:GC.Easing.Quintic.Out,QUINTIC_IN_OUT:GC.Easing.Quintic.InOut,SINUSOIDAL_IN:GC.Easing.Sinusoidal.In,SINUSOIDAL_OUT:GC.Easing.Sinusoidal.Out,SINUSOIDAL_IN_OUT:GC.Easing.Sinusoidal.InOut,EXPONENTIAL_IN:GC.Easing.Exponential.In,EXPONENTIAL_OUT:GC.Easing.Exponential.Out,EXPONENTIAL_IN_OUT:GC.Easing.Exponential.InOut,CIRCULAR_IN:GC.Easing.Circular.In,CIRCULAR_OUT:GC.Easing.Circular.Out,CIRCULAR_IN_OUT:GC.Easing.Circular.InOut,ELASTIC_IN:GC.Easing.Elastic.In,ELASTIC_OUT:GC.Easing.Elastic.Out,ELASTIC_IN_OUT:GC.Easing.Elastic.InOut,BACK_IN:GC.Easing.Back.In,BACK_OUT:GC.Easing.Back.Out,BACK_IN_OUT:GC.Easing.Back.InOut,BOUNCE_IN:GC.Easing.Bounce.In,BOUNCE_OUT:GC.Easing.Bounce.Out,BOUNCE_IN_OUT:GC.Easing.Bounce.InOut};Object.defineProperties(YC,{QUADRACTIC_IN:{get:function(){return qC("QUADRACTIC_IN","QUADRACTIC_IN is deprecated and will be removed in Cesium 1.79. Use QUADRATIC_IN instead."),GC.Easing.Quadratic.In}},QUADRACTIC_OUT:{get:function(){return qC("QUADRACTIC_OUT","QUADRACTIC_OUT is deprecated and will be removed in Cesium 1.79. Use QUADRATIC_OUT instead."),GC.Easing.Quadratic.Out}},QUADRACTIC_IN_OUT:{get:function(){return qC("QUADRACTIC_IN_OUT","QUADRACTIC_IN_OUT is deprecated and will be removed in Cesium 1.79. Use QUADRATIC_IN_OUT instead."),GC.Easing.Quadratic.InOut}}});var jC=Object.freeze(YC);function XC(e,t,n,r,i,o,a){var s=function(e,t){return e*t*(4+e*(4-3*t))/16}(e,n);return(1-s)*e*t*(r+s*i*(a+s*o*(2*a*a-1)))}var ZC=new p,KC=new p;function QC(e,t,n,r){p.normalize(r.cartographicToCartesian(t,KC),ZC),p.normalize(r.cartographicToCartesian(n,KC),KC),function(e,t,n,r,i,o,s){var u,c,l,h,d,f=(t-n)/t,m=o-r,p=Math.atan((1-f)*Math.tan(i)),_=Math.atan((1-f)*Math.tan(s)),g=Math.cos(p),v=Math.sin(p),y=Math.cos(_),T=Math.sin(_),E=g*y,x=g*T,C=v*T,S=v*y,A=m,w=a.TWO_PI,b=Math.cos(A),D=Math.sin(A);do{b=Math.cos(A),D=Math.sin(A);var I,R=x-S*b;l=Math.sqrt(y*y*D*D+R*R),c=C+E*b,u=Math.atan2(l,c),0===l?(I=0,h=1):h=1-(I=E*D/l)*I,w=A,d=c-2*C/h,isNaN(d)&&(d=0),A=m+XC(f,I,h,u,l,c,d)}while(Math.abs(A-w)>a.EPSILON12);var P=h*(t*t-n*n)/(n*n),O=P*(256+P*(P*(74-47*P)-128))/1024,N=d*d,M=n*(1+P*(4096+P*(P*(320-175*P)-768))/16384)*(u-O*l*(d+O*(c*(2*N-1)-O*d*(4*l*l-3)*(4*N-3)/6)/4)),L=Math.atan2(y*D,x-S*b),F=Math.atan2(g*D,x*b-S);e._distance=M,e._startHeading=L,e._endHeading=F,e._uSquared=P}(e,r.maximumRadius,r.minimumRadius,t.longitude,t.latitude,n.longitude,n.latitude),e._start=N.clone(t,e._start),e._end=N.clone(n,e._end),e._start.height=0,e._end.height=0,function(e){var t=e._uSquared,n=e._ellipsoid.maximumRadius,r=e._ellipsoid.minimumRadius,i=(n-r)/n,o=Math.cos(e._startHeading),a=Math.sin(e._startHeading),s=(1-i)*Math.tan(e._start.latitude),u=1/Math.sqrt(1+s*s),c=u*s,l=Math.atan2(s,o),h=u*a,d=h*h,f=1-d,m=Math.sqrt(f),p=t/4,_=p*p,g=_*p,v=_*_,y=1+p-3*_/4+5*g/4-175*v/64,T=1-p+15*_/8-35*g/8,E=1-3*p+35*_/4,x=1-5*p,C=y*l-T*Math.sin(2*l)*p/2-E*Math.sin(4*l)*_/16-x*Math.sin(6*l)*g/48-5*Math.sin(8*l)*v/512,S=e._constants;S.a=n,S.b=r,S.f=i,S.cosineHeading=o,S.sineHeading=a,S.tanU=s,S.cosineU=u,S.sineU=c,S.sigma=l,S.sineAlpha=h,S.sineSquaredAlpha=d,S.cosineSquaredAlpha=f,S.cosineAlpha=m,S.u2Over4=p,S.u4Over16=_,S.u6Over64=g,S.u8Over256=v,S.a0=y,S.a1=T,S.a2=E,S.a3=x,S.distanceRatio=C}(e)}function JC(t,n,r){var o=i(r,H.WGS84);this._ellipsoid=o,this._start=new N,this._end=new N,this._constants={},this._startHeading=void 0,this._endHeading=void 0,this._distance=void 0,this._uSquared=void 0,e(t)&&e(n)&&QC(this,t,n,o)}function $C(e,t,n){this.heading=i(e,0),this.pitch=i(t,0),this.range=i(n,0)}Object.defineProperties(JC.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},surfaceDistance:{get:function(){return this._distance}},start:{get:function(){return this._start}},end:{get:function(){return this._end}},startHeading:{get:function(){return this._startHeading}},endHeading:{get:function(){return this._endHeading}}}),JC.prototype.setEndPoints=function(e,t){QC(this,e,t,this._ellipsoid)},JC.prototype.interpolateUsingFraction=function(e,t){return this.interpolateUsingSurfaceDistance(this._distance*e,t)},JC.prototype.interpolateUsingSurfaceDistance=function(t,n){var r=this._constants,i=r.distanceRatio+t/r.b,o=Math.cos(2*i),a=Math.cos(4*i),s=Math.cos(6*i),u=Math.sin(2*i),c=Math.sin(4*i),l=Math.sin(6*i),h=Math.sin(8*i),d=i*i,f=i*d,m=r.u8Over256,p=r.u2Over4,_=r.u6Over64,g=r.u4Over16,v=2*f*m*o/3+i*(1-p+7*g/4-15*_/4+579*m/64-(g-15*_/4+187*m/16)*o-(5*_/4-115*m/16)*a-29*m*s/16)+(p/2-g+71*_/32-85*m/16)*u+(5*g/16-5*_/4+383*m/96)*c-d*((_-11*m/2)*u+5*m*c/2)+(29*_/96-29*m/16)*l+539*m*h/1536,y=Math.asin(Math.sin(v)*r.cosineAlpha),T=Math.atan(r.a/r.b*Math.tan(y));v-=r.sigma;var E=Math.cos(2*r.sigma+v),x=Math.sin(v),C=Math.cos(v),S=r.cosineU*C,A=r.sineU*x,w=Math.atan2(x*r.sineHeading,S-A*r.cosineHeading)-XC(r.f,r.sineAlpha,r.cosineSquaredAlpha,v,x,C,E);return e(n)?(n.longitude=this._start.longitude+w,n.latitude=T,n.height=0,n):new N(this._start.longitude+w,T,0)},$C.clone=function(t,n){if(e(t))return e(n)||(n=new $C),n.heading=t.heading,n.pitch=t.pitch,n.range=t.range,n};var eS={};var tS=new p,nS=new p;function rS(t,n,r,i,o){var s=o,u=Math.max(r,i);if(!e(s)){var c=t.position,l=n,h=t.up,d=t.right,f=t.frustum,m=p.subtract(c,l,tS),_=p.magnitude(p.multiplyByScalar(h,p.dot(m,h),nS)),g=p.magnitude(p.multiplyByScalar(d,p.dot(m,d),nS));s=Math.min(.2*function(e,t,n){var r,i,o;if(e instanceof Jx){var a=Math.tan(.5*e.fovy);return r=e.near,i=e.near*a,o=e.aspectRatio*i,Math.max(t*r/o,n*r/i)}return e instanceof Yx?(r=e.near,i=e.top,o=e.right,Math.max(t*r/o,n*r/i)):Math.max(t,n)}(f,_,g),1e9)}if(u<s){var v=1e6,y=-Math.pow((s-r)*v,1/8),T=Math.pow((s-i)*v,1/8);return function(e){var t=e*(T-y)+y;return-Math.pow(t,8)/v+s}}return function(e){return a.lerp(r,i,e)}}function iS(e,t){return a.equalsEpsilon(e,a.TWO_PI,a.EPSILON11)&&(e=0),t>e+Math.PI?e+=a.TWO_PI:t<e-Math.PI&&(e-=a.TWO_PI),e}var oS=new p;function aS(e,t,n,r,i,o,s){var u=e.camera,l=p.clone(u.position,oS),h=u.pitch,d=iS(u.heading,r),f=iS(u.roll,o),m=rS(u,n,l.z,n.z,s);return function(e){var s=e.time/t;u.setView({orientation:{heading:a.lerp(d,r,s),pitch:a.lerp(h,i,s),roll:a.lerp(f,o,s)}}),c.lerp(l,n,s,u.position),u.position.z=m(s)}}var sS=new N,uS=new N;function cS(t,n,r,i,o,s,u,c,l,h){var d=t.camera,f=t.mapProjection.ellipsoid,m=N.clone(d.positionCartographic,sS),_=d.pitch,g=iS(d.heading,i),v=iS(d.roll,s),y=f.cartesianToCartographic(r,uS);m.longitude=a.zeroToTwoPi(m.longitude),y.longitude=a.zeroToTwoPi(y.longitude);var T=!1;if(e(c)){var E=a.zeroToTwoPi(c),x=Math.min(m.longitude,y.longitude),C=Math.max(m.longitude,y.longitude),S=E>=x&&E<=C;if(e(l)){var A=Math.abs(m.longitude-y.longitude),w=a.TWO_PI-A;(S?A:w)<(S?w:A)*l&&!S&&(T=!0)}else S||(T=!0)}T?function(e,t){e.longitude<t.longitude?e.longitude+=a.TWO_PI:t.longitude+=a.TWO_PI}(m,y):function(e,t){var n=e.longitude-t.longitude;n<-a.PI?e.longitude+=a.TWO_PI:n>a.PI&&(t.longitude+=a.TWO_PI)}(m,y);var b,D,I,R,P=rS(d,r,m.height,y.height,u),O=function(t,n,r,i){if(e(i)&&r(.5)>i){var o=r(0),s=r(1),u=r(.5),c=u-o,l=u-s;return function(e){var i=r(e);if(e<=.5){var u=(i-o)/c;return a.lerp(t,-a.PI_OVER_TWO,u)}var h=(i-s)/l;return a.lerp(-a.PI_OVER_TWO,n,1-h)}}return function(e){return a.lerp(t,n,e)}}(_,o,P,h);return b=m.longitude,D=y.longitude,I=m.latitude,R=y.latitude,function(e){var t=e.time/n,r=p.fromRadians(a.lerp(b,D,t),a.lerp(I,R,t),P(t));d.setView({destination:r,orientation:{heading:a.lerp(g,i,t),pitch:O(t),roll:a.lerp(v,s,t)}})}}function lS(e,t,n,r,i,o,s){var u=e.camera,l=p.clone(u.position,oS),h=iS(u.heading,r),d=u.frustum.right-u.frustum.left,f=rS(u,n,d,n.z,s);return function(e){var i=e.time/t;u.setView({orientation:{heading:a.lerp(h,r,i)}}),c.lerp(l,n,i,u.position);var o=f(i),s=u.frustum,d=s.top/s.right,m=.5*(o-(s.right-s.left));s.right+=m,s.left-=m,s.top=d*s.right,s.bottom=-s.top}}var hS=new N,dS=new p;function fS(e,t){return{startObject:{},stopObject:{},duration:0,complete:e,cancel:t}}function mS(e,t){return function(){"function"==typeof t&&t(),e.enableInputs=!0}}eS.createTween=function(t,n){var r=(n=i(n,i.EMPTY_OBJECT)).destination,o=t.mode;if(o===Al.MORPHING)return fS();var s=i(n.convert,!0),u=t.mapProjection,l=u.ellipsoid,h=n.maximumHeight,d=n.flyOverLongitude,f=n.flyOverLongitudeWeight,m=n.pitchAdjustHeight,_=n.easingFunction;s&&o!==Al.SCENE3D&&(l.cartesianToCartographic(r,hS),r=u.project(hS,dS));var g=t.camera,v=n.endTransform;e(v)&&g._setTransform(v);var y=n.duration;e(y)||(y=Math.ceil(p.distance(g.position,r)/1e6)+2,y=Math.min(y,3));var T=i(n.heading,0),E=i(n.pitch,-a.PI_OVER_TWO),x=i(n.roll,0),C=t.screenSpaceCameraController;C.enableInputs=!1;var S=mS(C,n.complete),A=mS(C,n.cancel),w=g.frustum,b=t.mode===Al.SCENE2D;if(b=(b=(b=(b=b&&c.equalsEpsilon(g.position,r,a.EPSILON6))&&a.equalsEpsilon(Math.max(w.right-w.left,w.top-w.bottom),r.z,a.EPSILON6))||t.mode!==Al.SCENE2D&&p.equalsEpsilon(r,g.position,a.EPSILON10))&&a.equalsEpsilon(a.negativePiToPi(T),a.negativePiToPi(g.heading),a.EPSILON10)&&a.equalsEpsilon(a.negativePiToPi(E),a.negativePiToPi(g.pitch),a.EPSILON10)&&a.equalsEpsilon(a.negativePiToPi(x),a.negativePiToPi(g.roll),a.EPSILON10))return fS(S,A);var D=new Array(4);if(D[Al.SCENE2D]=lS,D[Al.SCENE3D]=cS,D[Al.COLUMBUS_VIEW]=aS,y<=0){return fS((function(){D[o](t,1,r,T,E,x,h,d,f,m)({time:1}),"function"==typeof S&&S()}),A)}var I=D[o](t,y,r,T,E,x,h,d,f,m);if(!e(_)){var R=g.positionCartographic.height;_=R>(o===Al.SCENE3D?l.cartesianToCartographic(r).height:r.z)&&R>11500?jC.CUBIC_OUT:jC.QUINTIC_IN_OUT}return{duration:y,easingFunction:_,startObject:{time:0},stopObject:{time:y},update:I,complete:S,cancel:A}};var pS=Object.freeze({ROTATE:0,INFINITE_SCROLL:1});function _S(e){this._scene=e,this._transform=ye.clone(ye.IDENTITY),this._invTransform=ye.clone(ye.IDENTITY),this._actualTransform=ye.clone(ye.IDENTITY),this._actualInvTransform=ye.clone(ye.IDENTITY),this._transformChanged=!1,this.position=new p,this._position=new p,this._positionWC=new p,this._positionCartographic=new N,this._oldPositionWC=void 0,this.positionWCDeltaMagnitude=0,this.positionWCDeltaMagnitudeLastFrame=0,this.timeSinceMoved=0,this._lastMovedTimestamp=0,this.direction=new p,this._direction=new p,this._directionWC=new p,this.up=new p,this._up=new p,this._upWC=new p,this.right=new p,this._right=new p,this._rightWC=new p,this.frustum=new Jx,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.fov=a.toRadians(60),this.defaultMoveAmount=1e5,this.defaultLookAmount=Math.PI/60,this.defaultRotateAmount=Math.PI/3600,this.defaultZoomAmount=1e5,this.constrainedAxis=void 0,this.maximumZoomFactor=1.5,this._moveStart=new qo,this._moveEnd=new qo,this._changed=new qo,this._changedPosition=void 0,this._changedDirection=void 0,this._changedFrustum=void 0,this.percentageChanged=.5,this._viewMatrix=new ye,this._invViewMatrix=new ye,gS(this),this._mode=Al.SCENE3D,this._modeChanged=!0;var t=e.mapProjection;this._projection=t,this._maxCoord=t.project(new N(Math.PI,a.PI_OVER_TWO)),this._max2Dfrustum=void 0,NA(this,_S.DEFAULT_VIEW_RECTANGLE,this.position,!0);var n=p.magnitude(this.position);n+=n*_S.DEFAULT_VIEW_FACTOR,p.normalize(this.position,this.position),p.multiplyByScalar(this.position,n,this.position)}function gS(e){ye.computeView(e._position,e._direction,e._up,e._right,e._viewMatrix),ye.multiply(e._viewMatrix,e._actualInvTransform,e._viewMatrix),ye.inverseTransformation(e._viewMatrix,e._invViewMatrix)}_S.TRANSFORM_2D=new ye(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),_S.TRANSFORM_2D_INVERSE=ye.inverseTransformation(_S.TRANSFORM_2D,new ye),_S.DEFAULT_VIEW_RECTANGLE=Oe.fromDegrees(-95,-20,-70,90),_S.DEFAULT_VIEW_FACTOR=.5,_S.DEFAULT_OFFSET=new $C(0,-a.PI_OVER_FOUR,0),_S.prototype.canPreloadFlight=function(){return e(this._currentFlight)&&this._mode!==Al.SCENE2D},_S.prototype._updateCameraChanged=function(){var t=this;if(function(t){if(e(t._oldPositionWC)){t.positionWCDeltaMagnitudeLastFrame=t.positionWCDeltaMagnitude;var n=p.subtract(t.positionWC,t._oldPositionWC,t._oldPositionWC);t.positionWCDeltaMagnitude=p.magnitude(n),t._oldPositionWC=p.clone(t.positionWC,t._oldPositionWC),t.positionWCDeltaMagnitude>0?(t.timeSinceMoved=0,t._lastMovedTimestamp=di()):t.timeSinceMoved=Math.max(di()-t._lastMovedTimestamp,0)/1e3}else t._oldPositionWC=p.clone(t.positionWC,t._oldPositionWC)}(t),0!==t._changed.numberOfListeners){var n=t.percentageChanged;if(t._mode!==Al.SCENE2D){if(!e(t._changedDirection))return t._changedPosition=p.clone(t.positionWC,t._changedPosition),void(t._changedDirection=p.clone(t.directionWC,t._changedDirection));var r,i=a.acosClamped(p.dot(t.directionWC,t._changedDirection));r=e(t.frustum.fovy)?i/(.5*t.frustum.fovy):i;var o=p.distance(t.positionWC,t._changedPosition)/t.positionCartographic.height;(r>n||o>n)&&(t._changed.raiseEvent(Math.max(r,o)),t._changedPosition=p.clone(t.positionWC,t._changedPosition),t._changedDirection=p.clone(t.directionWC,t._changedDirection))}else{if(!e(t._changedFrustum))return t._changedPosition=p.clone(t.position,t._changedPosition),void(t._changedFrustum=t.frustum.clone());var s,u=t.position,c=t._changedPosition,l=t.frustum,h=t._changedFrustum,d=u.x+l.left,f=u.x+l.right,m=c.x+h.left,_=c.x+h.right,g=u.y+l.bottom,v=u.y+l.top,y=c.y+h.bottom,T=c.y+h.top,E=Math.max(d,m),x=Math.min(f,_),C=Math.max(g,y),S=Math.min(v,T);if(E>=x||C>=v)s=1;else{var A=h;d<m&&f>_&&g<y&&v>T&&(A=l),s=1-(x-E)*(S-C)/((A.right-A.left)*(A.top-A.bottom))}s>n&&(t._changed.raiseEvent(s),t._changedPosition=p.clone(t.position,t._changedPosition),t._changedFrustum=t.frustum.clone(t._changedFrustum))}}};var vS=new N,yS=new p,TS=new p,ES=new le,xS=new le,CS=new le,SS=new le,AS=new le;var wS=new p;function bS(e){var t=e._mode,n=!1,r=0;t===Al.SCENE2D&&(n=(r=e.frustum.right-e.frustum.left)!==e._positionCartographic.height);var i=e._position,o=!p.equals(i,e.position)||n;o&&(i=p.clone(e.position,e._position));var s=e._direction,u=!p.equals(s,e.direction);u&&(p.normalize(e.direction,e.direction),s=p.clone(e.direction,e._direction));var c=e._up,l=!p.equals(c,e.up);l&&(p.normalize(e.up,e.up),c=p.clone(e.up,e._up));var h=e._right,d=!p.equals(h,e.right);d&&(p.normalize(e.right,e.right),h=p.clone(e.right,e._right));var f=e._transformChanged||e._modeChanged;e._transformChanged=!1,f&&(ye.inverseTransformation(e._transform,e._invTransform),e._mode===Al.COLUMBUS_VIEW||e._mode===Al.SCENE2D?ye.equals(ye.IDENTITY,e._transform)?ye.clone(_S.TRANSFORM_2D,e._actualTransform):e._mode===Al.COLUMBUS_VIEW?function(e){ka.basisTo2D(e._projection,e._transform,e._actualTransform)}(e):function(e){var t=e._projection,n=t.ellipsoid,r=ye.getColumn(e._transform,3,ES),i=n.cartesianToCartographic(r,vS),o=t.project(i,yS),s=xS;s.x=o.z,s.y=o.x,s.z=o.y,s.w=1;var u=le.clone(le.UNIT_X,AS),c=le.add(ye.getColumn(e._transform,0,TS),r,TS);n.cartesianToCartographic(c,i),t.project(i,o);var l=CS;l.x=o.z,l.y=o.x,l.z=o.y,l.w=0,p.subtract(l,s,l),l.x=0;var h=SS;if(p.magnitudeSquared(l)>a.EPSILON10)p.cross(u,l,h);else{var d=le.add(ye.getColumn(e._transform,1,TS),r,TS);n.cartesianToCartographic(d,i),t.project(i,o),h.x=o.z,h.y=o.x,h.z=o.y,h.w=0,p.subtract(h,s,h),h.x=0,p.magnitudeSquared(h)<a.EPSILON10&&(le.clone(le.UNIT_Y,l),le.clone(le.UNIT_Z,h))}p.cross(h,u,l),p.normalize(l,l),p.cross(u,l,h),p.normalize(h,h),ye.setColumn(e._actualTransform,0,l,e._actualTransform),ye.setColumn(e._actualTransform,1,h,e._actualTransform),ye.setColumn(e._actualTransform,2,u,e._actualTransform),ye.setColumn(e._actualTransform,3,s,e._actualTransform)}(e):ye.clone(e._transform,e._actualTransform),ye.inverseTransformation(e._actualTransform,e._actualInvTransform),e._modeChanged=!1);var m=e._actualTransform;if(o||f)if(e._positionWC=ye.multiplyByPoint(m,i,e._positionWC),t===Al.SCENE3D||t===Al.MORPHING)e._positionCartographic=e._projection.ellipsoid.cartesianToCartographic(e._positionWC,e._positionCartographic);else{var _=wS;_.x=e._positionWC.y,_.y=e._positionWC.z,_.z=e._positionWC.x,t===Al.SCENE2D&&(_.z=r),e._projection.unproject(_,e._positionCartographic)}if(u||l||d){var g=p.dot(s,p.cross(c,h,wS));if(Math.abs(1-g)>a.EPSILON2){var v=1/p.magnitudeSquared(c),y=p.dot(c,s)*v,T=p.multiplyByScalar(s,y,wS);c=p.normalize(p.subtract(c,T,e._up),e._up),p.clone(c,e.up),h=p.cross(s,c,e._right),p.clone(h,e.right)}}(u||f)&&(e._directionWC=ye.multiplyByPointAsVector(m,s,e._directionWC),p.normalize(e._directionWC,e._directionWC)),(l||f)&&(e._upWC=ye.multiplyByPointAsVector(m,c,e._upWC),p.normalize(e._upWC,e._upWC)),(d||f)&&(e._rightWC=ye.multiplyByPointAsVector(m,h,e._rightWC),p.normalize(e._rightWC,e._rightWC)),(o||u||l||d||f)&&gS(e)}function DS(e,t){var n;return n=a.equalsEpsilon(Math.abs(e.z),1,a.EPSILON3)?Math.atan2(t.y,t.x)-a.PI_OVER_TWO:Math.atan2(e.y,e.x)-a.PI_OVER_TWO,a.TWO_PI-a.zeroToTwoPi(n)}function IS(e){return a.PI_OVER_TWO-a.acosClamped(e.z)}function RS(e,t,n){var r=0;return a.equalsEpsilon(Math.abs(e.z),1,a.EPSILON3)||(r=Math.atan2(-n.z,t.z),r=a.zeroToTwoPi(r+a.TWO_PI)),r}var PS=new ye,OS=new ye;Object.defineProperties(_S.prototype,{transform:{get:function(){return this._transform}},inverseTransform:{get:function(){return bS(this),this._invTransform}},viewMatrix:{get:function(){return bS(this),this._viewMatrix}},inverseViewMatrix:{get:function(){return bS(this),this._invViewMatrix}},positionCartographic:{get:function(){return bS(this),this._positionCartographic}},positionWC:{get:function(){return bS(this),this._positionWC}},directionWC:{get:function(){return bS(this),this._directionWC}},upWC:{get:function(){return bS(this),this._upWC}},rightWC:{get:function(){return bS(this),this._rightWC}},heading:{get:function(){if(this._mode!==Al.MORPHING){var e=this._projection.ellipsoid,t=ye.clone(this._transform,PS),n=ka.eastNorthUpToFixedFrame(this.positionWC,e,OS);this._setTransform(n);var r=DS(this.direction,this.up);return this._setTransform(t),r}}},pitch:{get:function(){if(this._mode!==Al.MORPHING){var e=this._projection.ellipsoid,t=ye.clone(this._transform,PS),n=ka.eastNorthUpToFixedFrame(this.positionWC,e,OS);this._setTransform(n);var r=IS(this.direction);return this._setTransform(t),r}}},roll:{get:function(){if(this._mode!==Al.MORPHING){var e=this._projection.ellipsoid,t=ye.clone(this._transform,PS),n=ka.eastNorthUpToFixedFrame(this.positionWC,e,OS);this._setTransform(n);var r=RS(this.direction,this.up,this.right);return this._setTransform(t),r}}},moveStart:{get:function(){return this._moveStart}},moveEnd:{get:function(){return this._moveEnd}},changed:{get:function(){return this._changed}}}),_S.prototype.update=function(e){var t=!1;if(e!==this._mode&&(this._mode=e,this._modeChanged=e!==Al.MORPHING,t=this._mode===Al.SCENE2D),t){var n=this._max2Dfrustum=this.frustum.clone(),r=n.top/n.right;n.right=2*this._maxCoord.x,n.left=-n.right,n.top=r*n.right,n.bottom=-n.top}this._mode===Al.SCENE2D&&eA(this,this.position)};var NS=new p,MS=new p,LS=new p;_S.prototype._setTransform=function(e){var t=p.clone(this.positionWC,NS),n=p.clone(this.upWC,MS),r=p.clone(this.directionWC,LS);ye.clone(e,this._transform),this._transformChanged=!0,bS(this);var i=this._actualInvTransform;ye.multiplyByPoint(i,t,this.position),ye.multiplyByPointAsVector(i,r,this.direction),ye.multiplyByPointAsVector(i,n,this.up),p.cross(this.direction,this.up,this.right),bS(this)};var FS=new c,zS=new Fn,BS=new p,US=new p;function VS(t){if(!ye.equals(ye.IDENTITY,t.transform))return p.magnitude(t.position);var n,r,i,o=t._scene,a=o.globe,s=FS;if(s.x=o.drawingBufferWidth/2,s.y=o.drawingBufferHeight/2,e(a)){var u=t.getPickRay(s,zS);n=a.pickWorldCoordinates(u,o,!0,BS)}if(o.pickPositionSupported&&(r=o.pickPositionWorldCoordinates(s,US)),e(n)||e(r)){var c=e(r)?p.distance(r,t.positionWC):Number.POSITIVE_INFINITY,l=e(n)?p.distance(n,t.positionWC):Number.POSITIVE_INFINITY;i=Math.min(c,l)}else i=Math.max(t.positionCartographic.height,0);return i}_S.prototype._adjustOrthographicFrustum=function(e){this.frustum instanceof Pr&&(!e&&this._positionCartographic.height<15e4||(this.frustum.width=VS(this)))};var HS=new p,GS=new ye,kS=new ye,WS=new Nr,qS=new $,YS=new N;var jS=new p,XS=new p,ZS=new p;function KS(e,t,n,r){var i=p.clone(n.direction,jS),o=p.clone(n.up,XS);if(e._scene.mode===Al.SCENE3D){var a=e._projection.ellipsoid,s=ka.eastNorthUpToFixedFrame(t,a,PS),u=ye.inverseTransformation(s,OS);ye.multiplyByPointAsVector(u,i,i),ye.multiplyByPointAsVector(u,o,o)}var c=p.cross(i,o,ZS);return r.heading=DS(i,o),r.pitch=IS(i),r.roll=RS(i,o,c),r}var QS={destination:void 0,orientation:{direction:void 0,up:void 0,heading:void 0,pitch:void 0,roll:void 0},convert:void 0,endTransform:void 0},JS=new wn;_S.prototype.setView=function(t){t=i(t,i.EMPTY_OBJECT);var n=i(t.orientation,i.EMPTY_OBJECT),r=this._mode;if(r!==Al.MORPHING){e(t.endTransform)&&this._setTransform(t.endTransform);var o=i(t.convert,!0),s=i(t.destination,p.clone(this.positionWC,HS));e(s)&&e(s.west)&&(s=this.getRectangleCameraCoordinates(s,HS),o=!1),e(n.direction)&&(n=KS(this,s,n,QS.orientation)),JS.heading=i(n.heading,0),JS.pitch=i(n.pitch,-a.PI_OVER_TWO),JS.roll=i(n.roll,0),r===Al.SCENE3D?function(e,t,n){var r=ye.clone(e.transform,GS),i=ka.eastNorthUpToFixedFrame(t,e._projection.ellipsoid,kS);e._setTransform(i),p.clone(p.ZERO,e.position),n.heading=n.heading-a.PI_OVER_TWO;var o=Nr.fromHeadingPitchRoll(n,WS),s=$.fromQuaternion(o,qS);$.getColumn(s,0,e.direction),$.getColumn(s,2,e.up),p.cross(e.direction,e.up,e.right),e._setTransform(r),e._adjustOrthographicFrustum(!0)}(this,s,JS):r===Al.SCENE2D?function(e,t,n,r){var i=ye.clone(e.transform,GS);if(e._setTransform(ye.IDENTITY),!p.equals(t,e.positionWC)){if(r){var o=e._projection,s=o.ellipsoid.cartesianToCartographic(t,YS);t=o.project(s,HS)}c.clone(t,e.position);var u=.5*-t.z,l=-u,h=e.frustum;if(l>u){var d=h.top/h.right;h.right=l,h.left=u,h.top=h.right*d,h.bottom=-h.top}}if(e._scene.mapMode2D===pS.ROTATE){n.heading=n.heading-a.PI_OVER_TWO,n.pitch=-a.PI_OVER_TWO,n.roll=0;var f=Nr.fromHeadingPitchRoll(n,WS),m=$.fromQuaternion(f,qS);$.getColumn(m,2,e.up),p.cross(e.direction,e.up,e.right)}e._setTransform(i)}(this,s,JS,o):function(e,t,n,r){var i=ye.clone(e.transform,GS);if(e._setTransform(ye.IDENTITY),!p.equals(t,e.positionWC)){if(r){var o=e._projection,s=o.ellipsoid.cartesianToCartographic(t,YS);t=o.project(s,HS)}p.clone(t,e.position)}n.heading=n.heading-a.PI_OVER_TWO;var u=Nr.fromHeadingPitchRoll(n,WS),c=$.fromQuaternion(u,qS);$.getColumn(c,0,e.direction),$.getColumn(c,2,e.up),p.cross(e.direction,e.up,e.right),e._setTransform(i),e._adjustOrthographicFrustum(!0)}(this,s,JS,o)}};var $S=new p;function eA(e,t){var n,r,i=e._scene.mapMode2D===pS.ROTATE,o=e._maxCoord.x,a=e._maxCoord.y;i?n=-(r=o):(r=t.x-2*o,n=t.x+2*o),t.x>o&&(t.x=r),t.x<-o&&(t.x=n),t.y>a&&(t.y=a),t.y<-a&&(t.y=-a)}_S.prototype.flyHome=function(e){var t=this._mode;if(t===Al.MORPHING&&this._scene.completeMorph(),t===Al.SCENE2D)this.flyTo({destination:_S.DEFAULT_VIEW_RECTANGLE,duration:e,endTransform:ye.IDENTITY});else if(t===Al.SCENE3D){var n=this.getRectangleCameraCoordinates(_S.DEFAULT_VIEW_RECTANGLE),r=p.magnitude(n);r+=r*_S.DEFAULT_VIEW_FACTOR,p.normalize(n,n),p.multiplyByScalar(n,r,n),this.flyTo({destination:n,duration:e,endTransform:ye.IDENTITY})}else if(t===Al.COLUMBUS_VIEW){var i=this._projection.ellipsoid.maximumRadius,o=new p(0,-1,1);o=p.multiplyByScalar(p.normalize(o,o),5*i,o),this.flyTo({destination:o,duration:e,orientation:{heading:0,pitch:-Math.acos(p.normalize(o,$S).z),roll:0},endTransform:ye.IDENTITY,convert:!1})}},_S.prototype.worldToCameraCoordinates=function(t,n){return e(n)||(n=new le),bS(this),ye.multiplyByVector(this._actualInvTransform,t,n)},_S.prototype.worldToCameraCoordinatesPoint=function(t,n){return e(n)||(n=new p),bS(this),ye.multiplyByPoint(this._actualInvTransform,t,n)},_S.prototype.worldToCameraCoordinatesVector=function(t,n){return e(n)||(n=new p),bS(this),ye.multiplyByPointAsVector(this._actualInvTransform,t,n)},_S.prototype.cameraToWorldCoordinates=function(t,n){return e(n)||(n=new le),bS(this),ye.multiplyByVector(this._actualTransform,t,n)},_S.prototype.cameraToWorldCoordinatesPoint=function(t,n){return e(n)||(n=new p),bS(this),ye.multiplyByPoint(this._actualTransform,t,n)},_S.prototype.cameraToWorldCoordinatesVector=function(t,n){return e(n)||(n=new p),bS(this),ye.multiplyByPointAsVector(this._actualTransform,t,n)};var tA=new p;_S.prototype.move=function(e,t){var n=this.position;p.multiplyByScalar(e,t,tA),p.add(n,tA,n),this._mode===Al.SCENE2D&&eA(this,n),this._adjustOrthographicFrustum(!0)},_S.prototype.moveForward=function(e){e=i(e,this.defaultMoveAmount),this._mode===Al.SCENE2D?dA(this,e):this.move(this.direction,e)},_S.prototype.moveBackward=function(e){e=i(e,this.defaultMoveAmount),this._mode===Al.SCENE2D?dA(this,-e):this.move(this.direction,-e)},_S.prototype.moveUp=function(e){e=i(e,this.defaultMoveAmount),this.move(this.up,e)},_S.prototype.moveDown=function(e){e=i(e,this.defaultMoveAmount),this.move(this.up,-e)},_S.prototype.moveRight=function(e){e=i(e,this.defaultMoveAmount),this.move(this.right,e)},_S.prototype.moveLeft=function(e){e=i(e,this.defaultMoveAmount),this.move(this.right,-e)},_S.prototype.lookLeft=function(e){e=i(e,this.defaultLookAmount),this._mode!==Al.SCENE2D&&this.look(this.up,-e)},_S.prototype.lookRight=function(e){e=i(e,this.defaultLookAmount),this._mode!==Al.SCENE2D&&this.look(this.up,e)},_S.prototype.lookUp=function(e){e=i(e,this.defaultLookAmount),this._mode!==Al.SCENE2D&&this.look(this.right,-e)},_S.prototype.lookDown=function(e){e=i(e,this.defaultLookAmount),this._mode!==Al.SCENE2D&&this.look(this.right,e)};var nA=new Nr,rA=new $;_S.prototype.look=function(e,t){var n=i(t,this.defaultLookAmount),r=Nr.fromAxisAngle(e,-n,nA),o=$.fromQuaternion(r,rA),a=this.direction,s=this.up,u=this.right;$.multiplyByVector(o,a,a),$.multiplyByVector(o,s,s),$.multiplyByVector(o,u,u)},_S.prototype.twistLeft=function(e){e=i(e,this.defaultLookAmount),this.look(this.direction,e)},_S.prototype.twistRight=function(e){e=i(e,this.defaultLookAmount),this.look(this.direction,-e)};var iA=new Nr,oA=new $;_S.prototype.rotate=function(e,t){var n=i(t,this.defaultRotateAmount),r=Nr.fromAxisAngle(e,-n,iA),o=$.fromQuaternion(r,oA);$.multiplyByVector(o,this.position,this.position),$.multiplyByVector(o,this.direction,this.direction),$.multiplyByVector(o,this.up,this.up),p.cross(this.direction,this.up,this.right),p.cross(this.right,this.direction,this.up),this._adjustOrthographicFrustum(!1)},_S.prototype.rotateDown=function(e){lA(this,e=i(e,this.defaultRotateAmount))},_S.prototype.rotateUp=function(e){lA(this,-(e=i(e,this.defaultRotateAmount)))};var aA=new p,sA=new p,uA=new p,cA=new p;function lA(t,n){var r=t.position;if(e(t.constrainedAxis)&&!p.equalsEpsilon(t.position,p.ZERO,a.EPSILON2)){var i=p.normalize(r,aA),o=p.equalsEpsilon(i,t.constrainedAxis,a.EPSILON2),s=p.equalsEpsilon(i,p.negate(t.constrainedAxis,cA),a.EPSILON2);if(o||s)(o&&n<0||s&&n>0)&&t.rotate(t.right,n);else{var u=p.normalize(t.constrainedAxis,sA),c=p.dot(i,u),l=a.acosClamped(c);n>0&&n>l&&(n=l-a.EPSILON4),c=p.dot(i,p.negate(u,cA)),l=a.acosClamped(c),n<0&&-n>l&&(n=-l+a.EPSILON4);var h=p.cross(u,i,uA);t.rotate(h,n)}}else t.rotate(t.right,n)}function hA(t,n){e(t.constrainedAxis)?t.rotate(t.constrainedAxis,n):t.rotate(t.up,n)}function dA(e,t){var n,r=e.frustum;if(t*=.5,Math.abs(r.top)+Math.abs(r.bottom)>Math.abs(r.left)+Math.abs(r.right)){var i=r.top-t,o=r.bottom+t,a=e._maxCoord.y;e._scene.mapMode2D===pS.ROTATE&&(a*=e.maximumZoomFactor),o>a&&(o=a,i=-a),i<=o&&(i=1,o=-1),n=r.right/r.top,r.top=i,r.bottom=o,r.right=r.top*n,r.left=-r.right}else{var s=r.right-t,u=r.left+t,c=e._maxCoord.x;e._scene.mapMode2D===pS.ROTATE&&(c*=e.maximumZoomFactor),s>c&&(s=c,u=-c),s<=u&&(s=1,u=-1),n=r.top/r.right,r.right=s,r.left=u,r.top=r.right*n,r.bottom=-r.top}}function fA(e,t){e.move(e.direction,t)}_S.prototype.rotateRight=function(e){hA(this,-(e=i(e,this.defaultRotateAmount)))},_S.prototype.rotateLeft=function(e){hA(this,e=i(e,this.defaultRotateAmount))},_S.prototype.zoomIn=function(e){e=i(e,this.defaultZoomAmount),this._mode===Al.SCENE2D?dA(this,e):fA(this,e)},_S.prototype.zoomOut=function(e){e=i(e,this.defaultZoomAmount),this._mode===Al.SCENE2D?dA(this,-e):fA(this,-e)},_S.prototype.getMagnitude=function(){return this._mode===Al.SCENE3D?p.magnitude(this.position):this._mode===Al.COLUMBUS_VIEW?Math.abs(this.position.z):this._mode===Al.SCENE2D?Math.max(this.frustum.right-this.frustum.left,this.frustum.top-this.frustum.bottom):void 0};var mA=new ye;_S.prototype.lookAt=function(e,t){var n=ka.eastNorthUpToFixedFrame(e,H.WGS84,mA);this.lookAtTransform(n,t)};var pA=new p,_A=new Nr,gA=new Nr,vA=new $;function yA(e,t,n){t=a.clamp(t,-a.PI_OVER_TWO,a.PI_OVER_TWO),e=a.zeroToTwoPi(e)-a.PI_OVER_TWO;var r=Nr.fromAxisAngle(p.UNIT_Y,-t,_A),i=Nr.fromAxisAngle(p.UNIT_Z,-e,gA),o=Nr.multiply(i,r,i),s=$.fromQuaternion(o,vA),u=p.clone(p.UNIT_X,pA);return $.multiplyByVector(s,u,u),p.negate(u,u),p.multiplyByScalar(u,n,u),u}_S.prototype.lookAtTransform=function(t,n){if(this._setTransform(t),e(n)){var r;if(r=e(n.heading)?yA(n.heading,n.pitch,n.range):n,this._mode===Al.SCENE2D){c.clone(c.ZERO,this.position),p.negate(r,this.up),this.up.z=0,p.magnitudeSquared(this.up)<a.EPSILON10&&p.clone(p.UNIT_Y,this.up),p.normalize(this.up,this.up),this._setTransform(ye.IDENTITY),p.negate(p.UNIT_Z,this.direction),p.cross(this.direction,this.up,this.right),p.normalize(this.right,this.right);var i=this.frustum,o=i.top/i.right;return i.right=.5*p.magnitude(r),i.left=-i.right,i.top=o*i.right,i.bottom=-i.top,void this._setTransform(t)}p.clone(r,this.position),p.negate(this.position,this.direction),p.normalize(this.direction,this.direction),p.cross(this.direction,p.UNIT_Z,this.right),p.magnitudeSquared(this.right)<a.EPSILON10&&p.clone(p.UNIT_X,this.right),p.normalize(this.right,this.right),p.cross(this.right,this.direction,this.up),p.normalize(this.up,this.up),this._adjustOrthographicFrustum(!0)}};var TA,EA=new N,xA=new N,CA=new p,SA=new p,AA=new p,wA=new p,bA=new p,DA=new p,IA=new p,RA=new p,PA={direction:new p,right:new p,up:new p};function OA(e,t,n,r){return Math.abs(p.dot(t,n))/r-p.dot(e,n)}function NA(t,n,r,i){var o=t._projection.ellipsoid,s=i?t:PA,u=n.north,c=n.south,l=n.east,h=n.west;h>l&&(l+=a.TWO_PI);var d,f=.5*(h+l);if(c<-a.PI_OVER_TWO+a.RADIANS_PER_DEGREE&&u>a.PI_OVER_TWO-a.RADIANS_PER_DEGREE)d=0;else{var m=EA;m.longitude=f,m.latitude=u,m.height=0;var _=xA;_.longitude=f,_.latitude=c,_.height=0;var g=TA;e(g)&&g.ellipsoid===o||(TA=g=new JC(void 0,void 0,o)),g.setEndPoints(m,_),d=g.interpolateUsingFraction(.5,EA).latitude}var v=EA;v.longitude=f,v.latitude=d,v.height=0;var y=o.cartographicToCartesian(v,IA),T=EA;T.longitude=l,T.latitude=u;var E=o.cartographicToCartesian(T,CA);T.longitude=h;var x=o.cartographicToCartesian(T,AA);T.longitude=f;var C=o.cartographicToCartesian(T,bA);T.latitude=c;var S=o.cartographicToCartesian(T,DA);T.longitude=l;var A=o.cartographicToCartesian(T,wA);T.longitude=h;var w=o.cartographicToCartesian(T,SA);p.subtract(x,y,x),p.subtract(A,y,A),p.subtract(E,y,E),p.subtract(w,y,w),p.subtract(C,y,C),p.subtract(S,y,S);var b=o.geodeticSurfaceNormal(y,s.direction);p.negate(b,b);var D=p.cross(b,p.UNIT_Z,s.right);p.normalize(D,D);var I,R=p.cross(D,b,s.up);if(t.frustum instanceof Pr){var P,O,N=Math.max(p.distance(E,x),p.distance(A,w)),M=Math.max(p.distance(E,A),p.distance(x,w)),L=t.frustum._offCenterFrustum.right/t.frustum._offCenterFrustum.top,F=M*L;N>F?O=(P=N)/L:(O=M,P=F),I=Math.max(P,O)}else{var z=Math.tan(.5*t.frustum.fovy),B=t.frustum.aspectRatio*z;if(I=Math.max(OA(b,R,x,z),OA(b,R,A,z),OA(b,R,E,z),OA(b,R,w,z),OA(b,R,C,z),OA(b,R,S,z),OA(b,D,x,B),OA(b,D,A,B),OA(b,D,E,B),OA(b,D,w,B),OA(b,D,C,B),OA(b,D,S,B)),c<0&&u>0){var U=EA;U.longitude=h,U.latitude=0,U.height=0;var V=o.cartographicToCartesian(U,RA);p.subtract(V,y,V),I=Math.max(I,OA(b,R,V,z),OA(b,D,V,B)),U.longitude=l,V=o.cartographicToCartesian(U,RA),p.subtract(V,y,V),I=Math.max(I,OA(b,R,V,z),OA(b,D,V,B))}}return p.add(y,p.multiplyByScalar(b,-I,RA),r)}var MA=new N,LA=new p,FA=new p;var zA=new N,BA=new p,UA=new p;_S.prototype.getRectangleCameraCoordinates=function(t,n){var r=this._mode;return e(n)||(n=new p),r===Al.SCENE3D?NA(this,t,n):r===Al.COLUMBUS_VIEW?function(t,n,r){var i=t._projection;n.west>n.east&&(n=Oe.MAX_VALUE);var o=t._actualTransform,a=t._actualInvTransform,s=MA;s.longitude=n.east,s.latitude=n.north;var u=i.project(s,LA);ye.multiplyByPoint(o,u,u),ye.multiplyByPoint(a,u,u),s.longitude=n.west,s.latitude=n.south;var c=i.project(s,FA);if(ye.multiplyByPoint(o,c,c),ye.multiplyByPoint(a,c,c),r.x=.5*(u.x-c.x)+c.x,r.y=.5*(u.y-c.y)+c.y,e(t.frustum.fovy)){var l=Math.tan(.5*t.frustum.fovy),h=t.frustum.aspectRatio*l;r.z=.5*Math.max((u.x-c.x)/h,(u.y-c.y)/l)}else{var d=u.x-c.x,f=u.y-c.y;r.z=Math.max(d,f)}return r}(this,t,n):r===Al.SCENE2D?function(e,t,n){var r=e._projection,i=t.east;t.west>t.east&&(e._scene.mapMode2D===pS.INFINITE_SCROLL?i+=a.TWO_PI:i=(t=Oe.MAX_VALUE).east);var o=zA;o.longitude=i,o.latitude=t.north;var s=r.project(o,BA);o.longitude=t.west,o.latitude=t.south;var u,c,l=r.project(o,UA),h=.5*Math.abs(s.x-l.x),d=.5*Math.abs(s.y-l.y),f=e.frustum.right/e.frustum.top,m=d*f;return h>m?c=(u=h)/f:(c=d,u=m),d=Math.max(2*u,2*c),n.x=.5*(s.x-l.x)+l.x,n.y=.5*(s.y-l.y)+l.y,(o=r.unproject(n,o)).height=d,r.project(o,n)}(this,t,n):void 0};var VA=new Fn;var HA=new Fn;var GA=new Fn;_S.prototype.pickEllipsoid=function(t,n,r){var o=this._scene.canvas;if(0!==o.clientWidth&&0!==o.clientHeight){if(e(r)||(r=new p),n=i(n,H.WGS84),this._mode===Al.SCENE3D)r=function(e,t,n,r){n=i(n,H.WGS84);var o=e.getPickRay(t,VA),a=zn.rayEllipsoid(o,n);if(a){var s=a.start>0?a.start:a.stop;return Fn.getPoint(o,s,r)}}(this,t,n,r);else if(this._mode===Al.SCENE2D)r=function(e,t,n,r){var i=e.getPickRay(t,HA).origin;i=p.fromElements(i.y,i.z,0,i);var o=n.unproject(i);if(!(o.latitude<-a.PI_OVER_TWO||o.latitude>a.PI_OVER_TWO))return n.ellipsoid.cartographicToCartesian(o,r)}(this,t,this._projection,r);else{if(this._mode!==Al.COLUMBUS_VIEW)return;r=function(e,t,n,r){var i=e.getPickRay(t,GA),o=-i.origin.x/i.direction.x;Fn.getPoint(i,o,r);var s=n.unproject(new p(r.y,r.z,0));if(!(s.latitude<-a.PI_OVER_TWO||s.latitude>a.PI_OVER_TWO||s.longitude<-Math.PI||s.longitude>Math.PI))return n.ellipsoid.cartographicToCartesian(s,r)}(this,t,this._projection,r)}return r}};var kA=new p,WA=new p,qA=new p;var YA=new p;_S.prototype.getPickRay=function(t,n){e(n)||(n=new Fn);var r=this.frustum;return e(r.aspectRatio)&&e(r.fov)&&e(r.near)?function(e,t,n){var r=e._scene.canvas,i=r.clientWidth,o=r.clientHeight,a=Math.tan(.5*e.frustum.fovy),s=e.frustum.aspectRatio*a,u=e.frustum.near,c=2/i*t.x-1,l=2/o*(o-t.y)-1,h=e.positionWC;p.clone(h,n.origin);var d=p.multiplyByScalar(e.directionWC,u,kA);p.add(h,d,d);var f=p.multiplyByScalar(e.rightWC,c*u*s,WA),m=p.multiplyByScalar(e.upWC,l*u*a,qA),_=p.add(d,f,n.direction);return p.add(_,m,_),p.subtract(_,h,_),p.normalize(_,_),n}(this,t,n):function(t,n,r){var i=t._scene.canvas,o=i.clientWidth,a=i.clientHeight,s=t.frustum;e(s._offCenterFrustum)&&(s=s._offCenterFrustum);var u=2/o*n.x-1;u*=.5*(s.right-s.left);var c=2/a*(a-n.y)-1;c*=.5*(s.top-s.bottom);var l=r.origin;return p.clone(t.position,l),p.multiplyByScalar(t.right,u,YA),p.add(YA,l,l),p.multiplyByScalar(t.up,c,YA),p.add(YA,l,l),p.clone(t.directionWC,r.direction),t._mode!==Al.COLUMBUS_VIEW&&t._mode!==Al.SCENE2D||p.fromElements(r.origin.z,r.origin.x,r.origin.y,r.origin),r}(this,t,n)};var jA=new p,XA=new p;_S.prototype.distanceToBoundingSphere=function(e){var t=p.subtract(this.positionWC,e.center,jA),n=p.multiplyByScalar(this.directionWC,p.dot(t,this.directionWC),XA);return Math.max(0,p.magnitude(n)-e.radius)};var ZA=new c;_S.prototype.getPixelSize=function(e,t,n){var r=this.distanceToBoundingSphere(e),i=this.frustum.getPixelDimensions(t,n,r,this._scene.pixelRatio,ZA);return Math.max(i.x,i.y)};var KA=new p,QA=new p,JA=new p,$A=new p;function ew(e,t){var n=e.position,r=e.direction,i=e.worldToCameraCoordinatesVector(p.UNIT_X,KA),o=-p.dot(i,n)/p.dot(i,r),a=p.add(n,p.multiplyByScalar(r,o,QA),QA);e.cameraToWorldCoordinatesPoint(a,a),n=e.cameraToWorldCoordinatesPoint(e.position,JA);var s=Math.tan(.5*e.frustum.fovy),u=e.frustum.aspectRatio*s,c=p.magnitude(p.subtract(n,a,$A)),l=u*c,h=s*c,d=e._maxCoord.x,f=e._maxCoord.y,m=Math.max(l-d,d),_=Math.max(h-f,f);if(n.z<-m||n.z>m||n.y<-_||n.y>_){var g=a.y<-m||a.y>m,v=a.z<-_||a.z>_;if(g||v)return function(e,t,n,r,i,o){var a=p.clone(t);return n.y>r?a.y-=n.y-r:n.y<-r&&(a.y+=-r-n.y),n.z>i?a.z-=n.z-i:n.z<-i&&(a.z+=-i-n.z),{easingFunction:jC.EXPONENTIAL_OUT,startObject:{time:0},stopObject:{time:1},duration:o,update:function(n){var r=p.lerp(t,a,n.time,new p);e.worldToCameraCoordinatesPoint(r,e.position)}}}(e,n,a,m,_,t)}}_S.prototype.createCorrectPositionTween=function(e){if(this._mode===Al.COLUMBUS_VIEW)return ew(this,e)};var tw=new p,nw={destination:void 0,heading:void 0,pitch:void 0,roll:void 0,duration:void 0,complete:void 0,cancel:void 0,endTransform:void 0,maximumHeight:void 0,easingFunction:void 0};_S.prototype.cancelFlight=function(){e(this._currentFlight)&&(this._currentFlight.cancelTween(),this._currentFlight=void 0)},_S.prototype.completeFlight=function(){if(e(this._currentFlight)){this._currentFlight.cancelTween();var t={destination:void 0,orientation:{heading:void 0,pitch:void 0,roll:void 0}};t.destination=nw.destination,t.orientation.heading=nw.heading,t.orientation.pitch=nw.pitch,t.orientation.roll=nw.roll,this.setView(t),e(this._currentFlight.complete)&&this._currentFlight.complete(),this._currentFlight=void 0}},_S.prototype.flyTo=function(t){var n=(t=i(t,i.EMPTY_OBJECT)).destination;if(this._mode!==Al.MORPHING){this.cancelFlight();var r=i(t.orientation,i.EMPTY_OBJECT);if(e(r.direction)&&(r=KS(this,n,r,QS.orientation)),e(t.duration)&&t.duration<=0){var o=QS;return o.destination=t.destination,o.orientation.heading=r.heading,o.orientation.pitch=r.pitch,o.orientation.roll=r.roll,o.convert=t.convert,o.endTransform=t.endTransform,this.setView(o),void("function"==typeof t.complete&&t.complete())}var a=e(n.west);a&&(n=this.getRectangleCameraCoordinates(n,tw));var s,u=this;nw.destination=n,nw.heading=r.heading,nw.pitch=r.pitch,nw.roll=r.roll,nw.duration=t.duration,nw.complete=function(){s===u._currentFlight&&(u._currentFlight=void 0),e(t.complete)&&t.complete()},nw.cancel=t.cancel,nw.endTransform=t.endTransform,nw.convert=!a&&t.convert,nw.maximumHeight=t.maximumHeight,nw.pitchAdjustHeight=t.pitchAdjustHeight,nw.flyOverLongitude=t.flyOverLongitude,nw.flyOverLongitudeWeight=t.flyOverLongitudeWeight,nw.easingFunction=t.easingFunction;var c=this._scene,l=eS.createTween(c,nw);if(0!==l.duration){s=c.tweens.add(l),this._currentFlight=s;var h=this._scene.preloadFlightCamera;this._mode!==Al.SCENE2D&&(e(h)||(h=_S.clone(this)),h.setView({destination:n,orientation:r}),this._scene.preloadFlightCullingVolume=h.frustum.computeCullingVolume(h.positionWC,h.directionWC,h.upWC))}else"function"==typeof l.complete&&l.complete()}};function rw(t,n,r){r=$C.clone(e(r)?r:_S.DEFAULT_OFFSET);var i=t._scene.screenSpaceCameraController.minimumZoomDistance,o=t._scene.screenSpaceCameraController.maximumZoomDistance,s=r.range;if(!e(s)||0===s){var u=n.radius;0===u?r.range=100:t.frustum instanceof Pr||t._mode===Al.SCENE2D?r.range=function(t,n){var r,i,o=t.frustum;e(o._offCenterFrustum)&&(o=o._offCenterFrustum);var a=o.right/o.top,s=n*a;return n>s?i=(r=n)/a:(i=n,r=s),1.5*Math.max(r,i)}(t,u):r.range=function(e,t){var n=e.frustum,r=Math.tan(.5*n.fovy),i=n.aspectRatio*r;return Math.max(t/i,t/r)}(t,u),r.range=a.clamp(r.range,i,o)}return r}_S.prototype.viewBoundingSphere=function(e,t){t=rw(this,e,t),this.lookAt(e.center,t)};var iw=new ye,ow=new p,aw=new p,sw=new p,uw=new p,cw=new le,lw=new Nr,hw=new $;_S.prototype.flyToBoundingSphere=function(e,t){t=i(t,i.EMPTY_OBJECT);var n=this._mode===Al.SCENE2D||this._mode===Al.COLUMBUS_VIEW;this._setTransform(ye.IDENTITY);var r,o=rw(this,e,t.offset);r=n?p.multiplyByScalar(p.UNIT_Z,o.range,ow):yA(o.heading,o.pitch,o.range);var s,u,c=ka.eastNorthUpToFixedFrame(e.center,H.WGS84,iw);if(ye.multiplyByPoint(c,r,r),!n){if(s=p.subtract(e.center,r,aw),p.normalize(s,s),u=ye.multiplyByPointAsVector(c,p.UNIT_Z,sw),1-Math.abs(p.dot(s,u))<a.EPSILON6){var l=Nr.fromAxisAngle(s,o.heading,lw),h=$.fromQuaternion(l,hw);p.fromCartesian4(ye.getColumn(c,1,cw),u),$.multiplyByVector(h,u,u)}var d=p.cross(s,u,uw);p.cross(d,s,u),p.normalize(u,u)}this.flyTo({destination:r,orientation:{direction:s,up:u},duration:t.duration,complete:t.complete,cancel:t.cancel,endTransform:t.endTransform,maximumHeight:t.maximumHeight,easingFunction:t.easingFunction,flyOverLongitude:t.flyOverLongitude,flyOverLongitudeWeight:t.flyOverLongitudeWeight,pitchAdjustHeight:t.pitchAdjustHeight})};var dw=new p,fw=new p,mw=new p,pw=new p,_w=[new p,new p,new p,new p];var gw=new c,vw=new p,yw=[new N,new N,new N,new N];function Tw(t,n,r,i,o,a){gw.x=t,gw.y=n;var s=i.pickEllipsoid(gw,o,vw);return e(s)?(yw[r]=o.cartesianToCartographic(s,yw[r]),1):(yw[r]=o.cartesianToCartographic(a[r],yw[r]),0)}function Ew(){}function xw(e,t,n){}_S.prototype.computeViewRectangle=function(e,t){e=i(e,H.WGS84);var n=this.frustum.computeCullingVolume(this.positionWC,this.directionWC,this.upWC),r=new Me(p.ZERO,e.maximumRadius);if(n.computeVisibility(r)!==Q.OUTSIDE){var o=this._scene.canvas,s=o.clientWidth,u=o.clientHeight,c=0,l=function(e,t){var n,r,i=t.radii,o=e.positionWC,s=p.multiplyComponents(t.oneOverRadii,o,dw),u=p.magnitude(s),c=p.normalize(s,fw);p.equalsEpsilon(c,p.UNIT_Z,a.EPSILON10)?(n=new p(0,1,0),r=new p(0,0,1)):(n=p.normalize(p.cross(p.UNIT_Z,c,mw),mw),r=p.normalize(p.cross(c,n,pw),pw));var l=Math.sqrt(p.magnitudeSquared(s)-1),h=p.multiplyByScalar(c,1/u,dw),d=l/u,f=p.multiplyByScalar(n,d,fw),m=p.multiplyByScalar(r,d,mw),_=p.add(h,m,_w[0]);p.subtract(_,f,_),p.multiplyComponents(i,_,_);var g=p.subtract(h,m,_w[1]);p.subtract(g,f,g),p.multiplyComponents(i,g,g);var v=p.subtract(h,m,_w[2]);p.add(v,f,v),p.multiplyComponents(i,v,v);var y=p.add(h,m,_w[3]);return p.add(y,f,y),p.multiplyComponents(i,y,y),_w}(this,e);if(c+=Tw(0,0,0,this,e,l),c+=Tw(0,u,1,this,e,l),c+=Tw(s,u,2,this,e,l),(c+=Tw(s,0,3,this,e,l))<2)return Oe.MAX_VALUE;t=Oe.fromCartographicArray(yw,t);for(var h=0,d=yw[3].longitude,f=0;f<4;++f){var m=yw[f].longitude,_=Math.abs(m-d);_>a.PI?h+=a.TWO_PI-_:h+=_,d=m}return a.equalsEpsilon(Math.abs(h),a.TWO_PI,a.EPSILON9)&&(t.west=-a.PI,t.east=a.PI,yw[0].latitude>=0?t.north=a.PI_OVER_TWO:t.south=-a.PI_OVER_TWO),t}},_S.prototype.switchToPerspectiveFrustum=function(){if(!(this._mode===Al.SCENE2D||this.frustum instanceof Jx)){var e=this._scene;this.frustum=new Jx,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.fov=a.toRadians(60)}},_S.prototype.switchToOrthographicFrustum=function(){if(!(this._mode===Al.SCENE2D||this.frustum instanceof Pr)){var e=VS(this),t=this._scene;this.frustum=new Pr,this.frustum.aspectRatio=t.drawingBufferWidth/t.drawingBufferHeight,this.frustum.width=e}},_S.clone=function(t,n){return e(n)||(n=new _S(t._scene)),p.clone(t.position,n.position),p.clone(t.direction,n.direction),p.clone(t.up,n.up),p.clone(t.right,n.right),ye.clone(t._transform,n.transform),n._transformChanged=!0,n.frustum=t.frustum.clone(),n},xw.prototype.addCredit=Ew,xw.prototype.addDefaultCredit=Ew,xw.prototype.removeDefaultCredit=Ew,xw.prototype.showLightbox=Ew,xw.prototype.hideLightbox=Ew,xw.prototype.update=Ew,xw.prototype.beginFrame=Ew,xw.prototype.endFrame=Ew,xw.prototype.destroy=function(){return hi(this)},xw.prototype.isDestroyed=function(){return!1};function Cw(){this._rs=void 0,this._sp=void 0,this._va=void 0,this._command=void 0,this._mode=void 0,this._useLogDepth=!1}var Sw=fn.supportsTypedArrays()?new Float32Array(12):[],Aw=new p,ww=new p,bw=new p,Dw=new p,Iw=new p;function Rw(){}Cw.prototype.update=function(t){if(this._mode=t.mode,t.mode===Al.SCENE3D){var n=t.context,r=t.mapProjection.ellipsoid,i=t.useLogDepth;if(e(this._command)||(this._rs=Us.fromCache({cull:{enabled:!0},depthTest:{enabled:!0},colorMask:{red:!1,green:!1,blue:!1,alpha:!1}}),this._command=new Ps({renderState:this._rs,boundingVolume:new Me(p.ZERO,r.maximumRadius),pass:Os.OPAQUE,owner:this})),!e(this._sp)||this._useLogDepth!==i){this._useLogDepth=i;var o=new nc({sources:["attribute vec4 position;\nvarying vec4 positionEC;\nvoid main()\n{\npositionEC = czm_modelView * position;\ngl_Position = czm_projection * positionEC;\nczm_vertexLogDepth();\n}\n"]}),a=new nc({sources:["varying vec4 positionEC;\nvoid main()\n{\nvec3 position;\nvec3 direction;\nif (czm_orthographicIn3D == 1.0)\n{\nvec2 uv = (gl_FragCoord.xy -  czm_viewport.xy) / czm_viewport.zw;\nvec2 minPlane = vec2(czm_frustumPlanes.z, czm_frustumPlanes.y);\nvec2 maxPlane = vec2(czm_frustumPlanes.w, czm_frustumPlanes.x);\nposition = vec3(mix(minPlane, maxPlane, uv), 0.0);\ndirection = vec3(0.0, 0.0, -1.0);\n}\nelse\n{\nposition = vec3(0.0);\ndirection = normalize(positionEC.xyz);\n}\nczm_ray ray = czm_ray(position, direction);\nvec3 ellipsoid_center = czm_view[3].xyz;\nczm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);\nif (!czm_isEmpty(intersection))\n{\ngl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n}\nelse\n{\ndiscard;\n}\nczm_writeLogDepth();\n}\n"]});if(i){a.sources.push("#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n"),a.defines.push("LOG_DEPTH"),o.defines.push("LOG_DEPTH")}this._sp=Hu.replaceCache({shaderProgram:this._sp,context:n,vertexShaderSource:o,fragmentShaderSource:a,attributeLocations:{position:0}}),this._command.shaderProgram=this._sp}var s=function(e,t){var n,r,i,o=e.radii,a=t.camera;if(a.frustum instanceof Pr)n=p.ZERO,r=a.rightWC,i=a.upWC;else{var s=a.positionWC,u=p.multiplyComponents(e.oneOverRadii,s,Aw),c=p.normalize(u,ww),l=p.normalize(p.cross(p.UNIT_Z,u,bw),bw),h=p.normalize(p.cross(c,l,Dw),Dw),d=p.magnitude(u),f=Math.sqrt(d*d-1);n=p.multiplyByScalar(c,1/d,Aw);var m=f/d;r=p.multiplyByScalar(l,m,ww),i=p.multiplyByScalar(h,m,bw)}var _=p.add(n,i,Iw);p.subtract(_,r,_),p.multiplyComponents(o,_,_),p.pack(_,Sw,0);var g=p.subtract(n,i,Iw);p.subtract(g,r,g),p.multiplyComponents(o,g,g),p.pack(g,Sw,3);var v=p.add(n,i,Iw);p.add(v,r,v),p.multiplyComponents(o,v,v),p.pack(v,Sw,6);var y=p.subtract(n,i,Iw);return p.add(y,r,y),p.multiplyComponents(o,y,y),p.pack(y,Sw,9),Sw}(r,t);if(e(this._va))this._va.getAttribute(0).vertexBuffer.copyFromArrayView(s);else{var u=new cc({attributes:{position:new tp({componentDatatype:xn.FLOAT,componentsPerAttribute:3,values:s})},indices:[0,1,2,2,1,3],primitiveType:Rs.TRIANGLES});this._va=xc.fromGeometry({context:n,geometry:u,attributeLocations:{position:0},bufferUsage:ws.DYNAMIC_DRAW}),this._command.vertexArray=this._va}}},Cw.prototype.execute=function(e,t){this._mode===Al.SCENE3D&&this._command.execute(e,t)},Cw.prototype.isDestroyed=function(){return!1},Cw.prototype.destroy=function(){this._sp=this._sp&&this._sp.destroy(),this._va=this._va&&this._va.destroy()};var Pw=/\bgl_FragDepthEXT\b/,Ow=/\bdiscard\b/;Rw.createDepthOnlyDerivedCommand=function(t,n,r,i){var o,a;return e(i)||(i={}),e(i.depthOnlyCommand)&&(o=i.depthOnlyCommand.shaderProgram,a=i.depthOnlyCommand.renderState),i.depthOnlyCommand=Ps.shallowClone(n,i.depthOnlyCommand),e(o)&&i.shaderProgramId===n.shaderProgram.id?(i.depthOnlyCommand.shaderProgram=o,i.depthOnlyCommand.renderState=a):(i.depthOnlyCommand.shaderProgram=function(t,n){var r=t.shaderCache.getDerivedShaderProgram(n,"depthOnly");if(!e(r)){var i,o=n._attributeLocations,a=n.fragmentShaderSource,s=!1,u=a.sources,c=u.length;for(i=0;i<c;++i)if(Pw.test(u[i])||Ow.test(u[i])){s=!0;break}var l=!1,h=a.defines;for(c=h.length,i=0;i<c;++i)if("LOG_DEPTH"===h[i]){l=!0;break}s||l?!s&&l&&(a=new nc({defines:["LOG_DEPTH"],sources:["#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\nvoid main() \n{ \n    gl_FragColor = vec4(1.0); \n    czm_writeLogDepth(); \n} \n"]})):a=new nc({sources:["void main() \n{ \n    gl_FragColor = vec4(1.0); \n} \n"]}),r=t.shaderCache.createDerivedShaderProgram(n,"depthOnly",{vertexShaderSource:n.vertexShaderSource,fragmentShaderSource:a,attributeLocations:o})}return r}(r,n.shaderProgram),i.depthOnlyCommand.renderState=function(t,n){var r=t._depthOnlyRenderStateCache,i=r[n.id];if(!e(i)){var o=Us.getState(n);o.depthMask=!0,o.colorMask={red:!1,green:!1,blue:!1,alpha:!1},i=Us.fromCache(o),r[n.id]=i}return i}(t,n.renderState),i.shaderProgramId=n.shaderProgram.id),i};var Nw=/\s+czm_writeLogDepth\(/,Mw=/\s+czm_vertexLogDepth\(/,Lw=/\s*#extension\s+GL_EXT_frag_depth\s*:\s*enable/;function Fw(){this.enabled=!0,this.density=2e-4,this.screenSpaceErrorFactor=2,this.minimumBrightness=.03}Rw.createLogDepthCommand=function(t,n,r){var i;return e(r)||(r={}),e(r.command)&&(i=r.command.shaderProgram),r.command=Ps.shallowClone(t,r.command),e(i)&&r.shaderProgramId===t.shaderProgram.id?r.command.shaderProgram=i:(r.command.shaderProgram=function(t,n){var r=t.shaderCache.getDerivedShaderProgram(n,"logDepth");if(!e(r)){var i,o=n._attributeLocations,a=n.vertexShaderSource.clone(),s=n.fragmentShaderSource.clone();a.defines=e(a.defines)?a.defines.slice(0):[],a.defines.push("LOG_DEPTH"),s.defines=e(s.defines)?s.defines.slice(0):[],s.defines.push("LOG_DEPTH");var u=!1,c=a.sources,l=c.length;for(i=0;i<l;++i)if(Mw.test(c[i])){u=!0;break}if(!u){for(i=0;i<l;++i)c[i]=nc.replaceMain(c[i],"czm_log_depth_main");c.push("\n\nvoid main() \n{ \n    czm_log_depth_main(); \n    czm_vertexLogDepth(); \n} \n")}for(l=(c=s.sources).length,u=!1,i=0;i<l;++i)Nw.test(c[i])&&(u=!0);-1!==s.defines.indexOf("LOG_DEPTH_WRITE")&&(u=!0);var h=!0;for(i=0;i<l;++i)Lw.test(c[i])&&(h=!1);var d="";if(h&&(d+="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n"),!u){for(i=0;i<l;i++)c[i]=nc.replaceMain(c[i],"czm_log_depth_main");d+="\nvoid main() \n{ \n    czm_log_depth_main(); \n    czm_writeLogDepth(); \n} \n"}c.push(d),r=t.shaderCache.createDerivedShaderProgram(n,"logDepth",{vertexShaderSource:a,fragmentShaderSource:s,attributeLocations:o})}return r}(n,t.shaderProgram),r.shaderProgramId=t.shaderProgram.id),r},Rw.createHdrCommand=function(t,n,r){var i;return e(r)||(r={}),e(r.command)&&(i=r.command.shaderProgram),r.command=Ps.shallowClone(t,r.command),e(i)&&r.shaderProgramId===t.shaderProgram.id?r.command.shaderProgram=i:(r.command.shaderProgram=function(t,n){var r=t.shaderCache.getDerivedShaderProgram(n,"HDR");if(!e(r)){var i=n._attributeLocations,o=n.vertexShaderSource.clone(),a=n.fragmentShaderSource.clone();o.defines=e(o.defines)?o.defines.slice(0):[],o.defines.push("HDR"),a.defines=e(a.defines)?a.defines.slice(0):[],a.defines.push("HDR"),r=t.shaderCache.createDerivedShaderProgram(n,"HDR",{vertexShaderSource:o,fragmentShaderSource:a,attributeLocations:i})}return r}(n,t.shaderProgram),r.shaderProgramId=t.shaderProgram.id),r};for(var zw=[359.393,800.749,1275.6501,2151.1192,3141.7763,4777.5198,6281.2493,12364.307,15900.765,49889.0549,78026.8259,99260.7344,120036.3873,151011.0158,156091.1953,203849.3112,274866.9803,319916.3149,493552.0528,628733.5874],Bw=[2e-5,2e-4,1e-4,7e-5,5e-5,4e-5,3e-5,19e-6,1e-5,85e-7,62e-7,58e-7,53e-7,52e-7,51e-7,42e-7,4e-6,34e-7,26e-7,22e-7],Uw=0;Uw<Bw.length;++Uw)Bw[Uw]*=1e6;for(var Vw=Bw[1],Hw=Bw[Bw.length-1],Gw=0;Gw<Bw.length;++Gw)Bw[Gw]=(Bw[Gw]-Hw)/(Vw-Hw);var kw=0;var Ww=new p;function qw(e,t,n){this.context=e,this.commandList=[],this.shadowMaps=[],this.brdfLutGenerator=void 0,this.environmentMap=void 0,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this.specularEnvironmentMapsMaximumLOD=void 0,this.mode=Al.SCENE3D,this.morphTime=Al.getMorphTime(Al.SCENE3D),this.frameNumber=0,this.newFrame=!1,this.time=void 0,this.jobScheduler=n,this.mapProjection=void 0,this.camera=void 0,this.cameraUnderground=!1,this.globeTranslucencyState=void 0,this.cullingVolume=void 0,this.occluder=void 0,this.maximumScreenSpaceError=void 0,this.pixelRatio=1,this.passes={render:!1,pick:!1,depth:!1,postProcess:!1,offscreen:!1},this.creditDisplay=t,this.afterRender=[],this.scene3DOnly=!1,this.fog={enabled:!1,density:void 0,sse:void 0,minimumBrightness:void 0},this.terrainExaggeration=1,this.shadowState={shadowsEnabled:!0,shadowMaps:[],lightShadowMaps:[],nearPlane:1,farPlane:5e3,closestObjectSize:1e3,lastDirtyTime:0,outOfView:!0},this.imagerySplitPosition=0,this.frustumSplits=[],this.backgroundColor=void 0,this.light=void 0,this.minimumDisableDepthTestDistance=void 0,this.invertClassification=!1,this.invertClassificationColor=void 0,this.useLogDepth=!1,this.tilesetPassState=void 0,this.minimumTerrainHeight=0}Fw.prototype.update=function(t){if(t.fog.enabled=this.enabled){var n=t.camera,r=n.positionCartographic;if(!e(r)||r.height>8e5||t.mode!==Al.SCENE3D)t.fog.enabled=!1;else{var i=r.height,o=function(e){var t,n=zw,r=n.length;if(e<n[0])return kw=0;if(e>n[r-1])return kw=r-2;if(e>=n[kw]){if(kw+1<r&&e<n[kw+1])return kw;if(kw+2<r&&e<n[kw+2])return++kw}else if(kw-1>=0&&e>=n[kw-1])return--kw;for(t=0;t<r-2&&!(e>=n[t]&&e<n[t+1]);++t);return kw=t}(i),s=a.clamp((i-zw[o])/(zw[o+1]-zw[o]),0,1),u=a.lerp(Bw[o],Bw[o+1],s),c=1e6*this.density;u=u*(c-c/Vw*Hw)*1e-6;var l=p.normalize(n.positionWC,Ww);u*=1-Math.abs(p.dot(n.directionWC,l)),t.fog.density=u,t.fog.sse=this.screenSpaceErrorFactor,t.fog.minimumBrightness=this.minimumBrightness}}};var Yw="uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\ngl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n}\n",jw="uniform highp sampler2D u_depthTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\ngl_FragColor = czm_packDepth(texture2D(u_depthTexture, v_textureCoordinates).r);\n}\n",Xw={NEVER:Tn.NEVER,LESS:Tn.LESS,EQUAL:Tn.EQUAL,LESS_OR_EQUAL:Tn.LEQUAL,GREATER:Tn.GREATER,NOT_EQUAL:Tn.NOTEQUAL,GREATER_OR_EQUAL:Tn.GEQUAL,ALWAYS:Tn.ALWAYS},Zw=Object.freeze(Xw),Kw={ZERO:Tn.ZERO,KEEP:Tn.KEEP,REPLACE:Tn.REPLACE,INCREMENT:Tn.INCR,DECREMENT:Tn.DECR,INVERT:Tn.INVERT,INCREMENT_WRAP:Tn.INCR_WRAP,DECREMENT_WRAP:Tn.DECR_WRAP},Qw=Object.freeze(Kw),Jw={CESIUM_3D_TILE_MASK:128,SKIP_LOD_MASK:112,SKIP_LOD_BIT_SHIFT:4,CLASSIFICATION_MASK:15,setCesium3DTileBit:function(){return{enabled:!0,frontFunction:Zw.ALWAYS,frontOperation:{fail:Qw.KEEP,zFail:Qw.KEEP,zPass:Qw.REPLACE},backFunction:Zw.ALWAYS,backOperation:{fail:Qw.KEEP,zFail:Qw.KEEP,zPass:Qw.REPLACE},reference:Jw.CESIUM_3D_TILE_MASK,mask:Jw.CESIUM_3D_TILE_MASK}}},$w=Object.freeze(Jw);function eb(){this._globeColorTexture=void 0,this._primitiveColorTexture=void 0,this._depthStencilTexture=void 0,this._globeDepthTexture=void 0,this._tempGlobeDepthTexture=void 0,this._tempCopyDepthTexture=void 0,this._globeColorFramebuffer=void 0,this._primitiveColorFramebuffer=void 0,this._copyDepthFramebuffer=void 0,this._tempCopyDepthFramebuffer=void 0,this._updateDepthFramebuffer=void 0,this._clearGlobeColorCommand=void 0,this._clearPrimitiveColorCommand=void 0,this._copyColorCommand=void 0,this._copyDepthCommand=void 0,this._tempCopyDepthCommand=void 0,this._updateDepthCommand=void 0,this._mergeColorCommand=void 0,this._viewport=new Ns,this._rs=void 0,this._rsBlend=void 0,this._rsUpdate=void 0,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useLogDepth=void 0,this._useHdr=void 0,this._clearGlobeDepth=void 0,this._debugGlobeDepthViewportCommand=void 0}function tb(e){e._globeColorTexture=e._globeColorTexture&&!e._globeColorTexture.isDestroyed()&&e._globeColorTexture.destroy(),e._depthStencilTexture=e._depthStencilTexture&&!e._depthStencilTexture.isDestroyed()&&e._depthStencilTexture.destroy(),e._globeDepthTexture=e._globeDepthTexture&&!e._globeDepthTexture.isDestroyed()&&e._globeDepthTexture.destroy()}function nb(e){e._globeColorFramebuffer=e._globeColorFramebuffer&&!e._globeColorFramebuffer.isDestroyed()&&e._globeColorFramebuffer.destroy(),e._copyDepthFramebuffer=e._copyDepthFramebuffer&&!e._copyDepthFramebuffer.isDestroyed()&&e._copyDepthFramebuffer.destroy()}function rb(e){e._tempCopyDepthFramebuffer=e._tempCopyDepthFramebuffer&&!e._tempCopyDepthFramebuffer.isDestroyed()&&e._tempCopyDepthFramebuffer.destroy(),e._updateDepthFramebuffer=e._updateDepthFramebuffer&&!e._updateDepthFramebuffer.isDestroyed()&&e._updateDepthFramebuffer.destroy(),e._tempGlobeDepthTexture=e._tempGlobeDepthTexture&&!e._tempGlobeDepthTexture.isDestroyed()&&e._tempGlobeDepthTexture.destroy()}function ib(e){e._primitiveColorTexture=e._primitiveColorTexture&&!e._primitiveColorTexture.isDestroyed()&&e._primitiveColorTexture.destroy(),e._primitiveColorFramebuffer=e._primitiveColorFramebuffer&&!e._primitiveColorFramebuffer.isDestroyed()&&e._primitiveColorFramebuffer.destroy()}function ob(t,n,r,i,o,a){var s=t._globeColorTexture,u=!e(s)||s.width!==r||s.height!==i||o!==t._useHdr;u&&(tb(t),nb(t),function(e,t,n,r,i){var o=i?t.halfFloatingPointTexture?Yc.HALF_FLOAT:Yc.FLOAT:Yc.UNSIGNED_BYTE;e._globeColorTexture=new Fh({context:t,width:n,height:r,pixelFormat:Xc.RGBA,pixelDatatype:o,sampler:Lh.NEAREST}),e._depthStencilTexture=new Fh({context:t,width:n,height:r,pixelFormat:Xc.DEPTH_STENCIL,pixelDatatype:Yc.UNSIGNED_INT_24_8}),e._globeDepthTexture=new Fh({context:t,width:n,height:r,pixelFormat:Xc.RGBA,pixelDatatype:Yc.UNSIGNED_BYTE,sampler:Lh.NEAREST})}(t,n,r,i,o),function(e,t){e._globeColorFramebuffer=new wh({context:t,colorTextures:[e._globeColorTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1}),e._copyDepthFramebuffer=new wh({context:t,colorTextures:[e._globeDepthTexture],destroyAttachments:!1})}(t,n)),(u||a!==t._clearGlobeDepth)&&(ib(t),a&&function(e,t,n,r,i){var o=i?t.halfFloatingPointTexture?Yc.HALF_FLOAT:Yc.FLOAT:Yc.UNSIGNED_BYTE;e._primitiveColorTexture=new Fh({context:t,width:n,height:r,pixelFormat:Xc.RGBA,pixelDatatype:o,sampler:Lh.NEAREST}),e._primitiveColorFramebuffer=new wh({context:t,colorTextures:[e._primitiveColorTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1})}(t,n,r,i,o))}function ab(t,n,r,i,o){t._viewport.width=r,t._viewport.height=i;var a=!Ns.equals(t._viewport,o.viewport),s=a!==t._useScissorTest;t._useScissorTest=a,Ns.equals(t._scissorRectangle,o.viewport)||(t._scissorRectangle=Ns.clone(o.viewport,t._scissorRectangle),s=!0),e(t._rs)&&Ns.equals(t._viewport,t._rs.viewport)&&!s||(t._rs=Us.fromCache({viewport:t._viewport,scissorTest:{enabled:t._useScissorTest,rectangle:t._scissorRectangle}}),t._rsBlend=Us.fromCache({viewport:t._viewport,scissorTest:{enabled:t._useScissorTest,rectangle:t._scissorRectangle},blending:Eh.ALPHA_BLEND}),t._rsUpdate=Us.fromCache({viewport:t._viewport,scissorTest:{enabled:t._useScissorTest,rectangle:t._scissorRectangle},stencilTest:{enabled:!0,frontFunction:Zw.EQUAL,frontOperation:{fail:Qw.KEEP,zFail:Qw.KEEP,zPass:Qw.KEEP},backFunction:Zw.NEVER,reference:$w.CESIUM_3D_TILE_MASK,mask:$w.CESIUM_3D_TILE_MASK}})),e(t._copyDepthCommand)||(t._copyDepthCommand=n.createViewportQuadCommand(jw,{uniformMap:{u_depthTexture:function(){return t._depthStencilTexture}},owner:t})),t._copyDepthCommand.framebuffer=t._copyDepthFramebuffer,t._copyDepthCommand.renderState=t._rs,e(t._copyColorCommand)||(t._copyColorCommand=n.createViewportQuadCommand(Yw,{uniformMap:{colorTexture:function(){return t._globeColorTexture}},owner:t})),t._copyColorCommand.renderState=t._rs,e(t._tempCopyDepthCommand)||(t._tempCopyDepthCommand=n.createViewportQuadCommand(jw,{uniformMap:{u_depthTexture:function(){return t._tempCopyDepthTexture}},owner:t})),t._tempCopyDepthCommand.framebuffer=t._tempCopyDepthFramebuffer,t._tempCopyDepthCommand.renderState=t._rs,e(t._updateDepthCommand)||(t._updateDepthCommand=n.createViewportQuadCommand(Yw,{uniformMap:{colorTexture:function(){return t._tempGlobeDepthTexture}},owner:t})),t._updateDepthCommand.framebuffer=t._updateDepthFramebuffer,t._updateDepthCommand.renderState=t._rsUpdate,e(t._clearGlobeColorCommand)||(t._clearGlobeColorCommand=new eC({color:new pn(0,0,0,0),stencil:0,owner:t})),t._clearGlobeColorCommand.framebuffer=t._globeColorFramebuffer,e(t._clearPrimitiveColorCommand)||(t._clearPrimitiveColorCommand=new eC({color:new pn(0,0,0,0),stencil:0,owner:t})),t._clearPrimitiveColorCommand.framebuffer=t._primitiveColorFramebuffer,e(t._mergeColorCommand)||(t._mergeColorCommand=n.createViewportQuadCommand(Yw,{uniformMap:{colorTexture:function(){return t._primitiveColorTexture}},owner:t})),t._mergeColorCommand.framebuffer=t._globeColorFramebuffer,t._mergeColorCommand.renderState=t._rsBlend}Object.defineProperties(eb.prototype,{framebuffer:{get:function(){return this._globeColorFramebuffer}},primitiveFramebuffer:{get:function(){return this._primitiveColorFramebuffer}}}),eb.prototype.executeDebugGlobeDepth=function(t,n,r){!function(t,n,r,i){if(!e(t._debugGlobeDepthViewportCommand)||i!==t._useLogDepth){var o=new nc({defines:[i?"LOG_DEPTH":""],sources:["uniform highp sampler2D u_depthTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    float z_window = czm_unpackDepth(texture2D(u_depthTexture, v_textureCoordinates));\n    z_window = czm_reverseLogDepth(z_window); \n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    float z_ndc = (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n    float scale = pow(z_ndc * 0.5 + 0.5, 8.0);\n    gl_FragColor = vec4(mix(vec3(0.0), vec3(1.0), scale), 1.0);\n}\n"]});t._debugGlobeDepthViewportCommand=n.createViewportQuadCommand(o,{uniformMap:{u_depthTexture:function(){return t._globeDepthTexture}},owner:t}),t._useLogDepth=i}t._debugGlobeDepthViewportCommand.execute(n,r)}(this,t,n,r)},eb.prototype.update=function(e,t,n,r,i){var o=n.width,a=n.height;ob(this,e,o,a,r,i),ab(this,e,o,a,t),e.uniformState.globeDepthTexture=void 0,this._useHdr=r,this._clearGlobeDepth=i},eb.prototype.executeCopyDepth=function(t,n){e(this._copyDepthCommand)&&(this._copyDepthCommand.execute(t,n),t.uniformState.globeDepthTexture=this._globeDepthTexture)},eb.prototype.executeUpdateDepth=function(t,n,r){var i=n.framebuffer.depthStencilTexture;if(r||i!==this._depthStencilTexture){if(e(this._updateDepthCommand)){if(!e(this._updateDepthFramebuffer)||this._updateDepthFramebuffer.depthStencilTexture!==i||this._updateDepthFramebuffer.getColorTexture(0)!==this._globeDepthTexture){var o=this._globeDepthTexture.width,a=this._globeDepthTexture.height;rb(this),function(e,t,n,r,i){e._tempGlobeDepthTexture=new Fh({context:t,width:n,height:r,pixelFormat:Xc.RGBA,pixelDatatype:Yc.UNSIGNED_BYTE,sampler:Lh.NEAREST}),e._tempCopyDepthFramebuffer=new wh({context:t,colorTextures:[e._tempGlobeDepthTexture],destroyAttachments:!1}),e._updateDepthFramebuffer=new wh({context:t,colorTextures:[e._globeDepthTexture],depthStencilTexture:i.framebuffer.depthStencilTexture,destroyAttachments:!1})}(this,t,o,a,n),ab(this,t,o,a,n)}this._tempCopyDepthTexture=i,this._tempCopyDepthCommand.execute(t,n),this._updateDepthCommand.execute(t,n)}}else e(this._copyDepthCommand)&&this._copyDepthCommand.execute(t,n)},eb.prototype.executeCopyColor=function(t,n){e(this._copyColorCommand)&&this._copyColorCommand.execute(t,n)},eb.prototype.executeMergeColor=function(t,n){e(this._mergeColorCommand)&&this._mergeColorCommand.execute(t,n)},eb.prototype.clear=function(t,n,r){var i=this._clearGlobeColorCommand;e(i)&&(pn.clone(r,i.color),i.execute(t,n)),e(i=this._clearPrimitiveColorCommand)&&e(this._primitiveColorFramebuffer)&&i.execute(t,n)},eb.prototype.isDestroyed=function(){return!1},eb.prototype.destroy=function(){return tb(this),nb(this),ib(this),rb(this),e(this._copyColorCommand)&&(this._copyColorCommand.shaderProgram=this._copyColorCommand.shaderProgram.destroy()),e(this._copyDepthCommand)&&(this._copyDepthCommand.shaderProgram=this._copyDepthCommand.shaderProgram.destroy()),e(this._tempCopyDepthCommand)&&(this._tempCopyDepthCommand.shaderProgram=this._tempCopyDepthCommand.shaderProgram.destroy()),e(this._updateDepthCommand)&&(this._updateDepthCommand.shaderProgram=this._updateDepthCommand.shaderProgram.destroy()),e(this._mergeColorCommand)&&(this._mergeColorCommand.shaderProgram=this._mergeColorCommand.shaderProgram.destroy()),e(this._debugGlobeDepthViewportCommand)&&(this._debugGlobeDepthViewportCommand.shaderProgram=this._debugGlobeDepthViewportCommand.shaderProgram.destroy()),hi(this)};var sb=0,ub=1,cb=2,lb=3,hb=4,db=5,fb=6,mb=7,pb=8,_b=9,gb=10,vb=11,yb=["opaqueFrontFaceCommand","opaqueBackFaceCommand","depthOnlyFrontFaceCommand","depthOnlyBackFaceCommand","depthOnlyFrontAndBackFaceCommand","translucentFrontFaceCommand","translucentBackFaceCommand","translucentFrontFaceManualDepthTestCommand","translucentBackFaceManualDepthTestCommand","pickFrontFaceCommand","pickBackFaceCommand"];function Tb(){this._frontFaceAlphaByDistance=new fr(0,1,0,1),this._backFaceAlphaByDistance=new fr(0,1,0,1),this._frontFaceTranslucent=!1,this._backFaceTranslucent=!1,this._requiresManualDepthTest=!1,this._sunVisibleThroughGlobe=!1,this._environmentVisible=!1,this._useDepthPlane=!1,this._numberOfTextureUniforms=0,this._globeTranslucencyFramebuffer=void 0,this._rectangle=Oe.clone(Oe.MAX_VALUE),this._derivedCommandKey=0,this._derivedCommandsDirty=!1,this._derivedCommandPacks=void 0,this._derivedCommandTypes=new Array(vb),this._derivedBlendCommandTypes=new Array(vb),this._derivedPickCommandTypes=new Array(vb),this._derivedCommandTypesToUpdate=new Array(vb),this._derivedCommandsLength=0,this._derivedBlendCommandsLength=0,this._derivedPickCommandsLength=0,this._derivedCommandsToUpdateLength=0}function Eb(t,n,r,i){return t?e(r)?(fr.clone(r,i),i.nearValue*=n,i.farValue*=n,i):(i.nearValue=n,i.farValue=n,i):(i.nearValue=1,i.farValue=1,i)}function xb(e,t,n){return e&&(n.baseColor.alpha<1||t.nearValue<1||t.farValue<1)}function Cb(e,t,n,r,i){var o=0,a=e._frontFaceTranslucent,s=e._backFaceTranslucent;if(!a)return o;var u=t.cameraUnderground,c=e._requiresManualDepthTest,l=r?_b:c?mb:db,h=r?gb:c?pb:fb;return t.mode===Al.SCENE2D?(i[o++]=cb,i[o++]=l,o):(s?(n||(i[o++]=hb),u?(i[o++]=l,i[o++]=h):(i[o++]=h,i[o++]=l)):u?(n||(i[o++]=lb),i[o++]=sb,i[o++]=h):(n||(i[o++]=cb),i[o++]=ub,i[o++]=l),o)}function Sb(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}function Ab(e,t){return e.indexOf(t)>-1}function wb(e,t){Sb(e.defines,"TRANSLUCENT"),Sb(t.defines,"TRANSLUCENT")}function bb(e,t){Sb(e.defines,"GROUND_ATMOSPHERE"),Sb(t.defines,"GROUND_ATMOSPHERE"),Sb(e.defines,"FOG"),Sb(t.defines,"FOG"),Sb(e.defines,"TRANSLUCENT"),Sb(t.defines,"TRANSLUCENT")}function Db(e,t){if(!Ab(t.defines,"TILE_LIMIT_RECTANGLE")&&!Ab(t.defines,"ENABLE_CLIPPING_PLANES")){t.sources=["void main() \n{ \n    gl_FragColor = vec4(1.0); \n} \n"]}}function Ib(e,t){for(var n=t.sources,r=n.length,i=0;i<r;++i)n[i]=nc.replaceMain(n[i],"czm_globe_translucency_main");n.push("\n\nuniform sampler2D u_classificationTexture; \nvoid main() \n{ \n    vec2 st = gl_FragCoord.xy / czm_viewport.zw; \n#ifdef MANUAL_DEPTH_TEST \n    float logDepthOrDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, st)); \n    if (logDepthOrDepth != 0.0) \n    { \n        vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth); \n        float depthEC = eyeCoordinate.z / eyeCoordinate.w; \n        if (v_positionEC.z < depthEC) \n        { \n            discard; \n        } \n    } \n#endif \n    czm_globe_translucency_main(); \n    vec4 classificationColor = texture2D(u_classificationTexture, st); \n    if (classificationColor.a > 0.0) \n    { \n        // Reverse premultiplication process to get the correct composited result of the classification primitives \n        classificationColor.rgb /= classificationColor.a; \n    } \n    gl_FragColor = classificationColor * vec4(classificationColor.aaa, 1.0) + gl_FragColor * (1.0 - classificationColor.a); \n} \n")}function Rb(e,t){Ib(0,t),Sb(e.defines,"GROUND_ATMOSPHERE"),Sb(t.defines,"GROUND_ATMOSPHERE"),Sb(e.defines,"FOG"),Sb(t.defines,"FOG")}function Pb(e,t){Ib(0,t),e.defines.push("GENERATE_POSITION"),t.defines.push("MANUAL_DEPTH_TEST")}function Ob(e,t){Rb(e,t),e.defines.push("GENERATE_POSITION"),t.defines.push("MANUAL_DEPTH_TEST")}function Nb(e,t){t.sources=["uniform sampler2D u_classificationTexture; \nvoid main() \n{ \n    vec2 st = gl_FragCoord.xy / czm_viewport.zw; \n    vec4 pickColor = texture2D(u_classificationTexture, st); \n    if (pickColor == vec4(0.0)) \n    { \n        discard; \n    } \n    gl_FragColor = pickColor; \n} \n"]}function Mb(t,n,r,i,o,a){if(!e(o))return n;if(!i&&e(r))return r;var s=t.shaderCache.getDerivedShaderProgram(n,a);if(!e(s)){var u=n._attributeLocations,c=n.vertexShaderSource.clone(),l=n.fragmentShaderSource.clone();c.defines=e(c.defines)?c.defines.slice(0):[],l.defines=e(l.defines)?l.defines.slice(0):[],o(c,l),s=t.shaderCache.createDerivedShaderProgram(n,a,{vertexShaderSource:c,fragmentShaderSource:l,attributeLocations:u})}return s}function Lb(e){e.cull.face=pg.BACK,e.cull.enabled=!0}function Fb(e){e.cull.face=pg.FRONT,e.cull.enabled=!0}function zb(e){e.cull.face=pg.BACK,e.cull.enabled=!0,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function Bb(e){e.cull.face=pg.FRONT,e.cull.enabled=!0,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function Ub(e){e.cull.enabled=!1,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function Vb(e){e.cull.face=pg.BACK,e.cull.enabled=!0,e.depthMask=!1,e.blending=Eh.ALPHA_BLEND}function Hb(e){e.cull.face=pg.FRONT,e.cull.enabled=!0,e.depthMask=!1,e.blending=Eh.ALPHA_BLEND}function Gb(e){e.cull.face=pg.BACK,e.cull.enabled=!0,e.blending.enabled=!1}function kb(e){e.cull.face=pg.FRONT,e.cull.enabled=!0,e.blending.enabled=!1}function Wb(t,n,r,i,o){if(!e(i))return t;if(!r&&e(n))return n;var a=o[t.id];if(!e(a)){var s=Us.getState(t);i(s),a=Us.fromCache(s),o[t.id]=a}return a}function qb(e){return{u_classificationTexture:function(){return e._globeTranslucencyFramebuffer.classificationTexture}}}function Yb(t,n,r,i,o){return e(o)?!i&&e(r)?r:No(n,o(t),!1):n}function jb(e){this.pass=e.pass,this.pickOnly=e.pickOnly,this.getShaderProgramFunction=e.getShaderProgramFunction,this.getRenderStateFunction=e.getRenderStateFunction,this.getUniformMapFunction=e.getUniformMapFunction,this.renderStateCache={}}Object.defineProperties(Tb.prototype,{frontFaceAlphaByDistance:{get:function(){return this._frontFaceAlphaByDistance}},backFaceAlphaByDistance:{get:function(){return this._backFaceAlphaByDistance}},translucent:{get:function(){return this._frontFaceTranslucent}},sunVisibleThroughGlobe:{get:function(){return this._sunVisibleThroughGlobe}},environmentVisible:{get:function(){return this._environmentVisible}},useDepthPlane:{get:function(){return this._useDepthPlane}},numberOfTextureUniforms:{get:function(){return this._numberOfTextureUniforms}},rectangle:{get:function(){return this._rectangle}}}),Tb.prototype.update=function(t){var n=t.globe;if(!e(n)||!n.show)return this._frontFaceTranslucent=!1,this._backFaceTranslucent=!1,this._sunVisibleThroughGlobe=!0,this._environmentVisible=!0,void(this._useDepthPlane=!1);this._frontFaceAlphaByDistance=Eb(n.translucency.enabled,n.translucency.frontFaceAlpha,n.translucency.frontFaceAlphaByDistance,this._frontFaceAlphaByDistance),this._backFaceAlphaByDistance=Eb(n.translucency.enabled,n.translucency.backFaceAlpha,n.translucency.backFaceAlphaByDistance,this._backFaceAlphaByDistance),this._frontFaceTranslucent=xb(n.translucency.enabled,this._frontFaceAlphaByDistance,n),this._backFaceTranslucent=xb(n.translucency.enabled,this._backFaceAlphaByDistance,n),this._requiresManualDepthTest=function(e,t,n){return e._frontFaceTranslucent&&!e._backFaceTranslucent&&!n.depthTestAgainstTerrain&&t.mode!==Al.SCENE2D&&t.context.depthTexture}(this,t,n),this._sunVisibleThroughGlobe=function(e,t){var n=e._frontFaceTranslucent,r=e._backFaceTranslucent;return n&&(t.cameraUnderground||r)}(this,t),this._environmentVisible=function(e,t){return!t.cameraUnderground||e._frontFaceTranslucent}(this,t),this._useDepthPlane=function(e,t){return!t.cameraUnderground&&!e._frontFaceTranslucent}(this,t),this._numberOfTextureUniforms=function(e){var t=0;e._frontFaceTranslucent&&++t;e._requiresManualDepthTest&&++t;return t}(this),this._rectangle=Oe.clone(n.translucency.rectangle,this._rectangle),function(t,n){var r;t._derivedCommandsLength=Cb(t,n,!1,!1,t._derivedCommandTypes),t._derivedBlendCommandsLength=Cb(t,n,!0,!1,t._derivedBlendCommandTypes),t._derivedPickCommandsLength=Cb(t,n,!1,!0,t._derivedPickCommandTypes);var i=0;for(r=0;r<t._derivedCommandsLength;++r)i|=1<<t._derivedCommandTypes[r];for(r=0;r<t._derivedBlendCommandsLength;++r)i|=1<<t._derivedBlendCommandTypes[r];for(r=0;r<t._derivedPickCommandsLength;++r)i|=1<<t._derivedPickCommandTypes[r];var o=0;for(r=0;r<vb;++r)(i&1<<r)>0&&(t._derivedCommandTypesToUpdate[o++]=r);t._derivedCommandsToUpdateLength=o;var a=i!==t._derivedCommandKey;t._derivedCommandKey=i,t._derivedCommandsDirty=a,!e(t._derivedCommandPacks)&&t._frontFaceTranslucent&&(t._derivedCommandPacks=[new jb({pass:Os.GLOBE,pickOnly:!1,getShaderProgramFunction:wb,getRenderStateFunction:Lb,getUniformMapFunction:void 0}),new jb({pass:Os.GLOBE,pickOnly:!1,getShaderProgramFunction:bb,getRenderStateFunction:Fb,getUniformMapFunction:void 0}),new jb({pass:Os.GLOBE,pickOnly:!1,getShaderProgramFunction:Db,getRenderStateFunction:zb,getUniformMapFunction:void 0}),new jb({pass:Os.GLOBE,pickOnly:!1,getShaderProgramFunction:Db,getRenderStateFunction:Bb,getUniformMapFunction:void 0}),new jb({pass:Os.GLOBE,pickOnly:!1,getShaderProgramFunction:Db,getRenderStateFunction:Ub,getUniformMapFunction:void 0}),new jb({pass:Os.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:Ib,getRenderStateFunction:Vb,getUniformMapFunction:qb}),new jb({pass:Os.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:Rb,getRenderStateFunction:Hb,getUniformMapFunction:qb}),new jb({pass:Os.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:Pb,getRenderStateFunction:Vb,getUniformMapFunction:qb}),new jb({pass:Os.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:Ob,getRenderStateFunction:Hb,getUniformMapFunction:qb}),new jb({pass:Os.TRANSLUCENT,pickOnly:!0,getShaderProgramFunction:Nb,getRenderStateFunction:Gb,getUniformMapFunction:qb}),new jb({pass:Os.TRANSLUCENT,pickOnly:!0,getShaderProgramFunction:Nb,getRenderStateFunction:kb,getUniformMapFunction:qb})])}(this,t)};var Xb=new Array(vb),Zb=new Array(vb);function Kb(t,n,r,i,o,a,s){for(var u=0;u<n;++u){var c=t[u],l=c.derivedCommands.type;(!e(s)||s.indexOf(l)>-1)&&r(c,i,o,a)}}function Qb(e,t,n,r,i,o){for(var a=0;a<t;++a)n(e[a],r,i,o)}Tb.prototype.updateDerivedCommands=function(t,n){var r=this._derivedCommandTypesToUpdate,o=this._derivedCommandsToUpdateLength;if(0!==o){for(var a=0;a<o;++a)Zb[a]=this._derivedCommandPacks[r[a]],Xb[a]=yb[r[a]];!function(t,n,r,o,a,s,u){var c=n.derivedCommands.globeTranslucency,l=t._derivedCommandsDirty;if(n.dirty||!e(c)||l){n.dirty=!1,e(c)||(c={},n.derivedCommands.globeTranslucency=c);var h=u.frameNumber,d=i(c.uniformMapDirtyFrame,0),f=i(c.shaderProgramDirtyFrame,0),m=i(c.renderStateDirtyFrame,0),p=c.uniformMap!==n.uniformMap,_=c.shaderProgramId!==n.shaderProgram.id,g=c.renderStateId!==n.renderState.id;p&&(c.uniformMapDirtyFrame=h),_&&(c.shaderProgramDirtyFrame=h),g&&(c.renderStateDirtyFrame=h),c.uniformMap=n.uniformMap,c.shaderProgramId=n.shaderProgram.id,c.renderStateId=n.renderState.id;for(var v=0;v<r;++v){var y,T,E,x=s[v],C=o[v],S=a[v],A=c[S];e(A)?(y=A.uniformMap,T=A.shaderProgram,E=A.renderState):(y=void 0,T=void 0,E=void 0),A=Ps.shallowClone(n,A),c[S]=A;var w=i(A.derivedCommands.uniformMapDirtyFrame,0),b=i(A.derivedCommands.shaderProgramDirtyFrame,0),D=i(A.derivedCommands.renderStateDirtyFrame,0),I=p||w<d,R=_||b<f,P=g||D<m;I&&(A.derivedCommands.uniformMapDirtyFrame=h),R&&(A.derivedCommands.shaderProgramDirtyFrame=h),P&&(A.derivedCommands.renderStateDirtyFrame=h),A.derivedCommands.type=C,A.pass=x.pass,A.pickOnly=x.pickOnly,A.uniformMap=Yb(t,n.uniformMap,y,I,x.getUniformMapFunction),A.shaderProgram=Mb(u.context,n.shaderProgram,T,R,x.getShaderProgramFunction,S),A.renderState=Wb(n.renderState,E,P,x.getRenderStateFunction,x.renderStateCache)}}}(this,t,o,r,Xb,Zb,n)}},Tb.prototype.pushDerivedCommands=function(e,t,n){var r=n.passes.pick;if(!r||!t){var i=this._derivedCommandTypes,o=this._derivedCommandsLength;if(r?(i=this._derivedPickCommandTypes,o=this._derivedPickCommandsLength):t&&(i=this._derivedBlendCommandTypes,o=this._derivedBlendCommandsLength),0!==o)for(var a=e.derivedCommands.globeTranslucency,s=0;s<o;++s){var u=yb[i[s]];n.commandList.push(a[u])}else n.commandList.push(e)}};var Jb=[sb,ub],$b=[cb,lb,hb];function eD(){this.previousFramebuffer=void 0,this._previousFramebuffer=void 0,this._texture=void 0,this._classifiedTexture=void 0,this._depthStencilTexture=void 0,this._fbo=void 0,this._fboClassified=void 0,this._rsUnclassified=void 0,this._rsClassified=void 0,this._unclassifiedCommand=void 0,this._classifiedCommand=void 0,this._translucentCommand=void 0,this._clearColorCommand=new eC({color:new pn(0,0,0,0),owner:this}),this._clearCommand=new eC({color:new pn(0,0,0,0),depth:1,stencil:0});var e=this;this._uniformMap={colorTexture:function(){return e._texture},depthTexture:function(){return e._depthStencilTexture},classifiedTexture:function(){return e._classifiedTexture}}}Tb.prototype.executeGlobeCommands=function(e,t,n,r,i){var o=r.context,a=e.commands[Os.GLOBE],s=e.indices[Os.GLOBE];0!==s&&(this._globeTranslucencyFramebuffer=n,n.clearClassification(o,i),Kb(a,s,t,r,o,i,Jb))},Tb.prototype.executeGlobeClassificationCommands=function(e,t,n,r,i){var o=r.context,a=e.commands[Os.GLOBE],s=e.indices[Os.GLOBE],u=e.commands[Os.TERRAIN_CLASSIFICATION],c=e.indices[Os.TERRAIN_CLASSIFICATION];if(0!==s&&0!==c){var l=this._frontFaceTranslucent,h=this._backFaceTranslucent;if(l&&h||Qb(u,c,t,r,o,i),l||h){this._globeTranslucencyFramebuffer=n;var d=o.uniformState.globeDepthTexture,f=i.framebuffer;if(i.framebuffer=n.classificationFramebuffer,Kb(a,s,t,r,o,i,$b),o.depthTexture){var m=n.packDepth(o,i);o.uniformState.globeDepthTexture=m}Qb(u,c,t,r,o,i),o.uniformState.globeDepthTexture=d,i.framebuffer=f}}},Object.defineProperties(eD.prototype,{unclassifiedCommand:{get:function(){return this._unclassifiedCommand}}}),eD.isTranslucencySupported=function(e){return e.depthTexture&&e.fragmentDepth};var tD={depthMask:!1,stencilTest:{enabled:!0,frontFunction:Zw.EQUAL,frontOperation:{fail:Qw.KEEP,zFail:Qw.KEEP,zPass:Qw.KEEP},backFunction:Zw.NEVER,reference:0,mask:$w.CLASSIFICATION_MASK},blending:Eh.ALPHA_BLEND},nD={depthMask:!1,stencilTest:{enabled:!0,frontFunction:Zw.NOT_EQUAL,frontOperation:{fail:Qw.KEEP,zFail:Qw.KEEP,zPass:Qw.KEEP},backFunction:Zw.NEVER,reference:0,mask:$w.CLASSIFICATION_MASK},blending:Eh.ALPHA_BLEND},rD={depthMask:!0,depthTest:{enabled:!0},stencilTest:$w.setCesium3DTileBit(),stencilMask:$w.CESIUM_3D_TILE_MASK,blending:Eh.ALPHA_BLEND};eD.prototype.update=function(t){var n=this._texture,r=!e(n)||this.previousFramebuffer!==this._previousFramebuffer;this._previousFramebuffer=this.previousFramebuffer;var i,o,a=t.drawingBufferWidth,s=t.drawingBufferHeight,u=!e(n)||n.width!==a||n.height!==s;((u||r)&&(this._texture=this._texture&&this._texture.destroy(),this._classifiedTexture=this._classifiedTexture&&this._classifiedTexture.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._texture=new Fh({context:t,width:a,height:s,pixelFormat:Xc.RGBA,pixelDatatype:Yc.UNSIGNED_BYTE,sampler:new Lh({wrapS:Mh.CLAMP_TO_EDGE,wrapT:Mh.CLAMP_TO_EDGE,minificationFilter:Oh.LINEAR,magnificationFilter:Rh.LINEAR})}),e(this._previousFramebuffer)||(this._classifiedTexture=new Fh({context:t,width:a,height:s,pixelFormat:Xc.RGBA,pixelDatatype:Yc.UNSIGNED_BYTE,sampler:new Lh({wrapS:Mh.CLAMP_TO_EDGE,wrapT:Mh.CLAMP_TO_EDGE,minificationFilter:Oh.LINEAR,magnificationFilter:Rh.LINEAR})}),this._depthStencilTexture=new Fh({context:t,width:a,height:s,pixelFormat:Xc.DEPTH_STENCIL,pixelDatatype:Yc.UNSIGNED_INT_24_8}))),!e(this._fbo)||u||r)&&(this._fbo=this._fbo&&this._fbo.destroy(),this._fboClassified=this._fboClassified&&this._fboClassified.destroy(),e(this._previousFramebuffer)?(i=this._previousFramebuffer.depthStencilTexture,o=this._previousFramebuffer.depthStencilRenderbuffer):i=this._depthStencilTexture,this._fbo=new wh({context:t,colorTextures:[this._texture],depthStencilTexture:i,depthStencilRenderbuffer:o,destroyAttachments:!1}),e(this._previousFramebuffer)||(this._fboClassified=new wh({context:t,colorTextures:[this._classifiedTexture],depthStencilTexture:i,destroyAttachments:!1})));if(e(this._rsUnclassified)||(this._rsUnclassified=Us.fromCache(tD),this._rsClassified=Us.fromCache(nD),this._rsDefault=Us.fromCache(rD)),!e(this._unclassifiedCommand)||r){e(this._unclassifiedCommand)&&(this._unclassifiedCommand.shaderProgram=this._unclassifiedCommand.shaderProgram&&this._unclassifiedCommand.shaderProgram.destroy(),this._classifiedCommand.shaderProgram=this._classifiedCommand.shaderProgram&&this._classifiedCommand.shaderProgram.destroy());var c=e(this._previousFramebuffer)?"uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    if (color.a == 0.0)\n    {\n        discard;\n    }\n#ifdef UNCLASSIFIED\n    gl_FragColor = color * czm_invertClassificationColor;\n#else\n    gl_FragColor = color;\n#endif\n}\n":"#extension GL_EXT_frag_depth : enable\nuniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nuniform sampler2D classifiedTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    if (color.a == 0.0)\n    {\n        discard;\n    }\n    bool isClassified = all(equal(texture2D(classifiedTexture, v_textureCoordinates), vec4(0.0)));\n#ifdef UNCLASSIFIED\n    vec4 highlightColor = czm_invertClassificationColor;\n    if (isClassified)\n    {\n        discard;\n    }\n#else\n    vec4 highlightColor = vec4(1.0);\n    if (!isClassified)\n    {\n        discard;\n    }\n#endif\n    gl_FragColor = color * highlightColor;\n    gl_FragDepthEXT = texture2D(depthTexture, v_textureCoordinates).r;\n}\n",l=new nc({defines:["UNCLASSIFIED"],sources:[c]}),h=new nc({sources:[c]});this._unclassifiedCommand=t.createViewportQuadCommand(l,{renderState:e(this._previousFramebuffer)?this._rsUnclassified:this._rsDefault,uniformMap:this._uniformMap,owner:this}),this._classifiedCommand=t.createViewportQuadCommand(h,{renderState:e(this._previousFramebuffer)?this._rsClassified:this._rsDefault,uniformMap:this._uniformMap,owner:this}),e(this._translucentCommand)&&(this._translucentCommand.shaderProgram=this._translucentCommand.shaderProgram&&this._translucentCommand.shaderProgram.destroy()),e(this._previousFramebuffer)||(this._translucentCommand=t.createViewportQuadCommand(Yw,{renderState:this._rsUnclassified,uniformMap:this._uniformMap,owner:this}))}},eD.prototype.clear=function(t,n){var r=n.framebuffer;e(this._previousFramebuffer)?(n.framebuffer=this._fbo,this._clearColorCommand.execute(t,n)):(n.framebuffer=this._fbo,this._clearCommand.execute(t,n),n.framebuffer=this._fboClassified,this._clearCommand.execute(t,n)),n.framebuffer=r},eD.prototype.executeClassified=function(t,n){if(!e(this._previousFramebuffer)){var r=n.framebuffer;n.framebuffer=this._fboClassified,this._translucentCommand.execute(t,n),n.framebuffer=r}this._classifiedCommand.execute(t,n)},eD.prototype.executeUnclassified=function(e,t){this._unclassifiedCommand.execute(e,t)},eD.prototype.isDestroyed=function(){return!1},eD.prototype.destroy=function(){return this._fbo=this._fbo&&this._fbo.destroy(),this._texture=this._texture&&this._texture.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),e(this._unclassifiedCommand)&&(this._unclassifiedCommand.shaderProgram=this._unclassifiedCommand.shaderProgram&&this._unclassifiedCommand.shaderProgram.destroy(),this._classifiedCommand.shaderProgram=this._classifiedCommand.shaderProgram&&this._classifiedCommand.shaderProgram.destroy()),hi(this)};var iD=Object.freeze({TEXTURE:0,PROGRAM:1,BUFFER:2,NUMBER_OF_JOB_TYPES:3});function oD(e){this._total=e,this.usedThisFrame=0,this.stolenFromMeThisFrame=0,this.starvedThisFrame=!1,this.starvedLastFrame=!1}function aD(t){var n=new Array(iD.NUMBER_OF_JOB_TYPES);n[iD.TEXTURE]=new oD(e(t)?t[iD.TEXTURE]:10),n[iD.PROGRAM]=new oD(e(t)?t[iD.PROGRAM]:10),n[iD.BUFFER]=new oD(e(t)?t[iD.BUFFER]:30);var r,i=n.length,o=0;for(r=0;r<i;++r)o+=n[r].total;var a=new Array(i);for(r=0;r<i;++r)a[r]=!1;this._totalBudget=o,this._totalUsedThisFrame=0,this._budgets=n,this._executedThisFrame=a}Object.defineProperties(oD.prototype,{total:{get:function(){return this._total}}}),aD.getTimestamp=di,Object.defineProperties(aD.prototype,{totalBudget:{get:function(){return this._totalBudget}}}),aD.prototype.disableThisFrame=function(){this._totalUsedThisFrame=this._totalBudget},aD.prototype.resetBudgets=function(){for(var e=this._budgets,t=e.length,n=0;n<t;++n){var r=e[n];r.starvedLastFrame=r.starvedThisFrame,r.starvedThisFrame=!1,r.usedThisFrame=0,r.stolenFromMeThisFrame=0}this._totalUsedThisFrame=0},aD.prototype.execute=function(e,t){var n,r=this._budgets,i=r[t],o=this._executedThisFrame[t];if(this._totalUsedThisFrame>=this._totalBudget&&o)return i.starvedThisFrame=!0,!1;if(i.usedThisFrame+i.stolenFromMeThisFrame>=i.total){var a,s=r.length;for(a=0;a<s&&(!((n=r[a]).usedThisFrame+n.stolenFromMeThisFrame<n.total)||n.starvedLastFrame);++a);if(a===s&&o)return!1;o&&(i.starvedThisFrame=!0)}var u=aD.getTimestamp();e.execute();var c=aD.getTimestamp()-u;return this._totalUsedThisFrame+=c,n?n.stolenFromMeThisFrame+=c:i.usedThisFrame+=c,this._executedThisFrame[t]=!0,!0};function sD(e){this._url=e,this._cubeMapBuffers=void 0,this._cubeMaps=void 0,this._texture=void 0,this._mipTextures=void 0,this._va=void 0,this._sp=void 0,this._maximumMipmapLevel=void 0,this._loading=!1,this._ready=!1,this._readyPromise=Et.defer()}Object.defineProperties(sD.prototype,{url:{get:function(){return this._url}},texture:{get:function(){return this._texture}},maximumMipmapLevel:{get:function(){return this._maximumMipmapLevel}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}}}),sD.isSupported=function(e){return e.colorBufferHalfFloat&&e.halfFloatingPointTexture||e.floatingPointTexture&&e.colorBufferFloat};for(var uD=new p(1,0,0),cD=new p(0,0,1),lD=new p(-1,0,0),hD=new p(0,0,-1),dD=new p(0,1,0),fD=[dD,lD,cD,new p(0,-1,0),uD,dD,hD,dD,dD],mD=fD.length,pD=new Float32Array(3*mD),_D=0,gD=0;gD<mD;++gD,_D+=3)p.pack(fD[gD],pD,_D);var vD=new Float32Array([-1,1,-1,0,0,1,0,0,1,0,1,1,0,-1,-1,-1,1,-1]),yD=new Uint16Array([0,1,2,2,3,1,7,6,1,3,6,1,2,5,4,3,4,2,4,8,6,3,4,6]);function TD(e){return function(){return e}}function ED(t){var n,r;t._va=t._va&&t._va.destroy(),t._sp=t._sp&&t._sp.destroy();var i=t._cubeMaps;if(e(i))for(r=i.length,n=0;n<r;++n)i[n].destroy();var o=t._mipTextures;if(e(o))for(r=o.length,n=0;n<r;++n)o[n].destroy();t._va=void 0,t._sp=void 0,t._cubeMaps=void 0,t._cubeMapBuffers=void 0,t._mipTextures=void 0}function xD(e){e=i(e,i.EMPTY_OBJECT);var t,n=("string"==typeof(t=e.container)&&(t=document.getElementById(t)),t);this._container=n;var r=document.createElement("div");r.className="cesium-performanceDisplay";var o=document.createElement("div");o.className="cesium-performanceDisplay-fps",this._fpsText=document.createTextNode(""),o.appendChild(this._fpsText);var a=document.createElement("div");a.className="cesium-performanceDisplay-ms",this._msText=document.createTextNode(""),a.appendChild(this._msText),r.appendChild(a),r.appendChild(o),this._container.appendChild(r),this._lastFpsSampleTime=di(),this._lastMsSampleTime=di(),this._fpsFrameCount=0,this._msFrameCount=0,this._throttled=!1;var s=document.createElement("div");s.className="cesium-performanceDisplay-throttled",this._throttledText=document.createTextNode(""),s.appendChild(this._throttledText),r.appendChild(s)}function CD(e){e=i(e,i.EMPTY_OBJECT),this._primitives=[],this._guid=Tl(),this._zIndex=void 0,this.show=i(e.show,!0),this.destroyPrimitives=i(e.destroyPrimitives,!0)}function SD(e,t){return e._primitives.indexOf(t)}function AD(e,t,n,r,i,o,a,s,u,c){this._tweens=e,this._tweenjs=t,this._startObject=Oo(n),this._stopObject=Oo(r),this._duration=i,this._delay=o,this._easingFunction=a,this._update=s,this._complete=u,this.cancel=c,this.needsStart=!0}function wD(){this._tweens=[]}function bD(e){this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.translateEventTypes=Od.LEFT_DRAG,this.zoomEventTypes=[Od.RIGHT_DRAG,Od.WHEEL,Od.PINCH],this.rotateEventTypes=Od.LEFT_DRAG,this.tiltEventTypes=[Od.MIDDLE_DRAG,Od.PINCH,{eventType:Od.LEFT_DRAG,modifier:dr.CTRL},{eventType:Od.RIGHT_DRAG,modifier:dr.CTRL}],this.lookEventTypes={eventType:Od.LEFT_DRAG,modifier:dr.SHIFT},this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumCollisionTerrainHeight=15e3,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this._scene=e,this._globe=void 0,this._ellipsoid=void 0,this._aggregator=new Ud(e.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._inertiaDisablers={_lastInertiaZoomMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement","_lastInertiaTiltMovement"],_lastInertiaTiltMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement"]},this._tweens=new wD,this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new c(-1,-1),this._tiltCenter=new p,this._rotateMousePosition=new c(-1,-1),this._rotateStartPosition=new p,this._strafeStartPosition=new p,this._strafeMousePosition=new c,this._strafeEndMousePosition=new c,this._zoomMouseStart=new c(-1,-1),this._zoomWorldPosition=new p,this._useZoomWorldPosition=!1,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._zoomingUnderground=!1,this._rotatingZoom=!1,this._adjustedHeightForTerrain=!1,this._cameraUnderground=!1;var t=e.mapProjection;this._maxCoord=t.project(new N(Math.PI,a.PI_OVER_TWO)),this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3,this._minimumUndergroundPickDistance=2e3,this._maximumUndergroundPickDistance=1e4}sD.prototype.update=function(t){var n=t.context;if(sD.isSupported(n)&&(e(this._texture)&&e(this._va)&&ED(this),!e(this._texture))){if(!e(this._texture)&&!this._loading){var r=n.textureCache.getTexture(this._url);if(e(r))return ED(this),this._texture=r,this._maximumMipmapLevel=this._texture.maximumMipmapLevel,this._ready=!0,void this._readyPromise.resolve()}var i=this._cubeMapBuffers;if(!e(i)&&!this._loading){var o=this;Zc(this._url).then((function(e){o._cubeMapBuffers=e,o._loading=!1})).otherwise(this._readyPromise.reject),this._loading=!0}if(e(this._cubeMapBuffers)){this._va=function(e){var t=bs.createVertexBuffer({context:e,typedArray:vD,usage:ws.STATIC_DRAW}),n=bs.createVertexBuffer({context:e,typedArray:pD,usage:ws.STATIC_DRAW}),r=bs.createIndexBuffer({context:e,typedArray:yD,usage:ws.STATIC_DRAW,indexDatatype:Dn.UNSIGNED_SHORT});return new xc({context:e,attributes:[{index:0,vertexBuffer:t,componentsPerAttribute:2,componentDatatype:xn.FLOAT},{index:1,vertexBuffer:n,componentsPerAttribute:3,componentDatatype:xn.FLOAT}],indexBuffer:r})}(n),this._sp=Hu.fromCache({context:n,vertexShaderSource:"attribute vec4 position;\nattribute vec3 cubeMapCoordinates;\nvarying vec3 v_cubeMapCoordinates;\nvoid main()\n{\ngl_Position = position;\nv_cubeMapCoordinates = cubeMapCoordinates;\n}\n",fragmentShaderSource:"varying vec3 v_cubeMapCoordinates;\nuniform samplerCube cubeMap;\nvoid main()\n{\nvec4 rgbm = textureCube(cubeMap, v_cubeMapCoordinates);\nfloat m = rgbm.a * 16.0;\nvec3 r = rgbm.rgb * m;\ngl_FragColor = vec4(r * r, 1.0);\n}\n",attributeLocations:{position:0,cubeMapCoordinates:1}});var a=Math.min(i.length,6);this._maximumMipmapLevel=a-1;for(var s=this._cubeMaps=new Array(a),u=this._mipTextures=new Array(a),c=2*i[0].positiveX.width,l={originalSize:function(){return c}},h=n.halfFloatingPointTexture?Yc.HALF_FLOAT:Yc.FLOAT,d=Xc.RGBA,f=0;f<a;++f){var m=i[f].positiveY;i[f].positiveY=i[f].negativeY,i[f].negativeY=m;var p=s[f]=new sC({context:n,source:i[f]}),_=2*s[f].width,g=u[f]=new Fh({context:n,width:_,height:_,pixelDatatype:h,pixelFormat:d}),v=new J_({vertexArray:this._va,shaderProgram:this._sp,uniformMap:{cubeMap:TD(p)},outputTexture:g,persists:!0,owner:this});t.commandList.push(v),l["texture"+f]=TD(g)}this._texture=new Fh({context:n,width:1.5*c+2,height:c,pixelDatatype:h,pixelFormat:d}),this._texture.maximumMipmapLevel=this._maximumMipmapLevel,n.textureCache.addTexture(this._url,this._texture);var y=new J_({fragmentShaderSource:"varying vec2 v_textureCoordinates;\nuniform float originalSize;\nuniform sampler2D texture0;\nuniform sampler2D texture1;\nuniform sampler2D texture2;\nuniform sampler2D texture3;\nuniform sampler2D texture4;\nuniform sampler2D texture5;\nconst float yMipLevel1 = 1.0 - (1.0 / pow(2.0, 1.0));\nconst float yMipLevel2 = 1.0 - (1.0 / pow(2.0, 2.0));\nconst float yMipLevel3 = 1.0 - (1.0 / pow(2.0, 3.0));\nconst float yMipLevel4 = 1.0 - (1.0 / pow(2.0, 4.0));\nvoid main()\n{\nvec2 uv = v_textureCoordinates;\nvec2 textureSize = vec2(originalSize * 1.5 + 2.0, originalSize);\nvec2 pixel = 1.0 / textureSize;\nfloat mipLevel = 0.0;\nif (uv.x - pixel.x > (textureSize.y / textureSize.x))\n{\nmipLevel = 1.0;\nif (uv.y - pixel.y > yMipLevel1)\n{\nmipLevel = 2.0;\nif (uv.y - pixel.y * 3.0 > yMipLevel2)\n{\nmipLevel = 3.0;\nif (uv.y - pixel.y * 5.0 > yMipLevel3)\n{\nmipLevel = 4.0;\nif (uv.y - pixel.y * 7.0 > yMipLevel4)\n{\nmipLevel = 5.0;\n}\n}\n}\n}\n}\nif (mipLevel > 0.0)\n{\nfloat scale = pow(2.0, mipLevel);\nuv.y -= (pixel.y * (mipLevel - 1.0) * 2.0);\nuv.x *= ((textureSize.x - 2.0) / textureSize.y);\nuv.x -= 1.0 + pixel.x;\nuv.y -= (1.0 - (1.0 / pow(2.0, mipLevel - 1.0)));\nuv *= scale;\n}\nelse\n{\nuv.x *= (textureSize.x / textureSize.y);\n}\nif(mipLevel == 0.0)\n{\ngl_FragColor = texture2D(texture0, uv);\n}\nelse if(mipLevel == 1.0)\n{\ngl_FragColor = texture2D(texture1, uv);\n}\nelse if(mipLevel == 2.0)\n{\ngl_FragColor = texture2D(texture2, uv);\n}\nelse if(mipLevel == 3.0)\n{\ngl_FragColor = texture2D(texture3, uv);\n}\nelse if(mipLevel == 4.0)\n{\ngl_FragColor = texture2D(texture4, uv);\n}\nelse if(mipLevel == 5.0)\n{\ngl_FragColor = texture2D(texture5, uv);\n}\nelse\n{\ngl_FragColor = vec4(0.0);\n}\n}\n",uniformMap:l,outputTexture:this._texture,persists:!1,owner:this});t.commandList.push(y),this._ready=!0,this._readyPromise.resolve()}}},sD.prototype.isDestroyed=function(){return!1},sD.prototype.destroy=function(){return ED(this),this._texture=this._texture&&this._texture.destroy(),hi(this)},Object.defineProperties(xD.prototype,{throttled:{get:function(){return this._throttled},set:function(e){this._throttled!==e&&(this._throttledText.nodeValue=e?"(throttled)":"",this._throttled=e)}}}),xD.prototype.update=function(e){var t=di(),n=i(e,!0);this._fpsFrameCount++;var r=t-this._lastFpsSampleTime;if(r>1e3){var o="N/A";n&&(o=1e3*this._fpsFrameCount/r|0),this._fpsText.nodeValue=o+" FPS",this._lastFpsSampleTime=t,this._fpsFrameCount=0}this._msFrameCount++;var a=t-this._lastMsSampleTime;if(a>200){var s="N/A";n&&(s=(a/this._msFrameCount).toFixed(2)),this._msText.nodeValue=s+" MS",this._lastMsSampleTime=t,this._msFrameCount=0}},xD.prototype.destroy=function(){return hi(this)},Object.defineProperties(CD.prototype,{length:{get:function(){return this._primitives.length}}}),CD.prototype.add=function(t,n){var r=e(n),i=t._external=t._external||{};return(i._composites=i._composites||{})[this._guid]={collection:this},r?this._primitives.splice(n,0,t):this._primitives.push(t),t},CD.prototype.remove=function(e){if(this.contains(e)){var t=this._primitives.indexOf(e);if(-1!==t)return this._primitives.splice(t,1),delete e._external._composites[this._guid],this.destroyPrimitives&&e.destroy(),!0}return!1},CD.prototype.removeAndDestroy=function(e){var t=this.remove(e);return t&&!this.destroyPrimitives&&e.destroy(),t},CD.prototype.removeAll=function(){for(var e=this._primitives,t=e.length,n=0;n<t;++n)delete e[n]._external._composites[this._guid],this.destroyPrimitives&&e[n].destroy();this._primitives=[]},CD.prototype.contains=function(t){return!!(e(t)&&t._external&&t._external._composites&&t._external._composites[this._guid])},CD.prototype.raise=function(t){if(e(t)){var n=SD(this,t),r=this._primitives;if(n!==r.length-1){var i=r[n];r[n]=r[n+1],r[n+1]=i}}},CD.prototype.raiseToTop=function(t){if(e(t)){var n=SD(this,t),r=this._primitives;n!==r.length-1&&(r.splice(n,1),r.push(t))}},CD.prototype.lower=function(t){if(e(t)){var n=SD(this,t),r=this._primitives;if(0!==n){var i=r[n];r[n]=r[n-1],r[n-1]=i}}},CD.prototype.lowerToBottom=function(t){if(e(t)){var n=SD(this,t),r=this._primitives;0!==n&&(r.splice(n,1),r.unshift(t))}},CD.prototype.get=function(e){return this._primitives[e]},CD.prototype.update=function(e){if(this.show)for(var t=this._primitives,n=0;n<t.length;++n)t[n].update(e)},CD.prototype.prePassesUpdate=function(t){for(var n=this._primitives,r=0;r<n.length;++r){var i=n[r];e(i.prePassesUpdate)&&i.prePassesUpdate(t)}},CD.prototype.updateForPass=function(t,n){for(var r=this._primitives,i=0;i<r.length;++i){var o=r[i];e(o.updateForPass)&&o.updateForPass(t,n)}},CD.prototype.postPassesUpdate=function(t){for(var n=this._primitives,r=0;r<n.length;++r){var i=n[r];e(i.postPassesUpdate)&&i.postPassesUpdate(t)}},CD.prototype.isDestroyed=function(){return!1},CD.prototype.destroy=function(){return this.removeAll(),hi(this)},Object.defineProperties(AD.prototype,{startObject:{get:function(){return this._startObject}},stopObject:{get:function(){return this._stopObject}},duration:{get:function(){return this._duration}},delay:{get:function(){return this._delay}},easingFunction:{get:function(){return this._easingFunction}},update:{get:function(){return this._update}},complete:{get:function(){return this._complete}},tweenjs:{get:function(){return this._tweenjs}}}),AD.prototype.cancelTween=function(){this._tweens.remove(this)},Object.defineProperties(wD.prototype,{length:{get:function(){return this._tweens.length}}}),wD.prototype.add=function(t){if(0===(t=i(t,i.EMPTY_OBJECT)).duration)return e(t.complete)&&t.complete(),new AD(this);var n=t.duration/ro.SECONDS_PER_MILLISECOND,r=i(t.delay,0),o=r/ro.SECONDS_PER_MILLISECOND,a=i(t.easingFunction,jC.LINEAR_NONE),s=t.startObject,u=new GC.Tween(s);u.to(Oo(t.stopObject),n),u.delay(o),u.easing(a),e(t.update)&&u.onUpdate((function(){t.update(s)})),u.onComplete(i(t.complete,null)),u.repeat(i(t._repeat,0));var c=new AD(this,u,t.startObject,t.stopObject,t.duration,r,a,t.update,t.complete,t.cancel);return this._tweens.push(c),c},wD.prototype.addProperty=function(e){var t=(e=i(e,i.EMPTY_OBJECT)).object,n=e.property,r=e.startValue,o=e.stopValue;return this.add({startObject:{value:r},stopObject:{value:o},duration:i(e.duration,3),delay:e.delay,easingFunction:e.easingFunction,update:function(e){t[n]=e.value},complete:e.complete,cancel:e.cancel,_repeat:e._repeat})},wD.prototype.addAlpha=function(t){var n=(t=i(t,i.EMPTY_OBJECT)).material,r=[];for(var o in n.uniforms)n.uniforms.hasOwnProperty(o)&&e(n.uniforms[o])&&e(n.uniforms[o].alpha)&&r.push(o);return this.add({startObject:{alpha:i(t.startValue,0)},stopObject:{alpha:i(t.stopValue,1)},duration:i(t.duration,3),delay:t.delay,easingFunction:t.easingFunction,update:function(e){for(var t=r.length,i=0;i<t;++i)n.uniforms[r[i]].alpha=e.alpha},complete:t.complete,cancel:t.cancel})},wD.prototype.addOffsetIncrement=function(e){var t=(e=i(e,i.EMPTY_OBJECT)).material.uniforms;return this.addProperty({object:t,property:"offset",startValue:t.offset,stopValue:t.offset+1,duration:e.duration,delay:e.delay,easingFunction:e.easingFunction,update:e.update,cancel:e.cancel,_repeat:1/0})},wD.prototype.remove=function(t){if(!e(t))return!1;var n=this._tweens.indexOf(t);return-1!==n&&(t.tweenjs.stop(),e(t.cancel)&&t.cancel(),this._tweens.splice(n,1),!0)},wD.prototype.removeAll=function(){for(var t=this._tweens,n=0;n<t.length;++n){var r=t[n];r.tweenjs.stop(),e(r.cancel)&&r.cancel()}t.length=0},wD.prototype.contains=function(t){return e(t)&&-1!==this._tweens.indexOf(t)},wD.prototype.get=function(e){return this._tweens[e]},wD.prototype.update=function(t){var n=this._tweens,r=0;for(t=e(t)?t/ro.SECONDS_PER_MILLISECOND:di();r<n.length;){var i=n[r],o=i.tweenjs;i.needsStart?(i.needsStart=!1,o.start(t)):o.update(t)?r++:(o.stop(),n.splice(r,1))}};function DD(t,n,r,i,o,s,u){var l=s[u];e(l)||(l=s[u]={startPosition:new c,endPosition:new c,motion:new c,inertiaEnabled:!0});var h,d=t.getButtonPressTime(n,r),f=t.getButtonReleaseTime(n,r),m=d&&f&&(f.getTime()-d.getTime())/1e3,p=new Date,_=f&&(p.getTime()-f.getTime())/1e3;if(d&&f&&m<.4){var g=function(e,t){if(e<0)return 0;var n=25*(1-t);return Math.exp(-n*e)}(_,i),v=t.getLastMovement(n,r);if(!e(v)||(h=v,c.equalsEpsilon(h.startPosition,h.endPosition,a.EPSILON14))||!l.inertiaEnabled)return;if(l.motion.x=.5*(v.endPosition.x-v.startPosition.x),l.motion.y=.5*(v.endPosition.y-v.startPosition.y),l.startPosition=c.clone(v.startPosition,l.startPosition),l.endPosition=c.multiplyByScalar(l.motion,g,l.endPosition),l.endPosition=c.add(l.startPosition,l.endPosition,l.endPosition),isNaN(l.endPosition.x)||isNaN(l.endPosition.y)||c.distance(l.startPosition,l.endPosition)<.5)return;if(!t.isButtonDown(n,r))o(s,t.getStartMousePosition(n,r),l)}}function ID(t,n){if(e(n)){var r=t[n];e(r)&&(r.inertiaEnabled=!0);var i=t._inertiaDisablers[n];if(e(i))for(var o=i.length,a=0;a<o;++a)e(r=t[i[a]])&&(r.inertiaEnabled=!1)}}var RD=[];function PD(t,n,r,i,o,a){if(e(r)){var s=t._aggregator;Array.isArray(r)||(RD[0]=r,r=RD);for(var u=r.length,c=0;c<u;++c){var l=r[c],h=e(l.eventType)?l.eventType:l,d=l.modifier,f=s.isMoving(h,d)&&s.getMovement(h,d),m=s.getStartMousePosition(h,d);t.enableInputs&&n&&(f?(i(t,m,f),ID(t,a)):o<1&&DD(s,h,d,o,i,t,a))}}}var OD=new Fn,ND=new p,MD=new c,LD=new p,FD=new c,zD=new p,BD=new p,UD=new p,VD=new p,HD=new p,GD=new p,kD=new p,WD=new p,qD=new p,YD=new p,jD=new p,XD=new p,ZD=new p,KD=new p,QD=new p,JD=new p,$D=new p,eI=new p,tI={orientation:new wn};function nI(t,n,r,i,o,s){var u=1;e(s)&&(u=a.clamp(Math.abs(s),.25,1));var l=t.minimumZoomDistance*u,h=t.maximumZoomDistance,d=i*(o-l);d=a.clamp(d,t._minimumZoomRate,t._maximumZoomRate);var f=(r.endPosition.y-r.startPosition.y)/t._scene.canvas.clientHeight,m=d*(f=Math.min(f,t.maximumMovementRatio));if(t.enableCollisionDetection||0===t.minimumZoomDistance||!e(t._globe)){if(m>0&&Math.abs(o-l)<1)return;if(m<0&&Math.abs(o-h)<1)return;o-m<l?m=o-l-1:o-m>h&&(m=o-h)}var _=t._scene,g=_.camera,v=_.mode,y=tI.orientation;if(y.heading=g.heading,y.pitch=g.pitch,y.roll=g.roll,g.frustum instanceof Pr)Math.abs(m)>0&&(g.zoomIn(m),g._adjustOrthographicFrustum());else{var T,E=c.equals(n,t._zoomMouseStart),x=t._zoomingOnVector,C=t._rotatingZoom;if(E||(t._zoomMouseStart=c.clone(n,t._zoomMouseStart),e(t._globe)&&(v===Al.SCENE2D?(T=g.getPickRay(n,OD).origin,T=p.fromElements(T.y,T.z,T.x)):T=mI(t,n,ND)),e(T)?(t._useZoomWorldPosition=!0,t._zoomWorldPosition=p.clone(T,t._zoomWorldPosition)):t._useZoomWorldPosition=!1,x=t._zoomingOnVector=!1,C=t._rotatingZoom=!1,t._zoomingUnderground=t._cameraUnderground),t._useZoomWorldPosition){var S=v===Al.COLUMBUS_VIEW;if(g.positionCartographic.height<2e6&&(C=!0),!E||C){if(v===Al.SCENE2D){var A=t._zoomWorldPosition,w=g.position;if(!p.equals(A,w)&&g.positionCartographic.height<2*t._maxCoord.x){var b=g.position.x,D=p.subtract(A,w,LD);p.normalize(D,D);var I=p.distance(A,w)*m/(.5*g.getMagnitude());g.move(D,.5*I),(g.position.x<0&&b>0||g.position.x>0&&b<0)&&(T=g.getPickRay(n,OD).origin,T=p.fromElements(T.y,T.z,T.x),t._zoomWorldPosition=p.clone(T,t._zoomWorldPosition))}}else if(v===Al.SCENE3D){var R=p.normalize(g.position,HD);if(t._cameraUnderground||t._zoomingUnderground||g.positionCartographic.height<3e3&&Math.abs(p.dot(g.direction,R))<.6)S=!0;else{var P=_.canvas,O=FD;O.x=P.clientWidth/2,O.y=P.clientHeight/2;var N=mI(t,O,zD);if(e(N))if(g.positionCartographic.height<1e6){if(!(p.dot(g.direction,R)>=-.5)){var M=kD;p.clone(g.position,M);var L=t._zoomWorldPosition,F=GD;if(F=p.normalize(L,F),p.dot(F,R)<0)return;var z=QD,B=YD;p.clone(g.direction,B),p.add(M,p.multiplyByScalar(B,1e3,JD),z);var U=jD,V=XD;p.subtract(L,M,U),p.normalize(U,V);var H=p.dot(R,V);if(H>=0)return void(t._zoomMouseStart.x=-1);var G=Math.acos(-H),k=p.magnitude(M),W=p.magnitude(L),q=k-m,Y=p.magnitude(U),j=Math.asin(a.clamp(Y/W*Math.sin(G),-1,1))-Math.asin(a.clamp(q/W*Math.sin(G),-1,1))+G,X=WD;p.normalize(M,X);var Z=qD;Z=p.cross(V,X,Z),Z=p.normalize(Z,Z),p.normalize(p.cross(X,Z,JD),B),p.multiplyByScalar(p.normalize(z,JD),p.magnitude(z)-m,z),p.normalize(M,M),p.multiplyByScalar(M,q,M);var K=ZD;p.multiplyByScalar(p.add(p.multiplyByScalar(X,Math.cos(j)-1,$D),p.multiplyByScalar(B,Math.sin(j),eI),JD),q,K),p.add(M,K,M),p.normalize(z,X),p.normalize(p.cross(X,Z,JD),B);var Q=KD;return p.multiplyByScalar(p.add(p.multiplyByScalar(X,Math.cos(j)-1,$D),p.multiplyByScalar(B,Math.sin(j),eI),JD),p.magnitude(z),Q),p.add(z,Q,z),p.clone(M,g.position),p.normalize(p.subtract(z,M,JD),g.direction),p.clone(g.direction,g.direction),p.cross(g.direction,g.up,g.right),p.cross(g.right,g.direction,g.up),void g.setView(tI)}S=!0}else{var J=p.normalize(N,BD),$=p.normalize(t._zoomWorldPosition,UD),ee=p.dot($,J);if(ee>0&&ee<1){var te=a.acosClamped(ee),ne=p.cross($,J,VD),re=m/(Math.abs(te)>a.toRadians(20)?.75*g.positionCartographic.height:g.positionCartographic.height-m);g.rotate(ne,te*re)}}else S=!0}}t._rotatingZoom=!S}if(!E&&S||x){var ie=wl.wgs84ToWindowCoordinates(_,t._zoomWorldPosition,MD),oe=(v!==Al.COLUMBUS_VIEW&&c.equals(n,t._zoomMouseStart)&&e(ie)?g.getPickRay(ie,OD):g.getPickRay(n,OD)).direction;v!==Al.COLUMBUS_VIEW&&v!==Al.SCENE2D||p.fromElements(oe.y,oe.z,oe.x,oe),g.move(oe,m),t._zoomingOnVector=!0}else g.zoomIn(m);t._cameraUnderground||g.setView(tI)}else g.zoomIn(m)}}var rI=new Fn,iI=new Fn,oI=new p;function aI(e,t,n){var r=e._scene.camera,i=r.getPickRay(n.startPosition,rI).origin,o=r.getPickRay(n.endPosition,iI).origin;i=p.fromElements(i.y,i.z,i.x,i),o=p.fromElements(o.y,o.z,o.x,o);var a=p.subtract(i,o,oI),s=p.magnitude(a);s>0&&(p.normalize(a,a),r.move(a,s))}function sI(t,n,r){e(r.distance)&&(r=r.distance);var i=t._scene.camera;nI(t,n,r,t._zoomFactor,i.getMagnitude())}var uI=new c,cI=new c;function lI(t,n,r){if(e(r.angleAndHeight))!function(e,t,n){var r=e._rotateFactor*e._rotateRateRangeAdjustment;r>e._maximumRotateRate&&(r=e._maximumRotateRate);r<e._minimumRotateRate&&(r=e._minimumRotateRate);var i=e._scene,o=i.camera,a=i.canvas,s=(n.endPosition.x-n.startPosition.x)/a.clientWidth;s=Math.min(s,e.maximumMovementRatio);var u=r*s*Math.PI*4;o.twistRight(u)}(t,0,r.angleAndHeight);else{var i=t._scene,o=i.camera,s=i.canvas,u=s.clientWidth,l=s.clientHeight,h=uI;h.x=2/u*r.startPosition.x-1,h.y=2/l*(l-r.startPosition.y)-1,h=c.normalize(h,h);var d=cI;d.x=2/u*r.endPosition.x-1,d.y=2/l*(l-r.endPosition.y)-1,d=c.normalize(d,d);var f=a.acosClamped(h.x);h.y<0&&(f=a.TWO_PI-f);var m=a.acosClamped(d.x);d.y<0&&(m=a.TWO_PI-m);var p=m-f;o.twistRight(p)}}var hI=new Fn,dI=new p,fI=new p;function mI(t,n,r){var i=t._scene,o=t._globe,a=i.camera;if(e(o)){var s,u=!t._cameraUnderground;i.pickPositionSupported&&(s=i.pickPositionWorldCoordinates(n,dI));var c=a.getPickRay(n,hI),l=o.pickWorldCoordinates(c,i,u,fI);return(e(s)?p.distance(s,a.positionWC):Number.POSITIVE_INFINITY)<(e(l)?p.distance(l,a.positionWC):Number.POSITIVE_INFINITY)?p.clone(s,r):p.clone(l,r)}}var pI=new N;function _I(t){var n=t._ellipsoid,r=t._scene,o=r.camera,a=0;if(r.mode===Al.SCENE3D){var s=n.cartesianToCartographic(o.position,pI);e(s)&&(a=s.height)}else a=o.position.z;var u=i(t._scene.globeHeight,0);return Math.abs(u-a)}var gI=new p;function vI(e,t){var n=t.origin,r=t.direction,i=_I(e),o=p.normalize(n,gI),a=Math.abs(p.dot(o,r));return i*(a=2*Math.max(a,.5))}function yI(e,t,n,r){var i=p.distance(t.origin,n),o=_I(e);return i>a.clamp(5*o,e._minimumUndergroundPickDistance,e._maximumUndergroundPickDistance)&&(i=Math.min(i,o/5),i=Math.max(i,100)),Fn.getPoint(t,i,r)}function TI(t,n,r,i){var o;return e(r)?(o=p.distance(n.origin,r))>t._maximumUndergroundPickDistance&&(o=_I(t)):o=_I(t),Fn.getPoint(n,o,i)}var EI=new c;function xI(e,t){var n=t.endPosition,r=c.subtract(t.endPosition,t.startPosition,EI),i=e._strafeEndMousePosition;c.add(i,r,i),t.endPosition=i,rR(e,t,e._strafeStartPosition),t.endPosition=n}var CI=new Fn,SI=new Fn,AI=new p,wI=new p,bI=new p,DI=new p,II=new mr(p.UNIT_X,0),RI=new c,PI=new c;function OI(t,n,r){if(p.equals(n,t._translateMousePosition)||(t._looking=!1),p.equals(n,t._strafeMousePosition)||(t._strafing=!1),t._looking)kR(t,n,r);else if(t._strafing)xI(t,r);else{var i,o=t._scene.camera,s=t._cameraUnderground,u=c.clone(r.startPosition,RI),l=c.clone(r.endPosition,PI),h=o.getPickRay(u,CI),d=p.clone(p.ZERO,DI),f=p.UNIT_X;if(o.position.z<t._minimumPickingTerrainHeight&&e(i=mI(t,u,AI))&&(d.x=i.x),s||d.x>o.position.z&&e(i)){var m=i;return s&&(m=TI(t,h,i,AI)),c.clone(n,t._strafeMousePosition),c.clone(n,t._strafeEndMousePosition),p.clone(m,t._strafeStartPosition),t._strafing=!0,void rR(t,r,t._strafeStartPosition)}var _=mr.fromPointNormal(d,f,II);h=o.getPickRay(u,CI);var g=zn.rayPlane(h,_,AI),v=o.getPickRay(l,SI),y=zn.rayPlane(v,_,wI);if(!e(g)||!e(y))return t._looking=!0,kR(t,n,r),void c.clone(n,t._translateMousePosition);var T=p.subtract(g,y,bI),E=T.x;T.x=T.y,T.y=T.z,T.z=E;var x=p.magnitude(T);x>a.EPSILON6&&(p.normalize(T,T),o.move(T,x))}}var NI=new c,MI=new Fn,LI=new p,FI=new p,zI=new ye,BI=new ye,UI=new p,VI=new mr(p.UNIT_X,0),HI=new p,GI=new N,kI=new ye,WI=new Nr,qI=new $,YI=new p;function jI(t,n,r){if(e(r.angleAndHeight)&&(r=r.angleAndHeight),c.equals(n,t._tiltCenterMousePosition)||(t._tiltCVOffMap=!1,t._looking=!1),t._looking)kR(t,n,r);else{var i=t._scene.camera;t._tiltCVOffMap||!t.onMap()||Math.abs(i.position.z)>t._minimumPickingTerrainHeight?(t._tiltCVOffMap=!0,function(t,n,r){var i=t._scene,o=i.camera,s=i.canvas,u=NI;u.x=s.clientWidth/2,u.y=s.clientHeight/2;var l,h=o.getPickRay(u,MI),d=p.UNIT_X,f=h.origin,m=h.direction,_=p.dot(d,m);Math.abs(_)>a.EPSILON6&&(l=-p.dot(d,f)/_);if(!e(l)||l<=0)return t._looking=!0,kR(t,n,r),void c.clone(n,t._tiltCenterMousePosition);var g=p.multiplyByScalar(m,l,LI);p.add(f,g,g);var v=i.mapProjection,y=v.ellipsoid;p.fromElements(g.y,g.z,g.x,g);var T=v.unproject(g,GI);y.cartographicToCartesian(T,g);var E=ka.eastNorthUpToFixedFrame(g,y,zI),x=t._globe,C=t._ellipsoid;t._globe=void 0,t._ellipsoid=H.UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;var S=ye.clone(o.transform,kI);o._setTransform(E),hR(t,n,r,p.UNIT_Z),o._setTransform(S),t._globe=x,t._ellipsoid=C;var A=C.maximumRadius;t._rotateFactor=1/A,t._rotateRateRangeAdjustment=A}(t,n,r)):function(t,n,r){var i,o,s=t._scene,u=s.camera,l=t._cameraUnderground,h=p.UNIT_X;if(c.equals(n,t._tiltCenterMousePosition))i=p.clone(t._tiltCenter,LI);else{if(u.position.z<t._minimumPickingTerrainHeight&&(i=mI(t,n,LI)),!e(i)){var d,f=(o=u.getPickRay(n,MI)).origin,m=o.direction,_=p.dot(h,m);if(Math.abs(_)>a.EPSILON6&&(d=-p.dot(h,f)/_),!e(d)||d<=0)return t._looking=!0,kR(t,n,r),void c.clone(n,t._tiltCenterMousePosition);i=p.multiplyByScalar(m,d,LI),p.add(f,i,i)}l&&(e(o)||(o=u.getPickRay(n,MI)),yI(t,o,i,i)),c.clone(n,t._tiltCenterMousePosition),p.clone(i,t._tiltCenter)}var g=s.canvas,v=NI;v.x=g.clientWidth/2,v.y=t._tiltCenterMousePosition.y,o=u.getPickRay(v,MI);var y=p.clone(p.ZERO,UI);y.x=i.x;var T=mr.fromPointNormal(y,h,VI),E=zn.rayPlane(o,T,FI),x=u._projection,C=x.ellipsoid;p.fromElements(i.y,i.z,i.x,i);var S=x.unproject(i,GI);C.cartographicToCartesian(S,i);var A,w=ka.eastNorthUpToFixedFrame(i,C,zI);e(E)?(p.fromElements(E.y,E.z,E.x,E),S=x.unproject(E,GI),C.cartographicToCartesian(S,E),A=ka.eastNorthUpToFixedFrame(E,C,BI)):A=w;var b=t._globe,D=t._ellipsoid;t._globe=void 0,t._ellipsoid=H.UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;var I=p.UNIT_Z,R=ye.clone(u.transform,kI);u._setTransform(w);var P=p.cross(p.UNIT_Z,p.normalize(u.position,HI),HI),O=p.dot(u.right,P);if(hR(t,n,r,I,!1,!0),u._setTransform(A),O<0){var N=r.startPosition.y-r.endPosition.y;(l&&N<0||!l&&N>0)&&(I=void 0);var M=u.constrainedAxis;u.constrainedAxis=void 0,hR(t,n,r,I,!0,!1),u.constrainedAxis=M}else hR(t,n,r,I,!0,!1);if(e(u.constrainedAxis)){var L=p.cross(u.direction,u.constrainedAxis,YI);p.equalsEpsilon(L,p.ZERO,a.EPSILON6)||(p.dot(L,u.right)<0&&p.negate(L,L),p.cross(L,u.direction,u.up),p.cross(u.direction,u.up,u.right),p.normalize(u.up,u.up),p.normalize(u.right,u.right))}u._setTransform(R),t._globe=b,t._ellipsoid=D;var F=D.maximumRadius;t._rotateFactor=1/F,t._rotateRateRangeAdjustment=F;var z=p.clone(u.positionWC,HI);t.enableCollisionDetection&&YR(t);if(!p.equals(u.positionWC,z)){u._setTransform(A),u.worldToCameraCoordinatesPoint(z,z);var B=p.magnitudeSquared(z);p.magnitudeSquared(u.position)>B&&(p.normalize(u.position,u.position),p.multiplyByScalar(u.position,Math.sqrt(B),u.position));var U=p.angleBetween(z,u.position),V=p.cross(z,u.position,z);p.normalize(V,V);var G=Nr.fromAxisAngle(V,U,WI),k=$.fromQuaternion(G,qI);$.multiplyByVector(k,u.direction,u.direction),$.multiplyByVector(k,u.up,u.up),p.cross(u.direction,u.up,u.right),p.cross(u.right,u.direction,u.up),u._setTransform(R)}}(t,n,r)}}var XI=new c,ZI=new Fn,KI=new p;function QI(t,n,r){e(r.distance)&&(r=r.distance);var i,o=t._scene,a=o.camera,s=o.canvas,u=t._cameraUnderground;u?i=n:((i=XI).x=s.clientWidth/2,i.y=s.clientHeight/2);var c,l,h=a.getPickRay(i,ZI),d=h.origin,f=h.direction;if(a.position.z<t._minimumPickingTerrainHeight&&(c=mI(t,i,KI)),e(c)&&(l=p.distance(d,c)),u){var m=vI(t,h);l=e(l)?Math.min(l,m):m}if(!e(l)){var _=p.UNIT_X;l=-p.dot(_,d)/p.dot(_,f)}nI(t,n,r,t._zoomFactor,l)}var JI=new Fn,$I=new mr(p.UNIT_X,0),eR=new p,tR=new p,nR=new p;function rR(t,n,r){var i=t._scene,o=i.camera,a=o.getPickRay(n.endPosition,JI),s=p.clone(o.direction,tR);i.mode===Al.COLUMBUS_VIEW&&p.fromElements(s.z,s.x,s.y,s);var u=mr.fromPointNormal(r,s,$I),c=zn.rayPlane(a,u,eR);e(c)&&(s=p.subtract(r,c,s),i.mode===Al.COLUMBUS_VIEW&&p.fromElements(s.y,s.z,s.x,s),p.add(o.position,s,o.position))}var iR=new p,oR=new N,aR=new p,sR=new H,uR=new p,cR=new p;function lR(t,n,r){var i=t._scene.camera,o=t._cameraUnderground,a=t._ellipsoid;if(ye.equals(i.transform,ye.IDENTITY)){var s,u,l=a.geodeticSurfaceNormal(i.position,uR);if(c.equals(n,t._rotateMousePosition))if(t._looking)kR(t,n,r,l);else if(t._rotating)hR(t,n,r);else if(t._strafing)xI(t,r);else{if(p.magnitude(i.position)<p.magnitude(t._rotateStartPosition))return;s=p.magnitude(t._rotateStartPosition),(u=aR).x=u.y=u.z=s,TR(t,n,r,a=H.fromCartesian3(u,sR))}else{t._looking=!1,t._rotating=!1,t._strafing=!1;var h=a.cartesianToCartographic(i.positionWC,oR).height;if(e(t._globe)&&h<t._minimumPickingTerrainHeight){var d=mI(t,r.startPosition,nR);if(e(d)){var f=!1,m=i.getPickRay(r.startPosition,hI);if(o)f=!0,TI(t,m,d,d);else{var _=a.geodeticSurfaceNormal(d,cR);f=!!(Math.abs(p.dot(m.direction,_))<.05)||p.magnitude(i.position)<p.magnitude(d)}f?(c.clone(n,t._strafeEndMousePosition),p.clone(d,t._strafeStartPosition),t._strafing=!0,rR(t,r,t._strafeStartPosition)):(s=p.magnitude(d),(u=aR).x=u.y=u.z=s,TR(t,n,r,a=H.fromCartesian3(u,sR)),p.clone(d,t._rotateStartPosition))}else t._looking=!0,kR(t,n,r,l)}else e(i.pickEllipsoid(r.startPosition,t._ellipsoid,iR))?(TR(t,n,r,t._ellipsoid),p.clone(iR,t._rotateStartPosition)):h>t._minimumTrackBallHeight?(t._rotating=!0,hR(t,n,r)):(t._looking=!0,kR(t,n,r,l));c.clone(n,t._rotateMousePosition)}}else hR(t,n,r)}function hR(t,n,r,o,a,s){a=i(a,!1),s=i(s,!1);var u=t._scene,c=u.camera,l=u.canvas,h=c.constrainedAxis;e(o)&&(c.constrainedAxis=o);var d=p.magnitude(c.position),f=t._rotateFactor*(d-t._rotateRateRangeAdjustment);f>t._maximumRotateRate&&(f=t._maximumRotateRate),f<t._minimumRotateRate&&(f=t._minimumRotateRate);var m=(r.startPosition.x-r.endPosition.x)/l.clientWidth,_=(r.startPosition.y-r.endPosition.y)/l.clientHeight;m=Math.min(m,t.maximumMovementRatio),_=Math.min(_,t.maximumMovementRatio);var g=f*m*Math.PI*2,v=f*_*Math.PI;a||c.rotateRight(g),s||c.rotateUp(v),c.constrainedAxis=h}var dR=le.clone(le.UNIT_W),fR=le.clone(le.UNIT_W),mR=new p,pR=new p,_R=new p,gR=new p,vR=new c,yR=new c;function TR(t,n,r,i){var o=t._scene.camera,s=c.clone(r.startPosition,vR),u=c.clone(r.endPosition,yR),l=o.pickEllipsoid(s,i,dR),h=o.pickEllipsoid(u,i,fR);if(!e(l)||!e(h))return t._rotating=!0,void hR(t,0,r);if(l=o.worldToCameraCoordinates(l,l),h=o.worldToCameraCoordinates(h,h),e(o.constrainedAxis)){var d=o.constrainedAxis,f=p.mostOrthogonalAxis(d,mR);p.cross(f,d,f),p.normalize(f,f);var m=p.cross(d,f,pR),_=p.magnitude(l),g=p.dot(d,l),v=Math.acos(g/_),y=p.multiplyByScalar(d,g,_R);p.subtract(l,y,y),p.normalize(y,y);var T=p.magnitude(h),E=p.dot(d,h),x=Math.acos(E/T),C=p.multiplyByScalar(d,E,gR);p.subtract(h,C,C),p.normalize(C,C);var S=Math.acos(p.dot(y,f));p.dot(y,m)<0&&(S=a.TWO_PI-S);var A=Math.acos(p.dot(C,f));p.dot(C,m)<0&&(A=a.TWO_PI-A);var w,b=S-A;w=p.equalsEpsilon(d,o.position,a.EPSILON2)?o.right:p.cross(d,o.position,mR);var D,I=p.cross(d,w,mR),R=p.dot(I,p.subtract(l,d,pR)),P=p.dot(I,p.subtract(h,d,pR));D=R>0&&P>0?x-v:R>0&&P<=0?p.dot(o.position,d)>0?-v-x:v+x:v-x,o.rotateRight(b),o.rotateUp(D)}else{p.normalize(l,l),p.normalize(h,h);var O=p.dot(l,h),N=p.cross(l,h,mR);if(O<1&&!p.equalsEpsilon(N,p.ZERO,a.EPSILON14)){var M=Math.acos(O);o.rotate(N,M)}}}var ER=new p,xR=new N;function CR(t,n,r){e(r.distance)&&(r=r.distance);var i,o=t._ellipsoid,a=t._scene,s=a.camera,u=a.canvas,c=t._cameraUnderground;c?i=n:((i=XI).x=u.clientWidth/2,i.y=u.clientHeight/2);var l,h,d=s.getPickRay(i,ZI),f=o.cartesianToCartographic(s.position,xR).height;if(f<t._minimumPickingTerrainHeight&&(l=mI(t,i,KI)),e(l)&&(h=p.distance(d.origin,l)),c){var m=vI(t,d);h=e(h)?Math.min(h,m):m}e(h)||(h=f);var _=p.normalize(s.position,ER);nI(t,n,r,t._zoomFactor,h,p.dot(_,s.direction))}var SR=new c,AR=new Fn,wR=new p,bR=new p,DR=new ye,IR=new ye,RR=new ye,PR=new Nr,OR=new $,NR=new N,MR=new p;function LR(t,n,r){var i=t._scene.camera;if(ye.equals(i.transform,ye.IDENTITY))if(e(r.angleAndHeight)&&(r=r.angleAndHeight),c.equals(n,t._tiltCenterMousePosition)||(t._tiltOnEllipsoid=!1,t._looking=!1),t._looking){var o=t._ellipsoid.geodeticSurfaceNormal(i.position,MR);kR(t,n,r,o)}else{var s=t._ellipsoid.cartesianToCartographic(i.position,NR);t._tiltOnEllipsoid||s.height>t._minimumCollisionTerrainHeight?(t._tiltOnEllipsoid=!0,function(t,n,r){var i=t._ellipsoid,o=t._scene,s=o.camera,u=.25*t.minimumZoomDistance,l=i.cartesianToCartographic(s.positionWC,FR).height;if(l-u-1<a.EPSILON3&&r.endPosition.y-r.startPosition.y<0)return;var h=o.canvas,d=SR;d.x=h.clientWidth/2,d.y=h.clientHeight/2;var f,m=s.getPickRay(d,AR),_=zn.rayEllipsoid(m,i);if(e(_))f=Fn.getPoint(m,_.start,wR);else{if(!(l>t._minimumTrackBallHeight)){t._looking=!0;var g=t._ellipsoid.geodeticSurfaceNormal(s.position,MR);return kR(t,n,r,g),void c.clone(n,t._tiltCenterMousePosition)}var v=zn.grazingAltitudeLocation(m,i);if(!e(v))return;var y=i.cartesianToCartographic(v,NR);y.height=0,f=i.cartographicToCartesian(y,wR)}var T=ka.eastNorthUpToFixedFrame(f,i,DR),E=t._globe,x=t._ellipsoid;t._globe=void 0,t._ellipsoid=H.UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;var C=ye.clone(s.transform,RR);s._setTransform(T),hR(t,0,r,p.UNIT_Z),s._setTransform(C),t._globe=E,t._ellipsoid=x;var S=x.maximumRadius;t._rotateFactor=1/S,t._rotateRateRangeAdjustment=S}(t,n,r)):function(t,n,r){var i,o,s,u=t._ellipsoid,l=t._scene,h=l.camera,d=t._cameraUnderground;if(c.equals(n,t._tiltCenterMousePosition))i=p.clone(t._tiltCenter,wR);else{if(!e(i=mI(t,n,wR))){if(o=h.getPickRay(n,AR),!e(s=zn.rayEllipsoid(o,u))){if(u.cartesianToCartographic(h.position,NR).height<=t._minimumTrackBallHeight){t._looking=!0;var f=t._ellipsoid.geodeticSurfaceNormal(h.position,MR);kR(t,n,r,f),c.clone(n,t._tiltCenterMousePosition)}return}i=Fn.getPoint(o,s.start,wR)}d&&(e(o)||(o=h.getPickRay(n,AR)),yI(t,o,i,i)),c.clone(n,t._tiltCenterMousePosition),p.clone(i,t._tiltCenter)}var m=l.canvas,_=SR;_.x=m.clientWidth/2,_.y=t._tiltCenterMousePosition.y,o=h.getPickRay(_,AR);var g=p.magnitude(i),v=p.fromElements(g,g,g,aR),y=H.fromCartesian3(v,sR);if(!e(s=zn.rayEllipsoid(o,y)))return;var T=p.magnitude(o.origin)>g?s.start:s.stop,E=Fn.getPoint(o,T,bR),x=ka.eastNorthUpToFixedFrame(i,u,DR),C=ka.eastNorthUpToFixedFrame(E,y,IR),S=t._globe,A=t._ellipsoid;t._globe=void 0,t._ellipsoid=H.UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;var w=p.UNIT_Z,b=ye.clone(h.transform,RR);h._setTransform(x);var D=p.cross(E,h.positionWC,YI),I=p.dot(h.rightWC,D);if(hR(t,0,r,w,!1,!0),h._setTransform(C),I<0){var R=r.startPosition.y-r.endPosition.y;(d&&R<0||!d&&R>0)&&(w=void 0);var P=h.constrainedAxis;h.constrainedAxis=void 0,hR(t,0,r,w,!0,!1),h.constrainedAxis=P}else hR(t,0,r,w,!0,!1);if(e(h.constrainedAxis)){var O=p.cross(h.direction,h.constrainedAxis,YI);p.equalsEpsilon(O,p.ZERO,a.EPSILON6)||(p.dot(O,h.right)<0&&p.negate(O,O),p.cross(O,h.direction,h.up),p.cross(h.direction,h.up,h.right),p.normalize(h.up,h.up),p.normalize(h.right,h.right))}h._setTransform(b),t._globe=S,t._ellipsoid=A;var N=A.maximumRadius;t._rotateFactor=1/N,t._rotateRateRangeAdjustment=N;var M=p.clone(h.positionWC,YI);t.enableCollisionDetection&&YR(t);if(!p.equals(h.positionWC,M)){h._setTransform(C),h.worldToCameraCoordinatesPoint(M,M);var L=p.magnitudeSquared(M);p.magnitudeSquared(h.position)>L&&(p.normalize(h.position,h.position),p.multiplyByScalar(h.position,Math.sqrt(L),h.position));var F=p.angleBetween(M,h.position),z=p.cross(M,h.position,M);p.normalize(z,z);var B=Nr.fromAxisAngle(z,F,PR),U=$.fromQuaternion(B,OR);$.multiplyByVector(U,h.direction,h.direction),$.multiplyByVector(U,h.up,h.up),p.cross(h.direction,h.up,h.right),p.cross(h.right,h.direction,h.up),h._setTransform(b)}}(t,n,r)}}var FR=new N;var zR=new c,BR=new c,UR=new Fn,VR=new Fn,HR=new p,GR=new p;function kR(t,n,r,o){var s=t._scene.camera,u=zR;u.x=r.startPosition.x,u.y=0;var c=BR;c.x=r.endPosition.x,c.y=0;var l,h,d=s.getPickRay(u,UR),f=s.getPickRay(c,VR),m=0;s.frustum instanceof Pr?(l=d.origin,h=f.origin,p.add(s.direction,l,l),p.add(s.direction,h,h),p.subtract(l,s.position,l),p.subtract(h,s.position,h),p.normalize(l,l),p.normalize(h,h)):(l=d.direction,h=f.direction);var _=p.dot(l,h);_<1&&(m=Math.acos(_)),m=r.startPosition.x>r.endPosition.x?-m:m;var g=t._horizontalRotationAxis;if(e(o)?s.look(o,-m):e(g)?s.look(g,-m):s.lookLeft(m),u.x=0,u.y=r.startPosition.y,c.x=0,c.y=r.endPosition.y,d=s.getPickRay(u,UR),f=s.getPickRay(c,VR),m=0,s.frustum instanceof Pr?(l=d.origin,h=f.origin,p.add(s.direction,l,l),p.add(s.direction,h,h),p.subtract(l,s.position,l),p.subtract(h,s.position,h),p.normalize(l,l),p.normalize(h,h)):(l=d.direction,h=f.direction),(_=p.dot(l,h))<1&&(m=Math.acos(_)),m=r.startPosition.y>r.endPosition.y?-m:m,e(o=i(o,g))){var v=s.direction,y=p.negate(o,HR),T=p.equalsEpsilon(v,o,a.EPSILON2),E=p.equalsEpsilon(v,y,a.EPSILON2);if(T||E)(T&&m<0||E&&m>0)&&s.look(s.right,-m);else{_=p.dot(v,o);var x=a.acosClamped(_);m>0&&m>x&&(m=x-a.EPSILON4),_=p.dot(v,y),x=a.acosClamped(_),m<0&&-m>x&&(m=-x+a.EPSILON4);var C=p.cross(o,v,GR);s.look(C,m)}}else s.lookUp(m)}var WR=new ye,qR=new N;function YR(t){t._adjustedHeightForTerrain=!0;var n=t._scene,r=n.mode,i=n.globe;if(e(i)&&r!==Al.SCENE2D&&r!==Al.MORPHING){var o,a,s=n.camera,u=i.ellipsoid,c=n.mapProjection;ye.equals(s.transform,ye.IDENTITY)||(o=ye.clone(s.transform,WR),a=p.magnitude(s.position),s._setTransform(ye.IDENTITY));var l=qR;r===Al.SCENE3D?u.cartesianToCartographic(s.position,l):c.unproject(s.position,l);var h=!1;if(l.height<t._minimumCollisionTerrainHeight){var d=t._scene.globeHeight;if(e(d)){var f=d+t.minimumZoomDistance;l.height<f&&(l.height=f,r===Al.SCENE3D?u.cartographicToCartesian(l,s.position):c.project(l,s.position),h=!0)}}e(o)&&(s._setTransform(o),h&&(p.normalize(s.position,s.position),p.negate(s.position,s.direction),p.multiplyByScalar(s.position,Math.max(a,t.minimumZoomDistance),s.position),p.normalize(s.direction,s.direction),p.cross(s.direction,s.up,s.right),p.cross(s.right,s.direction,s.up)))}}bD.prototype.onMap=function(){var e=this._scene,t=e.mode,n=e.camera;return t!==Al.COLUMBUS_VIEW||Math.abs(n.position.x)-this._maxCoord.x<0&&Math.abs(n.position.y)-this._maxCoord.y<0};var jR=new p,XR=new p;function ZR(e,t){this.near=i(e,0),this.far=i(t,0);for(var n=Os.NUMBER_OF_PASSES,r=new Array(n),o=new Array(n),a=0;a<n;++a)r[a]=[],o[a]=0;this.commands=r,this.indices=o}bD.prototype.update=function(){var t=this._scene,n=t.camera,r=t.globe,i=t.mode;ye.equals(n.transform,ye.IDENTITY)?(this._globe=r,this._ellipsoid=e(this._globe)?this._globe.ellipsoid:t.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=H.UNIT_SPHERE),this._cameraUnderground=t.cameraUnderground&&e(this._globe),this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight*t.terrainExaggeration,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight*t.terrainExaggeration,this._minimumTrackBallHeight=this.minimumTrackBallHeight*t.terrainExaggeration;var o=this._ellipsoid.maximumRadius;this._rotateFactor=1/o,this._rotateRateRangeAdjustment=o,this._adjustedHeightForTerrain=!1;var a,s,u=p.clone(n.positionWC,jR),c=p.clone(n.directionWC,XR);(i===Al.SCENE2D?(s=(a=this)._scene.mapMode2D===pS.ROTATE,ye.equals(ye.IDENTITY,a._scene.camera.transform)?(PD(a,a.enableTranslate,a.translateEventTypes,aI,a.inertiaTranslate,"_lastInertiaTranslateMovement"),PD(a,a.enableZoom,a.zoomEventTypes,sI,a.inertiaZoom,"_lastInertiaZoomMovement"),s&&PD(a,a.enableRotate,a.tiltEventTypes,lI,a.inertiaSpin,"_lastInertiaTiltMovement")):(PD(a,a.enableZoom,a.zoomEventTypes,sI,a.inertiaZoom,"_lastInertiaZoomMovement"),s&&PD(a,a.enableRotate,a.translateEventTypes,lI,a.inertiaSpin,"_lastInertiaSpinMovement"))):i===Al.COLUMBUS_VIEW?(this._horizontalRotationAxis=p.UNIT_Z,function(t){var n=t._scene.camera;if(ye.equals(ye.IDENTITY,n.transform)){var r=t._tweens;if(t._aggregator.anyButtonDown&&r.removeAll(),PD(t,t.enableTilt,t.tiltEventTypes,jI,t.inertiaSpin,"_lastInertiaTiltMovement"),PD(t,t.enableTranslate,t.translateEventTypes,OI,t.inertiaTranslate,"_lastInertiaTranslateMovement"),PD(t,t.enableZoom,t.zoomEventTypes,QI,t.inertiaZoom,"_lastInertiaZoomMovement"),PD(t,t.enableLook,t.lookEventTypes,kR),!t._aggregator.anyButtonDown&&!r.contains(t._tween)){var i=n.createCorrectPositionTween(t.bounceAnimationTime);e(i)&&(t._tween=r.add(i))}r.update()}else PD(t,t.enableRotate,t.rotateEventTypes,hR,t.inertiaSpin,"_lastInertiaSpinMovement"),PD(t,t.enableZoom,t.zoomEventTypes,CR,t.inertiaZoom,"_lastInertiaZoomMovement")}(this)):i===Al.SCENE3D&&(this._horizontalRotationAxis=void 0,function(e){PD(e,e.enableRotate,e.rotateEventTypes,lR,e.inertiaSpin,"_lastInertiaSpinMovement"),PD(e,e.enableZoom,e.zoomEventTypes,CR,e.inertiaZoom,"_lastInertiaZoomMovement"),PD(e,e.enableTilt,e.tiltEventTypes,LR,e.inertiaSpin,"_lastInertiaTiltMovement"),PD(e,e.enableLook,e.lookEventTypes,kR)}(this)),this.enableCollisionDetection&&!this._adjustedHeightForTerrain)&&((!p.equals(u,n.positionWC)||!p.equals(c,n.directionWC))&&YR(this));this._aggregator.reset()},bD.prototype.isDestroyed=function(){return!1},bD.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),hi(this)};var KR={RGBA4:Tn.RGBA4,RGB5_A1:Tn.RGB5_A1,RGB565:Tn.RGB565,DEPTH_COMPONENT16:Tn.DEPTH_COMPONENT16,STENCIL_INDEX8:Tn.STENCIL_INDEX8,DEPTH_STENCIL:Tn.DEPTH_STENCIL,validate:function(e){return e===KR.RGBA4||e===KR.RGB5_A1||e===KR.RGB565||e===KR.DEPTH_COMPONENT16||e===KR.STENCIL_INDEX8||e===KR.DEPTH_STENCIL}},QR=Object.freeze(KR);function JR(t){var n=(t=i(t,i.EMPTY_OBJECT)).context._gl;Ds.maximumRenderbufferSize;var r=i(t.format,QR.RGBA4),o=e(t.width)?t.width:n.drawingBufferWidth,a=e(t.height)?t.height:n.drawingBufferHeight;this._gl=n,this._format=r,this._width=o,this._height=a,this._renderbuffer=this._gl.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,this._renderbuffer),n.renderbufferStorage(n.RENDERBUFFER,r,o,a),n.bindRenderbuffer(n.RENDERBUFFER,null)}function $R(){this._colorTexture=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this._framebuffer=void 0,this._packedDepthTexture=void 0,this._packedDepthFramebuffer=void 0,this._renderState=void 0,this._packedDepthCommand=void 0,this._clearCommand=void 0,this._viewport=new Ns,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useHdr=void 0}function eP(e){e._colorTexture=e._colorTexture&&!e._colorTexture.isDestroyed()&&e._colorTexture.destroy(),e._depthStencilTexture=e._depthStencilTexture&&!e._depthStencilTexture.isDestroyed()&&e._depthStencilTexture.destroy(),e._depthStencilRenderbuffer=e._depthStencilRenderbuffer&&!e._depthStencilRenderbuffer.isDestroyed()&&e._depthStencilRenderbuffer.destroy(),e._framebuffer=e._framebuffer&&!e._framebuffer.isDestroyed()&&e._framebuffer.destroy(),e._packedDepthTexture=e._packedDepthTexture&&!e._packedDepthTexture.isDestroyed()&&e._packedDepthTexture.destroy(),e._packedDepthFramebuffer=e._packedDepthFramebuffer&&!e._packedDepthFramebuffer.isDestroyed()&&e._packedDepthFramebuffer.destroy()}function tP(t,n,r,i,o){var a=t._colorTexture;(!e(a)||a.width!==r||a.height!==i||o!==t._useHdr)&&(eP(t),function(e,t,n,r,i){var o=i?t.halfFloatingPointTexture?Yc.HALF_FLOAT:Yc.FLOAT:Yc.UNSIGNED_BYTE;e._colorTexture=new Fh({context:t,width:n,height:r,pixelFormat:Xc.RGBA,pixelDatatype:o,sampler:Lh.NEAREST}),t.depthTexture?e._depthStencilTexture=new Fh({context:t,width:n,height:r,pixelFormat:Xc.DEPTH_STENCIL,pixelDatatype:Yc.UNSIGNED_INT_24_8}):e._depthStencilRenderbuffer=new JR({context:t,width:n,height:r,format:QR.DEPTH_STENCIL}),e._framebuffer=new wh({context:t,colorTextures:[e._colorTexture],depthStencilTexture:e._depthStencilTexture,depthStencilRenderbuffer:e._depthStencilRenderbuffer,destroyAttachments:!1}),e._packedDepthTexture=new Fh({context:t,width:n,height:r,pixelFormat:Xc.RGBA,pixelDatatype:Yc.UNSIGNED_BYTE,sampler:Lh.NEAREST}),e._packedDepthFramebuffer=new wh({context:t,colorTextures:[e._packedDepthTexture],destroyAttachments:!1})}(t,n,r,i,o))}function nP(){this._depthStencilTexture=void 0,this._framebuffer=void 0,this._passState=void 0}function rP(e){e._framebuffer=e._framebuffer&&e._framebuffer.destroy(),e._depthStencilTexture=e._depthStencilTexture&&e._depthStencilTexture.destroy()}function iP(e){var t=new uC(e);t.blendingEnabled=!1,t.scissorTest={enabled:!0,rectangle:new Ns},t.viewport=new Ns,this._context=e,this._fb=void 0,this._passState=t,this._width=0,this._height=0}Object.defineProperties(JR.prototype,{format:{get:function(){return this._format}},width:{get:function(){return this._width}},height:{get:function(){return this._height}}}),JR.prototype._getRenderbuffer=function(){return this._renderbuffer},JR.prototype.isDestroyed=function(){return!1},JR.prototype.destroy=function(){return this._gl.deleteRenderbuffer(this._renderbuffer),hi(this)},Object.defineProperties($R.prototype,{classificationTexture:{get:function(){return this._colorTexture}},classificationFramebuffer:{get:function(){return this._framebuffer}}}),$R.prototype.updateAndClear=function(t,n,r,i){var o=n.width,a=n.height;tP(this,r,o,a,t),function(t,n,r,i,o){t._viewport.width=r,t._viewport.height=i;var a=!Ns.equals(t._viewport,o.viewport),s=a!==t._useScissorTest;t._useScissorTest=a,Ns.equals(t._scissorRectangle,o.viewport)||(t._scissorRectangle=Ns.clone(o.viewport,t._scissorRectangle),s=!0),e(t._renderState)&&Ns.equals(t._viewport,t._renderState.viewport)&&!s||(t._renderState=Us.fromCache({viewport:t._viewport,scissorTest:{enabled:t._useScissorTest,rectangle:t._scissorRectangle}})),e(t._packedDepthCommand)||(t._packedDepthCommand=n.createViewportQuadCommand(jw,{uniformMap:{u_depthTexture:function(){return t._depthStencilTexture}},owner:t})),e(t._clearCommand)||(t._clearCommand=new eC({color:new pn(0,0,0,0),depth:1,stencil:0,owner:t})),t._packedDepthCommand.framebuffer=t._packedDepthFramebuffer,t._packedDepthCommand.renderState=t._renderState,t._clearCommand.framebuffer=t._framebuffer,t._clearCommand.renderState=t._renderState}(this,r,o,a,i),this._useHdr=t},$R.prototype.clearClassification=function(e,t){this._clearCommand.execute(e,t)},$R.prototype.packDepth=function(e,t){return this._packedDepthCommand.execute(e,t),this._packedDepthTexture},$R.prototype.isDestroyed=function(){return!1},$R.prototype.destroy=function(){return eP(this),hi(this)},nP.prototype.update=function(t,n,r){var i=r.width,o=r.height;e(this._framebuffer)&&i===this._depthStencilTexture.width&&o===this._depthStencilTexture.height||(rP(this),function(e,t){var n=t.drawingBufferWidth,r=t.drawingBufferHeight;e._depthStencilTexture=new Fh({context:t,width:n,height:r,pixelFormat:Xc.DEPTH_STENCIL,pixelDatatype:Yc.UNSIGNED_INT_24_8}),e._framebuffer=new wh({context:t,depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1});var i=new uC(t);i.blendingEnabled=!1,i.scissorTest={enabled:!0,rectangle:new Ns},i.viewport=new Ns,e._passState=i}(this,t));var a=this._framebuffer,s=this._passState;return s.framebuffer=a,s.viewport.width=i,s.viewport.height=o,s.scissorTest.rectangle.x=n.x,s.scissorTest.rectangle.y=o-n.y,s.scissorTest.rectangle.width=1,s.scissorTest.rectangle.height=1,s},nP.prototype.isDestroyed=function(){return!1},nP.prototype.destroy=function(){return rP(this),hi(this)},iP.prototype.begin=function(t,n){var r=this._context,i=n.width,o=n.height;return Ns.clone(t,this._passState.scissorTest.rectangle),e(this._fb)&&this._width===i&&this._height===o||(this._width=i,this._height=o,this._fb=this._fb&&this._fb.destroy(),this._fb=new wh({context:r,colorTextures:[new Fh({context:r,width:i,height:o})],depthStencilRenderbuffer:new JR({context:r,width:i,height:o,format:QR.DEPTH_STENCIL})}),this._passState.framebuffer=this._fb),this._passState.viewport.width=i,this._passState.viewport.height=o,this._passState};var oP=new pn;function aP(){this._colorTexture=void 0,this._idTexture=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this._framebuffer=void 0,this._idFramebuffer=void 0,this._idClearColor=new pn(0,0,0,0),this._useHdr=void 0,this._clearCommand=new eC({color:new pn(0,0,0,0),depth:1,owner:this})}function sP(e){e._framebuffer=e._framebuffer&&e._framebuffer.destroy(),e._idFramebuffer=e._idFramebuffer&&e._idFramebuffer.destroy(),e._colorTexture=e._colorTexture&&e._colorTexture.destroy(),e._idTexture=e._idTexture&&e._idTexture.destroy(),e._depthStencilTexture=e._depthStencilTexture&&e._depthStencilTexture.destroy(),e._depthStencilRenderbuffer=e._depthStencilRenderbuffer&&e._depthStencilRenderbuffer.destroy(),e._depthStencilIdTexture=e._depthStencilIdTexture&&e._depthStencilIdTexture.destroy(),e._depthStencilIdRenderbuffer=e._depthStencilIdRenderbuffer&&e._depthStencilIdRenderbuffer.destroy(),e._framebuffer=void 0,e._idFramebuffer=void 0,e._colorTexture=void 0,e._idTexture=void 0,e._depthStencilTexture=void 0,e._depthStencilRenderbuffer=void 0,e._depthStencilIdTexture=void 0,e._depthStencilIdRenderbuffer=void 0}function uP(){this.command=void 0,this.near=void 0,this.far=void 0}function cP(e,t,n){var r,i=e.context;i.depthTexture&&(r=new eb);var o=new uC(i);o.viewport=Ns.clone(n),this.camera=t,this._cameraClone=_S.clone(t),this._cameraStartFired=!1,this._cameraMovedTime=void 0,this.viewport=n,this.passState=o,this.pickFramebuffer=new iP(i),this.pickDepthFramebuffer=new nP,this.sceneFramebuffer=new aP,this.globeDepth=r,this.globeTranslucencyFramebuffer=new $R,this.pickDepths=[],this.debugGlobeDepths=[],this.frustumCommandsList=[],this.debugFrustumStatistics=void 0,this._commandExtents=[]}iP.prototype.end=function(t){for(var n=i(t.width,1),r=i(t.height,1),o=this._context,a=o.readPixels({x:t.x,y:t.y,width:n,height:r,framebuffer:this._fb}),s=Math.max(n,r),u=s*s,c=Math.floor(.5*n),l=Math.floor(.5*r),h=0,d=0,f=0,m=-1,p=0;p<u;++p){if(-c<=h&&h<=c&&-l<=d&&d<=l){var _=4*((l-d)*n+h+c);oP.red=pn.byteToFloat(a[_]),oP.green=pn.byteToFloat(a[_+1]),oP.blue=pn.byteToFloat(a[_+2]),oP.alpha=pn.byteToFloat(a[_+3]);var g=o.getObjectByPickColor(oP);if(e(g))return g}if(h===d||h<0&&-h===d||h>0&&h===1-d){var v=f;f=-m,m=v}h+=f,d+=m}},iP.prototype.isDestroyed=function(){return!1},iP.prototype.destroy=function(){return this._fb=this._fb&&this._fb.destroy(),hi(this)},aP.prototype.update=function(t,n,r){var i=n.width,o=n.height,a=this._colorTexture;if(!e(a)||a.width!==i||a.height!==o||r!==this._useHdr){sP(this),this._useHdr=r;var s=r?t.halfFloatingPointTexture?Yc.HALF_FLOAT:Yc.FLOAT:Yc.UNSIGNED_BYTE;this._colorTexture=new Fh({context:t,width:i,height:o,pixelFormat:Xc.RGBA,pixelDatatype:s,sampler:Lh.NEAREST}),this._idTexture=new Fh({context:t,width:i,height:o,pixelFormat:Xc.RGBA,pixelDatatype:Yc.UNSIGNED_BYTE,sampler:Lh.NEAREST}),t.depthTexture?(this._depthStencilTexture=new Fh({context:t,width:i,height:o,pixelFormat:Xc.DEPTH_STENCIL,pixelDatatype:Yc.UNSIGNED_INT_24_8,sampler:Lh.NEAREST}),this._depthStencilIdTexture=new Fh({context:t,width:i,height:o,pixelFormat:Xc.DEPTH_STENCIL,pixelDatatype:Yc.UNSIGNED_INT_24_8,sampler:Lh.NEAREST})):(this._depthStencilRenderbuffer=new JR({context:t,width:i,height:o,format:QR.DEPTH_STENCIL}),this._depthStencilIdRenderbuffer=new JR({context:t,width:i,height:o,format:QR.DEPTH_STENCIL})),this._framebuffer=new wh({context:t,colorTextures:[this._colorTexture],depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1}),this._idFramebuffer=new wh({context:t,colorTextures:[this._idTexture],depthStencilTexture:this._depthStencilIdTexture,depthStencilRenderbuffer:this._depthStencilIdRenderbuffer,destroyAttachments:!1})}},aP.prototype.clear=function(e,t,n){var r=t.framebuffer;t.framebuffer=this._framebuffer,pn.clone(n,this._clearCommand.color),this._clearCommand.execute(e,t),t.framebuffer=this._idFramebuffer,pn.clone(this._idClearColor,this._clearCommand.color),this._clearCommand.execute(e,t),t.framebuffer=r},aP.prototype.getFramebuffer=function(){return this._framebuffer},aP.prototype.getIdFramebuffer=function(){return this._idFramebuffer},aP.prototype.isDestroyed=function(){return!1},aP.prototype.destroy=function(){return sP(this),hi(this)};var lP=new p,hP=new p;function dP(e,t,n){var r=1/Math.max(1,function(e,t){var n=Math.max(Math.abs(e.x),Math.abs(t.x)),r=Math.max(Math.abs(e.y),Math.abs(t.y)),i=Math.max(Math.abs(e.z),Math.abs(t.z));return Math.max(Math.max(n,r),i)}(e.position,t.position));return p.multiplyByScalar(e.position,r,lP),p.multiplyByScalar(t.position,r,hP),p.equalsEpsilon(lP,hP,n)&&p.equalsEpsilon(e.direction,t.direction,n)&&p.equalsEpsilon(e.up,t.up,n)&&p.equalsEpsilon(e.right,t.right,n)&&ye.equalsEpsilon(e.transform,t.transform,n)&&e.frustum.equalsEpsilon(t.frustum,n)}function fP(t,n,r,i,o){n.debugShowFrustums&&(r.debugOverlappingFrustums=0);for(var a=t.frustumCommandsList,s=a.length,u=0;u<s;++u){var c=a[u],l=c.near;if(!(i>c.far)){if(o<l)break;var h=r.pass,d=c.indices[h]++;if(c.commands[h][d]=r,n.debugShowFrustums&&(r.debugOverlappingFrustums|=1<<u),r.executeInClosestFrustum)break}}if(n.debugShowFrustums){var f=t.debugFrustumStatistics.commandsInFrustums;f[r.debugOverlappingFrustums]=e(f[r.debugOverlappingFrustums])?f[r.debugOverlappingFrustums]+1:1,++t.debugFrustumStatistics.totalCommands}n.updateDerivedCommands(r)}cP.prototype.checkForCameraUpdates=function(e){var t=this.camera,n=this._cameraClone;return dP(t,n,a.EPSILON15)?(this._cameraStartFired&&di()-this._cameraMovedTime>e.cameraEventWaitTime&&(t.moveEnd.raiseEvent(),this._cameraStartFired=!1),!1):(this._cameraStartFired||(t.moveStart.raiseEvent(),this._cameraStartFired=!0),this._cameraMovedTime=di(),_S.clone(t,n),!0)};var mP=new Tr,pP=new J;cP.prototype.createPotentiallyVisibleSet=function(t){var n=t.frameState,r=n.camera,i=r.directionWC,o=r.positionWC,s=t._computeCommandList,u=t._overlayCommandList,c=n.commandList;t.debugShowFrustums&&(this.debugFrustumStatistics={totalCommands:0,commandsInFrustums:{}});for(var l=this.frustumCommandsList,h=l.length,d=Os.NUMBER_OF_PASSES,f=0;f<h;++f)for(var m=0;m<d;++m)l[f].indices[m]=0;s.length=0,u.length=0;for(var p=this._commandExtents,_=p.length,g=0,v=+Number.MAX_VALUE,y=-Number.MAX_VALUE,T=n.shadowState.shadowsEnabled,E=+Number.MAX_VALUE,x=-Number.MAX_VALUE,C=Number.MAX_VALUE,S=n.mode===Al.SCENE3D?n.occluder:void 0,A=n.cullingVolume,w=mP.planes,b=0;b<5;++b)w[b]=A.planes[b];A=mP;for(var D,I,R=c.length,P=0;P<R;++P){var O=c[P],N=O.pass;if(N===Os.COMPUTE)s.push(O);else if(N===Os.OVERLAY)u.push(O);else{var M,L,F=O.boundingVolume;if(e(F)){if(!t.isVisible(O,A,S))continue;var z=F.computePlaneDistances(o,i,pP);M=z.start,L=z.stop,v=Math.min(v,M),y=Math.max(y,L)}else O instanceof eC?(M=r.frustum.near,L=r.frustum.far):(M=r.frustum.near,L=r.frustum.far,v=Math.min(v,M),y=Math.max(y,L));var B=p[g];e(B)||(B=p[g]=new uP),B.command=O,B.near=M,B.far=L,g++}}for(T&&(E=Math.min(Math.max(E,r.frustum.near),r.frustum.far),x=Math.max(Math.min(x,r.frustum.far),E)),T&&(n.shadowState.nearPlane=E,n.shadowState.farPlane=x,n.shadowState.closestObjectSize=C),function(t,n,r,i){var o,s=n.frameState,u=s.camera,c=s.useLogDepth?n.logarithmicDepthFarToNearRatio:n.farToNearRatio,l=n.mode===Al.SCENE2D,h=n.nearToFarDistance2D;i*=1+a.EPSILON2,r=Math.min(Math.max(r,u.frustum.near),u.frustum.far),i=Math.max(Math.min(i,u.frustum.far),r),l?(i=Math.min(i,u.position.z+n.nearToFarDistance2D),r=Math.min(r,i),o=Math.ceil(Math.max(1,i-r)/n.nearToFarDistance2D)):o=Math.ceil(Math.log(i/r)/Math.log(c));var d=t.frustumCommandsList;d.length=o;for(var f=0;f<o;++f){var m,p;l?(m=Math.min(i-h,r+f*h),p=Math.min(i,m+h)):(m=Math.max(r,Math.pow(c,f)*r),p=Math.min(i,c*m));var _=d[f];e(_)?(_.near=m,_.far=p):_=d[f]=new ZR(m,p)}}(this,t,v,y),D=0;D<g;D++)fP(this,t,(I=p[D]).command,I.near,I.far);if(g<_)for(D=g;D<_&&e((I=p[D]).command);D++)I.command=void 0;var U=l.length,V=n.frustumSplits;V.length=U+1;for(var H=0;H<U;++H)V[H]=l[H].near,H===U-1&&(V[H+1]=l[H].far)},cP.prototype.destroy=function(){var e,t;this.pickFramebuffer=this.pickFramebuffer&&this.pickFramebuffer.destroy(),this.pickDepthFramebuffer=this.pickDepthFramebuffer&&this.pickDepthFramebuffer.destroy(),this.sceneFramebuffer=this.sceneFramebuffer&&this.sceneFramebuffer.destroy(),this.globeDepth=this.globeDepth&&this.globeDepth.destroy(),this.globeTranslucencyFramebuffer=this.globeTranslucencyFramebuffer&&this.globeTranslucencyFramebuffer.destroy();var n=this.pickDepths,r=this.debugGlobeDepths;for(t=n.length,e=0;e<t;++e)n[e].destroy();for(t=r.length,e=0;e<t;++e)r[e].destroy()};var _P=function(e){return function(){e.frameState.afterRender.push((function(){e.requestRender()}))}};function gP(t){var n=(t=i(t,i.EMPTY_OBJECT)).canvas,r=t.creditContainer,o=t.creditViewport,a=Oo(t.contextOptions);e(a)||(a={}),e(a.webgl)||(a.webgl={}),a.webgl.powerPreference=i(a.webgl.powerPreference,"high-performance");var s=e(r),u=new PC(n,a);s||((r=document.createElement("div")).style.position="absolute",r.style.bottom="0",r.style["text-shadow"]="0 0 2px #000000",r.style.color="#ffffff",r.style["font-size"]="10px",r.style["padding-right"]="5px",n.parentNode.appendChild(r)),e(o)||(o=n.parentNode),this._id=Tl(),this._jobScheduler=new aD,this._frameState=new qw(u,new xw(r,"  ",o),this._jobScheduler),this._frameState.scene3DOnly=i(t.scene3DOnly,!1),this._removeCreditContainer=!s,this._creditContainer=r,this._canvas=n,this._context=u,this._computeEngine=new rC(u),this._globe=void 0,this._globeTranslucencyState=new Tb,this._primitives=new CD,this._groundPrimitives=new CD,this._globeHeight=void 0,this._cameraUnderground=!1,this._logDepthBuffer=u.fragmentDepth,this._logDepthBufferDirty=!0,this._tweens=new wD,this._shaderFrameCount=0,this._computeCommandList=[],this._overlayCommandList=[],this._useOIT=i(t.orderIndependentTranslucency,!0),this._executeOITFunction=void 0,this._depthPlane=new Cw,this._clearColorCommand=new eC({color:new pn,stencil:0,owner:this}),this._depthClearCommand=new eC({depth:1,owner:this}),this._stencilClearCommand=new eC({stencil:0}),this._classificationStencilClearCommand=new eC({stencil:0,renderState:Us.fromCache({stencilMask:$w.CLASSIFICATION_MASK})}),this._depthOnlyRenderStateCache={},this._preUpdate=new qo,this._postUpdate=new qo,this._renderError=new qo,this._preRender=new qo,this._postRender=new qo,this._minimumDisableDepthTestDistance=0,this.rethrowRenderErrors=!1,this.completeMorphOnUserInput=!0,this.morphStart=new qo,this.morphComplete=new qo,this.skyBox=void 0,this.skyAtmosphere=void 0,this.sun=void 0,this.sunBloom=!0,this._sunBloom=void 0,this.moon=void 0,this.backgroundColor=pn.clone(pn.BLACK),this._mode=Al.SCENE3D,this._mapProjection=e(t.mapProjection)?t.mapProjection:new K,this.morphTime=1,this.farToNearRatio=1e3,this.logarithmicDepthFarToNearRatio=1e9,this.nearToFarDistance2D=175e4,this.debugCommandFilter=void 0,this.debugShowCommands=!1,this.debugShowFrustums=!1,this.debugShowFramesPerSecond=!1,this.debugShowGlobeDepth=!1,this.debugShowDepthFrustum=1,this.debugShowFrustumPlanes=!1,this._debugShowFrustumPlanes=!1,this._debugFrustumPlanes=void 0,this.pickTranslucentDepth=!1,this.cameraEventWaitTime=500,this.fog=new Fw,this._shadowMapCamera=new _S(this),this.invertClassification=!1,this.invertClassificationColor=pn.clone(pn.WHITE),this._actualInvertClassificationColor=pn.clone(this._invertClassificationColor),this._invertClassification=new eD,this._brdfLutGenerator=new UC,this._terrainExaggeration=i(t.terrainExaggeration,1),this._performanceDisplay=void 0,this._debugVolume=void 0,this._screenSpaceCameraController=new bD(this),this._cameraUnderground=!1,this._environmentState={skyBoxCommand:void 0,skyAtmosphereCommand:void 0,sunDrawCommand:void 0,sunComputeCommand:void 0,moonCommand:void 0,isSunVisible:!1,isMoonVisible:!1,isReadyForAtmosphere:!1,isSkyAtmosphereVisible:!1,clearGlobeDepth:!1,useDepthPlane:!1,originalFramebuffer:void 0,useGlobeDepthFramebuffer:!1,separatePrimitiveFramebuffer:!1,useOIT:!1,useInvertClassification:!1,usePostProcess:!1,usePostProcessSelected:!1},this.requestRenderMode=i(t.requestRenderMode,!1),this._renderRequested=!0,this.maximumRenderTimeChange=i(t.maximumRenderTimeChange,0),this._lastRenderTime=void 0,this._frameRateMonitor=void 0,this._removeRequestListenerCallback=na.requestCompletedEvent.addEventListener(_P(this)),this._removeTaskProcessorListenerCallback=Gc.taskCompletedEvent.addEventListener(_P(this)),this._removeGlobeCallbacks=[];var c=new Ns(0,0,u.drawingBufferWidth,u.drawingBufferHeight),l=new _S(this);this._logDepthBuffer&&(l.frustum.near=.1,l.frustum.far=1e10),this.preloadFlightCamera=new _S(this),this.preloadFlightCullingVolume=void 0,this._picking={pickPositionWorldCoordinates:function(){}},this._defaultView=new cP(this,l,c),this._view=this._defaultView,this._hdr=void 0,this._hdrDirty=void 0,this.highDynamicRange=!1,this.gamma=2.2,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this._specularEnvironmentMapAtlas=void 0,EP(this,0,Co.now()),this.updateFrameState(),this.initializeFrame()}function vP(t,n,r){var i=t._context,o=t._view.oit,a=n.derivedCommands;n.pickOnly||(a.depth=Rw.createDepthOnlyDerivedCommand(t,n,i,a.depth)),a.originalCommand=n,t._hdr&&(a.hdr=Rw.createHdrCommand(n,i,a.hdr),a=(n=a.hdr.command).derivedCommands),n.pass===Os.TRANSLUCENT&&e(o)&&o.isSupported()&&(a.oit=o.createDerivedCommands(n,i,a.oit))}Object.defineProperties(gP.prototype,{canvas:{get:function(){return this._canvas}},drawingBufferHeight:{get:function(){return this._context.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._context.drawingBufferWidth}},maximumAliasedLineWidth:{get:function(){return Ds.maximumAliasedLineWidth}},maximumCubeMapSize:{get:function(){return Ds.maximumCubeMapSize}},pickPositionSupported:{get:function(){return this._context.depthTexture}},sampleHeightSupported:{get:function(){return this._context.depthTexture}},clampToHeightSupported:{get:function(){return this._context.depthTexture}},invertClassificationSupported:{get:function(){return this._context.depthTexture}},specularEnvironmentMapsSupported:{get:function(){return sD.isSupported(this._context)}},globe:{get:function(){return this._globe},set:function(t){this._globe=this._globe&&this._globe.destroy(),this._globe=t,function(t,n){for(var r=0;r<t._removeGlobeCallbacks.length;++r)t._removeGlobeCallbacks[r]();t._removeGlobeCallbacks.length=0;var i=[];e(n)&&(i.push(n.imageryLayersUpdatedEvent.addEventListener(_P(t))),i.push(n.terrainProviderChanged.addEventListener(_P(t)))),t._removeGlobeCallbacks=i}(this,t)}},primitives:{get:function(){return this._primitives}},groundPrimitives:{get:function(){return this._groundPrimitives}},camera:{get:function(){return this._view.camera},set:function(e){this._view.camera=e}},view:{get:function(){return this._view},set:function(e){this._view=e}},defaultView:{get:function(){return this._defaultView}},screenSpaceCameraController:{get:function(){return this._screenSpaceCameraController}},mapProjection:{get:function(){return this._mapProjection}},jobScheduler:{get:function(){return this._jobScheduler}},frameState:{get:function(){return this._frameState}},environmentState:{get:function(){return this._environmentState}},tweens:{get:function(){return this._tweens}},imageryLayers:{get:function(){if(e(this.globe))return this.globe.imageryLayers}},terrainProvider:{get:function(){if(e(this.globe))return this.globe.terrainProvider},set:function(t){e(this.globe)&&(this.globe.terrainProvider=t)}},terrainProviderChanged:{get:function(){if(e(this.globe))return this.globe.terrainProviderChanged}},preUpdate:{get:function(){return this._preUpdate}},postUpdate:{get:function(){return this._postUpdate}},renderError:{get:function(){return this._renderError}},preRender:{get:function(){return this._preRender}},postRender:{get:function(){return this._postRender}},lastRenderTime:{get:function(){return this._lastRenderTime}},context:{get:function(){return this._context}},debugFrustumStatistics:{get:function(){return this._view.debugFrustumStatistics}},scene3DOnly:{get:function(){return this._frameState.scene3DOnly}},orderIndependentTranslucency:{get:function(){return this._useOIT}},id:{get:function(){return this._id}},mode:{get:function(){return this._mode},set:function(e){e===Al.SCENE2D?this.morphTo2D(0):e===Al.SCENE3D?this.morphTo3D(0):e===Al.COLUMBUS_VIEW&&this.morphToColumbusView(0),this._mode=e}},frustumCommandsList:{get:function(){return this._view.frustumCommandsList}},numberOfFrustums:{get:function(){return this._view.frustumCommandsList.length}},terrainExaggeration:{get:function(){return this._terrainExaggeration}},imagerySplitPosition:{get:function(){return this._frameState.imagerySplitPosition},set:function(e){this._frameState.imagerySplitPosition=e}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance},set:function(e){this._minimumDisableDepthTestDistance=e}},logarithmicDepthBuffer:{get:function(){return this._logDepthBuffer},set:function(e){e=this._context.fragmentDepth&&e,this._logDepthBuffer!==e&&(this._logDepthBuffer=e,this._logDepthBufferDirty=!0)}},gamma:{get:function(){return this._context.uniformState.gamma},set:function(e){this._context.uniformState.gamma=e}},highDynamicRange:{get:function(){return this._hdr},set:function(e){var t=this._context,n=e&&t.depthTexture&&(t.colorBufferFloat||t.colorBufferHalfFloat);this._hdrDirty=n!==this._hdr,this._hdr=n}},highDynamicRangeSupported:{get:function(){var e=this._context;return e.depthTexture&&(e.colorBufferFloat||e.colorBufferHalfFloat)}},cameraUnderground:{get:function(){return this._cameraUnderground}},pixelRatio:{get:function(){return this._frameState.pixelRatio},set:function(e){this._frameState.pixelRatio=e}},opaqueFrustumNearOffset:{get:function(){return.9999}},globeHeight:{get:function(){return this._globeHeight}}}),gP.prototype.getCompressedTextureFormatSupported=function(e){var t=this.context;return("WEBGL_compressed_texture_s3tc"===e||"s3tc"===e)&&t.s3tc||("WEBGL_compressed_texture_pvrtc"===e||"pvrtc"===e)&&t.pvrtc||("WEBGL_compressed_texture_etc1"===e||"etc1"===e)&&t.etc1},gP.prototype.updateDerivedCommands=function(t){if(e(t.derivedCommands)){var n=this._frameState,r=this._context,i=n.shadowState.lastDirtyTime;t.lastDirtyTime!==i&&(t.lastDirtyTime=i,t.dirty=!0);var o=n.useLogDepth,a=this._hdr,s=t.derivedCommands,u=e(s.logDepth),c=e(s.hdr),l=e(s.originalCommand),h=o&&!u,d=a&&!c,f=!(o&&a||l);t.dirty=t.dirty||h||d||f,t.dirty&&(t.dirty=!1,(u||h)&&(s.logDepth=Rw.createLogDepthCommand(t,r,s.logDepth),vP(this,s.logDepth.command)),(l||f)&&vP(this,t))}};var yP,TP=new Me;function EP(e,t,n){var r=e._frameState;r.frameNumber=t,r.time=Co.clone(n,r.time)}gP.prototype.clearPasses=function(e){e.render=!1,e.pick=!1,e.depth=!1,e.postProcess=!1,e.offscreen=!1},gP.prototype.updateFrameState=function(){var t=this.camera,n=this._frameState;n.commandList.length=0,n.brdfLutGenerator=this._brdfLutGenerator,n.environmentMap=this.skyBox&&this.skyBox._cubeMap,n.mode=this._mode,n.morphTime=this.morphTime,n.mapProjection=this.mapProjection,n.camera=t,n.cullingVolume=t.frustum.computeCullingVolume(t.positionWC,t.directionWC,t.upWC),n.occluder=function(t){var n=t.globe;if(t._mode===Al.SCENE3D&&e(n)&&n.show&&!t._cameraUnderground&&!t._globeTranslucencyState.translucent){var r=n.ellipsoid,i=t.frameState.minimumTerrainHeight;return TP.radius=r.minimumRadius+i,yP=Nx.fromBoundingSphere(TP,t.camera.positionWC,yP)}}(this),n.terrainExaggeration=this._terrainExaggeration,n.minimumTerrainHeight=0,n.minimumDisableDepthTestDistance=this._minimumDisableDepthTestDistance,n.invertClassification=this.invertClassification,n.useLogDepth=this._logDepthBuffer&&!(this.camera.frustum instanceof Pr||this.camera.frustum instanceof Ar),n.light=this.light,n.cameraUnderground=this._cameraUnderground,n.globeTranslucencyState=this._globeTranslucencyState,e(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready?(n.specularEnvironmentMaps=this._specularEnvironmentMapAtlas.texture,n.specularEnvironmentMapsMaximumLOD=this._specularEnvironmentMapAtlas.maximumMipmapLevel):(n.specularEnvironmentMaps=void 0,n.specularEnvironmentMapsMaximumLOD=void 0),n.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,this._actualInvertClassificationColor=pn.clone(this.invertClassificationColor,this._actualInvertClassificationColor),eD.isTranslucencySupported(this._context)||(this._actualInvertClassificationColor.alpha=1),n.invertClassificationColor=this._actualInvertClassificationColor,e(this.globe)?n.maximumScreenSpaceError=this.globe.maximumScreenSpaceError:n.maximumScreenSpaceError=2,this.clearPasses(n.passes),n.tilesetPassState=void 0},gP.prototype.isVisible=function(t,n,r){return e(t)&&(!e(t.boundingVolume)||!t.cull||n.computeVisibility(t.boundingVolume)!==Q.OUTSIDE&&(!e(r)||!t.occlude||!t.boundingVolume.isOccluded(r)))};var xP=new ye(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);function CP(t,n,r,i,o){var a=n._frameState;if(!e(n.debugCommandFilter)||n.debugCommandFilter(t))if(t instanceof eC)t.execute(r,i);else{t.debugShowBoundingVolume&&e(t.boundingVolume)&&function(t,n,r,i){var o,a=n._frameState,s=a.context,u=t.boundingVolume;e(n._debugVolume)&&n._debugVolume.destroy();var c=p.clone(u.center);if(a.mode!==Al.SCENE3D){c=ye.multiplyByPoint(xP,c,c);var l=a.mapProjection,h=l.unproject(c);c=l.ellipsoid.cartographicToCartesian(h)}if(e(u.radius)){var d=u.radius;o=pp.toWireframe(Cx.createGeometry(new Cx({radii:new p(d,d,d),vertexFormat:gg.FLAT_VERTEX_FORMAT}))),n._debugVolume=new zg({geometryInstances:new lp({geometry:o,modelMatrix:ye.fromTranslation(c),attributes:{color:new cp(1,0,0,1)}}),appearance:new gg({flat:!0,translucent:!1}),asynchronous:!1})}else{var f=u.halfAxes;o=pp.toWireframe(cx.createGeometry(cx.fromDimensions({dimensions:new p(2,2,2),vertexFormat:gg.FLAT_VERTEX_FORMAT}))),n._debugVolume=new zg({geometryInstances:new lp({geometry:o,modelMatrix:ye.fromRotationTranslation(f,c,new ye),attributes:{color:new cp(1,0,0,1)}}),appearance:new gg({flat:!0,translucent:!1}),asynchronous:!1})}var m,_=a.commandList,g=a.commandList=[];n._debugVolume.update(a),t=g[0],a.useLogDepth&&(t=Rw.createLogDepthCommand(t,s).command),e(i)&&(m=r.framebuffer,r.framebuffer=i),t.execute(s,r),e(m)&&(r.framebuffer=m),a.commandList=_}(t,n,i,o),a.useLogDepth&&e(t.derivedCommands.logDepth)&&(t=t.derivedCommands.logDepth.command);var s=a.passes;if(!s.pick&&!s.depth&&n._hdr&&e(t.derivedCommands)&&e(t.derivedCommands.hdr)&&(t=t.derivedCommands.hdr.command),s.pick||s.depth){if(s.pick&&!s.depth&&e(t.derivedCommands.picking))return void(t=t.derivedCommands.picking.pickCommand).execute(r,i);if(e(t.derivedCommands.depth))return void(t=t.derivedCommands.depth.depthOnlyCommand).execute(r,i)}a.shadowState.lightShadowsEnabled&&t.receiveShadows&&e(t.derivedCommands.shadows)?t.derivedCommands.shadows.receiveCommand.execute(r,i):t.execute(r,i)}}function SP(t,n,r,i){var o=n._frameState,a=t.derivedCommands;e(a)&&(o.useLogDepth&&e(a.logDepth)&&(t=a.logDepth.command),e((a=t.derivedCommands).picking)?(t=a.picking.pickCommand).execute(r,i):e(a.depth)&&(t=a.depth.depthOnlyCommand).execute(r,i))}function AP(e,t,n){return t.boundingVolume.distanceSquaredTo(n)-e.boundingVolume.distanceSquaredTo(n)}function wP(e,t,n){return e.boundingVolume.distanceSquaredTo(n)-t.boundingVolume.distanceSquaredTo(n)+a.EPSILON12}function bP(t,n,r,i,o){var a=t.context;Ox(i,AP,t.camera.positionWC),e(o)&&n(o.unclassifiedCommand,t,a,r);for(var s=i.length,u=0;u<s;++u)n(i[u],t,a,r)}function DP(t,n,r,i,o){var a=t.context;Ox(i,wP,t.camera.positionWC),e(o)&&n(o.unclassifiedCommand,t,a,r);for(var s=i.length,u=0;u<s;++u)n(i[u],t,a,r)}function IP(t,n){var r=t._view.debugGlobeDepths,i=r[n];return!e(i)&&t.context.depthTexture&&(i=new eb,r[n]=i),i}xP=ye.inverseTransformation(xP,xP);var RP=new Jx,PP=new Yx,OP=new Pr,NP=new Ar;gP.prototype.updateAndExecuteCommands=function(t,n){!function(t,n,r,i){var o=n._environmentState,a=n._view,s=o.renderTranslucentDepthForPick;t||s||(n.frameState.commandList.length=0);s||function(e){var t=e._frameState;e._groundPrimitives.update(t),e._primitives.update(t),e._globe&&e._globe.render(t)}(n);a.createPotentiallyVisibleSet(n),t&&(e(i)&&function(t,n,r){var i=t._context,o=t._environmentState,a=t._view,s=t._frameState.passes.pick;o.originalFramebuffer=n.framebuffer;var u=t._clearColorCommand;pn.clone(r,u.color),u.execute(i,n);var c=o.useGlobeDepthFramebuffer=e(a.globeDepth);c&&(a.globeDepth.update(i,n,a.viewport,t._hdr,o.clearGlobeDepth),a.globeDepth.clear(i,n,r));var l=a.oit,h=o.useOIT=!s&&e(l)&&l.isSupported();h&&(l.update(i,n,a.globeDepth.framebuffer,t._hdr),l.clear(i,n,r),o.useOIT=l.isSupported());c&&(n.framebuffer=a.globeDepth.framebuffer);e(n.framebuffer)&&u.execute(i,n);if(o.useInvertClassification=!s&&e(n.framebuffer)&&t.invertClassification){var d;if(1===t.frameState.invertClassificationColor.alpha&&o.useGlobeDepthFramebuffer&&(d=a.globeDepth.framebuffer),e(d)||i.depthTexture){if(t._invertClassification.previousFramebuffer=d,t._invertClassification.update(i),t._invertClassification.clear(i,n),t.frameState.invertClassificationColor.alpha<1&&h){var f=t._invertClassification.unclassifiedCommand,m=f.derivedCommands;m.oit=l.createDerivedCommands(f,i,m.oit)}}else o.useInvertClassification=!1}t._globeTranslucencyState.translucent&&a.globeTranslucencyFramebuffer.updateAndClear(t._hdr,a.viewport,i,n)}(n,r,i),s||function(t){t.context.uniformState.updatePass(Os.COMPUTE);var n=t._environmentState.sunComputeCommand;e(n)&&n.execute(t._computeEngine);for(var r=t._computeCommandList,i=r.length,o=0;o<i;++o)r[o].execute(t._computeEngine)}(n));!function(t,n){var r,i=t.camera,o=t.context,a=t.frameState,s=o.uniformState;s.updateCamera(i),(r=e(i.frustum.fov)?i.frustum.clone(RP):e(i.frustum.infiniteProjectionMatrix)?i.frustum.clone(PP):e(i.frustum.width)?i.frustum.clone(OP):i.frustum.clone(NP)).near=i.frustum.near,r.far=i.frustum.far,s.updateFrustum(r),s.updatePass(Os.ENVIRONMENT);var u,c=a.passes,l=c.pick,h=t._environmentState,d=t._view,f=h.renderTranslucentDepthForPick;if(!l){var m=h.skyBoxCommand;e(m)&&CP(m,t,o,n),h.isSkyAtmosphereVisible&&CP(h.skyAtmosphereCommand,t,o,n),h.isSunVisible&&h.sunDrawCommand.execute(o,n),h.isMoonVisible&&h.moonCommand.execute(o,n)}h.useOIT?(e(t._executeOITFunction)||(t._executeOITFunction=function(e,t,n,r,i){d.oit.executeCommands(e,t,n,r,i)}),u=t._executeOITFunction):u=c.render?bP:DP;for(var p,_=d.frustumCommandsList,g=_.length,v=h.clearGlobeDepth,y=h.useDepthPlane,T=t._globeTranslucencyState,E=T.translucent,x=t._view.globeTranslucencyFramebuffer,C=h.separatePrimitiveFramebuffer=!1,S=t._depthClearCommand,A=t._stencilClearCommand,w=t._classificationStencilClearCommand,b=t._depthPlane,D=h.usePostProcessSelected,I=i.position.z,R=0;R<g;++R){var P=g-R-1,O=_[P];t.mode===Al.SCENE2D?(i.position.z=I-O.near+1,r.far=Math.max(1,O.far-O.near),r.near=1,s.update(a),s.updateFrustum(r)):(r.near=0!==P?O.near*t.opaqueFrustumNearOffset:O.near,r.far=O.far,s.updateFrustum(r));var N,M=t.debugShowGlobeDepth?IP(t,P):d.globeDepth;C&&(n.framebuffer=M.framebuffer),t.debugShowGlobeDepth&&e(M)&&h.useGlobeDepthFramebuffer&&(M.update(o,n,d.viewport,t._hdr,v),M.clear(o,n,t._clearColorCommand.color),N=n.framebuffer,n.framebuffer=M.framebuffer),S.execute(o,n),o.stencilBuffer&&A.execute(o,n),s.updatePass(Os.GLOBE);var L,F=O.commands[Os.GLOBE],z=O.indices[Os.GLOBE];if(E)T.executeGlobeCommands(O,CP,x,t,n);else for(p=0;p<z;++p)CP(F[p],t,o,n);if(e(M)&&h.useGlobeDepthFramebuffer&&M.executeCopyDepth(o,n),t.debugShowGlobeDepth&&e(M)&&h.useGlobeDepthFramebuffer&&(n.framebuffer=N),!h.renderTranslucentDepthForPick)if(s.updatePass(Os.TERRAIN_CLASSIFICATION),F=O.commands[Os.TERRAIN_CLASSIFICATION],z=O.indices[Os.TERRAIN_CLASSIFICATION],E)T.executeGlobeClassificationCommands(O,CP,x,t,n);else for(p=0;p<z;++p)CP(F[p],t,o,n);if(v&&(S.execute(o,n),y&&b.execute(o,n)),C&&(n.framebuffer=M.primitiveFramebuffer),!h.useInvertClassification||l||h.renderTranslucentDepthForPick){for(s.updatePass(Os.CESIUM_3D_TILE),F=O.commands[Os.CESIUM_3D_TILE],z=O.indices[Os.CESIUM_3D_TILE],p=0;p<z;++p)CP(F[p],t,o,n);if(z>0&&(e(M)&&h.useGlobeDepthFramebuffer&&M.executeUpdateDepth(o,n,v),!h.renderTranslucentDepthForPick))for(s.updatePass(Os.CESIUM_3D_TILE_CLASSIFICATION),F=O.commands[Os.CESIUM_3D_TILE_CLASSIFICATION],z=O.indices[Os.CESIUM_3D_TILE_CLASSIFICATION],p=0;p<z;++p)CP(F[p],t,o,n)}else{t._invertClassification.clear(o,n);var B=n.framebuffer;for(n.framebuffer=t._invertClassification._fbo,s.updatePass(Os.CESIUM_3D_TILE),F=O.commands[Os.CESIUM_3D_TILE],z=O.indices[Os.CESIUM_3D_TILE],p=0;p<z;++p)CP(F[p],t,o,n);for(e(M)&&h.useGlobeDepthFramebuffer&&M.executeUpdateDepth(o,n,v),s.updatePass(Os.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW),F=O.commands[Os.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],z=O.indices[Os.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],p=0;p<z;++p)CP(F[p],t,o,n);for(n.framebuffer=B,t._invertClassification.executeClassified(o,n),1===a.invertClassificationColor.alpha&&t._invertClassification.executeUnclassified(o,n),z>0&&o.stencilBuffer&&w.execute(o,n),s.updatePass(Os.CESIUM_3D_TILE_CLASSIFICATION),F=O.commands[Os.CESIUM_3D_TILE_CLASSIFICATION],z=O.indices[Os.CESIUM_3D_TILE_CLASSIFICATION],p=0;p<z;++p)CP(F[p],t,o,n)}for(z>0&&o.stencilBuffer&&A.execute(o,n),s.updatePass(Os.OPAQUE),F=O.commands[Os.OPAQUE],z=O.indices[Os.OPAQUE],p=0;p<z;++p)CP(F[p],t,o,n);if(0!==P&&t.mode!==Al.SCENE2D&&(r.near=O.near,s.updateFrustum(r)),!l&&h.useInvertClassification&&a.invertClassificationColor.alpha<1&&(L=t._invertClassification),s.updatePass(Os.TRANSLUCENT),(F=O.commands[Os.TRANSLUCENT]).length=O.indices[Os.TRANSLUCENT],u(t,CP,n,F,L),o.depthTexture&&t.useDepthPicking&&(h.useGlobeDepthFramebuffer||f)){var U=f?n.framebuffer.depthStencilTexture:M.framebuffer.depthStencilTexture,V=t._picking.getPickDepth(t,P);V.update(o,U),V.executeCopyDepth(o,n)}if(C&&(n.framebuffer=M.framebuffer),!l&&D){var H=n.framebuffer;if(n.framebuffer=d.sceneFramebuffer.getIdFramebuffer(),r.near=0!==P?O.near*t.opaqueFrustumNearOffset:O.near,r.far=O.far,s.updateFrustum(r),s.updatePass(Os.GLOBE),F=O.commands[Os.GLOBE],z=O.indices[Os.GLOBE],E)T.executeGlobeCommands(O,SP,x,t,n);else for(p=0;p<z;++p)SP(F[p],t,o,n);for(v&&(S.framebuffer=n.framebuffer,S.execute(o,n),S.framebuffer=void 0),v&&y&&b.execute(o,n),s.updatePass(Os.CESIUM_3D_TILE),F=O.commands[Os.CESIUM_3D_TILE],z=O.indices[Os.CESIUM_3D_TILE],p=0;p<z;++p)SP(F[p],t,o,n);for(s.updatePass(Os.OPAQUE),F=O.commands[Os.OPAQUE],z=O.indices[Os.OPAQUE],p=0;p<z;++p)SP(F[p],t,o,n);for(s.updatePass(Os.TRANSLUCENT),F=O.commands[Os.TRANSLUCENT],z=O.indices[Os.TRANSLUCENT],p=0;p<z;++p)SP(F[p],t,o,n);n.framebuffer=H}}}(n,r)}(!0,this,t,n)};var MP=new Tr;function LP(t){t._jobScheduler.resetBudgets();var n=t._frameState;t.primitives.prePassesUpdate(n),e(t.globe)&&t.globe.update(n),n.creditDisplay.update()}function FP(e){var t=e._frameState;e.primitives.postPassesUpdate(t),na.update()}gP.prototype.updateEnvironment=function(){var t=this._frameState,n=this._view,r=this._environmentState,i=t.passes.render,o=this.skyAtmosphere,a=this.globe,s=this._globeTranslucencyState;if(!i||this._mode!==Al.SCENE2D&&n.camera.frustum instanceof Pr||!s.environmentVisible)r.skyAtmosphereCommand=void 0,r.skyBoxCommand=void 0,r.sunDrawCommand=void 0,r.sunComputeCommand=void 0,r.moonCommand=void 0;else{e(o)?(e(a)&&(o.setDynamicAtmosphereColor(a.enableLighting&&a.dynamicAtmosphereLighting,a.dynamicAtmosphereLightingFromSun),r.isReadyForAtmosphere=r.isReadyForAtmosphere||a._surface._tilesToRender.length>0),r.skyAtmosphereCommand=o.update(t,a),e(r.skyAtmosphereCommand)&&this.updateDerivedCommands(r.skyAtmosphereCommand)):r.skyAtmosphereCommand=void 0,r.skyBoxCommand=e(this.skyBox)?this.skyBox.update(t,this._hdr):void 0;var u=e(this.sun)?this.sun.update(t,n.passState,this._hdr):void 0;r.sunDrawCommand=e(u)?u.drawCommand:void 0,r.sunComputeCommand=e(u)?u.computeCommand:void 0,r.moonCommand=e(this.moon)?this.moon.update(t):void 0}var c=r.clearGlobeDepth=e(a)&&a.show&&(!a.depthTestAgainstTerrain||this.mode===Al.SCENE2D);(r.useDepthPlane=c&&this.mode===Al.SCENE3D&&s.useDepthPlane)&&this._depthPlane.update(t),r.renderTranslucentDepthForPick=!1;for(var l=t.mode!==Al.SCENE3D||s.sunVisibleThroughGlobe?void 0:t.occluder,h=t.cullingVolume,d=MP.planes,f=0;f<5;++f)d[f]=h.planes[f];h=MP,r.isSkyAtmosphereVisible=e(r.skyAtmosphereCommand)&&r.isReadyForAtmosphere,r.isSunVisible=this.isVisible(r.sunDrawCommand,h,l),r.isMoonVisible=this.isVisible(r.moonCommand,h,l);var m=this.specularEnvironmentMaps,p=this._specularEnvironmentMapAtlas;!e(m)||e(p)&&p.url===m?!e(m)&&e(p)&&(p.destroy(),this._specularEnvironmentMapAtlas=void 0):(p=p&&p.destroy(),this._specularEnvironmentMapAtlas=new sD(m)),e(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(t)},gP.prototype.resolveFramebuffers=function(e){var t=this._context,n=this._frameState,r=this._environmentState,i=this._view,o=i.globeDepth,a=r.useOIT,s=r.useGlobeDepthFramebuffer,u=r.usePostProcess,c=r.originalFramebuffer,l=i.sceneFramebuffer.getFramebuffer();r.separatePrimitiveFramebuffer&&o.executeMergeColor(t,e),a&&(e.framebuffer=u?l:c,i.oit.execute(t,e)),a||u||!s||(e.framebuffer=c,o.executeCopyColor(t,e));var h=n.useLogDepth;this.debugShowGlobeDepth&&s&&IP(this,this.debugShowDepthFrustum-1).executeDebugGlobeDepth(t,e,h);this.debugShowPickDepth&&s&&this._picking.getPickDepth(this,this.debugShowDepthFrustum-1).executeDebugPickDepth(t,e,h)},gP.prototype.initializeFrame=function(){120==this._shaderFrameCount++&&(this._shaderFrameCount=0,this._context.shaderCache.destroyReleasedShaderPrograms(),this._context.textureCache.destroyReleasedTextures()),this._tweens.update(),this._globeHeight=function(t){var n=t._globe,r=t.camera.positionCartographic;if(e(n)&&n.show&&e(r))return n.getHeight(r)}(this),this._cameraUnderground=function(t){var n=t.camera,r=t._mode,i=t.globe,o=t._screenSpaceCameraController,a=n.positionCartographic;if(!e(a))return!1;if(!o.onMap()&&a.height<0)return!0;if(!e(i)||!i.show||r===Al.SCENE2D||r===Al.MORPHING)return!1;var s=t._globeHeight;return e(s)&&a.height<s}(this),this._globeTranslucencyState.update(this),this._screenSpaceCameraController.update(),e(this._deviceOrientationCameraController)&&this._deviceOrientationCameraController.update(),this.camera.update(this._mode),this.camera._updateCameraChanged()};var zP=new pn;function BP(t){var n=t._frameState,r=t.context,o=r.uniformState,a=t._defaultView;t._view=a,t.updateFrameState(),n.passes.render=!0;var s=i(t.backgroundColor,pn.BLACK);t._hdr&&((s=pn.clone(s,zP)).red=Math.pow(s.red,t.gamma),s.green=Math.pow(s.green,t.gamma),s.blue=Math.pow(s.blue,t.gamma)),n.backgroundColor=s,t.fog.update(n),o.update(n),t._computeCommandList.length=0,t._overlayCommandList.length=0;var u=a.viewport;u.x=0,u.y=0,u.width=r.drawingBufferWidth,u.height=r.drawingBufferHeight;var c=a.passState;c.framebuffer=void 0,c.blendingEnabled=void 0,c.scissorTest=void 0,c.viewport=Ns.clone(u,c.viewport),e(t.globe)&&t.globe.beginFrame(n),t.updateEnvironment(),t.updateAndExecuteCommands(c,s),t.resolveFramebuffers(c),c.framebuffer=void 0,function(e,t){e.context.uniformState.updatePass(Os.OVERLAY);for(var n=e.context,r=e._overlayCommandList,i=r.length,o=0;o<i;++o)r[o].execute(n,t)}(t,c),e(t.globe)&&(t.globe.endFrame(n),t.globe.tilesLoaded||(t._renderRequested=!0)),r.endFrame()}function UP(e,t){try{t(e)}catch(n){if(e._renderError.raiseEvent(e,n),e.rethrowRenderErrors)throw n}}gP.prototype.render=function(t){this._preUpdate.raiseEvent(this,t);var n=this._frameState;n.newFrame=!1,e(t)||(t=Co.now());var r=this._view.checkForCameraUpdates(this),i=!this.requestRenderMode||this._renderRequested||r||this._logDepthBufferDirty||this._hdrDirty||this.mode===Al.MORPHING;if(!i&&e(this.maximumRenderTimeChange)&&e(this._lastRenderTime)){var o=Math.abs(Co.secondsDifference(this._lastRenderTime,t));i=i||o>this.maximumRenderTimeChange}i&&(this._lastRenderTime=Co.clone(t,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1,EP(this,a.incrementWrap(n.frameNumber,15e6,1),t),n.newFrame=!0);UP(this,LP),this._postUpdate.raiseEvent(this,t),i&&(this._preRender.raiseEvent(this,t),n.creditDisplay.beginFrame(),UP(this,BP)),function(t,n){if(t.debugShowFramesPerSecond){if(!e(t._performanceDisplay)){var r=document.createElement("div");r.className="cesium-performanceDisplay-defaultContainer",t._canvas.parentNode.appendChild(r);var i=new xD({container:r});t._performanceDisplay=i,t._performanceContainer=r}t._performanceDisplay.throttled=t.requestRenderMode,t._performanceDisplay.update(n)}else e(t._performanceDisplay)&&(t._performanceDisplay=t._performanceDisplay&&t._performanceDisplay.destroy(),t._performanceContainer.parentNode.removeChild(t._performanceContainer))}(this,i),UP(this,FP),function(e){for(var t=e._frameState.afterRender,n=0,r=t.length;n<r;++n)t[n](),e.requestRender();t.length=0}(this),i&&(this._postRender.raiseEvent(this,t),n.creditDisplay.endFrame())},gP.prototype.forceRender=function(e){this._renderRequested=!0,this.render(e)},gP.prototype.requestRender=function(){this._renderRequested=!0},gP.prototype.clampLineWidth=function(e){return Math.max(Ds.minimumAliasedLineWidth,Math.min(e,Ds.maximumAliasedLineWidth))},gP.prototype.pick=function(e,t,n){return this._picking.pick(this,e,t,n)},gP.prototype.pickPositionWorldCoordinates=function(e,t){return this._picking.pickPositionWorldCoordinates(this,e,t)},gP.prototype.pickPosition=function(e,t){return this._picking.pickPosition(this,e,t)},gP.prototype.drillPick=function(e,t,n,r){return this._picking.drillPick(this,e,t,n,r)},gP.prototype.pickFromRay=function(e,t,n){return this._picking.pickFromRay(this,e,t,n)},gP.prototype.drillPickFromRay=function(e,t,n,r){return this._picking.drillPickFromRay(this,e,t,n,r)},gP.prototype.pickFromRayMostDetailed=function(e,t,n){return this._picking.pickFromRayMostDetailed(this,e,t,n)},gP.prototype.drillPickFromRayMostDetailed=function(e,t,n,r){return this._picking.drillPickFromRayMostDetailed(this,e,t,n,r)},gP.prototype.sampleHeight=function(e,t,n){return this._picking.sampleHeight(this,e,t,n)},gP.prototype.clampToHeight=function(e,t,n,r){return this._picking.clampToHeight(this,e,t,n,r)},gP.prototype.sampleHeightMostDetailed=function(e,t,n){return this._picking.sampleHeightMostDetailed(this,e,t,n)},gP.prototype.clampToHeightMostDetailed=function(e,t,n){return this._picking.clampToHeightMostDetailed(this,e,t,n)},gP.prototype.cartesianToCanvasCoordinates=function(e,t){return wl.wgs84ToWindowCoordinates(this,e,t)},gP.prototype.isDestroyed=function(){return!1},gP.prototype.destroy=function(){this._tweens.removeAll(),this._computeEngine=this._computeEngine&&this._computeEngine.destroy(),this._screenSpaceCameraController=this._screenSpaceCameraController&&this._screenSpaceCameraController.destroy(),this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this._primitives=this._primitives&&this._primitives.destroy(),this._groundPrimitives=this._groundPrimitives&&this._groundPrimitives.destroy(),this._globe=this._globe&&this._globe.destroy(),this.skyBox=this.skyBox&&this.skyBox.destroy(),this.skyAtmosphere=this.skyAtmosphere&&this.skyAtmosphere.destroy(),this._debugSphere=this._debugSphere&&this._debugSphere.destroy(),this.sun=this.sun&&this.sun.destroy(),this._sunPostProcess=this._sunPostProcess&&this._sunPostProcess.destroy(),this._depthPlane=this._depthPlane&&this._depthPlane.destroy(),this._debugFrustumPlanes=this._debugFrustumPlanes&&this._debugFrustumPlanes.destroy(),this._brdfLutGenerator=this._brdfLutGenerator&&this._brdfLutGenerator.destroy(),this._picking=this._picking&&this._picking.destroy(),this._defaultView=this._defaultView&&this._defaultView.destroy(),this._view=void 0,this._removeCreditContainer&&this._canvas.parentNode.removeChild(this._creditContainer),this._context=this._context&&this._context.destroy(),this._frameState.creditDisplay=this._frameState.creditDisplay&&this._frameState.creditDisplay.destroy(),e(this._performanceDisplay)&&(this._performanceDisplay=this._performanceDisplay&&this._performanceDisplay.destroy(),this._performanceContainer.parentNode.removeChild(this._performanceContainer)),this._removeRequestListenerCallback(),this._removeTaskProcessorListenerCallback();for(var t=0;t<this._removeGlobeCallbacks.length;++t)this._removeGlobeCallbacks[t]();return this._removeGlobeCallbacks.length=0,hi(this)};export{fr as $,Dn as A,Yl as B,p as C,Ps as D,H as E,xn as F,ql as G,wn as H,zn as I,Cl as J,dr as K,S as L,ye as M,xl as N,Pr as O,mr as P,Nr as Q,Fn as R,Al as S,wD as T,gP as U,Ac as V,Tn as W,JE as X,il as Y,Ki as Z,fn as _,le as a,hd as a0,fi as a1,Od as b,Ud as c,c as d,N as e,a as f,$ as g,e as h,hi as i,wl as j,ka as k,i as l,ws as m,Cn as n,Uh as o,Me as p,xh as q,Us as r,Eh as s,Ds as t,nc as u,Ch as v,Hu as w,Os as x,pn as y,bs as z};
